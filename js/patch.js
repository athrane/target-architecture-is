(()=>{var r={823:(e,t,i)=>{"use strict";i.r(t);i.d(t,{ARRAY_TYPE:()=>s,EPSILON:()=>r,RANDOM:()=>n,equals:()=>h,setMatrixArrayType:()=>a,toRadian:()=>l});var r=1e-6;var s=typeof Float32Array!=="undefined"?Float32Array:Array;var n=Math.random;function a(e){s=e}var o=Math.PI/180;function l(e){return e*o}function h(e,t){return Math.abs(e-t)<=r*Math.max(1,Math.abs(e),Math.abs(t))}if(!Math.hypot)Math.hypot=function(){var e=0,t=arguments.length;while(t--){e+=arguments[t]*arguments[t]}return Math.sqrt(e)}},522:(e,t,i)=>{"use strict";i.r(t);i.d(t,{LDU:()=>F,add:()=>v,adjoint:()=>g,clone:()=>s,copy:()=>n,create:()=>r,determinant:()=>f,equals:()=>C,exactEquals:()=>T,frob:()=>A,fromRotation:()=>_,fromScaling:()=>E,fromValues:()=>o,identity:()=>a,invert:()=>c,mul:()=>S,multiply:()=>d,multiplyScalar:()=>D,multiplyScalarAndAdd:()=>B,rotate:()=>p,scale:()=>m,set:()=>l,str:()=>b,sub:()=>I,subtract:()=>x,transpose:()=>h});var u=i(823);function r(){var e=new u.ARRAY_TYPE(4);if(u.ARRAY_TYPE!=Float32Array){e[1]=0;e[2]=0}e[0]=1;e[3]=1;return e}function s(e){var t=new u.ARRAY_TYPE(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function n(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function a(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e}function o(e,t,i,r){var s=new u.ARRAY_TYPE(4);s[0]=e;s[1]=t;s[2]=i;s[3]=r;return s}function l(e,t,i,r,s){e[0]=t;e[1]=i;e[2]=r;e[3]=s;return e}function h(e,t){if(e===t){var i=t[1];e[1]=t[2];e[2]=i}else{e[0]=t[0];e[1]=t[2];e[2]=t[1];e[3]=t[3]}return e}function c(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=i*n-s*r;if(!a){return null}a=1/a;e[0]=n*a;e[1]=-r*a;e[2]=-s*a;e[3]=i*a;return e}function g(e,t){var i=t[0];e[0]=t[3];e[1]=-t[1];e[2]=-t[2];e[3]=i;return e}function f(e){return e[0]*e[3]-e[2]*e[1]}function d(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3];var o=i[0],l=i[1],h=i[2],u=i[3];e[0]=r*o+n*l;e[1]=s*o+a*l;e[2]=r*h+n*u;e[3]=s*h+a*u;return e}function p(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3];var o=Math.sin(i);var l=Math.cos(i);e[0]=r*l+n*o;e[1]=s*l+a*o;e[2]=r*-o+n*l;e[3]=s*-o+a*l;return e}function m(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3];var o=i[0],l=i[1];e[0]=r*o;e[1]=s*o;e[2]=n*l;e[3]=a*l;return e}function _(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=r;e[1]=i;e[2]=-i;e[3]=r;return e}function E(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];return e}function b(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function A(e){return Math.hypot(e[0],e[1],e[2],e[3])}function F(e,t,i,r){e[2]=r[2]/r[0];i[0]=r[0];i[1]=r[1];i[3]=r[3]-e[2]*i[1];return[e,t,i]}function v(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function x(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function T(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function C(e,t){var i=e[0],r=e[1],s=e[2],n=e[3];var a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(i-a)<=u.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=u.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-l)<=u.EPSILON*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-h)<=u.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))}function D(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function B(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;return e}var S=d;var I=x},964:(e,t,i)=>{"use strict";i.r(t);i.d(t,{add:()=>F,clone:()=>s,copy:()=>n,create:()=>r,determinant:()=>u,equals:()=>D,exactEquals:()=>C,frob:()=>A,fromRotation:()=>m,fromScaling:()=>_,fromTranslation:()=>E,fromValues:()=>o,identity:()=>a,invert:()=>h,mul:()=>B,multiply:()=>c,multiplyScalar:()=>x,multiplyScalarAndAdd:()=>T,rotate:()=>g,scale:()=>f,set:()=>l,str:()=>b,sub:()=>S,subtract:()=>v,translate:()=>p});var d=i(823);function r(){var e=new d.ARRAY_TYPE(6);if(d.ARRAY_TYPE!=Float32Array){e[1]=0;e[2]=0;e[4]=0;e[5]=0}e[0]=1;e[3]=1;return e}function s(e){var t=new d.ARRAY_TYPE(6);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t}function n(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e}function a(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e}function o(e,t,i,r,s,n){var a=new d.ARRAY_TYPE(6);a[0]=e;a[1]=t;a[2]=i;a[3]=r;a[4]=s;a[5]=n;return a}function l(e,t,i,r,s,n,a){e[0]=t;e[1]=i;e[2]=r;e[3]=s;e[4]=n;e[5]=a;return e}function h(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=t[4],o=t[5];var l=i*n-r*s;if(!l){return null}l=1/l;e[0]=n*l;e[1]=-r*l;e[2]=-s*l;e[3]=i*l;e[4]=(s*o-n*a)*l;e[5]=(r*a-i*o)*l;return e}function u(e){return e[0]*e[3]-e[1]*e[2]}function c(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],l=t[5];var h=i[0],u=i[1],c=i[2],g=i[3],f=i[4],d=i[5];e[0]=r*h+n*u;e[1]=s*h+a*u;e[2]=r*c+n*g;e[3]=s*c+a*g;e[4]=r*f+n*d+o;e[5]=s*f+a*d+l;return e}function g(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],l=t[5];var h=Math.sin(i);var u=Math.cos(i);e[0]=r*u+n*h;e[1]=s*u+a*h;e[2]=r*-h+n*u;e[3]=s*-h+a*u;e[4]=o;e[5]=l;return e}function f(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],l=t[5];var h=i[0],u=i[1];e[0]=r*h;e[1]=s*h;e[2]=n*u;e[3]=a*u;e[4]=o;e[5]=l;return e}function p(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],l=t[5];var h=i[0],u=i[1];e[0]=r;e[1]=s;e[2]=n;e[3]=a;e[4]=r*h+n*u+o;e[5]=s*h+a*u+l;return e}function m(e,t){var i=Math.sin(t),r=Math.cos(t);e[0]=r;e[1]=i;e[2]=-i;e[3]=r;e[4]=0;e[5]=0;return e}function _(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];e[4]=0;e[5]=0;return e}function E(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0];e[5]=t[1];return e}function b(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function A(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function F(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];return e}function v(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];return e}function x(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;return e}function T(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;e[4]=t[4]+i[4]*r;e[5]=t[5]+i[5]*r;return e}function C(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function D(e,t){var i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5];var l=t[0],h=t[1],u=t[2],c=t[3],g=t[4],f=t[5];return Math.abs(i-l)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-h)<=d.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-u)<=d.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-c)<=d.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-g)<=d.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-f)<=d.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))}var B=c;var S=v},409:(e,t,i)=>{"use strict";i.r(t);i.d(t,{add:()=>S,adjoint:()=>g,clone:()=>n,copy:()=>a,create:()=>r,determinant:()=>f,equals:()=>P,exactEquals:()=>O,frob:()=>B,fromMat2d:()=>v,fromMat4:()=>s,fromQuat:()=>x,fromRotation:()=>b,fromScaling:()=>F,fromTranslation:()=>E,fromValues:()=>o,identity:()=>h,invert:()=>c,mul:()=>N,multiply:()=>d,multiplyScalar:()=>M,multiplyScalarAndAdd:()=>R,normalFromMat4:()=>T,projection:()=>C,rotate:()=>m,scale:()=>_,set:()=>l,str:()=>D,sub:()=>y,subtract:()=>I,translate:()=>p,transpose:()=>u});var A=i(823);function r(){var e=new A.ARRAY_TYPE(9);if(A.ARRAY_TYPE!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[5]=0;e[6]=0;e[7]=0}e[0]=1;e[4]=1;e[8]=1;return e}function s(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[4];e[4]=t[5];e[5]=t[6];e[6]=t[8];e[7]=t[9];e[8]=t[10];return e}function n(e){var t=new A.ARRAY_TYPE(9);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function a(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function o(e,t,i,r,s,n,a,o,l){var h=new A.ARRAY_TYPE(9);h[0]=e;h[1]=t;h[2]=i;h[3]=r;h[4]=s;h[5]=n;h[6]=a;h[7]=o;h[8]=l;return h}function l(e,t,i,r,s,n,a,o,l,h){e[0]=t;e[1]=i;e[2]=r;e[3]=s;e[4]=n;e[5]=a;e[6]=o;e[7]=l;e[8]=h;return e}function h(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function u(e,t){if(e===t){var i=t[1],r=t[2],s=t[5];e[1]=t[3];e[2]=t[6];e[3]=i;e[5]=t[7];e[6]=r;e[7]=s}else{e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8]}return e}function c(e,t){var i=t[0],r=t[1],s=t[2];var n=t[3],a=t[4],o=t[5];var l=t[6],h=t[7],u=t[8];var c=u*a-o*h;var g=-u*n+o*l;var f=h*n-a*l;var d=i*c+r*g+s*f;if(!d){return null}d=1/d;e[0]=c*d;e[1]=(-u*r+s*h)*d;e[2]=(o*r-s*a)*d;e[3]=g*d;e[4]=(u*i-s*l)*d;e[5]=(-o*i+s*n)*d;e[6]=f*d;e[7]=(-h*i+r*l)*d;e[8]=(a*i-r*n)*d;return e}function g(e,t){var i=t[0],r=t[1],s=t[2];var n=t[3],a=t[4],o=t[5];var l=t[6],h=t[7],u=t[8];e[0]=a*u-o*h;e[1]=s*h-r*u;e[2]=r*o-s*a;e[3]=o*l-n*u;e[4]=i*u-s*l;e[5]=s*n-i*o;e[6]=n*h-a*l;e[7]=r*l-i*h;e[8]=i*a-r*n;return e}function f(e){var t=e[0],i=e[1],r=e[2];var s=e[3],n=e[4],a=e[5];var o=e[6],l=e[7],h=e[8];return t*(h*n-a*l)+i*(-h*s+a*o)+r*(l*s-n*o)}function d(e,t,i){var r=t[0],s=t[1],n=t[2];var a=t[3],o=t[4],l=t[5];var h=t[6],u=t[7],c=t[8];var g=i[0],f=i[1],d=i[2];var p=i[3],m=i[4],_=i[5];var E=i[6],b=i[7],A=i[8];e[0]=g*r+f*a+d*h;e[1]=g*s+f*o+d*u;e[2]=g*n+f*l+d*c;e[3]=p*r+m*a+_*h;e[4]=p*s+m*o+_*u;e[5]=p*n+m*l+_*c;e[6]=E*r+b*a+A*h;e[7]=E*s+b*o+A*u;e[8]=E*n+b*l+A*c;return e}function p(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],g=i[0],f=i[1];e[0]=r;e[1]=s;e[2]=n;e[3]=a;e[4]=o;e[5]=l;e[6]=g*r+f*a+h;e[7]=g*s+f*o+u;e[8]=g*n+f*l+c;return e}function m(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],g=Math.sin(i),f=Math.cos(i);e[0]=f*r+g*a;e[1]=f*s+g*o;e[2]=f*n+g*l;e[3]=f*a-g*r;e[4]=f*o-g*s;e[5]=f*l-g*n;e[6]=h;e[7]=u;e[8]=c;return e}function _(e,t,i){var r=i[0],s=i[1];e[0]=r*t[0];e[1]=r*t[1];e[2]=r*t[2];e[3]=s*t[3];e[4]=s*t[4];e[5]=s*t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function E(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=t[0];e[7]=t[1];e[8]=1;return e}function b(e,t){var i=Math.sin(t),r=Math.cos(t);e[0]=r;e[1]=i;e[2]=0;e[3]=-i;e[4]=r;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function F(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=t[1];e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function v(e,t){e[0]=t[0];e[1]=t[1];e[2]=0;e[3]=t[2];e[4]=t[3];e[5]=0;e[6]=t[4];e[7]=t[5];e[8]=1;return e}function x(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=i+i;var o=r+r;var l=s+s;var h=i*a;var u=r*a;var c=r*o;var g=s*a;var f=s*o;var d=s*l;var p=n*a;var m=n*o;var _=n*l;e[0]=1-c-d;e[3]=u-_;e[6]=g+m;e[1]=u+_;e[4]=1-h-d;e[7]=f-p;e[2]=g-m;e[5]=f+p;e[8]=1-h-c;return e}function T(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=t[4],o=t[5],l=t[6],h=t[7];var u=t[8],c=t[9],g=t[10],f=t[11];var d=t[12],p=t[13],m=t[14],_=t[15];var E=i*o-r*a;var b=i*l-s*a;var A=i*h-n*a;var F=r*l-s*o;var v=r*h-n*o;var x=s*h-n*l;var T=u*p-c*d;var C=u*m-g*d;var D=u*_-f*d;var B=c*m-g*p;var S=c*_-f*p;var I=g*_-f*m;var M=E*I-b*S+A*B+F*D-v*C+x*T;if(!M){return null}M=1/M;e[0]=(o*I-l*S+h*B)*M;e[1]=(l*D-a*I-h*C)*M;e[2]=(a*S-o*D+h*T)*M;e[3]=(s*S-r*I-n*B)*M;e[4]=(i*I-s*D+n*C)*M;e[5]=(r*D-i*S-n*T)*M;e[6]=(p*x-m*v+_*F)*M;e[7]=(m*A-d*x-_*b)*M;e[8]=(d*v-p*A+_*E)*M;return e}function C(e,t,i){e[0]=2/t;e[1]=0;e[2]=0;e[3]=0;e[4]=-2/i;e[5]=0;e[6]=-1;e[7]=1;e[8]=1;return e}function D(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function B(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function S(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];return e}function I(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];return e}function M(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;return e}function R(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;e[4]=t[4]+i[4]*r;e[5]=t[5]+i[5]*r;e[6]=t[6]+i[6]*r;e[7]=t[7]+i[7]*r;e[8]=t[8]+i[8]*r;return e}function O(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function P(e,t){var i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8];var c=t[0],g=t[1],f=t[2],d=t[3],p=t[4],m=t[5],_=t[6],E=t[7],b=t[8];return Math.abs(i-c)<=A.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-g)<=A.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(s-f)<=A.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(n-d)<=A.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=A.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=A.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-_)<=A.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(h-E)<=A.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(u-b)<=A.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))}var N=d;var y=I},684:(w,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>H,adjoint:()=>h,clone:()=>r,copy:()=>s,create:()=>i,determinant:()=>u,equals:()=>q,exactEquals:()=>X,frob:()=>z,fromQuat:()=>O,fromQuat2:()=>D,fromRotation:()=>A,fromRotationTranslation:()=>C,fromRotationTranslationScale:()=>M,fromRotationTranslationScaleOrigin:()=>R,fromScaling:()=>b,fromTranslation:()=>E,fromValues:()=>n,fromXRotation:()=>F,fromYRotation:()=>v,fromZRotation:()=>T,frustum:()=>P,getRotation:()=>I,getScaling:()=>S,getTranslation:()=>B,identity:()=>x,invert:()=>l,lookAt:()=>V,mul:()=>Z,multiply:()=>c,multiplyScalar:()=>W,multiplyScalarAndAdd:()=>Y,ortho:()=>k,perspective:()=>L,perspectiveFromFieldOfView:()=>U,rotate:()=>d,rotateX:()=>p,rotateY:()=>m,rotateZ:()=>_,scale:()=>f,set:()=>a,str:()=>j,sub:()=>Q,subtract:()=>y,targetTo:()=>G,translate:()=>g,transpose:()=>o});var N=t(823);function i(){var e=new N.ARRAY_TYPE(16);if(N.ARRAY_TYPE!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0}e[0]=1;e[5]=1;e[10]=1;e[15]=1;return e}function r(e){var t=new N.ARRAY_TYPE(16);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}function s(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function n(e,t,i,r,s,n,a,o,l,h,u,c,g,f,d,p){var m=new N.ARRAY_TYPE(16);m[0]=e;m[1]=t;m[2]=i;m[3]=r;m[4]=s;m[5]=n;m[6]=a;m[7]=o;m[8]=l;m[9]=h;m[10]=u;m[11]=c;m[12]=g;m[13]=f;m[14]=d;m[15]=p;return m}function a(e,t,i,r,s,n,a,o,l,h,u,c,g,f,d,p,m){e[0]=t;e[1]=i;e[2]=r;e[3]=s;e[4]=n;e[5]=a;e[6]=o;e[7]=l;e[8]=h;e[9]=u;e[10]=c;e[11]=g;e[12]=f;e[13]=d;e[14]=p;e[15]=m;return e}function x(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function o(e,t){if(e===t){var i=t[1],r=t[2],s=t[3];var n=t[6],a=t[7];var o=t[11];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=i;e[6]=t[9];e[7]=t[13];e[8]=r;e[9]=n;e[11]=t[14];e[12]=s;e[13]=a;e[14]=o}else{e[0]=t[0];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=t[1];e[5]=t[5];e[6]=t[9];e[7]=t[13];e[8]=t[2];e[9]=t[6];e[10]=t[10];e[11]=t[14];e[12]=t[3];e[13]=t[7];e[14]=t[11];e[15]=t[15]}return e}function l(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=t[4],o=t[5],l=t[6],h=t[7];var u=t[8],c=t[9],g=t[10],f=t[11];var d=t[12],p=t[13],m=t[14],_=t[15];var E=i*o-r*a;var b=i*l-s*a;var A=i*h-n*a;var F=r*l-s*o;var v=r*h-n*o;var x=s*h-n*l;var T=u*p-c*d;var C=u*m-g*d;var D=u*_-f*d;var B=c*m-g*p;var S=c*_-f*p;var I=g*_-f*m;var M=E*I-b*S+A*B+F*D-v*C+x*T;if(!M){return null}M=1/M;e[0]=(o*I-l*S+h*B)*M;e[1]=(s*S-r*I-n*B)*M;e[2]=(p*x-m*v+_*F)*M;e[3]=(g*v-c*x-f*F)*M;e[4]=(l*D-a*I-h*C)*M;e[5]=(i*I-s*D+n*C)*M;e[6]=(m*A-d*x-_*b)*M;e[7]=(u*x-g*A+f*b)*M;e[8]=(a*S-o*D+h*T)*M;e[9]=(r*D-i*S-n*T)*M;e[10]=(d*v-p*A+_*E)*M;e[11]=(c*A-u*v-f*E)*M;e[12]=(o*C-a*B-l*T)*M;e[13]=(i*B-r*C+s*T)*M;e[14]=(p*b-d*F-m*E)*M;e[15]=(u*F-c*b+g*E)*M;return e}function h(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=t[4],o=t[5],l=t[6],h=t[7];var u=t[8],c=t[9],g=t[10],f=t[11];var d=t[12],p=t[13],m=t[14],_=t[15];e[0]=o*(g*_-f*m)-c*(l*_-h*m)+p*(l*f-h*g);e[1]=-(r*(g*_-f*m)-c*(s*_-n*m)+p*(s*f-n*g));e[2]=r*(l*_-h*m)-o*(s*_-n*m)+p*(s*h-n*l);e[3]=-(r*(l*f-h*g)-o*(s*f-n*g)+c*(s*h-n*l));e[4]=-(a*(g*_-f*m)-u*(l*_-h*m)+d*(l*f-h*g));e[5]=i*(g*_-f*m)-u*(s*_-n*m)+d*(s*f-n*g);e[6]=-(i*(l*_-h*m)-a*(s*_-n*m)+d*(s*h-n*l));e[7]=i*(l*f-h*g)-a*(s*f-n*g)+u*(s*h-n*l);e[8]=a*(c*_-f*p)-u*(o*_-h*p)+d*(o*f-h*c);e[9]=-(i*(c*_-f*p)-u*(r*_-n*p)+d*(r*f-n*c));e[10]=i*(o*_-h*p)-a*(r*_-n*p)+d*(r*h-n*o);e[11]=-(i*(o*f-h*c)-a*(r*f-n*c)+u*(r*h-n*o));e[12]=-(a*(c*m-g*p)-u*(o*m-l*p)+d*(o*g-l*c));e[13]=i*(c*m-g*p)-u*(r*m-s*p)+d*(r*g-s*c);e[14]=-(i*(o*m-l*p)-a*(r*m-s*p)+d*(r*l-s*o));e[15]=i*(o*g-l*c)-a*(r*g-s*c)+u*(r*l-s*o);return e}function u(e){var t=e[0],i=e[1],r=e[2],s=e[3];var n=e[4],a=e[5],o=e[6],l=e[7];var h=e[8],u=e[9],c=e[10],g=e[11];var f=e[12],d=e[13],p=e[14],m=e[15];var _=t*a-i*n;var E=t*o-r*n;var b=t*l-s*n;var A=i*o-r*a;var F=i*l-s*a;var v=r*l-s*o;var x=h*d-u*f;var T=h*p-c*f;var C=h*m-g*f;var D=u*p-c*d;var B=u*m-g*d;var S=c*m-g*p;return _*S-E*B+b*D+A*C-F*T+v*x}function c(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3];var o=t[4],l=t[5],h=t[6],u=t[7];var c=t[8],g=t[9],f=t[10],d=t[11];var p=t[12],m=t[13],_=t[14],E=t[15];var b=i[0],A=i[1],F=i[2],v=i[3];e[0]=b*r+A*o+F*c+v*p;e[1]=b*s+A*l+F*g+v*m;e[2]=b*n+A*h+F*f+v*_;e[3]=b*a+A*u+F*d+v*E;b=i[4];A=i[5];F=i[6];v=i[7];e[4]=b*r+A*o+F*c+v*p;e[5]=b*s+A*l+F*g+v*m;e[6]=b*n+A*h+F*f+v*_;e[7]=b*a+A*u+F*d+v*E;b=i[8];A=i[9];F=i[10];v=i[11];e[8]=b*r+A*o+F*c+v*p;e[9]=b*s+A*l+F*g+v*m;e[10]=b*n+A*h+F*f+v*_;e[11]=b*a+A*u+F*d+v*E;b=i[12];A=i[13];F=i[14];v=i[15];e[12]=b*r+A*o+F*c+v*p;e[13]=b*s+A*l+F*g+v*m;e[14]=b*n+A*h+F*f+v*_;e[15]=b*a+A*u+F*d+v*E;return e}function g(e,t,i){var r=i[0],s=i[1],n=i[2];var a,o,l,h;var u,c,g,f;var d,p,m,_;if(t===e){e[12]=t[0]*r+t[4]*s+t[8]*n+t[12];e[13]=t[1]*r+t[5]*s+t[9]*n+t[13];e[14]=t[2]*r+t[6]*s+t[10]*n+t[14];e[15]=t[3]*r+t[7]*s+t[11]*n+t[15]}else{a=t[0];o=t[1];l=t[2];h=t[3];u=t[4];c=t[5];g=t[6];f=t[7];d=t[8];p=t[9];m=t[10];_=t[11];e[0]=a;e[1]=o;e[2]=l;e[3]=h;e[4]=u;e[5]=c;e[6]=g;e[7]=f;e[8]=d;e[9]=p;e[10]=m;e[11]=_;e[12]=a*r+u*s+d*n+t[12];e[13]=o*r+c*s+p*n+t[13];e[14]=l*r+g*s+m*n+t[14];e[15]=h*r+f*s+_*n+t[15]}return e}function f(e,t,i){var r=i[0],s=i[1],n=i[2];e[0]=t[0]*r;e[1]=t[1]*r;e[2]=t[2]*r;e[3]=t[3]*r;e[4]=t[4]*s;e[5]=t[5]*s;e[6]=t[6]*s;e[7]=t[7]*s;e[8]=t[8]*n;e[9]=t[9]*n;e[10]=t[10]*n;e[11]=t[11]*n;e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function d(e,t,i,r){var s=r[0],n=r[1],a=r[2];var o=Math.hypot(s,n,a);var l,h,u;var c,g,f,d;var p,m,_,E;var b,A,F,v;var x,T,C;var D,B,S;var I,M,R;if(o<N.EPSILON){return null}o=1/o;s*=o;n*=o;a*=o;l=Math.sin(i);h=Math.cos(i);u=1-h;c=t[0];g=t[1];f=t[2];d=t[3];p=t[4];m=t[5];_=t[6];E=t[7];b=t[8];A=t[9];F=t[10];v=t[11];x=s*s*u+h;T=n*s*u+a*l;C=a*s*u-n*l;D=s*n*u-a*l;B=n*n*u+h;S=a*n*u+s*l;I=s*a*u+n*l;M=n*a*u-s*l;R=a*a*u+h;e[0]=c*x+p*T+b*C;e[1]=g*x+m*T+A*C;e[2]=f*x+_*T+F*C;e[3]=d*x+E*T+v*C;e[4]=c*D+p*B+b*S;e[5]=g*D+m*B+A*S;e[6]=f*D+_*B+F*S;e[7]=d*D+E*B+v*S;e[8]=c*I+p*M+b*R;e[9]=g*I+m*M+A*R;e[10]=f*I+_*M+F*R;e[11]=d*I+E*M+v*R;if(t!==e){e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}return e}function p(e,t,i){var r=Math.sin(i);var s=Math.cos(i);var n=t[4];var a=t[5];var o=t[6];var l=t[7];var h=t[8];var u=t[9];var c=t[10];var g=t[11];if(t!==e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[4]=n*s+h*r;e[5]=a*s+u*r;e[6]=o*s+c*r;e[7]=l*s+g*r;e[8]=h*s-n*r;e[9]=u*s-a*r;e[10]=c*s-o*r;e[11]=g*s-l*r;return e}function m(e,t,i){var r=Math.sin(i);var s=Math.cos(i);var n=t[0];var a=t[1];var o=t[2];var l=t[3];var h=t[8];var u=t[9];var c=t[10];var g=t[11];if(t!==e){e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=n*s-h*r;e[1]=a*s-u*r;e[2]=o*s-c*r;e[3]=l*s-g*r;e[8]=n*r+h*s;e[9]=a*r+u*s;e[10]=o*r+c*s;e[11]=l*r+g*s;return e}function _(e,t,i){var r=Math.sin(i);var s=Math.cos(i);var n=t[0];var a=t[1];var o=t[2];var l=t[3];var h=t[4];var u=t[5];var c=t[6];var g=t[7];if(t!==e){e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=n*s+h*r;e[1]=a*s+u*r;e[2]=o*s+c*r;e[3]=l*s+g*r;e[4]=h*s-n*r;e[5]=u*s-a*r;e[6]=c*s-o*r;e[7]=g*s-l*r;return e}function E(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=t[0];e[13]=t[1];e[14]=t[2];e[15]=1;return e}function b(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=t[1];e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=t[2];e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function A(e,t,i){var r=i[0],s=i[1],n=i[2];var a=Math.hypot(r,s,n);var o,l,h;if(a<N.EPSILON){return null}a=1/a;r*=a;s*=a;n*=a;o=Math.sin(t);l=Math.cos(t);h=1-l;e[0]=r*r*h+l;e[1]=s*r*h+n*o;e[2]=n*r*h-s*o;e[3]=0;e[4]=r*s*h-n*o;e[5]=s*s*h+l;e[6]=n*s*h+r*o;e[7]=0;e[8]=r*n*h+s*o;e[9]=s*n*h-r*o;e[10]=n*n*h+l;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function F(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=r;e[6]=i;e[7]=0;e[8]=0;e[9]=-i;e[10]=r;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function v(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=r;e[1]=0;e[2]=-i;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=i;e[9]=0;e[10]=r;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function T(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=r;e[1]=i;e[2]=0;e[3]=0;e[4]=-i;e[5]=r;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function C(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3];var o=r+r;var l=s+s;var h=n+n;var u=r*o;var c=r*l;var g=r*h;var f=s*l;var d=s*h;var p=n*h;var m=a*o;var _=a*l;var E=a*h;e[0]=1-(f+p);e[1]=c+E;e[2]=g-_;e[3]=0;e[4]=c-E;e[5]=1-(u+p);e[6]=d+m;e[7]=0;e[8]=g+_;e[9]=d-m;e[10]=1-(u+f);e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function D(e,t){var i=new N.ARRAY_TYPE(3);var r=-t[0],s=-t[1],n=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7];var c=r*r+s*s+n*n+a*a;if(c>0){i[0]=(o*a+u*r+l*n-h*s)*2/c;i[1]=(l*a+u*s+h*r-o*n)*2/c;i[2]=(h*a+u*n+o*s-l*r)*2/c}else{i[0]=(o*a+u*r+l*n-h*s)*2;i[1]=(l*a+u*s+h*r-o*n)*2;i[2]=(h*a+u*n+o*s-l*r)*2}C(e,t,i);return e}function B(e,t){e[0]=t[12];e[1]=t[13];e[2]=t[14];return e}function S(e,t){var i=t[0];var r=t[1];var s=t[2];var n=t[4];var a=t[5];var o=t[6];var l=t[8];var h=t[9];var u=t[10];e[0]=Math.hypot(i,r,s);e[1]=Math.hypot(n,a,o);e[2]=Math.hypot(l,h,u);return e}function I(e,t){var i=new N.ARRAY_TYPE(3);S(i,t);var r=1/i[0];var s=1/i[1];var n=1/i[2];var a=t[0]*r;var o=t[1]*s;var l=t[2]*n;var h=t[4]*r;var u=t[5]*s;var c=t[6]*n;var g=t[8]*r;var f=t[9]*s;var d=t[10]*n;var p=a+u+d;var m=0;if(p>0){m=Math.sqrt(p+1)*2;e[3]=.25*m;e[0]=(c-f)/m;e[1]=(g-l)/m;e[2]=(o-h)/m}else if(a>u&&a>d){m=Math.sqrt(1+a-u-d)*2;e[3]=(c-f)/m;e[0]=.25*m;e[1]=(o+h)/m;e[2]=(g+l)/m}else if(u>d){m=Math.sqrt(1+u-a-d)*2;e[3]=(g-l)/m;e[0]=(o+h)/m;e[1]=.25*m;e[2]=(c+f)/m}else{m=Math.sqrt(1+d-a-u)*2;e[3]=(o-h)/m;e[0]=(g+l)/m;e[1]=(c+f)/m;e[2]=.25*m}return e}function M(e,t,i,r){var s=t[0],n=t[1],a=t[2],o=t[3];var l=s+s;var h=n+n;var u=a+a;var c=s*l;var g=s*h;var f=s*u;var d=n*h;var p=n*u;var m=a*u;var _=o*l;var E=o*h;var b=o*u;var A=r[0];var F=r[1];var v=r[2];e[0]=(1-(d+m))*A;e[1]=(g+b)*A;e[2]=(f-E)*A;e[3]=0;e[4]=(g-b)*F;e[5]=(1-(c+m))*F;e[6]=(p+_)*F;e[7]=0;e[8]=(f+E)*v;e[9]=(p-_)*v;e[10]=(1-(c+d))*v;e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function R(e,t,i,r,s){var n=t[0],a=t[1],o=t[2],l=t[3];var h=n+n;var u=a+a;var c=o+o;var g=n*h;var f=n*u;var d=n*c;var p=a*u;var m=a*c;var _=o*c;var E=l*h;var b=l*u;var A=l*c;var F=r[0];var v=r[1];var x=r[2];var T=s[0];var C=s[1];var D=s[2];var B=(1-(p+_))*F;var S=(f+A)*F;var I=(d-b)*F;var M=(f-A)*v;var R=(1-(g+_))*v;var O=(m+E)*v;var P=(d+b)*x;var N=(m-E)*x;var y=(1-(g+p))*x;e[0]=B;e[1]=S;e[2]=I;e[3]=0;e[4]=M;e[5]=R;e[6]=O;e[7]=0;e[8]=P;e[9]=N;e[10]=y;e[11]=0;e[12]=i[0]+T-(B*T+M*C+P*D);e[13]=i[1]+C-(S*T+R*C+N*D);e[14]=i[2]+D-(I*T+O*C+y*D);e[15]=1;return e}function O(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=i+i;var o=r+r;var l=s+s;var h=i*a;var u=r*a;var c=r*o;var g=s*a;var f=s*o;var d=s*l;var p=n*a;var m=n*o;var _=n*l;e[0]=1-c-d;e[1]=u+_;e[2]=g-m;e[3]=0;e[4]=u-_;e[5]=1-h-d;e[6]=f+p;e[7]=0;e[8]=g+m;e[9]=f-p;e[10]=1-h-c;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function P(e,t,i,r,s,n,a){var o=1/(i-t);var l=1/(s-r);var h=1/(n-a);e[0]=n*2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=n*2*l;e[6]=0;e[7]=0;e[8]=(i+t)*o;e[9]=(s+r)*l;e[10]=(a+n)*h;e[11]=-1;e[12]=0;e[13]=0;e[14]=a*n*2*h;e[15]=0;return e}function L(e,t,i,r,s){var n=1/Math.tan(t/2),a;e[0]=n/i;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=n;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=-1;e[12]=0;e[13]=0;e[15]=0;if(s!=null&&s!==Infinity){a=1/(r-s);e[10]=(s+r)*a;e[14]=2*s*r*a}else{e[10]=-1;e[14]=-2*r}return e}function U(e,t,i,r){var s=Math.tan(t.upDegrees*Math.PI/180);var n=Math.tan(t.downDegrees*Math.PI/180);var a=Math.tan(t.leftDegrees*Math.PI/180);var o=Math.tan(t.rightDegrees*Math.PI/180);var l=2/(a+o);var h=2/(s+n);e[0]=l;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=h;e[6]=0;e[7]=0;e[8]=-((a-o)*l*.5);e[9]=(s-n)*h*.5;e[10]=r/(i-r);e[11]=-1;e[12]=0;e[13]=0;e[14]=r*i/(i-r);e[15]=0;return e}function k(e,t,i,r,s,n,a){var o=1/(t-i);var l=1/(r-s);var h=1/(n-a);e[0]=-2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*l;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*h;e[11]=0;e[12]=(t+i)*o;e[13]=(s+r)*l;e[14]=(a+n)*h;e[15]=1;return e}function V(e,t,i,r){var s,n,a,o,l,h,u,c,g,f;var d=t[0];var p=t[1];var m=t[2];var _=r[0];var E=r[1];var b=r[2];var A=i[0];var F=i[1];var v=i[2];if(Math.abs(d-A)<N.EPSILON&&Math.abs(p-F)<N.EPSILON&&Math.abs(m-v)<N.EPSILON){return x(e)}u=d-A;c=p-F;g=m-v;f=1/Math.hypot(u,c,g);u*=f;c*=f;g*=f;s=E*g-b*c;n=b*u-_*g;a=_*c-E*u;f=Math.hypot(s,n,a);if(!f){s=0;n=0;a=0}else{f=1/f;s*=f;n*=f;a*=f}o=c*a-g*n;l=g*s-u*a;h=u*n-c*s;f=Math.hypot(o,l,h);if(!f){o=0;l=0;h=0}else{f=1/f;o*=f;l*=f;h*=f}e[0]=s;e[1]=o;e[2]=u;e[3]=0;e[4]=n;e[5]=l;e[6]=c;e[7]=0;e[8]=a;e[9]=h;e[10]=g;e[11]=0;e[12]=-(s*d+n*p+a*m);e[13]=-(o*d+l*p+h*m);e[14]=-(u*d+c*p+g*m);e[15]=1;return e}function G(e,t,i,r){var s=t[0],n=t[1],a=t[2],o=r[0],l=r[1],h=r[2];var u=s-i[0],c=n-i[1],g=a-i[2];var f=u*u+c*c+g*g;if(f>0){f=1/Math.sqrt(f);u*=f;c*=f;g*=f}var d=l*g-h*c,p=h*u-o*g,m=o*c-l*u;f=d*d+p*p+m*m;if(f>0){f=1/Math.sqrt(f);d*=f;p*=f;m*=f}e[0]=d;e[1]=p;e[2]=m;e[3]=0;e[4]=c*m-g*p;e[5]=g*d-u*m;e[6]=u*p-c*d;e[7]=0;e[8]=u;e[9]=c;e[10]=g;e[11]=0;e[12]=s;e[13]=n;e[14]=a;e[15]=1;return e}function j(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function z(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function H(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];e[9]=t[9]+i[9];e[10]=t[10]+i[10];e[11]=t[11]+i[11];e[12]=t[12]+i[12];e[13]=t[13]+i[13];e[14]=t[14]+i[14];e[15]=t[15]+i[15];return e}function y(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];e[9]=t[9]-i[9];e[10]=t[10]-i[10];e[11]=t[11]-i[11];e[12]=t[12]-i[12];e[13]=t[13]-i[13];e[14]=t[14]-i[14];e[15]=t[15]-i[15];return e}function W(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;e[9]=t[9]*i;e[10]=t[10]*i;e[11]=t[11]*i;e[12]=t[12]*i;e[13]=t[13]*i;e[14]=t[14]*i;e[15]=t[15]*i;return e}function Y(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;e[4]=t[4]+i[4]*r;e[5]=t[5]+i[5]*r;e[6]=t[6]+i[6]*r;e[7]=t[7]+i[7]*r;e[8]=t[8]+i[8]*r;e[9]=t[9]+i[9]*r;e[10]=t[10]+i[10]*r;e[11]=t[11]+i[11]*r;e[12]=t[12]+i[12]*r;e[13]=t[13]+i[13]*r;e[14]=t[14]+i[14]*r;e[15]=t[15]+i[15]*r;return e}function X(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function q(e,t){var i=e[0],r=e[1],s=e[2],n=e[3];var a=e[4],o=e[5],l=e[6],h=e[7];var u=e[8],c=e[9],g=e[10],f=e[11];var d=e[12],p=e[13],m=e[14],_=e[15];var E=t[0],b=t[1],A=t[2],F=t[3];var v=t[4],x=t[5],T=t[6],C=t[7];var D=t[8],B=t[9],S=t[10],I=t[11];var M=t[12],R=t[13],O=t[14],P=t[15];return Math.abs(i-E)<=N.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(r-b)<=N.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(s-A)<=N.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(n-F)<=N.EPSILON*Math.max(1,Math.abs(n),Math.abs(F))&&Math.abs(a-v)<=N.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-x)<=N.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(l-T)<=N.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-C)<=N.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(u-D)<=N.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(c-B)<=N.EPSILON*Math.max(1,Math.abs(c),Math.abs(B))&&Math.abs(g-S)<=N.EPSILON*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(f-I)<=N.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(d-M)<=N.EPSILON*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(p-R)<=N.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-O)<=N.EPSILON*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(_-P)<=N.EPSILON*Math.max(1,Math.abs(_),Math.abs(P))}var Z=c;var Q=y},221:(w,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>M,calculateW:()=>d,clone:()=>D,conjugate:()=>v,copy:()=>S,create:()=>s,dot:()=>O,equals:()=>j,exactEquals:()=>G,exp:()=>p,fromEuler:()=>T,fromMat3:()=>x,fromValues:()=>B,getAngle:()=>h,getAxisAngle:()=>a,identity:()=>n,invert:()=>F,len:()=>k,length:()=>P,lerp:()=>U,ln:()=>m,mul:()=>L,multiply:()=>u,normalize:()=>y,pow:()=>E,random:()=>A,rotateX:()=>c,rotateY:()=>g,rotateZ:()=>f,rotationTo:()=>z,scale:()=>R,set:()=>I,setAxes:()=>W,setAxisAngle:()=>l,slerp:()=>b,sqlerp:()=>H,sqrLen:()=>V,squaredLength:()=>N,str:()=>C});var _=t(823);var i=t(409);var o=t(329);var r=t(796);function s(){var e=new _.ARRAY_TYPE(4);if(_.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0;e[2]=0}e[3]=1;return e}function n(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}function l(e,t,i){i=i*.5;var r=Math.sin(i);e[0]=r*t[0];e[1]=r*t[1];e[2]=r*t[2];e[3]=Math.cos(i);return e}function a(e,t){var i=Math.acos(t[3])*2;var r=Math.sin(i/2);if(r>_.EPSILON){e[0]=t[0]/r;e[1]=t[1]/r;e[2]=t[2]/r}else{e[0]=1;e[1]=0;e[2]=0}return i}function h(e,t){var i=O(e,t);return Math.acos(2*i*i-1)}function u(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3];var o=i[0],l=i[1],h=i[2],u=i[3];e[0]=r*u+a*o+s*h-n*l;e[1]=s*u+a*l+n*o-r*h;e[2]=n*u+a*h+r*l-s*o;e[3]=a*u-r*o-s*l-n*h;return e}function c(e,t,i){i*=.5;var r=t[0],s=t[1],n=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=r*l+a*o;e[1]=s*l+n*o;e[2]=n*l-s*o;e[3]=a*l-r*o;return e}function g(e,t,i){i*=.5;var r=t[0],s=t[1],n=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=r*l-n*o;e[1]=s*l+a*o;e[2]=n*l+r*o;e[3]=a*l-s*o;return e}function f(e,t,i){i*=.5;var r=t[0],s=t[1],n=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=r*l+s*o;e[1]=s*l-r*o;e[2]=n*l+a*o;e[3]=a*l-n*o;return e}function d(e,t){var i=t[0],r=t[1],s=t[2];e[0]=i;e[1]=r;e[2]=s;e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s));return e}function p(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=Math.sqrt(i*i+r*r+s*s);var o=Math.exp(n);var l=a>0?o*Math.sin(a)/a:0;e[0]=i*l;e[1]=r*l;e[2]=s*l;e[3]=o*Math.cos(a);return e}function m(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=Math.sqrt(i*i+r*r+s*s);var o=a>0?Math.atan2(a,n)/a:0;e[0]=i*o;e[1]=r*o;e[2]=s*o;e[3]=.5*Math.log(i*i+r*r+s*s+n*n);return e}function E(e,t,i){m(e,t);R(e,e,i);p(e,e);return e}function b(e,t,i,r){var s=t[0],n=t[1],a=t[2],o=t[3];var l=i[0],h=i[1],u=i[2],c=i[3];var g,f,d,p,m;f=s*l+n*h+a*u+o*c;if(f<0){f=-f;l=-l;h=-h;u=-u;c=-c}if(1-f>_.EPSILON){g=Math.acos(f);d=Math.sin(g);p=Math.sin((1-r)*g)/d;m=Math.sin(r*g)/d}else{p=1-r;m=r}e[0]=p*s+m*l;e[1]=p*n+m*h;e[2]=p*a+m*u;e[3]=p*o+m*c;return e}function A(e){var t=_.RANDOM();var i=_.RANDOM();var r=_.RANDOM();var s=Math.sqrt(1-t);var n=Math.sqrt(t);e[0]=s*Math.sin(2*Math.PI*i);e[1]=s*Math.cos(2*Math.PI*i);e[2]=n*Math.sin(2*Math.PI*r);e[3]=n*Math.cos(2*Math.PI*r);return e}function F(e,t){var i=t[0],r=t[1],s=t[2],n=t[3];var a=i*i+r*r+s*s+n*n;var o=a?1/a:0;e[0]=-i*o;e[1]=-r*o;e[2]=-s*o;e[3]=n*o;return e}function v(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];return e}function x(e,t){var i=t[0]+t[4]+t[8];var r;if(i>0){r=Math.sqrt(i+1);e[3]=.5*r;r=.5/r;e[0]=(t[5]-t[7])*r;e[1]=(t[6]-t[2])*r;e[2]=(t[1]-t[3])*r}else{var s=0;if(t[4]>t[0])s=1;if(t[8]>t[s*3+s])s=2;var n=(s+1)%3;var a=(s+2)%3;r=Math.sqrt(t[s*3+s]-t[n*3+n]-t[a*3+a]+1);e[s]=.5*r;r=.5/r;e[3]=(t[n*3+a]-t[a*3+n])*r;e[n]=(t[n*3+s]+t[s*3+n])*r;e[a]=(t[a*3+s]+t[s*3+a])*r}return e}function T(e,t,i,r){var s=.5*Math.PI/180;t*=s;i*=s;r*=s;var n=Math.sin(t);var a=Math.cos(t);var o=Math.sin(i);var l=Math.cos(i);var h=Math.sin(r);var u=Math.cos(r);e[0]=n*l*u-a*o*h;e[1]=a*o*u+n*l*h;e[2]=a*l*h-n*o*u;e[3]=a*l*u+n*o*h;return e}function C(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var D=r.clone;var B=r.fromValues;var S=r.copy;var I=r.set;var M=r.add;var L=u;var R=r.scale;var O=r.dot;var U=r.lerp;var P=r.length;var k=P;var N=r.squaredLength;var V=N;var y=r.normalize;var G=r.exactEquals;var j=r.equals;var z=function(){var s=o.create();var n=o.fromValues(1,0,0);var a=o.fromValues(0,1,0);return function(e,t,i){var r=o.dot(t,i);if(r<-.999999){o.cross(s,n,t);if(o.len(s)<1e-6)o.cross(s,a,t);o.normalize(s,s);l(e,s,Math.PI);return e}else if(r>.999999){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}else{o.cross(s,t,i);e[0]=s[0];e[1]=s[1];e[2]=s[2];e[3]=1+r;return y(e,e)}}}();var H=function(){var a=s();var o=s();return function(e,t,i,r,s,n){b(a,t,s,n);b(o,i,r,n);b(e,a,o,2*n*(1-n));return e}}();var W=function(){var s=i.create();return function(e,t,i,r){s[0]=i[0];s[3]=i[1];s[6]=i[2];s[1]=r[0];s[4]=r[1];s[7]=r[2];s[2]=-t[0];s[5]=-t[1];s[8]=-t[2];return y(e,x(e,s))}}()},991:(w,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>S,clone:()=>r,conjugate:()=>U,copy:()=>b,create:()=>i,dot:()=>O,equals:()=>H,exactEquals:()=>z,fromMat4:()=>u,fromRotation:()=>h,fromRotationTranslation:()=>o,fromRotationTranslationValues:()=>a,fromTranslation:()=>l,fromValues:()=>n,getDual:()=>d,getReal:()=>f,getTranslation:()=>A,identity:()=>c,invert:()=>L,len:()=>k,length:()=>N,lerp:()=>P,mul:()=>M,multiply:()=>I,normalize:()=>G,rotateAroundAxis:()=>B,rotateByQuatAppend:()=>C,rotateByQuatPrepend:()=>D,rotateX:()=>v,rotateY:()=>x,rotateZ:()=>T,scale:()=>R,set:()=>g,setDual:()=>_,setReal:()=>m,sqrLen:()=>V,squaredLength:()=>y,str:()=>j,translate:()=>F});var E=t(823);var p=t(221);var s=t(684);function i(){var e=new E.ARRAY_TYPE(8);if(E.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[4]=0;e[5]=0;e[6]=0;e[7]=0}e[3]=1;return e}function r(e){var t=new E.ARRAY_TYPE(8);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];return t}function n(e,t,i,r,s,n,a,o){var l=new E.ARRAY_TYPE(8);l[0]=e;l[1]=t;l[2]=i;l[3]=r;l[4]=s;l[5]=n;l[6]=a;l[7]=o;return l}function a(e,t,i,r,s,n,a){var o=new E.ARRAY_TYPE(8);o[0]=e;o[1]=t;o[2]=i;o[3]=r;var l=s*.5,h=n*.5,u=a*.5;o[4]=l*r+h*i-u*t;o[5]=h*r+u*e-l*i;o[6]=u*r+l*t-h*e;o[7]=-l*e-h*t-u*i;return o}function o(e,t,i){var r=i[0]*.5,s=i[1]*.5,n=i[2]*.5,a=t[0],o=t[1],l=t[2],h=t[3];e[0]=a;e[1]=o;e[2]=l;e[3]=h;e[4]=r*h+s*l-n*o;e[5]=s*h+n*a-r*l;e[6]=n*h+r*o-s*a;e[7]=-r*a-s*o-n*l;return e}function l(e,t){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0]*.5;e[5]=t[1]*.5;e[6]=t[2]*.5;e[7]=0;return e}function h(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function u(e,t){var i=p.create();s.getRotation(i,t);var r=new E.ARRAY_TYPE(3);s.getTranslation(r,t);o(e,i,r);return e}function b(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];return e}function c(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function g(e,t,i,r,s,n,a,o,l){e[0]=t;e[1]=i;e[2]=r;e[3]=s;e[4]=n;e[5]=a;e[6]=o;e[7]=l;return e}var f=p.copy;function d(e,t){e[0]=t[4];e[1]=t[5];e[2]=t[6];e[3]=t[7];return e}var m=p.copy;function _(e,t){e[4]=t[0];e[5]=t[1];e[6]=t[2];e[7]=t[3];return e}function A(e,t){var i=t[4],r=t[5],s=t[6],n=t[7],a=-t[0],o=-t[1],l=-t[2],h=t[3];e[0]=(i*h+n*a+r*l-s*o)*2;e[1]=(r*h+n*o+s*a-i*l)*2;e[2]=(s*h+n*l+i*o-r*a)*2;return e}function F(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3],o=i[0]*.5,l=i[1]*.5,h=i[2]*.5,u=t[4],c=t[5],g=t[6],f=t[7];e[0]=r;e[1]=s;e[2]=n;e[3]=a;e[4]=a*o+s*h-n*l+u;e[5]=a*l+n*o-r*h+c;e[6]=a*h+r*l-s*o+g;e[7]=-r*o-s*l-n*h+f;return e}function v(e,t,i){var r=-t[0],s=-t[1],n=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*a+u*r+l*n-h*s,g=l*a+u*s+h*r-o*n,f=h*a+u*n+o*s-l*r,d=u*a-o*r-l*s-h*n;p.rotateX(e,t,i);r=e[0];s=e[1];n=e[2];a=e[3];e[4]=c*a+d*r+g*n-f*s;e[5]=g*a+d*s+f*r-c*n;e[6]=f*a+d*n+c*s-g*r;e[7]=d*a-c*r-g*s-f*n;return e}function x(e,t,i){var r=-t[0],s=-t[1],n=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*a+u*r+l*n-h*s,g=l*a+u*s+h*r-o*n,f=h*a+u*n+o*s-l*r,d=u*a-o*r-l*s-h*n;p.rotateY(e,t,i);r=e[0];s=e[1];n=e[2];a=e[3];e[4]=c*a+d*r+g*n-f*s;e[5]=g*a+d*s+f*r-c*n;e[6]=f*a+d*n+c*s-g*r;e[7]=d*a-c*r-g*s-f*n;return e}function T(e,t,i){var r=-t[0],s=-t[1],n=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*a+u*r+l*n-h*s,g=l*a+u*s+h*r-o*n,f=h*a+u*n+o*s-l*r,d=u*a-o*r-l*s-h*n;p.rotateZ(e,t,i);r=e[0];s=e[1];n=e[2];a=e[3];e[4]=c*a+d*r+g*n-f*s;e[5]=g*a+d*s+f*r-c*n;e[6]=f*a+d*n+c*s-g*r;e[7]=d*a-c*r-g*s-f*n;return e}function C(e,t,i){var r=i[0],s=i[1],n=i[2],a=i[3],o=t[0],l=t[1],h=t[2],u=t[3];e[0]=o*a+u*r+l*n-h*s;e[1]=l*a+u*s+h*r-o*n;e[2]=h*a+u*n+o*s-l*r;e[3]=u*a-o*r-l*s-h*n;o=t[4];l=t[5];h=t[6];u=t[7];e[4]=o*a+u*r+l*n-h*s;e[5]=l*a+u*s+h*r-o*n;e[6]=h*a+u*n+o*s-l*r;e[7]=u*a-o*r-l*s-h*n;return e}function D(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3],o=i[0],l=i[1],h=i[2],u=i[3];e[0]=r*u+a*o+s*h-n*l;e[1]=s*u+a*l+n*o-r*h;e[2]=n*u+a*h+r*l-s*o;e[3]=a*u-r*o-s*l-n*h;o=i[4];l=i[5];h=i[6];u=i[7];e[4]=r*u+a*o+s*h-n*l;e[5]=s*u+a*l+n*o-r*h;e[6]=n*u+a*h+r*l-s*o;e[7]=a*u-r*o-s*l-n*h;return e}function B(e,t,i,r){if(Math.abs(r)<E.EPSILON){return b(e,t)}var s=Math.hypot(i[0],i[1],i[2]);r=r*.5;var n=Math.sin(r);var a=n*i[0]/s;var o=n*i[1]/s;var l=n*i[2]/s;var h=Math.cos(r);var u=t[0],c=t[1],g=t[2],f=t[3];e[0]=u*h+f*a+c*l-g*o;e[1]=c*h+f*o+g*a-u*l;e[2]=g*h+f*l+u*o-c*a;e[3]=f*h-u*a-c*o-g*l;var d=t[4],p=t[5],m=t[6],_=t[7];e[4]=d*h+_*a+p*l-m*o;e[5]=p*h+_*o+m*a-d*l;e[6]=m*h+_*l+d*o-p*a;e[7]=_*h-d*a-p*o-m*l;return e}function S(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];return e}function I(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3],o=i[4],l=i[5],h=i[6],u=i[7],c=t[4],g=t[5],f=t[6],d=t[7],p=i[0],m=i[1],_=i[2],E=i[3];e[0]=r*E+a*p+s*_-n*m;e[1]=s*E+a*m+n*p-r*_;e[2]=n*E+a*_+r*m-s*p;e[3]=a*E-r*p-s*m-n*_;e[4]=r*u+a*o+s*h-n*l+c*E+d*p+g*_-f*m;e[5]=s*u+a*l+n*o-r*h+g*E+d*m+f*p-c*_;e[6]=n*u+a*h+r*l-s*o+f*E+d*_+c*m-g*p;e[7]=a*u-r*o-s*l-n*h+d*E-c*p-g*m-f*_;return e}var M=I;function R(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;return e}var O=p.dot;function P(e,t,i,r){var s=1-r;if(O(t,i)<0)r=-r;e[0]=t[0]*s+i[0]*r;e[1]=t[1]*s+i[1]*r;e[2]=t[2]*s+i[2]*r;e[3]=t[3]*s+i[3]*r;e[4]=t[4]*s+i[4]*r;e[5]=t[5]*s+i[5]*r;e[6]=t[6]*s+i[6]*r;e[7]=t[7]*s+i[7]*r;return e}function L(e,t){var i=y(t);e[0]=-t[0]/i;e[1]=-t[1]/i;e[2]=-t[2]/i;e[3]=t[3]/i;e[4]=-t[4]/i;e[5]=-t[5]/i;e[6]=-t[6]/i;e[7]=t[7]/i;return e}function U(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];e[4]=-t[4];e[5]=-t[5];e[6]=-t[6];e[7]=t[7];return e}var N=p.length;var k=N;var y=p.squaredLength;var V=y;function G(e,t){var i=y(t);if(i>0){i=Math.sqrt(i);var r=t[0]/i;var s=t[1]/i;var n=t[2]/i;var a=t[3]/i;var o=t[4];var l=t[5];var h=t[6];var u=t[7];var c=r*o+s*l+n*h+a*u;e[0]=r;e[1]=s;e[2]=n;e[3]=a;e[4]=(o-r*c)/i;e[5]=(l-s*c)/i;e[6]=(h-n*c)/i;e[7]=(u-a*c)/i}return e}function j(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function z(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function H(e,t){var i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5],l=e[6],h=e[7];var u=t[0],c=t[1],g=t[2],f=t[3],d=t[4],p=t[5],m=t[6],_=t[7];return Math.abs(i-u)<=E.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-c)<=E.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-g)<=E.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(n-f)<=E.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-d)<=E.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-p)<=E.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-m)<=E.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-_)<=E.EPSILON*Math.max(1,Math.abs(h),Math.abs(_))}},842:(w,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>l,angle:()=>y,ceil:()=>g,clone:()=>r,copy:()=>n,create:()=>i,cross:()=>B,dist:()=>W,distance:()=>b,div:()=>H,divide:()=>c,dot:()=>D,equals:()=>V,exactEquals:()=>k,floor:()=>f,forEach:()=>q,fromValues:()=>s,inverse:()=>T,len:()=>G,length:()=>F,lerp:()=>S,max:()=>p,min:()=>d,mul:()=>z,multiply:()=>u,negate:()=>x,normalize:()=>C,random:()=>I,rotate:()=>N,round:()=>m,scale:()=>_,scaleAndAdd:()=>E,set:()=>o,sqrDist:()=>Y,sqrLen:()=>X,squaredDistance:()=>A,squaredLength:()=>v,str:()=>U,sub:()=>j,subtract:()=>h,transformMat2:()=>M,transformMat2d:()=>R,transformMat3:()=>O,transformMat4:()=>P,zero:()=>L});var a=t(823);function i(){var e=new a.ARRAY_TYPE(2);if(a.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0}return e}function r(e){var t=new a.ARRAY_TYPE(2);t[0]=e[0];t[1]=e[1];return t}function s(e,t){var i=new a.ARRAY_TYPE(2);i[0]=e;i[1]=t;return i}function n(e,t){e[0]=t[0];e[1]=t[1];return e}function o(e,t,i){e[0]=t;e[1]=i;return e}function l(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];return e}function h(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];return e}function u(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];return e}function c(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];return e}function g(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);return e}function f(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);return e}function d(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);return e}function p(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);return e}function m(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);return e}function _(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;return e}function E(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;return e}function b(e,t){var i=t[0]-e[0],r=t[1]-e[1];return Math.hypot(i,r)}function A(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function F(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function v(e){var t=e[0],i=e[1];return t*t+i*i}function x(e,t){e[0]=-t[0];e[1]=-t[1];return e}function T(e,t){e[0]=1/t[0];e[1]=1/t[1];return e}function C(e,t){var i=t[0],r=t[1];var s=i*i+r*r;if(s>0){s=1/Math.sqrt(s)}e[0]=t[0]*s;e[1]=t[1]*s;return e}function D(e,t){return e[0]*t[0]+e[1]*t[1]}function B(e,t,i){var r=t[0]*i[1]-t[1]*i[0];e[0]=e[1]=0;e[2]=r;return e}function S(e,t,i,r){var s=t[0],n=t[1];e[0]=s+r*(i[0]-s);e[1]=n+r*(i[1]-n);return e}function I(e,t){t=t||1;var i=a.RANDOM()*2*Math.PI;e[0]=Math.cos(i)*t;e[1]=Math.sin(i)*t;return e}function M(e,t,i){var r=t[0],s=t[1];e[0]=i[0]*r+i[2]*s;e[1]=i[1]*r+i[3]*s;return e}function R(e,t,i){var r=t[0],s=t[1];e[0]=i[0]*r+i[2]*s+i[4];e[1]=i[1]*r+i[3]*s+i[5];return e}function O(e,t,i){var r=t[0],s=t[1];e[0]=i[0]*r+i[3]*s+i[6];e[1]=i[1]*r+i[4]*s+i[7];return e}function P(e,t,i){var r=t[0];var s=t[1];e[0]=i[0]*r+i[4]*s+i[12];e[1]=i[1]*r+i[5]*s+i[13];return e}function N(e,t,i,r){var s=t[0]-i[0],n=t[1]-i[1],a=Math.sin(r),o=Math.cos(r);e[0]=s*o-n*a+i[0];e[1]=s*a+n*o+i[1];return e}function y(e,t){var i=e[0],r=e[1],s=t[0],n=t[1];var a=i*i+r*r;if(a>0){a=1/Math.sqrt(a)}var o=s*s+n*n;if(o>0){o=1/Math.sqrt(o)}var l=(i*s+r*n)*a*o;if(l>1){return 0}else if(l<-1){return Math.PI}else{return Math.acos(l)}}function L(e){e[0]=0;e[1]=0;return e}function U(e){return"vec2("+e[0]+", "+e[1]+")"}function k(e,t){return e[0]===t[0]&&e[1]===t[1]}function V(e,t){var i=e[0],r=e[1];var s=t[0],n=t[1];return Math.abs(i-s)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))}var G=F;var j=h;var z=u;var H=c;var W=b;var Y=A;var X=v;var q=function(){var l=i();return function(e,t,i,r,s,n){var a,o;if(!t){t=2}if(!i){i=0}if(r){o=Math.min(r*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];s(l,l,n);e[a]=l[0];e[a+1]=l[1]}return e}}()},329:(w,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>h,angle:()=>k,bezier:()=>M,ceil:()=>f,clone:()=>r,copy:()=>a,create:()=>i,cross:()=>B,dist:()=>X,distance:()=>A,div:()=>Y,divide:()=>g,dot:()=>D,equals:()=>z,exactEquals:()=>j,floor:()=>d,forEach:()=>K,fromValues:()=>n,hermite:()=>I,inverse:()=>T,len:()=>Z,length:()=>s,lerp:()=>S,max:()=>m,min:()=>p,mul:()=>W,multiply:()=>c,negate:()=>x,normalize:()=>C,random:()=>R,rotateX:()=>y,rotateY:()=>L,rotateZ:()=>U,round:()=>_,scale:()=>E,scaleAndAdd:()=>b,set:()=>o,sqrDist:()=>q,sqrLen:()=>Q,squaredDistance:()=>F,squaredLength:()=>v,str:()=>G,sub:()=>H,subtract:()=>u,transformMat3:()=>P,transformMat4:()=>O,transformQuat:()=>N,zero:()=>V});var l=t(823);function i(){var e=new l.ARRAY_TYPE(3);if(l.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0;e[2]=0}return e}function r(e){var t=new l.ARRAY_TYPE(3);t[0]=e[0];t[1]=e[1];t[2]=e[2];return t}function s(e){var t=e[0];var i=e[1];var r=e[2];return Math.hypot(t,i,r)}function n(e,t,i){var r=new l.ARRAY_TYPE(3);r[0]=e;r[1]=t;r[2]=i;return r}function a(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];return e}function o(e,t,i,r){e[0]=t;e[1]=i;e[2]=r;return e}function h(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];return e}function u(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];return e}function c(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];return e}function g(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];return e}function f(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);return e}function d(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);return e}function p(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);return e}function m(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);return e}function _(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);return e}function E(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;return e}function b(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;return e}function A(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var s=t[2]-e[2];return Math.hypot(i,r,s)}function F(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var s=t[2]-e[2];return i*i+r*r+s*s}function v(e){var t=e[0];var i=e[1];var r=e[2];return t*t+i*i+r*r}function x(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];return e}function T(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];return e}function C(e,t){var i=t[0];var r=t[1];var s=t[2];var n=i*i+r*r+s*s;if(n>0){n=1/Math.sqrt(n)}e[0]=t[0]*n;e[1]=t[1]*n;e[2]=t[2]*n;return e}function D(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function B(e,t,i){var r=t[0],s=t[1],n=t[2];var a=i[0],o=i[1],l=i[2];e[0]=s*l-n*o;e[1]=n*a-r*l;e[2]=r*o-s*a;return e}function S(e,t,i,r){var s=t[0];var n=t[1];var a=t[2];e[0]=s+r*(i[0]-s);e[1]=n+r*(i[1]-n);e[2]=a+r*(i[2]-a);return e}function I(e,t,i,r,s,n){var a=n*n;var o=a*(2*n-3)+1;var l=a*(n-2)+n;var h=a*(n-1);var u=a*(3-2*n);e[0]=t[0]*o+i[0]*l+r[0]*h+s[0]*u;e[1]=t[1]*o+i[1]*l+r[1]*h+s[1]*u;e[2]=t[2]*o+i[2]*l+r[2]*h+s[2]*u;return e}function M(e,t,i,r,s,n){var a=1-n;var o=a*a;var l=n*n;var h=o*a;var u=3*n*o;var c=3*l*a;var g=l*n;e[0]=t[0]*h+i[0]*u+r[0]*c+s[0]*g;e[1]=t[1]*h+i[1]*u+r[1]*c+s[1]*g;e[2]=t[2]*h+i[2]*u+r[2]*c+s[2]*g;return e}function R(e,t){t=t||1;var i=l.RANDOM()*2*Math.PI;var r=l.RANDOM()*2-1;var s=Math.sqrt(1-r*r)*t;e[0]=Math.cos(i)*s;e[1]=Math.sin(i)*s;e[2]=r*t;return e}function O(e,t,i){var r=t[0],s=t[1],n=t[2];var a=i[3]*r+i[7]*s+i[11]*n+i[15];a=a||1;e[0]=(i[0]*r+i[4]*s+i[8]*n+i[12])/a;e[1]=(i[1]*r+i[5]*s+i[9]*n+i[13])/a;e[2]=(i[2]*r+i[6]*s+i[10]*n+i[14])/a;return e}function P(e,t,i){var r=t[0],s=t[1],n=t[2];e[0]=r*i[0]+s*i[3]+n*i[6];e[1]=r*i[1]+s*i[4]+n*i[7];e[2]=r*i[2]+s*i[5]+n*i[8];return e}function N(e,t,i){var r=i[0],s=i[1],n=i[2],a=i[3];var o=t[0],l=t[1],h=t[2];var u=s*h-n*l,c=n*o-r*h,g=r*l-s*o;var f=s*g-n*c,d=n*u-r*g,p=r*c-s*u;var m=a*2;u*=m;c*=m;g*=m;f*=2;d*=2;p*=2;e[0]=o+u+f;e[1]=l+c+d;e[2]=h+g+p;return e}function y(e,t,i,r){var s=[],n=[];s[0]=t[0]-i[0];s[1]=t[1]-i[1];s[2]=t[2]-i[2];n[0]=s[0];n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r);n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r);e[0]=n[0]+i[0];e[1]=n[1]+i[1];e[2]=n[2]+i[2];return e}function L(e,t,i,r){var s=[],n=[];s[0]=t[0]-i[0];s[1]=t[1]-i[1];s[2]=t[2]-i[2];n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r);n[1]=s[1];n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r);e[0]=n[0]+i[0];e[1]=n[1]+i[1];e[2]=n[2]+i[2];return e}function U(e,t,i,r){var s=[],n=[];s[0]=t[0]-i[0];s[1]=t[1]-i[1];s[2]=t[2]-i[2];n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r);n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r);n[2]=s[2];e[0]=n[0]+i[0];e[1]=n[1]+i[1];e[2]=n[2]+i[2];return e}function k(e,t){var i=n(e[0],e[1],e[2]);var r=n(t[0],t[1],t[2]);C(i,i);C(r,r);var s=D(i,r);if(s>1){return 0}else if(s<-1){return Math.PI}else{return Math.acos(s)}}function V(e){e[0]=0;e[1]=0;e[2]=0;return e}function G(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function j(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function z(e,t){var i=e[0],r=e[1],s=e[2];var n=t[0],a=t[1],o=t[2];return Math.abs(i-n)<=l.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-a)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-o)<=l.EPSILON*Math.max(1,Math.abs(s),Math.abs(o))}var H=u;var W=c;var Y=g;var X=A;var q=F;var Z=s;var Q=v;var K=function(){var l=i();return function(e,t,i,r,s,n){var a,o;if(!t){t=3}if(!i){i=0}if(r){o=Math.min(r*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];s(l,l,n);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2]}return e}}()},796:(w,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>o,ceil:()=>g,clone:()=>r,copy:()=>n,create:()=>i,cross:()=>B,dist:()=>V,distance:()=>b,div:()=>k,divide:()=>c,dot:()=>D,equals:()=>y,exactEquals:()=>N,floor:()=>f,forEach:()=>H,fromValues:()=>s,inverse:()=>T,len:()=>j,length:()=>F,lerp:()=>S,max:()=>p,min:()=>d,mul:()=>U,multiply:()=>h,negate:()=>x,normalize:()=>C,random:()=>I,round:()=>m,scale:()=>_,scaleAndAdd:()=>E,set:()=>a,sqrDist:()=>G,sqrLen:()=>z,squaredDistance:()=>A,squaredLength:()=>v,str:()=>P,sub:()=>L,subtract:()=>l,transformMat4:()=>M,transformQuat:()=>R,zero:()=>O});var u=t(823);function i(){var e=new u.ARRAY_TYPE(4);if(u.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[3]=0}return e}function r(e){var t=new u.ARRAY_TYPE(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function s(e,t,i,r){var s=new u.ARRAY_TYPE(4);s[0]=e;s[1]=t;s[2]=i;s[3]=r;return s}function n(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function a(e,t,i,r,s){e[0]=t;e[1]=i;e[2]=r;e[3]=s;return e}function o(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function l(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function h(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];e[3]=t[3]*i[3];return e}function c(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];e[3]=t[3]/i[3];return e}function g(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);e[3]=Math.ceil(t[3]);return e}function f(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);e[3]=Math.floor(t[3]);return e}function d(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);e[3]=Math.min(t[3],i[3]);return e}function p(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);e[3]=Math.max(t[3],i[3]);return e}function m(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);e[3]=Math.round(t[3]);return e}function _(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function E(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;return e}function b(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var s=t[2]-e[2];var n=t[3]-e[3];return Math.hypot(i,r,s,n)}function A(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var s=t[2]-e[2];var n=t[3]-e[3];return i*i+r*r+s*s+n*n}function F(e){var t=e[0];var i=e[1];var r=e[2];var s=e[3];return Math.hypot(t,i,r,s)}function v(e){var t=e[0];var i=e[1];var r=e[2];var s=e[3];return t*t+i*i+r*r+s*s}function x(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=-t[3];return e}function T(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];e[3]=1/t[3];return e}function C(e,t){var i=t[0];var r=t[1];var s=t[2];var n=t[3];var a=i*i+r*r+s*s+n*n;if(a>0){a=1/Math.sqrt(a)}e[0]=i*a;e[1]=r*a;e[2]=s*a;e[3]=n*a;return e}function D(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function B(e,t,i,r){var s=i[0]*r[1]-i[1]*r[0],n=i[0]*r[2]-i[2]*r[0],a=i[0]*r[3]-i[3]*r[0],o=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],h=i[2]*r[3]-i[3]*r[2];var u=t[0];var c=t[1];var g=t[2];var f=t[3];e[0]=c*h-g*l+f*o;e[1]=-(u*h)+g*a-f*n;e[2]=u*l-c*a+f*s;e[3]=-(u*o)+c*n-g*s;return e}function S(e,t,i,r){var s=t[0];var n=t[1];var a=t[2];var o=t[3];e[0]=s+r*(i[0]-s);e[1]=n+r*(i[1]-n);e[2]=a+r*(i[2]-a);e[3]=o+r*(i[3]-o);return e}function I(e,t){t=t||1;var i,r,s,n;var a,o;do{i=u.RANDOM()*2-1;r=u.RANDOM()*2-1;a=i*i+r*r}while(a>=1);do{s=u.RANDOM()*2-1;n=u.RANDOM()*2-1;o=s*s+n*n}while(o>=1);var l=Math.sqrt((1-a)/o);e[0]=t*i;e[1]=t*r;e[2]=t*s*l;e[3]=t*n*l;return e}function M(e,t,i){var r=t[0],s=t[1],n=t[2],a=t[3];e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*a;e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*a;e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*a;e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*a;return e}function R(e,t,i){var r=t[0],s=t[1],n=t[2];var a=i[0],o=i[1],l=i[2],h=i[3];var u=h*r+o*n-l*s;var c=h*s+l*r-a*n;var g=h*n+a*s-o*r;var f=-a*r-o*s-l*n;e[0]=u*h+f*-a+c*-l-g*-o;e[1]=c*h+f*-o+g*-a-u*-l;e[2]=g*h+f*-l+u*-o-c*-a;e[3]=t[3];return e}function O(e){e[0]=0;e[1]=0;e[2]=0;e[3]=0;return e}function P(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function N(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function y(e,t){var i=e[0],r=e[1],s=e[2],n=e[3];var a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(i-a)<=u.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=u.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-l)<=u.EPSILON*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-h)<=u.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))}var L=l;var U=h;var k=c;var V=b;var G=A;var j=F;var z=v;var H=function(){var l=i();return function(e,t,i,r,s,n){var a,o;if(!t){t=4}if(!i){i=0}if(r){o=Math.min(r*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];l[3]=e[a+3];s(l,l,n);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2];e[a+3]=l[3]}return e}}()},344:(e,t,i)=>{"use strict";i.d(t,{k:()=>u});var r=i(125);var s=i(849);var n=i(562);var a=i(963);class u extends r.A{static EVENT_KEY_DELETE="keyDelete";static EVENT_CHANGE="onChange";static EVENT_UIATTRIB_CHANGE="uiattrchange";static LOOP_OFF=0;static LOOP_REPEAT=1;static LOOP_MIRROR=2;static LOOP_OFFSET=3;static EASING_LINEAR=0;static EASING_ABSOLUTE=1;static EASING_SMOOTHSTEP=2;static EASING_SMOOTHERSTEP=3;static EASING_CUBICSPLINE=4;static EASING_CUBIC_IN=5;static EASING_CUBIC_OUT=6;static EASING_CUBIC_INOUT=7;static EASING_EXPO_IN=8;static EASING_EXPO_OUT=9;static EASING_EXPO_INOUT=10;static EASING_SIN_IN=11;static EASING_SIN_OUT=12;static EASING_SIN_INOUT=13;static EASING_BACK_IN=14;static EASING_BACK_OUT=15;static EASING_BACK_INOUT=16;static EASING_ELASTIC_IN=17;static EASING_ELASTIC_OUT=18;static EASING_BOUNCE_IN=19;static EASING_BOUNCE_OUT=21;static EASING_QUART_IN=22;static EASING_QUART_OUT=23;static EASING_QUART_INOUT=24;static EASING_QUINT_IN=25;static EASING_QUINT_OUT=26;static EASING_QUINT_INOUT=27;static EASING_CLIP=28;static EASINGNAMES=["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out","Clip"];#tlActive=true;uiAttribs={};loop=0;onLooped=null;_timesLooped=0;#needsSort=false;_cachedIndex=0;port=null;keys=[];onChange=null;stayInTimeline=false;batchMode=false;constructor(e={}){super();e=e||{};this.id=(0,n.uuid)();this._log=new s.A("Anim");this.name=e.name||null;this.defaultEasing=e.defaultEasing||u.EASING_LINEAR}forceChangeCallback(){if(this.onChange!==null)this.onChange();this.emitEvent(u.EVENT_CHANGE,this)}forceChangeCallbackSoon(){if(this.batchMode)return;if(!this.forcecbto)this.forcecbto=setTimeout(()=>{this.forceChangeCallback();this.forcecbto=null},50)}getLoop(){return this.loop}setLoop(e){if(e===false)e=0;if(e===true)e=1;this.loop=e;this.emitEvent(u.EVENT_CHANGE,this)}hasEnded(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return true;if(this.keys[this.keys.length-1].time<=e)return true;return false}hasStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return false;if(e>=this.keys[0].time)return true;return false}isRising(e){if(this.#needsSort)this.sortKeys();if(this.hasEnded(e))return false;const t=this.getKeyIndex(e);if(this.keys[t].value<this.keys[t+1].value)return true;return false}clearBefore(e){if(this.#needsSort)this.sortKeys();const t=this.getValue(e);const i=this.getKeyIndex(e);this.setValue(e,t);if(i>1){this.keys.splice(0,i);this.#needsSort=true}}clear(e){if(this.#needsSort)this.sortKeys();let t=0;if(e)t=this.getValue(e);for(let e=0;e<this.keys.length;e++)this.emitEvent(u.EVENT_KEY_DELETE,this.keys[e]);this.keys.length=0;if(e)this.setValue(e,t);this.#needsSort=true;if(this.onChange!==null)this.onChange();this.emitEvent(u.EVENT_CHANGE,this)}checkIsSorted(){let t=true;for(let e=0;e<this.keys.length-1;e++)if(this.keys[e].time>this.keys[e+1].time){t=false;break}return t}sortKeys(){if(this.batchMode)return;if(!this.checkIsSorted()){this.keys.sort((e,t)=>{return e.time-t.time});this.#needsSort=false;if(this.keys.length>999&&this.keys.length%1e3==0)console.log(this.name,this.keys.length);this.emitEvent(u.EVENT_CHANGE)}}hasDuplicates(){const t={};let i=0;for(let e=0;e<this.keys.length;e++){t[this.keys[e].time]=1;i++}const e=Object.keys(t);if(e.length!=i){return true}return false}removeDuplicates(){if(this.hasDuplicates()){if(this.#needsSort)this.sortKeys();let t=0;while(this.hasDuplicates()){for(let e=0;e<this.keys.length-1;e++){if(this.keys[e].time==this.keys[e+1].time){const i=this.keys[e];this.keys.splice(e,1);this.emitEvent(u.EVENT_KEY_DELETE,i)}t++}}this.#needsSort=true}}getLengthLoop(){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return this.lastKey.time-this.firstKey.time}getLength(){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return 0;return this.lastKey.time}getKeyIndex(t){if(this.#needsSort)this.sortKeys();let i=0;let r=0;if(this._cachedIndex&&this.keys.length>this._cachedIndex&&t>=this.keys[this._cachedIndex].time)r=this._cachedIndex;for(let e=r;e<this.keys.length;e++){if(t>=this.keys[e].time)i=e;if(this.keys[e].time>t){if(t!=0)this._cachedIndex=i;return i}}return i}setValue(t,i,r=null){if(isNaN(i))CABLES.logStack();if(this.#needsSort)this.sortKeys();let s=null;if(!this.batchMode)if(this.keys.length==0||t<=this.lastKey.time)for(let e=0;e<this.keys.length;e++)if(this.keys[e].time==t){s=this.keys[e];this.keys[e].setValue(i);this.keys[e].cb=r;break}if(!s){s=new a.rA({time:t,value:i,e:this.defaultEasing,cb:r,anim:this});this.keys.push(s)}if(!this.batchMode){if(this.onChange)this.onChange();this.emitEvent(u.EVENT_CHANGE,this);this.#needsSort=true}return s}setKeyEasing(e,t){if(this.keys[e]){this.keys[e].setEasing(t);this.emitEvent(u.EVENT_CHANGE,this)}}deserialize(t,e,i){if(t.loop)this.loop=t.loop;if(t.tlActive)this.#tlActive=t.tlActive;if(t.height)this.uiAttribs.height=t.height;if(e){while(this.keys.length)this.keys[0].delete();this.keys.length=0}for(const r in t.keys){let e=new a.rA(t.keys[r],this);this.keys.push(e);if(i)if(t.keys[r].clipId){i[t.keys[r].clipId]=i[t.keys[r].clipId]||[];if(i)i[t.keys[r].clipId].push(e)}}this.sortKeys()}getSerialized(){const t={};t.keys=[];t.loop=this.loop;if(this.#tlActive)t.tlActive=this.tlActive;if(this.uiAttribs.height)t.height=this.uiAttribs.height;for(let e=0;e<this.keys.length;e++)t.keys.push(this.keys[e].getSerialized());return t}getKey(e){if(this.#needsSort)this.sortKeys();const t=this.getKeyIndex(e);return this.keys[t]}getNextKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)+1;if(t>=this.keys.length)return null;return this.keys[t]}getPrevKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)-1;if(t<0)return null;return this.keys[t]}isFinished(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return true;return e>this.lastKey.time}isStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return false;return e>=this.firstKey.time}remove(t,i){for(let e=0;e<this.keys.length;e++){if(this.keys[e]==t){this.emitEvent(u.EVENT_KEY_DELETE,this.keys[e]);this.keys.splice(e,1);this.#needsSort=true;if(i===undefined){this.emitEvent(u.EVENT_CHANGE,this)}return}}}get lastKey(){if(this.#needsSort)this.sortKeys();return this.keys[this.keys.length-1]}get firstKey(){if(this.#needsSort)this.sortKeys();return this.keys[0]}getLoopIndex(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return(e-this.firstKey.time)/this.getLengthLoop()}getValue(e){let t=0;if(this.keys.length===0)return 0;if(this.#needsSort)this.sortKeys();if(!this.loop&&e>this.keys[this.keys.length-1].time){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}if(e<this.firstKey.time)return this.keys[0].value;if(this.loop&&this.keys.length>1&&e>this.lastKey.time){const o=this.getLoopIndex(e);if(o>this._timesLooped){this._timesLooped++;if(this.onLooped)this.onLooped()}e=(e-this.firstKey.time)%this.getLengthLoop();if(this.loop==u.LOOP_REPEAT){}else if(this.loop==u.LOOP_MIRROR){if(Math.floor(o)%2==1)e=this.getLengthLoop()-e}else if(this.loop==u.LOOP_OFFSET){t=(this.lastKey.value-this.keys[0].value)*Math.floor(o)}e+=this.firstKey.time}const i=this.getKeyIndex(e);if(i>=this.keys.length-1){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}const r=i+1;const s=this.keys[i];const n=this.keys[r];if(s.cb&&!s.cbTriggered)s.trigger();if(!n)return-1;const a=(e-s.time)/(n.time-s.time);if(s.getEasing()==u.EASING_CLIP){if(s.clip&&s.clip.getValue){return s.clip.getValue(a*s.clip.getLength())}else{if(this.port){const l=this.port.op.patch;const h=l.getVar(s.clipId)?.getValue();if(h)s.clip=h;if(s.clip)return s.clip.getValue(e)}console.log("no clip found")}}return s.ease(a,n)+t}addKey(e){if(e.time===undefined){this._log.warn("key time undefined, ignoring!")}else{this.keys.push(e);if(this.onChange!==null)this.onChange();this.emitEvent(u.EVENT_CHANGE,this);this.#needsSort=true}}sortSoon(){this.#needsSort=true}easingFromString(e){if(e=="linear")return u.EASING_LINEAR;if(e=="absolute")return u.EASING_ABSOLUTE;if(e=="smoothstep")return u.EASING_SMOOTHSTEP;if(e=="smootherstep")return u.EASING_SMOOTHERSTEP;if(e=="Cubic In")return u.EASING_CUBIC_IN;if(e=="Cubic Out")return u.EASING_CUBIC_OUT;if(e=="Cubic In Out")return u.EASING_CUBIC_INOUT;if(e=="Expo In")return u.EASING_EXPO_IN;if(e=="Expo Out")return u.EASING_EXPO_OUT;if(e=="Expo In Out")return u.EASING_EXPO_INOUT;if(e=="Sin In")return u.EASING_SIN_IN;if(e=="Sin Out")return u.EASING_SIN_OUT;if(e=="Sin In Out")return u.EASING_SIN_INOUT;if(e=="Back In")return u.EASING_BACK_IN;if(e=="Back Out")return u.EASING_BACK_OUT;if(e=="Back In Out")return u.EASING_BACK_INOUT;if(e=="Elastic In")return u.EASING_ELASTIC_IN;if(e=="Elastic Out")return u.EASING_ELASTIC_OUT;if(e=="Bounce In")return u.EASING_BOUNCE_IN;if(e=="Bounce Out")return u.EASING_BOUNCE_OUT;if(e=="Quart Out")return u.EASING_QUART_OUT;if(e=="Quart In")return u.EASING_QUART_IN;if(e=="Quart In Out")return u.EASING_QUART_INOUT;if(e=="Quint Out")return u.EASING_QUINT_OUT;if(e=="Quint In")return u.EASING_QUINT_IN;if(e=="Quint In Out")return u.EASING_QUINT_INOUT;console.log("unknown anim easing?",e)}createPort(e,t,i){const r=e.inDropDown(t,u.EASINGNAMES,"linear");r.set("linear");r.defaultValue=0;r.onChange=()=>{this.defaultEasing=this.easingFromString(r.get());this.emitEvent("onChangeDefaultEasing",this);if(i)i()};return r}get tlActive(){return this.#tlActive}set tlActive(e){if(CABLES.UI){this.#tlActive=e;window.gui.emitEvent("tlActiveChanged",this);this.forceChangeCallbackSoon()}}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}this.emitEvent(u.EVENT_UIATTRIB_CHANGE)}hasKeyframesBetween(t,i){for(let e=0;e<this.keys.length;e++)if(this.keys[e].time>=t&&this.keys[e].time<=i)return true;return false}static initClipsFromVars(i){for(const t in i.missingClipAnims){const r=i.getVar(t);for(let e=0;e<i.missingClipAnims[t].length;e++){i.missingClipAnims[t].clip=r.getValue();delete i.missingClipAnims[t]}}}}},963:(e,t,i)=>{"use strict";i.d(t,{rA:()=>l});var s=i(344);class l{anim=null;id=CABLES.simpleId();time=0;value=0;onChange=null;_easing=0;bezCp1=null;bezCp2=null;bezAn=null;cb=null;cbTriggered=false;temp={};uiAttribs={};clip=null;clipId=null;constructor(e,t){this.anim=e.anim||t||null;this.setEasing(s.k.EASING_LINEAR);this.set(e)}setClip(e,t){this.clipId=e;this.clip=t;if(this.anim)this.anim.emitEvent(s.k.EVENT_CHANGE)}emitChange(){if(this.anim.batchMode)return;if(!this.anim)return;this.bezAn=null;if(this.onChange!==null)this.onChange();this.anim.forceChangeCallbackSoon();for(let e=0;e<this.anim.keys.length;e++)this.anim.keys[e].bezAn=null}delete(){if(this.anim)this.anim.remove(this);else console.log("animkey without anim...")}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}if(this.anim)this.anim.emitEvent(s.k.EVENT_CHANGE)}setEasing(e){let t=false;if(this._easing!=e)t=true;this._easing=e;if(this._easing!=s.k.EASING_CLIP){this.clipId="";this.clip=null}if(this._easing==s.k.EASING_LINEAR)this.ease=this.easeLinear;else if(this._easing==s.k.EASING_ABSOLUTE)this.ease=this.easeAbsolute;else if(this._easing==s.k.EASING_SMOOTHSTEP)this.ease=l.easeSmoothStep;else if(this._easing==s.k.EASING_SMOOTHERSTEP)this.ease=l.easeSmootherStep;else if(this._easing==s.k.EASING_CUBIC_IN)this.ease=l.easeCubicIn;else if(this._easing==s.k.EASING_CUBIC_OUT)this.ease=l.easeCubicOut;else if(this._easing==s.k.EASING_CUBIC_INOUT)this.ease=l.easeCubicInOut;else if(this._easing==s.k.EASING_EXPO_IN)this.ease=l.easeExpoIn;else if(this._easing==s.k.EASING_EXPO_OUT)this.ease=l.easeExpoOut;else if(this._easing==s.k.EASING_EXPO_INOUT)this.ease=l.easeExpoInOut;else if(this._easing==s.k.EASING_SIN_IN)this.ease=l.easeSinIn;else if(this._easing==s.k.EASING_SIN_OUT)this.ease=l.easeSinOut;else if(this._easing==s.k.EASING_SIN_INOUT)this.ease=l.easeSinInOut;else if(this._easing==s.k.EASING_BACK_OUT)this.ease=l.easeOutBack;else if(this._easing==s.k.EASING_BACK_IN)this.ease=l.easeInBack;else if(this._easing==s.k.EASING_BACK_INOUT)this.ease=l.easeInOutBack;else if(this._easing==s.k.EASING_ELASTIC_IN)this.ease=l.easeInElastic;else if(this._easing==s.k.EASING_ELASTIC_OUT)this.ease=l.easeOutElastic;else if(this._easing==s.k.EASING_BOUNCE_IN)this.ease=l.easeInBounce;else if(this._easing==s.k.EASING_BOUNCE_OUT)this.ease=l.easeOutBounce;else if(this._easing==s.k.EASING_QUART_OUT)this.ease=l.easeOutQuart;else if(this._easing==s.k.EASING_QUART_IN)this.ease=l.easeInQuart;else if(this._easing==s.k.EASING_QUART_INOUT)this.ease=l.easeInOutQuart;else if(this._easing==s.k.EASING_QUINT_OUT)this.ease=l.easeOutQuint;else if(this._easing==s.k.EASING_QUINT_IN)this.ease=l.easeInQuint;else if(this._easing==s.k.EASING_QUINT_INOUT)this.ease=l.easeInOutQuint;else if(this._easing==s.k.EASING_CLIP)this.ease=this.easeAbsolute;else if(this._easing==s.k.EASING_CUBICSPLINE){if(this.ease!=this.easeCubicSpline){this.ease=this.easeCubicSpline;this.bezReset()}this.bezAn=null}else{this._easing=s.k.EASING_LINEAR;this.ease=this.easeLinear}if(t)this.emitChange()}bezReset(){let e=.5;const t=this.anim.getPrevKey(this.time);if(t)e=(this.time-t.time)/2;let i=.5;const r=this.anim.getNextKey(this.time);if(r)i=(r.time-this.time)/2;this.bezCp1=[-Math.min(e,i),0];this.bezCp2=[Math.min(e,i),0];this.emitChange()}trigger(){this.cb();this.cbTriggered=true}setValue(e){this.value=e;this.emitChange()}setBezCp1(e,t){this.bezCp1=[e,t];this.emitChange()}setBezCp2(e,t){this.bezCp2=[e,t];this.emitChange()}set(e){if(e){if(e.hasOwnProperty("e"))this.setEasing(e.e);if(e.cb){this.cb=e.cb;this.cbTriggered=false}if(e.hasOwnProperty("cp1")){this.bezCp1=e.cp1;this.bezCp2=e.cp2}if(e.hasOwnProperty("t"))this.time=e.t;if(e.hasOwnProperty("time"))this.time=e.time;if(e.hasOwnProperty("v"))this.value=e.v;else if(e.hasOwnProperty("value"))this.value=e.value;if(e.hasOwnProperty("uiAttribs"))this.setUiAttribs(e.uiAttribs);if(e.clipId)this.clipId=e.clipId}this.emitChange()}getSerialized(){const e={};e.t=this.time;e.v=this.value;e.e=this._easing;e.uiAttribs=this.uiAttribs;if(this.clipId)e.clipId=this.clipId;if(this._easing===s.k.EASING_CUBICSPLINE){e.cp1=this.bezCp1;e.cp2=this.bezCp2}return e}getEasing(){return this._easing}easeCubicSpline(e,t){if(!this.bezAn){const i=30;this.bezAn=new s.k;for(let e=0;e<=i+1;e++){const r=l.cubicSpline(e/i,this,t);this.bezAn.setValue(r[0],r[1])}}return this.bezAn.getValue(this.time+e*(t.time-this.time))}easeLinear(e,t){return l.linear(e,this,t)}easeAbsolute(){return this.value}}l.cubicSpline=function(e,t,i){const r=1-e;const s=r*r;const n=e*e;const a=s*r;const o=3*s*e;const l=3*r*n;const h=n*e;t.bezCp1=t.bezCp1||[-.5,0];t.bezCp2=t.bezCp2||[.5,0];i.bezCp1=i.bezCp1||[-.5,0];i.bezCp2=i.bezCp2||[.5,0];const u=Math.min(i.time,t.bezCp2[0]+t.time);const c=Math.max(t.time,i.bezCp1[0]+i.time);const g=a*t.time+o*u+l*c+h*i.time;const f=a*t.value+o*(t.bezCp2[1]+t.value)+l*(i.bezCp1[1]+i.value)+h*i.value;return[g,f]};l.linear=function(e,t,i){return t.value+(i.value-t.value)*e};const r=function(e){return e=2**(10*(e-1))};l.easeExpoIn=function(e,t){e=r(e);return l.linear(e,this,t)};const n=function(e){e=-(2**(-10*e))+1;return e};l.easeExpoOut=function(e,t){e=n(e);return l.linear(e,this,t)};const a=function(e){e*=2;if(e<1){e=.5*2**(10*(e-1))}else{e--;e=.5*(-(2**(-10*e))+2)}return e};l.easeExpoInOut=function(e,t){e=a(e);return l.linear(e,this,t)};l.easeSinIn=function(e,t){e=-1*Math.cos(e*Math.PI/2)+1;return l.linear(e,this,t)};l.easeSinOut=function(e,t){e=Math.sin(e*Math.PI/2);return l.linear(e,this,t)};l.easeSinInOut=function(e,t){e=-.5*(Math.cos(Math.PI*e)-1);return l.linear(e,this,t)};const o=function(e){e=e*e*e;return e};l.easeCubicIn=function(e,t){e=o(e);return l.linear(e,this,t)};l.easeInQuint=function(e,t){e=e*e*e*e*e;return l.linear(e,this,t)};l.easeOutQuint=function(e,t){e=(e-=1)*e*e*e*e+1;return l.linear(e,this,t)};l.easeInOutQuint=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e*e;else e=.5*((e-=2)*e*e*e*e+2);return l.linear(e,this,t)};l.easeInQuart=function(e,t){e=e*e*e*e;return l.linear(e,this,t)};l.easeOutQuart=function(e,t){e=-1*((e-=1)*e*e*e-1);return l.linear(e,this,t)};l.easeInOutQuart=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e;else e=-.5*((e-=2)*e*e*e-2);return l.linear(e,this,t)};l.bounce=function(e){if((e/=1)<1/2.75)e=7.5625*e*e;else if(e<2/2.75)e=7.5625*(e-=1.5/2.75)*e+.75;else if(e<2.5/2.75)e=7.5625*(e-=2.25/2.75)*e+.9375;else e=7.5625*(e-=2.625/2.75)*e+.984375;return e};l.easeInBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeOutBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeInElastic=function(e,t){let i=1.70158;let r=0;let s=1;const n=0;const a=1;const o=1;if(e===0)e=n;else if((e/=a)==1)e=n+o;else{if(!r)r=a*.3;if(s<Math.abs(o)){s=o;i=r/4}else i=r/(2*Math.PI)*Math.asin(o/s);e=-(s*2**(10*(e-=1))*Math.sin((e*a-i)*(2*Math.PI)/r))+n}return l.linear(e,this,t)};l.easeOutElastic=function(e,t){let i=1.70158;let r=0;let s=1;const n=0;const a=1;const o=1;if(e===0)e=n;else if((e/=a)==1)e=n+o;else{if(!r)r=a*.3;if(s<Math.abs(o)){s=o;i=r/4}else i=r/(2*Math.PI)*Math.asin(o/s);e=s*2**(-10*e)*Math.sin((e*a-i)*(2*Math.PI)/r)+o+n}return l.linear(e,this,t)};l.easeInBack=function(e,t){const i=1.70158;e=e*e*((i+1)*e-i);return l.linear(e,this,t)};l.easeOutBack=function(e,t){const i=1.70158;e=(e=e/1-1)*e*((i+1)*e+i)+1;return l.linear(e,this,t)};l.easeInOutBack=function(e,t){let i=1.70158;const r=1/2;if((e/=1/2)<1)e=r*(e*e*(((i*=1.525)+1)*e-i));else e=r*((e-=2)*e*(((i*=1.525)+1)*e+i)+2);return l.linear(e,this,t)};const h=function(e){e--;e=e*e*e+1;return e};l.easeCubicOut=function(e,t){e=h(e);return l.linear(e,this,t)};const u=function(e){e*=2;if(e<1)e=.5*e*e*e;else{e-=2;e=.5*(e*e*e+2)}return e};l.easeCubicInOut=function(e,t){e=u(e);return l.linear(e,this,t)};l.easeSmoothStep=function(e,t){const i=Math.max(0,Math.min(1,e));e=i*i*(3-2*i);return l.linear(e,this,t)};l.easeSmootherStep=function(e,t){const i=Math.max(0,Math.min(1,(e-0)/(1-0)));e=i*i*i*(i*(i*6-15)+10);return l.linear(e,this,t)}},440:(e,t,i)=>{"use strict";i.d(t,{a:()=>s});var r=i(344);const s={ANIM:{EASINGS:r.k.EASINGNAMES,EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27,EASING_CLIP:28},OP:{OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_NUMBER:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_TRIGGER:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},PORT:{PORT_DIR_IN:0,PORT_DIR_OUT:1},PACO:{PACO_CLEAR:0,PACO_VALUECHANGE:1,PACO_OP_DELETE:2,PACO_UNLINK:3,PACO_LINK:4,PACO_LOAD:5,PACO_OP_CREATE:6,PACO_OP_ENABLE:7,PACO_OP_DISABLE:8,PACO_UIATTRIBS:9,PACO_VARIABLES:10,PACO_TRIGGERS:11,PACO_PORT_SETVARIABLE:12,PACO_PORT_SETANIMATED:13,PACO_PORT_ANIM_UPDATED:14,PACO_DESERIALIZE:15,PACO_OP_RELOAD:16}}},50:(e,t,i)=>{"use strict";i.d(t,{I:()=>l});var r=i(125);var s=i(849);var n=i(440);var a=i(562);var o=i(344);class l extends r.A{static DIR_IN=0;static DIR_OUT=1;static TYPE_VALUE=0;static TYPE_NUMBER=0;static TYPE_FUNCTION=1;static TYPE_TRIGGER=1;static TYPE_OBJECT=2;static TYPE_TEXTURE=2;static TYPE_ARRAY=3;static TYPE_DYNAMIC=4;static TYPE_STRING=5;static EVENT_UIATTRCHANGE="onUiAttrChange";static EVENT_VALUE_CHANGE="change";static EVENT_LINK_CHANGED="onLinkChanged";static EVENT_LINK_REMOVED="onLinkRemoved";#oldAnimVal=-5711;animMuted=false;lastAnimTime=0;#uiActiveState=true;#valueBeforeLink=null;#animated=false;#useVariableName=null;#op=null;constructor(e,t,i,r={}){super();this.data={};this._log=new s.A("core_port");this.direction=l.DIR_IN;this.id=String(CABLES.simpleId());this.#op=e;this.links=[];this.value=0;this.name=t;this.type=i||l.TYPE_VALUE;this.uiAttribs=r||{};this.anim=null;this.defaultValue=null;this.ignoreValueSerialize=false;this.onLinkChanged=null;this.crashed=false;this.onValueChanged=null;this.onTriggered=null;this.changeAlways=false;this.forceRefChange=false;this.activityCounter=0;this.apf=0;this.activityCounterStartFrame=0;this.canLink=null;this.preserveLinks=null;this.indexPort=null}get parent(){this._log.stack("use port.op, not .parent");return this.op}get title(){return this.uiAttribs.title||this.name}get op(){return this.#op}get val(){return this.get()}set val(e){this.setValue(e)}copyLinkedUiAttrib(e,t){if(!CABLES.UI)return;if(!this.isLinked())return;const i={};i[e]=this.links[0].getOtherPort(this).getUiAttrib(e);t.setUiAttribs(i)}getValueForDisplay(){let e=this.value;if(typeof this.value==="string"||this.value instanceof String){if(e.length>1e3){e=e.substring(0,999);e+="..."}if(this.uiAttribs&&this.uiAttribs.display=="boolnum"){e+=" - ";if(!this.value)e+="false";else e+="true"}e=e.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"});if(e.length>100)e=e.substring(0,100)}else{e=String(this.value)}return e}onAnimToggle(){}_onAnimToggle(){this.onAnimToggle()}remove(){this.removeLinks();this.#op.removePort(this)}setUiAttribs(e){let t=false;if(!this.uiAttribs)this.uiAttribs={};for(const i in e){if(e[i]===undefined){delete this.uiAttribs[i];continue}if(this.uiAttribs[i]!=e[i])t=true;this.uiAttribs[i]=e[i];if(i=="group"&&this.indexPort)this.indexPort.setUiAttribs({group:e[i]})}if(e.hasOwnProperty("expose"))this.#op.patch.emitEvent("subpatchExpose",this.#op.uiAttribs.subPatch);if(t)this.emitEvent(l.EVENT_UIATTRCHANGE,e,this)}getUiAttribs(){return this.uiAttribs}getUiAttrib(e){if(!this.uiAttribs||!this.uiAttribs.hasOwnProperty(e))return null;return this.uiAttribs[e]}get(){if(CABLES.UI&&this.#animated&&this.lastAnimTime==this.#op.patch.timer.getTime()&&!CABLES.UI.keyframeAutoCreate){return this.value}if(!this.animMuted&&this.#animated&&this.lastAnimFrame!=this.#op.patch.getFrameNum()){this.lastAnimTime=this.#op.patch.timer.getTime();this.lastAnimFrame=this.#op.patch.getFrameNum();let e=this.anim.getValue(this.#op.patch.timer.getTime());if(this.value!=e){this.value=e;this.#oldAnimVal=this.value;this.forceChange()}}return this.value}setRef(e){this.forceRefChange=true;this.set(e)}set(e){this.setValue(e)}setValue(t){if(t===undefined)t=null;if(CABLES.UI&&CABLES.UI.showDevInfos)if(this.direction==n.a.PORT.PORT_DIR_OUT&&this.type==l.TYPE_OBJECT&&t&&!this.forceRefChange)this._log.warn("object port ["+this.name+"] uses .set ["+this.op.objName+"]");if(this.#op.enabled&&!this.crashed){if(t!==this.value||this.changeAlways||this.type==l.TYPE_TEXTURE||this.type==l.TYPE_ARRAY){if(CABLES.UI&&this.#animated){CABLES.UI.PREVISKEYVAL=null;if(!CABLES.UI.keyframeAutoCreate)CABLES.UI.PREVISKEYVAL=t}if(CABLES.UI&&this.#animated&&CABLES.UI.keyframeAutoCreate){let e=this.#op.patch.timer.getTime();if(CABLES.UI&&CABLES.Patch.getGui().glTimeline)CABLES.Patch.getGui().glTimeline.createKey(this.anim,e,t);else this.anim.setValue(e,t)}else{try{this.value=t;this.forceChange()}catch(e){this.crashed=true;this.setValue=function(e){};this.onTriggered=function(){};this._log.error("exception in ",this.#op);this._log.error(e);this.#op.patch.emitEvent("exception",e,this.#op)}if(this.#op&&this.#op.patch&&this.#op.patch.isEditorMode()&&this.type==l.TYPE_TEXTURE)CABLES.Patch.getGui().texturePreview().updateTexturePort(this)}if(this.direction==n.a.PORT.PORT_DIR_OUT)for(let e=0;e<this.links.length;++e)this.links[e].setValue()}}}updateAnim(){if(!this.#animated||this.animMuted)return;this.value=this.get();if(this.#oldAnimVal!=this.value||this.changeAlways){this.#oldAnimVal=this.value;this.forceChange()}this.#oldAnimVal=this.value}forceChange(){if(this.onValueChanged||this.onChange){}this._activity();this.emitEvent(l.EVENT_VALUE_CHANGE,this.value,this);if(this.onChange)this.onChange(this,this.value);else if(this.onValueChanged)this.onValueChanged(this,this.value)}static getTypeString(e){if(e==l.TYPE_VALUE)return"Number";if(e==l.TYPE_FUNCTION)return"Trigger";if(e==l.TYPE_OBJECT)return"Object";if(e==l.TYPE_DYNAMIC)return"Dynamic";if(e==l.TYPE_ARRAY)return"Array";if(e==l.TYPE_STRING)return"String";return"Unknown"}getTypeString(){return l.getTypeString(this.type)}deSerializeSettings(e){if(!e)return;if(e.animated)this.setAnimated(e.animated);if(e.useVariable)this.setVariableName(e.useVariable);if(e.title)this.setUiAttribs({title:e.title});if(e.expose)this.setUiAttribs({expose:true});if(e.order)this.setUiAttribs({order:e.order});if(e.multiPortManual)this.setUiAttribs({multiPortManual:e.multiPortManual});if(e.multiPortNum)this.setUiAttribs({multiPortNum:e.multiPortNum});if(e.anim){if(!this.anim)this.anim=new o.k({name:"port "+this.name});this.#op.hasAnimPort=true;this.anim.port=this;this.anim.deserialize(e.anim,true,this.op.patch.clipAnims);this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.bindAnimListeners();this.anim.sortKeys()}}setInitialValue(e){if(this.op.preservedPortLinks[this.name]){for(let e=0;e<this.op.preservedPortLinks[this.name].length;e++){const t=this.op.preservedPortLinks[this.name][e];this.op.patch._addLink(t.objIn,t.objOut,t.portIn,t.portOut)}}if(this.op.preservedPortValues&&this.op.preservedPortValues.hasOwnProperty(this.name)&&this.op.preservedPortValues[this.name]!==undefined){this.set(this.op.preservedPortValues[this.name])}else if(e!==undefined)this.set(e);if(e!==undefined)this.defaultValue=e}getSerialized(){let t={name:this.getName()};if(!this.ignoreValueSerialize&&this.links.length===0){if(this.type==l.TYPE_OBJECT&&this.value&&this.value.tex){}else t.value=this.value}if(this.#useVariableName)t.useVariable=this.#useVariableName;if(this.#animated)t.animated=true;if(this.anim)t.anim=this.anim.getSerialized();if(this.uiAttribs.multiPortNum)t.multiPortNum=this.uiAttribs.multiPortNum;if(this.uiAttribs.multiPortManual)t.multiPortManual=this.uiAttribs.multiPortManual;if(this.uiAttribs.display=="file")t.display=this.uiAttribs.display;if(this.uiAttribs.expose){t.expose=true;if(this.uiAttribs.hasOwnProperty("order"))t.order=this.uiAttribs.order}if(this.uiAttribs.title)t.title=this.uiAttribs.title;if((this.preserveLinks||this.direction==n.a.PORT.PORT_DIR_OUT)&&this.links.length>0){t.links=[];for(const e in this.links){if(!this.links[e].ignoreInSerialize&&(this.links[e].portIn&&this.links[e].portOut))t.links.push(this.links[e].getSerialized())}}if(this.direction==l.DIR_IN&&this.links.length>0){for(const e in this.links){if(!this.links[e].portIn||!this.links[e].portOut)continue;const i=this.links[e].getOtherPort(this);if(i.op.isInBlueprint2&&this.op.isInBlueprint2){if(i.op.isInBlueprint2()&&!this.op.isInBlueprint2()){t.links=t.links||[];t.links.push(this.links[e].getSerialized())}}}}if(t.links&&t.links.length==0)delete t.links;if(this.type===l.TYPE_FUNCTION)delete t.value;if(this.type===l.TYPE_FUNCTION&&this.links.length==0)t=null;if(t&&Object.keys(t).length==1&&t.name)t=null;(0,a.cleanJson)(t);return t}shouldLink(e,t){return!!(e&&t)}removeLinks(){let e=0;while(this.links.length>0){e++;if(e>5e3){this._log.warn("could not delete links... / infinite loop");this.links.length=0;break}this.links[0].remove()}}removeLink(t){for(let e=0;e<this.links.length;e++)if(this.links[e]==t)this.links.splice(e,1);if(this.direction==l.DIR_IN){if(this.type==l.TYPE_VALUE)this.setValue(this.#valueBeforeLink||0);else this.setValue(this.#valueBeforeLink||null)}if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(l.EVENT_LINK_CHANGED);this.emitEvent(l.EVENT_LINK_REMOVED);this.#op.emitEvent(l.EVENT_LINK_CHANGED)}catch(e){this._log.error(e)}}getName(){return this.name}getTitle(){if(this.uiAttribs.title)return this.uiAttribs.title;return this.name}addLink(e){this.#valueBeforeLink=this.value;this.links.push(e);if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(l.EVENT_LINK_CHANGED);this.#op.emitEvent(l.EVENT_LINK_CHANGED)}catch(e){this._log.error(e)}}getLinkTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]}removeLinkTo(t){for(const e in this.links){if(this.links[e].portIn==t||this.links[e].portOut==t){this.links[e].remove();if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(l.EVENT_LINK_CHANGED);this.emitEvent(l.EVENT_LINK_REMOVED);return}}}isLinkedTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return true;return false}_activity(){this.activityCounter++}trigger(){const t=this.links.length;this._activity();if(t===0)return;if(!this.#op.enabled)return;let i=null;try{for(let e=0;e<t;++e){if(this.links[e].portIn){i=this.links[e].portIn;i.op.patch.pushTriggerStack(i);if(!i._onTriggered){console.log(i,i._onTriggered)}i._onTriggered();i.op.patch.popTriggerStack()}if(this.links[e])this.links[e].activity()}}catch(e){i.op.enabled=false;if(this.#op.patch.isEditorMode()){if(i.op.onError)i.op.onError(e)}this._log.error("exception in port: ",i.name,i.op.name,i.op.id);this._log.error(e)}}call(){this._log.warn("call deprecated - use trigger() ");this.trigger()}execute(){}setVariableName(e){this.#useVariableName=e;this.#op.patch.on("variableRename",(e,t)=>{if(e!=this.#useVariableName)return;this.#useVariableName=t})}getVariableName(){return this.#useVariableName}setVariable(e){this.setAnimated(false);const t={useVariable:false};if(this._variableIn&&this._varChangeListenerId){this._variableIn.off(this._varChangeListenerId);this._variableIn=null}if(e){this._variableIn=this.#op.patch.getVar(e);if(!this._variableIn){}else{if(this.type==l.TYPE_OBJECT){this._varChangeListenerId=this._variableIn.on("change",()=>{this.set(null);this.set(this._variableIn.getValue())})}else{this._varChangeListenerId=this._variableIn.on("change",this.set.bind(this))}this.set(this._variableIn.getValue())}this.#useVariableName=e;t.useVariable=true;t.variableName=this.#useVariableName}else{t.variableName=this.#useVariableName=null;t.useVariable=false}this.setUiAttribs(t);this.#op.patch.emitEvent("portSetVariable",this.#op,this,e)}_handleNoTriggerOpAnimUpdates(e){let t=false;if(!t){if(e)this._notriggerAnimUpdate=this.#op.patch.on("onRenderFrame",()=>{this.updateAnim()});else if(this._notriggerAnimUpdate)this._notriggerAnimUpdate=this.#op.patch.off(this._notriggerAnimUpdate)}}bindAnimListeners(){this.anim.on(o.k.EVENT_CHANGE,()=>{this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.updateAnimMaxTimeSoon()});this.anim.on(o.k.EVENT_KEY_DELETE,()=>{this.#op.patch.updateAnimMaxTimeSoon()})}setAnimated(e){let t=false;if(this.#animated!=e){this.#animated=e;this.#op.hasAnimPort=true;t=true}if(this.#animated&&!this.anim){this.anim=new o.k({name:"port "+this.name});this.bindAnimListeners()}if(this.#animated){let e=0;if(this.#op.patch.gui&&this.#op.patch.gui.glTimeline)e=this.#op.patch.timer.getTime();if(this.anim.keys.length==0)this.anim.setValue(e,this.value)}else{this.anim=null}this._handleNoTriggerOpAnimUpdates(e);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim);this.setUiAttribs({isAnimated:this.#animated});if(t)this._onAnimToggle()}toggleAnim(){this.setAnimated(!this.#animated);this.setUiAttribs({isAnimated:this.#animated});this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim)}getType(){return this.type}isLinked(){return this.links.length>0||this.#animated||this.#useVariableName!=null}isBoundToVar(){const e=this.#useVariableName!=null;this.uiAttribs.boundToVar=e;return e}isAnimated(){return this.#animated}isHidden(){return this.uiAttribs.hidePort}_onTriggered(){this._activity();this.#op.updateAnims();if(this.#op.enabled&&this.onTriggered)this.onTriggered();if(this.#op.enabled)this.emitEvent("trigger")}_onSetProfiling(e){if(this.op.patch.debuggerEnabled){const t=e;this.op.patch.emitEvent("debuggerstep",{opname:this.op.name,opid:this.op.id,portname:this.name,log:this.op.name+" - port "+this.name+": set value to "+e,exec:()=>{this.setValue(t)}});return}this.#op.patch.profiler.add("port",this);this.setValue(e);this.#op.patch.profiler.add("port",null)}_onTriggeredProfiling(){if(this.#op.enabled&&this.onTriggered){if(this.op.patch.debuggerEnabled){console.log();this.op.patch.emitEvent("debuggerstep",{opname:this.op.name,opid:this.op.id,portname:this.name,log:this.op.name+" - triggered "+this.name,exec:()=>{this.onTriggered()}});return}this.#op.patch.profiler.add("port",this);this.onTriggered();this.#op.patch.profiler.add("port",null)}}onValueChange(e){this.onChange=e}hidePort(){}static portTypeNumberToString(e){if(e==l.TYPE_VALUE)return"value";if(e==l.TYPE_FUNCTION)return"function";if(e==l.TYPE_OBJECT)return"object";if(e==l.TYPE_ARRAY)return"array";if(e==l.TYPE_STRING)return"string";if(e==l.TYPE_DYNAMIC)return"dynamic";return"unknown"}}},606:(w,e,t)=>{"use strict";t.r(e);t.d(e,{Anim:()=>p.k,AnimKey:()=>N.rA,CONSTANTS:()=>F.a,EMBED:()=>O,Link:()=>m,LoadingStatus:()=>v,Op:()=>R,Patch:()=>D,PatchVariable:()=>C,Port:()=>b.I,Profiler:()=>T,Timer:()=>x.M4,default:()=>y,now:()=>x.tB,utils:()=>E});var i={};t.r(i);t.d(i,{glMatrix:()=>r,mat2:()=>s,mat2d:()=>n,mat3:()=>a,mat4:()=>o,quat:()=>l,quat2:()=>h,vec2:()=>u,vec3:()=>c,vec4:()=>g});var r=t(823);var s=t(522);var n=t(964);var a=t(409);var o=t(684);var l=t(221);var h=t(991);var u=t(842);var c=t(329);var g=t(796);var f=t(125);var d=t(849);var E=t(562);var p=t(344);var b=t(50);class m extends f.A{constructor(e){super();this.id=CABLES.simpleId();this.portIn=null;this.portOut=null;this._patch=e;this.activityCounter=0;this.ignoreInSerialize=false}setValue(e){if(e===undefined)this._setValue();else this.portIn.set(e)}activity(){this.activityCounter++}_setValue(){if(!this.portOut){this.remove();return}const e=this.portOut.get();if(e==e){if(this.portIn.type!=b.I.TYPE_FUNCTION)this.activity();if(this.portIn.get()!==e){this.portIn.set(e)}else{if(this.portIn.changeAlways)this.portIn.set(e);if(this.portOut.forceRefChange)this.portIn.forceChange()}}}getOtherPort(e){if(e==this.portIn)return this.portOut;return this.portIn}remove(){if(this.portIn)this.portIn.removeLink(this);if(this.portOut)this.portOut.removeLink(this);if(this._patch){this._patch.emitEvent("onUnLink",this.portIn,this.portOut,this)}if(this.portIn&&(this.portIn.type==b.I.TYPE_OBJECT||this.portIn.type==b.I.TYPE_ARRAY)){this.portIn.set(null);if(this.portIn.links.length>0)this.portIn.set(this.portIn.links[0].getOtherPort(this.portIn).get())}if(this.portIn)this.portIn.op._checkLinksNeededToWork();if(this.portOut)this.portOut.op._checkLinksNeededToWork();this.portIn=null;this.portOut=null;this._patch=null}link(e,t){if(!m.canLink(e,t)){console.warn("[core_link] cannot link ports!",e,t);return false}if(e.direction==b.I.DIR_IN){this.portIn=e;this.portOut=t}else{this.portIn=t;this.portOut=e}e.addLink(this);t.addLink(this);this.setValue();e.op._checkLinksNeededToWork();t.op._checkLinksNeededToWork()}getSerialized(){const e={};e.portIn=this.portIn.getName();e.portOut=this.portOut.getName();e.objIn=this.portIn.op.id;e.objOut=this.portOut.op.id;return e}static canLinkText(e,t){if(e.direction==t.direction){let e="(out)";if(t.direction==b.I.DIR_IN)e="(in)";return"can not link: same direction "+e}if(e.op==t.op)return"can not link: same op";if(e.type!=b.I.TYPE_DYNAMIC&&t.type!=b.I.TYPE_DYNAMIC){if(e.type!=t.type)return"can not link: different type"}if(CABLES.UI&&e.type==b.I.TYPE_OBJECT&&t.type==b.I.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType)if(e.uiAttribs.objType!=t.uiAttribs.objType)return"incompatible objects"}if(!e)return"can not link: port 1 invalid";if(!t)return"can not link: port 2 invalid";if(e.direction==b.I.DIR_IN&&e.isAnimated())return"can not link: is animated";if(t.direction==b.I.DIR_IN&&t.isAnimated())return"can not link: is animated";if(e.isLinkedTo(t))return"ports already linked";if(e.canLink&&!e.canLink(t)||t.canLink&&!t.canLink(e))return"Incompatible";return"can link"}static canLink(e,t){if(!e)return false;if(!t)return false;if(e.direction==b.I.DIR_IN&&e.isAnimated())return false;if(t.direction==b.I.DIR_IN&&t.isAnimated())return false;if(e.isHidden()||t.isHidden())return false;if(e.isLinkedTo(t))return false;if(e.direction==t.direction)return false;if(CABLES.UI&&e.type==b.I.TYPE_OBJECT&&t.type==b.I.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType){if(e.uiAttribs.objType.indexOf("sg_")==0&&t.uiAttribs.objType.indexOf("sg_")==0)return true;if(e.uiAttribs.objType!=t.uiAttribs.objType)return false}}if(e.type!=t.type&&(e.type!=b.I.TYPE_DYNAMIC&&t.type!=b.I.TYPE_DYNAMIC))return false;if(e.type==b.I.TYPE_DYNAMIC||t.type==b.I.TYPE_DYNAMIC)return true;if(e.op==t.op)return false;if(e.canLink&&!e.canLink(t))return false;if(t.canLink&&!t.canLink(e))return false;return true}}var _=t(772);var A=t(308);var F=t(440);class v extends f.A{constructor(e){super();this._log=new d.A("LoadingStatus");this._loadingAssets={};this._cbFinished=[];this._assetTasks=[];this._percent=0;this._count=0;this._countFinished=0;this._order=0;this._startTime=0;this._patch=e;this._wasFinishedPrinted=false;this._loadingAssetTaskCb=false}setOnFinishedLoading(e){this._cbFinished.push(e)}getNumAssets(){return this._countFinished}getProgress(){return this._percent}checkStatus(){this._countFinished=0;this._count=0;for(const e in this._loadingAssets){this._count++;if(!this._loadingAssets[e].finished){this._countFinished++}}this._percent=(this._count-this._countFinished)/this._count;if(this._countFinished===0){for(let e=0;e<this._cbFinished.length;e++){if(this._cbFinished[e]){const t=this._cbFinished[e];setTimeout(()=>{t(this._patch);this.emitEvent("finishedAll")},100)}}if(!this._wasFinishedPrinted){this._wasFinishedPrinted=true;this.print()}this.emitEvent("finishedAll")}}getList(){let t=[];for(const e in this._loadingAssets){t.push(this._loadingAssets[e])}return t}getListJobs(){let t=[];for(const e in this._loadingAssets){if(!this._loadingAssets[e].finished)t.push(this._loadingAssets[e].name)}return t}print(){if(this._patch.config.silent)return;const t=[];for(const e in this._loadingAssets){t.push([this._loadingAssets[e].order,this._loadingAssets[e].type,this._loadingAssets[e].name,(this._loadingAssets[e].timeEnd-this._loadingAssets[e].timeStart)/1e3+"s"])}this._log.groupCollapsed("finished loading "+this._order+" assets in "+(Date.now()-this._startTime)/1e3+"s");this._log.table(t);this._log.groupEnd()}finished(e){const t=this._loadingAssets[e];if(t){if(t.finished)this._log.warn("loading job was already finished",t);if(t.op)t.op.setUiAttribs({loading:false});t.finished=true;t.timeEnd=Date.now()}this.checkStatus();this.emitEvent("finishedTask");return null}_startAssetTasks(){for(let e=0;e<this._assetTasks.length;e++)this._assetTasks[e]();this._assetTasks.length=0}addAssetLoadingTask(e){if(this._patch.isEditorMode()&&!CABLES.UI.loaded){this._assetTasks.push(e);if(!this._loadingAssetTaskCb)window.gui.addEventListener("uiloaded",this._startAssetTasks.bind(this));this._loadingAssetTaskCb=true}else{e()}this.emitEvent("addAssetTask")}existByName(t){for(let e in this._loadingAssets){if(this._loadingAssets[e].name==t&&!this._loadingAssets[e].finished)return true}}start(e,t,i){if(this._startTime==0)this._startTime=Date.now();const r=(0,E.generateUUID)();t=t||"unknown";if(t.length>100)t=t.substring(0,100);if(i)i.setUiAttrib({loading:true});this._loadingAssets[r]={id:r,op:i,type:e,name:t,finished:false,timeStart:Date.now(),order:this._order};this._order++;this.emitEvent("startTask");return r}}var x=t(920);class T{constructor(e){this.startFrame=e.getFrameNum();this.items={};this.currentId=null;this.currentStart=0;this._patch=e}getItems(){return this.items}clear(){this.currentStart=performance.now();if(this.paused)return;this.items={}}togglePause(){this.paused=!this.paused;if(!this.paused){this.items={};this.currentStart=performance.now()}}add(e,t){if(this.paused)return;if(this.currentId!==null){if(!t||t.id!=this.currentId){const i=this.items[this.currentId];if(i){i.timeUsed+=performance.now()-this.currentStart;i._timePsCount++;i._timePsMs+=performance.now()-this.currentStart;if(i._timePsStart==0||performance.now()>i._timePsStart+1e3){i.timePsMs=i._timePsMs;i.timePsMsAvg=i._timePsMs/i._timePsCount;i.timePsCount=i._timePsCount;i._timePsCount=0;i._timePsMs=0;i._timePsStart=performance.now()}if(!i.peakTime||(0,x.tB)()-i.peakTime>5e3){i.peak=0;i.peakTime=(0,x.tB)()}i.peak=Math.max(i.peak,performance.now()-this.currentStart)}}}if(t!==null){if(!this.items[t.id]){this.items[t.id]={numTriggers:0,timeUsed:0,timeUsedFrame:0,timePsMsAvg:0,timePsMs:0,_timePsCount:0,_timePsMs:0,_timePsStart:performance.now()}}if(this.items[t.id].lastFrame!=this._patch.getFrameNum())this.items[t.id].numTriggers=0;this.items[t.id].lastFrame=this._patch.getFrameNum();this.items[t.id].numTriggers++;this.items[t.id].opid=t.op.id;this.items[t.id].title=t.op.name+"."+t.name;this.items[t.id].subPatch=t.op.uiAttribs.subPatch;this.currentId=t.id;this.currentStart=performance.now()}else{this.currentId=null}}print(){console.log("--------");for(const e in this.items){console.log(this.items[e].title+": "+this.items[e].numTriggers+" / "+this.items[e].timeUsed)}}}class C extends f.A{#name;constructor(e,t,i){super();this.#name=e;this.type=i;this.setValue(t)}addListener(e){this.on("change",e,"var")}getValue(){return this._v}get name(){return this.#name}getName(){return this.#name}setValue(e){this._v=e;this.emitEvent("change",e,this)}}class D extends f.A{static EVENT_OP_DELETED="onOpDelete";static EVENT_OP_ADDED="onOpAdd";static EVENT_PAUSE="pause";static EVENT_RESUME="resume";static EVENT_PATCHLOADEND="patchLoadEnd";static EVENT_VARIABLES_CHANGED="variablesChanged";static EVENT_RENDER_FRAME="onRenderFrame";static EVENT_RENDERED_ONE_FRAME="renderedOneFrame";static EVENT_LINK="onLink";static EVENT_VALUESSET="loadedValueSet";static EVENT_ANIM_MAXTIME_CHANGE="animmaxtimechange";#renderOneFrame=false;#initialDeserialize=true;ops=[];settings={};animMaxTime=0;missingClipAnims={};constructor(e){super();this._log=new d.A("core_patch",{onError:e.onError});this.config=e||{glCanvasResizeToWindow:false,prefixAssetPath:"",prefixJsPath:"",silent:true,onError:null,onFinishedLoading:null,onFirstFrameRendered:null,onPatchLoaded:null,fpsLimit:0};this.timer=new x.M4;this.freeTimer=new x.M4;this.animFrameOps=[];this.animFrameCallbacks=[];this.gui=false;CABLES.logSilent=this.silent=true;this.profiler=null;this.aborted=false;this._crashedOps=[];this._animReq=null;this._opIdCache={};this._triggerStack=[];this.storeObjNames=false;this.loading=new v(this);this._volumeListeners=[];this._paused=false;this._frameNum=0;this.onOneFrameRendered=null;this.namedTriggers={};this._origData=null;this._frameNext=0;this._frameInterval=0;this._lastFrameTime=0;this._frameWasdelayed=true;this.tempData=this.frameStore={};this.reqAnimTimeStamp=0;this.cgCanvas=null;if(!function(){return!this}())console.log("not in strict mode: core patch");if(this.config.hasOwnProperty("silent"))this.silent=CABLES.logSilent=this.config.silent;if(!this.config.hasOwnProperty("doRequestAnimation"))this.config.doRequestAnimation=true;if(!this.config.prefixAssetPath)this.config.prefixAssetPath="";if(!this.config.prefixJsPath)this.config.prefixJsPath="";if(!this.config.masterVolume)this.config.masterVolume=1;this._variables={};this.vars={};if(e&&e.vars)this.vars=e.vars;this.cgl=new _.Rq.Context(this);this.cgp=null;this._subpatchOpCache={};this.cgl.setCanvas(this.config.glCanvasId||this.config.glCanvas||"glcanvas");if(this.config.glCanvasResizeToWindow===true)this.cgl.setAutoResize("window");if(this.config.glCanvasResizeToParent===true)this.cgl.setAutoResize("parent");this.loading.setOnFinishedLoading(this.config.onFinishedLoading);if(this.cgl.aborted)this.aborted=true;if(this.cgl.silent)this.silent=true;if(!CABLES.OPS){this.aborted=true;throw new Error("no CABLES.OPS found")}this.freeTimer.play();this.exec();if(!this.aborted){if(this.config.patch){this.deSerialize(this.config.patch)}else if(this.config.patchFile){(0,E.ajax)(this.config.patchFile,(e,t)=>{try{const i=JSON.parse(t);if(e){const r="";this._log.error("err",e);this._log.error("data",i);this._log.error("data",i.msg);return}this.deSerialize(i)}catch(e){this._log.error("could not load/parse patch ",e)}})}this.timer.play()}console.log("made with https://cables.gl");this.cg=undefined}static getGui(){return window.gui}isPlaying(){return!this._paused}renderOneFrame(){this._paused=true;this._renderOneFrame=true;this.exec();this._renderOneFrame=false}isEditorMode(){return this.config.editorMode===true}pause(){cancelAnimationFrame(this._animReq);this.emitEvent(D.EVENT_PAUSE);this._animReq=null;this._paused=true;this.freeTimer.pause()}resume(){if(this._paused){cancelAnimationFrame(this._animReq);this._paused=false;this.freeTimer.play();this.emitEvent(D.EVENT_RESUME);this.exec()}}setVolume(t){this.config.masterVolume=t;for(let e=0;e<this._volumeListeners.length;e++)this._volumeListeners[e].onMasterVolumeChanged(t)}getAssetPath(t=null){if(this.config.hasOwnProperty("assetPath")){return this.config.assetPath}else if(this.isEditorMode()){let e=t||D.getGui().project()._id;return"/assets/"+e+"/"}else if(document.location.href.indexOf("cables.gl")>0||document.location.href.indexOf("cables.local")>0){const i=document.location.pathname.split("/");let e=t||i[i.length-1];return"/assets/"+e+"/"}else{return"assets/"}}getJsPath(){if(this.config.hasOwnProperty("jsPath")){return this.config.jsPath}else{return"js/"}}getFilePath(e){if(!e)return e;e=String(e);if(e.indexOf("https:")===0||e.indexOf("http:")===0)return e;if(e.indexOf("data:")===0)return e;if(e.indexOf("file:")===0)return e;e=e.replace("//","/");if(e.startsWith(this.config.prefixAssetPath))e=e.replace(this.config.prefixAssetPath,"");return this.config.prefixAssetPath+e+(this.config.suffixAssetPath||"")}clear(){this.emitEvent("patchClearStart");this.cgl.TextureEffectMesh=null;this.animFrameOps.length=0;this.timer=new x.M4;while(this.ops.length>0)this.deleteOp(this.ops[0].id);this._opIdCache={};this.emitEvent("patchClearEnd")}createOp(e,t,i=null){let r=null;let s="";try{if(!e){console.error("createop identifier false",e);console.log((new Error).stack);return}if(e.indexOf("Ops.")===-1){const n=e;if(CABLES.OPS[n]){s=CABLES.OPS[n].objName;r=new CABLES.OPS[n].f(this,s,t,n);r.opId=n}else{if(i){e=i;this._log.warn("could not find op by id: "+n)}else{throw new Error("could not find op by id: "+n,{cause:"opId:"+n})}}}if(!r){s=e;const a=e.split(".");const o=D.getOpClass(s);if(!o){this.emitEvent("criticalError",{title:"Unknown op: "+s,text:"Unknown op: "+s});this._log.error("unknown op: "+s);throw new Error("unknown op: "+s)}else{if(a.length==2)r=new window[a[0]][a[1]](this,s,t);else if(a.length==3)r=new window[a[0]][a[1]][a[2]](this,s,t);else if(a.length==4)r=new window[a[0]][a[1]][a[2]][a[3]](this,s,t);else if(a.length==5)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]](this,s,t);else if(a.length==6)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]](this,s,t);else if(a.length==7)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]](this,s,t);else if(a.length==8)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]](this,s,t);else if(a.length==9)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]][a[8]](this,s,t);else if(a.length==10)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]][a[8]][a[9]](this,s,t);else console.log("parts.length",a.length)}if(r){r.opId=null;for(const e in CABLES.OPS){if(CABLES.OPS[e].objName==s)r.opId=e}}}}catch(e){this._crashedOps.push(s);this._log.error("[instancing error] "+s,e);if(!this.isEditorMode()){this._log.error("INSTANCE_ERR","Instancing Error: "+s,e)}else{if(this.#initialDeserialize)D.getGui().patchView.store.opCrashed=true}}if(r){r._objName=s;r.patch=this}else{this._log.log("no op was created!?",e,t)}return r}addOp(e,t,i,r=false,s=null){const n=this.createOp(e,i,s);if(n){t=t||{};if(t.hasOwnProperty("errors"))delete t.errors;if(t.hasOwnProperty("error"))delete t.error;t.subPatch=t.subPatch||0;n.setUiAttribs(t);if(n.onCreate)n.onCreate();if(n.hasOwnProperty("onAnimFrame"))this.addOnAnimFrame(n);if(n.hasOwnProperty("onMasterVolumeChanged"))this._volumeListeners.push(n);if(this._opIdCache[n.id]){this._log.warn("opid with id "+n.id+" already exists in patch!");this.deleteOp(n.id)}this.ops.push(n);this._opIdCache[n.id]=n;if(this._subPatchCacheAdd)this._subPatchCacheAdd(t.subPatch,n);this.emitEvent(D.EVENT_OP_ADDED,n,r);if(n.init)n.init();n.emitEvent(R.EVENT_INIT,r)}else{this._log.error("addop: op could not be created: ",e)}return n}addOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t){return}this.animFrameOps.push(t)}removeOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++){if(this.animFrameOps[e]==t){this.animFrameOps.splice(e,1);return}}}addOnAnimFrameCallback(e){this.animFrameCallbacks.push(e)}removeOnAnimCallback(t){for(let e=0;e<this.animFrameCallbacks.length;e++){if(this.animFrameCallbacks[e]==t){this.animFrameCallbacks.splice(e,1);return}}}updateAnimMaxTimeSoon(){if(this.toAnimMaxTime)clearTimeout(this.toAnimMaxTime);this.toAnimMaxTime=setTimeout(()=>{this.updateAnimMaxTime()},50)}updateAnimMaxTime(){let i=0;for(let t=0;t<this.ops.length;t++){if(this.ops[t].hasAnimPort){for(let e=0;e<this.ops[t].portsIn.length;e++){if(this.ops[t].portsIn[e].anim){if(this.ops[t].portsIn[e].anim.lastKey&&this.ops[t].portsIn[e].anim.lastKey.time>i){i=this.ops[t].portsIn[e].anim.lastKey.time}}}}}if(i!=this.animMaxTime){this.animMaxTime=i;this.emitEvent(D.EVENT_ANIM_MAXTIME_CHANGE)}}deleteOp(r,s,n){let a=false;for(let i=0;i<this.ops.length;i++){if(this.ops[i].id==r){const o=this.ops[i];let e=null;let t=null;if(o){a=true;if(s){if(o.portsIn.length>0&&o.portsIn[0].isLinked()&&(o.portsOut.length>0&&o.portsOut[0].isLinked())){if(o.portsIn[0].getType()==o.portsOut[0].getType()&&o.portsIn[0].links[0]){e=o.portsIn[0].links[0].getOtherPort(o.portsIn[0]);t=o.portsOut[0].links[0].getOtherPort(o.portsOut[0])}}}const l=this.ops[i];l.removeLinks();this.ops.splice(i,1);l.emitEvent("delete",l);this.emitEvent(D.EVENT_OP_DELETED,l,n);if(this.clearSubPatchCache)this.clearSubPatchCache(l.uiAttribs.subPatch);if(l.onDelete)l.onDelete(n);l.cleanUp();if(e!==null&&t!==null){this.link(e.op,e.getName(),t.op,t.getName())}delete this._opIdCache[r];break}}}if(!a)this._log.warn("core patch deleteop: not found...",r)}getFrameNum(){return this._frameNum}emitOnAnimFrameEvent(t,i){t=t||this.timer.getTime();for(let e=0;e<this.animFrameCallbacks.length;++e)if(this.animFrameCallbacks[e])this.animFrameCallbacks[e](t,this._frameNum,i);for(let e=0;e<this.animFrameOps.length;++e)if(this.animFrameOps[e].onAnimFrame)this.animFrameOps[e].onAnimFrame(t,this._frameNum,i)}renderFrame(e){this.timer.update(this.reqAnimTimeStamp);this.freeTimer.update(this.reqAnimTimeStamp);const t=this.timer.getTime();const i=performance.now();this.cgl.frameStartTime=this.timer.getTime();const r=e-this.reqAnimTimeStamp||e;this.emitOnAnimFrameEvent(null,r);this.cgl.profileData.profileFrameDelta=r;this.reqAnimTimeStamp=e;this.cgl.profileData.profileOnAnimFrameOps=performance.now()-i;this.emitEvent(D.EVENT_RENDER_FRAME,t);this._frameNum++;if(this._frameNum==1){if(this.config.onFirstFrameRendered)this.config.onFirstFrameRendered()}}exec(e){if(!this.#renderOneFrame&&(this._paused||this.aborted))return;this.emitEvent("reqAnimFrame");cancelAnimationFrame(this._animReq);this.config.fpsLimit=this.config.fpsLimit||0;if(this.config.fpsLimit){this._frameInterval=1e3/this.config.fpsLimit}const t=CABLES.now();const i=t-this._frameNext;if(this.isEditorMode()){if(!this.#renderOneFrame){if(t-this._lastFrameTime>=500&&this._lastFrameTime!==0&&!this._frameWasdelayed){this._lastFrameTime=0;setTimeout(this.exec.bind(this),500);this.emitEvent("renderDelayStart");this._frameWasdelayed=true;return}}}if(this.#renderOneFrame||this.config.fpsLimit===0||i>this._frameInterval||this._frameWasdelayed){this.renderFrame(e);if(this._frameInterval)this._frameNext=t-i%this._frameInterval}if(this._frameWasdelayed){this.emitEvent("renderDelayEnd");this._frameWasdelayed=false}if(this.#renderOneFrame){if(this.onOneFrameRendered)this.onOneFrameRendered();this.emitEvent(D.EVENT_RENDERED_ONE_FRAME);this._renderOneFrame=false}if(this.config.doRequestAnimation)this._animReq=this.cgl.canvas.ownerDocument.defaultView.requestAnimationFrame(this.exec.bind(this))}link(e,t,i,r,s=false,n=false){if(!e)return this._log.warn("link: op1 is null ");if(!i)return this._log.warn("link: op2 is null");const a=e.getPort(t,s);const o=i.getPort(r,s);if(!a)return this._log.warn("port1 not found! "+t+" ("+e.objName+")");if(!o)return this._log.warn("port2 not found! "+r+" of "+i.name+"("+i.objName+")",i);if(!a.shouldLink(a,o)||!o.shouldLink(a,o))return false;if(m.canLink(a,o)){const l=new m(this);l.link(a,o);this.emitEvent(D.EVENT_LINK,a,o,l,n);return l}}serialize(e){const t={};e=e||{};t.ops=[];t.settings=this.settings;for(let e=0;e<this.ops.length;e++){const i=this.ops[e];if(i&&i.getSerialized)t.ops.push(i.getSerialized())}(0,E.cleanJson)(t);if(e.asObject)return t;return JSON.stringify(t)}getOpsByRefId(t){const e=D.getGui().uiProfiler.start("[corepatchetend] getOpsByRefId");const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].storage&&this.ops[e].storage.ref==t)i.push(this.ops[e]);e.finish();return i}getOpById(e){return this._opIdCache[e]}getOpsByObjName(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].objName==t)i.push(this.ops[e]);return i}getOpsByOpId(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].opId==t)i.push(this.ops[e]);return i}getSubPatchOpsByName(t,i){const r=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)r.push(this.ops[e]);return r}getSubPatchOp(e,t){return this.getFirstSubPatchOpByName(e,t)}getFirstSubPatchOpByName(t,i){for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)return this.ops[e];return null}_addLink(e,t,i,r){return this.link(this.getOpById(e),i,this.getOpById(t),r,false,true)}logStartup(e){if(window.logStartup)window.logStartup(e)}deSerialize(a,e={genIds:false,createRef:false}){if(this.aborted)return;const r=[];const t=this.loading.start("core","deserialize");if(typeof a==="string")a=JSON.parse(a);if(this.#initialDeserialize){this.namespace=a.namespace||"";this.name=a.name||"";this.settings=a.settings}this.emitEvent("patchLoadStart");a.ops=a.ops||[];this.logStartup("add "+a.ops.length+" ops... ");const s=[];for(let i=0;i<a.ops.length;i++){const n=CABLES.now();const o=a.ops[i];let t=null;try{if(o.opId)t=this.addOp(o.opId,o.uiAttribs,o.id,true,o.objName);else t=this.addOp(o.objName,o.uiAttribs,o.id,true)}catch(e){this._log.error("[instancing error] op data:",o,e)}if(t){s.push(t);if(e.genIds)t.id=(0,E.shortId)();t.portsInData=o.portsIn;t._origData=JSON.parse(JSON.stringify(o));t.storage=o.storage;if(o.portsIn)for(let e=0;e<o.portsIn.length;e++){const h=o.portsIn[e];if(h&&h.hasOwnProperty("name")){const u=t.getPort(h.name);if(u&&(u.uiAttribs.display=="bool"||u.uiAttribs.type=="bool")&&!isNaN(h.value))h.value=h.value==true?1:0;if(u&&h.value!==undefined&&u.type!=b.I.TYPE_TEXTURE)u.set(h.value);if(u){u.deSerializeSettings(h)}else{t.preservedPortValues=t.preservedPortValues||{};t.preservedPortValues[h.name]=h.value}}}if(o.portsOut)for(let e=0;e<o.portsOut.length;e++){const h=o.portsOut[e];if(h&&h.hasOwnProperty("name")){const c=t.getPort(h.name);if(c){c.deSerializeSettings(h);if(c.uiAttribs.hasOwnProperty("title")){t.preservedPortTitles=t.preservedPortTitles||{};t.preservedPortTitles[c.name]=c.uiAttribs.title}if(c.type!=b.I.TYPE_TEXTURE&&h.hasOwnProperty("value"))c.set(a.ops[i].portsOut[e].value);if(h.expose)c.setUiAttribs({expose:true})}}}r.push(t)}const l=Math.round(100*(CABLES.now()-n))/100;if(!this.silent&&l>5)console.log("long op init ",a.ops[i].objName,l)}this.logStartup("add ops done");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoadedValueSet){this.ops[e].onLoadedValueSet(this.ops[e]._origData);this.ops[e].onLoadedValueSet=null;this.ops[e]._origData=null}this.ops[e].emitEvent(D.EVENT_VALUESSET)}this.logStartup("creating links");if(e.opsCreated)e.opsCreated(s);if(a.ops){for(let n=0;n<a.ops.length;n++){if(a.ops[n].portsIn){for(let t=0;t<a.ops[n].portsIn.length;t++){if(a.ops[n].portsIn[t]&&a.ops[n].portsIn[t].links){for(let e=0;e<a.ops[n].portsIn[t].links.length;e++){this._addLink(a.ops[n].portsIn[t].links[e].objIn,a.ops[n].portsIn[t].links[e].objOut,a.ops[n].portsIn[t].links[e].portIn,a.ops[n].portsIn[t].links[e].portOut)}}}}if(a.ops[n].portsOut)for(let s=0;s<a.ops[n].portsOut.length;s++)if(a.ops[n].portsOut[s]&&a.ops[n].portsOut[s].links){for(let r=0;r<a.ops[n].portsOut[s].links.length;r++){if(a.ops[n].portsOut[s].links[r]){if(a.ops[n].portsOut[s].links[r].subOpRef){const g=this.getOpById(a.ops[n].portsOut[s].links[r].objOut);let t=null;let i=0;for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==a.ops[n].portsOut[s].links[r].subOpRef&&g.uiAttribs.subPatch==this.ops[e].uiAttribs.subPatch){i=this.ops[e].patchId.get();break}}for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==a.ops[n].portsOut[s].links[r].refOp&&this.ops[e].uiAttribs.subPatch==i){t=this.ops[e];break}}if(!t)this._log.warn("could not find op for lost link");else{this._addLink(t.id,a.ops[n].portsOut[s].links[r].objOut,a.ops[n].portsOut[s].links[r].portIn,a.ops[n].portsOut[s].links[r].portOut)}}else{const i=this._addLink(a.ops[n].portsOut[s].links[r].objIn,a.ops[n].portsOut[s].links[r].objOut,a.ops[n].portsOut[s].links[r].portIn,a.ops[n].portsOut[s].links[r].portOut);if(!i){const f=this.getOpById(a.ops[n].portsOut[s].links[r].objIn);const d=this.getOpById(a.ops[n].portsOut[s].links[r].objOut);if(!f)console.log("could not find link op1");if(!d)console.log("could not find link op2");const p=a.ops[n].portsOut[s].links[r].portIn;if(f&&!f.getPort(p)){f.preservedPortLinks[p]=f.preservedPortLinks[p]||[];f.preservedPortLinks[p].push(a.ops[n].portsOut[s].links[r])}const m=a.ops[n].portsOut[s].links[r].portOut;if(d&&!d.getPort(m)){d.preservedPortLinks[p]=d.preservedPortLinks[p]||[];d.preservedPortLinks[p].push(a.ops[n].portsOut[s].links[r])}}}}}}}}this.logStartup("calling ops onloaded");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoaded){this.ops[e].onLoaded();this.ops[e].onLoaded=null}}this.logStartup("initializing ops...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].init){try{this.ops[e].init();this.ops[e].init=null}catch(e){console.error("op.init crash",e)}}}this.logStartup("initializing vars...");if(this.config.variables)for(const _ in this.config.variables)this.setVarValue(_,this.config.variables[_]);this.logStartup("initializing var ports");for(let e=0;e<this.ops.length;e++){this.ops[e].initVarPorts();delete this.ops[e].uiAttribs.pasted}setTimeout(()=>{this.loading.finished(t)},100);this.updateAnimMaxTime();if(this.config.onPatchLoaded)this.config.onPatchLoaded(this);this.emitEvent(D.EVENT_PATCHLOADEND,r,a,e.genIds);this.#initialDeserialize=false}profile(e){this.profiler=new T(this);for(let e=0;e<this.ops.length;e++)this.ops[e].profile()}setVariable(e,t){if(this._variables[e]!==undefined){this._variables[e].setValue(t)}else{this._log.warn("variable "+e+" not found!")}}_sortVars(){if(!this.isEditorMode())return;const t={};Object.keys(this._variables).sort((e,t)=>{return e.localeCompare(t,"en",{sensitivity:"base"})}).forEach(e=>{t[e]=this._variables[e]});this._variables=t}hasVar(e){return this._variables[e]!==undefined}setVarValue(e,t,i){if(this.hasVar(e)){this._variables[e].setValue(t)}else{this._variables[e]=new C(e,t,i);this._sortVars();this.emitEvent(D.EVENT_VARIABLES_CHANGED)}return this._variables[e]}getVarValue(e,t){if(this._variables.hasOwnProperty(e))return this._variables[e].getValue()}getVar(e){if(this._variables.hasOwnProperty(e))return this._variables[e]}deleteVar(i){for(let t=0;t<this.ops.length;t++)for(let e=0;e<this.ops[t].portsIn.length;e++)if(this.ops[t].portsIn[e].getVariableName()==i)this.ops[t].portsIn[e].setVariable(null);delete this._variables[i];this.emitEvent("variableDeleted",i);this.emitEvent("variablesChanged")}getVars(t){if(t===undefined)return this._variables;if(t===1)return{};const e=D.getGui().uiProfiler.start("[corepatchetend] getVars");const i=[];let r="";if(t==b.I.TYPE_STRING)r="string";else if(t==b.I.TYPE_VALUE)r="number";else if(t==b.I.TYPE_ARRAY)r="array";else if(t==b.I.TYPE_OBJECT)r="object";else if(t==b.I.TYPE_DYNAMIC)r="dynamic";else{console.log("unknown port type",t);console.log((new Error).stack)}for(const e in this._variables){if(!this._variables[e].type||this._variables[e].type==r||this._variables[e].type==t)i.push(this._variables[e])}e.finish();return i}preRenderOps(){this._log.log("prerendering...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].preRender){this.ops[e].preRender();this._log.log("prerender "+this.ops[e].objName)}}}dispose(){this.pause();this.clear();this.cgl.dispose()}pushTriggerStack(e){this._triggerStack.push(e)}popTriggerStack(){this._triggerStack.pop()}printTriggerStack(){if(this._triggerStack.length==0){return}console.groupCollapsed("trigger port stack "+this._triggerStack[this._triggerStack.length-1].op.objName+"."+this._triggerStack[this._triggerStack.length-1].name);const t=[];for(let e=0;e<this._triggerStack.length;e++){t.push(e+". "+this._triggerStack[e].op.objName+" "+this._triggerStack[e].name)}console.table(t);console.groupEnd()}get containerElement(){return this.config.containerElement||this.cgl.canvas.parentElement||null}getDocument(){return this.containerElement.ownerDocument}static getOpClass(e){const t=e.split(".");let i=null;try{if(t.length==2)i=window[t[0]][t[1]];else if(t.length==3)i=window[t[0]][t[1]][t[2]];else if(t.length==4)i=window[t[0]][t[1]][t[2]][t[3]];else if(t.length==5)i=window[t[0]][t[1]][t[2]][t[3]][t[4]];else if(t.length==6)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]];else if(t.length==7)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]];else if(t.length==8)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]];else if(t.length==9)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]];else if(t.length==10)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]][t[9]];return i}catch(e){return null}}static replaceOpIds(r,s){const t={};for(const e in r.ops){t[r.ops[e].id]=r.ops[e]}for(const i in r.ops){for(const o in r.ops[i].portsOut){const l=r.ops[i].portsOut[o].links;if(l){let e=l.length;while(e--){if(l[e]&&(!t[l[e].objIn]||!t[l[e].objOut])){if(!s.doNotUnlinkLostLinks){l.splice(e,1)}else{if(s.fixLostLinks){const h=D.getGui().corePatch().getOpById(l[e].objIn);if(!h)console.log("op not found!");else{const u=D.getGui().patchView.getSubPatchOuterOp(h.uiAttribs.subPatch);if(u){h.storage=h.storage||{};h.storage.ref=h.storage.ref||(0,E.shortId)();l[e].refOp=h.storage.ref;l[e].subOpRef=u.storage.ref}}}}}}}}}for(const t in r.ops){const h=r.ops[t];const c=h.id;let e=(0,E.shortId)();if(s.prefixHash)e=(0,E.prefixedHash)(s.prefixHash+c);else if(s.prefixId)e=s.prefixId+c;else if(s.refAsId){if(h.storage&&h.storage.ref){e=h.storage.ref;delete h.storage.ref}else{h.storage=h.storage||{};h.storage.ref=e=(0,E.shortId)()}}const g=h.id=e;if(s.oldIdAsRef){h.storage=h.storage||{};h.storage.ref=c}for(const i in r.ops){if(r.ops[i].portsIn)for(const o in r.ops[i].portsIn){if(r.ops[i].portsIn[o].links){let e=r.ops[i].portsIn[o].links.length;while(e--)if(r.ops[i].portsIn[o].links[e]===null)r.ops[i].portsIn[o].links.splice(e,1);for(e in r.ops[i].portsIn[o].links){if(r.ops[i].portsIn[o].links[e].objIn===c)r.ops[i].portsIn[o].links[e].objIn=g;if(r.ops[i].portsIn[o].links[e].objOut===c)r.ops[i].portsIn[o].links[e].objOut=g}}}if(r.ops[i].portsOut)for(const o in r.ops[i].portsOut){if(r.ops[i].portsOut[o].links){let e=r.ops[i].portsOut[o].links.length;while(e--)if(r.ops[i].portsOut[o].links[e]===null)r.ops[i].portsOut[o].links.splice(e,1);for(e in r.ops[i].portsOut[o].links){if(r.ops[i].portsOut[o].links[e].objIn===c)r.ops[i].portsOut[o].links[e].objIn=g;if(r.ops[i].portsOut[o].links[e].objOut===c)r.ops[i].portsOut[o].links[e].objOut=g}}}}}const n=[];const a=[];for(let i=0;i<r.ops.length;i++){if(r.ops[i].storage&&r.ops[i].storage.subPatchVer){for(let t=0;t<r.ops[i].portsIn.length;t++){if(r.ops[i].portsIn[t].name==="patchId"){let e=(0,E.shortId)();if(s.prefixHash)e=(0,E.prefixedHash)(s.prefixHash+r.ops[i].portsIn[t].value);const f=r.ops[i].portsIn[t].value;const d=r.ops[i].portsIn[t].value=e;n.push(d);for(let e=0;e<r.ops.length;e++){if(r.ops[e].uiAttribs){if(r.ops[e].uiAttribs.subPatch===f){r.ops[e].uiAttribs.subPatch=d;a.push(r.ops[e].id)}}}}}}}for(const p in r.ops){let t=false;for(let e=0;e<a.length;e++){if(r.ops[p].id===a[e]){t=true;break}}if(!t&&r.ops[p].uiAttribs&&s.parentSubPatchId!=null)r.ops[p].uiAttribs.subPatch=s.parentSubPatchId}return r}}class B extends b.I{constructor(e,t,i,r,s){super(e,t,i,r);this.get=()=>{let e=super.get();if(CABLES.UI){if(e===""||e===null||e===undefined||r.values&&r.values.indexOf(String(e))===-1){this.op.setUiError("invalidswitch","Invalid Value ["+this.name+']: "'+e+'"',1)}else this.op.setUiError("invalidswitch",null)}if(e===null||e===undefined)e="";return e};this.indexPort=s;this.indexPort.set=e=>{const t=r.values;if(!t){return}let i=Math.floor(e);i=Math.min(i,t.length-1);i=Math.max(i,0);this.indexPort.setValue(i);this.set(t[i]);if(this.op.patch.isEditorMode()&&performance.now()-(this.lastTime||0)>100&&D.getGui()&&D.getGui().patchView.isCurrentOp(this.op)){D.getGui().opParams.show(this.op);this.lastTime=performance.now()}}}setUiAttribs(e){const t=e.hidePort;e.hidePort=true;super.setUiAttribs(e);if(typeof t!=="undefined")this.indexPort.setUiAttribs({hidePort:t})}}class S extends B{setUiAttribs(e){if(this.indexPort.isLinked()){for(const t in e){if(t=="greyout"&&!e[t])e[t]="true"}}super.setUiAttribs(e)}}const I=2;class M extends b.I{constructor(e,i,r,s,t,n){super(e,i,b.I.TYPE_ARRAY,t);this.setUiAttribs({multiPort:true,group:this.name,order:-1});this.ports=[];this.direction=s;this._uiAttribsPorts=n;const a=()=>{const t=[];let i=1;if(this.uiAttribs.multiPortManual)i=0;for(let e=0;e<this.ports.length-i;e++)t[e]=this.ports[e];this.setRef(t)};const o=()=>{let n=!this.uiAttribs.multiPortManual||false;if(this.direction==F.a.PORT.PORT_DIR_OUT)n=false;for(let s=0;s<this.ports.length;s++){let e;let t=false;let i;let r={};if(this.op.preservedPortTitles&&this.op.preservedPortTitles[this.ports[s].name])i=this.op.preservedPortTitles[this.ports[s].name];if(s==0)e=this.ports.length;if(!this.uiAttribs.multiPortManual)if(s==this.ports.length-1){i="add port";t=true;n=true}for(const a in this._uiAttribsPorts){r[a]=this._uiAttribsPorts[a]}r.addPort=t;r.longPort=e;r.title=i;r.greyout=n;r.group=this.name;this.ports[s].setUiAttribs(r)}};this.removeInvalidPorts=()=>{for(let e=0;e<this.ports.length;e++){if(!this.ports[e])this.ports.splice(e,1)}if(!this.uiAttribs.multiPortManual){if(this.ports.length>I)for(let e=this.ports.length-1;e>1;e--){if(!this.ports[e].isLinked())this.uiAttribs.multiPortNum=e;else break}}a()};this.countPorts=()=>{const e=D.getGui();if(CABLES.UI&&!e.isRemoteClient&&e.patchView&&e.patchView.patchRenderer&&e.patchView.patchRenderer.isDraggingPort()){clearTimeout(this.retryTo);this.retryTo=setTimeout(this.countPorts.bind(this));return}this.retryTo=null;let i=false;this.removeListeners();this.removeInvalidPorts();for(let e=0;e<this.ports.length;e++){if(this.ports[e]&&this.ports[e].links.length>1){const r=this.ports[e+1];const s=this.ports[e].links[0].getOtherPort(this.ports[e]);if(!r||!s){this._log.warn("no port found?")}else{this.ports[e].links[0].remove();this.op.patch.link(this.op,r.name,s.op,s.name);i=true}break}}if(!this.uiAttribs.multiPortManual){let t=true;while(t){t=false;for(let e=this.ports.length-1;e>1;e--){if(this.ports[e]&&this.ports[e].links.length>0&&this.ports[e-1].links.length==0){const s=this.ports[e].links[0].getOtherPort(this.ports[e]);this.ports[e].links[0].remove();const r=this.ports[e-1];if(r&&this.ports[e]){this.op.patch.link(this.op,r.name,s.op,s.name);t=true;i=true;break}}}}}if(!this.uiAttribs.multiPortManual){while(this.ports.length>I&&!this.ports[this.ports.length-1].isLinked()&&!this.ports[this.ports.length-2].isLinked()){let e=this.ports.length-1;if(!this.ports[e].isLinked()&&this.ports[e-1]&&!this.ports[e-1].isLinked()){this.ports[e].setUiAttribs({removed:true});this.ports[e].remove();this.ports.splice(e,1)}}}this.removeInvalidPorts();if(!this.uiAttribs.multiPortManual&&this.ports.length>0&&this.ports[this.ports.length-1].isLinked())this.newPort();a();o();if(i)this.countPorts();else this.addListeners()};this.removeListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener)}};this.addListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];const i=e;if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);t.multiPortChangeListener=t.on("change",a.bind(this));if(t.multiPortTriggerListener)t.multiPortTriggerListener=t.off(t.multiPortTriggerListener);t.multiPortTriggerListener=t.on("trigger",()=>{this._onTriggered()});if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener);t.multiLinkChangeListener=t.on("onLinkChanged",()=>{this.countPorts();this.emitEvent("onLinkChanged")});if(t.multiLinkRemoveListener)t.multiLinkRemoveListener=t.off(t.multiLinkRemoveListener);t.multiLinkRemoveListener=t.on("onLinkRemoved",()=>{o();this.emitEvent("onLinkChanged")})}};this.newPort=()=>{const e={};e.type=r;const t=new b.I(this.op,i+"_"+this.ports.length,r,e);t.direction=s;if(this.direction==F.a.PORT.PORT_DIR_OUT)this.op.addOutPort(t);else this.op.addInPort(t,this.ports[this.ports.length-1]);this.ports.push(t);if(r==b.I.TYPE_NUMBER)t.setInitialValue(0);else if(r==b.I.TYPE_STRING)t.setInitialValue("");this.addListeners();o();a();this.emitEvent("onLinkChanged");if(this.op.preservedPortTitles&&this.op.preservedPortTitles[t.name])t.setUiAttribs({title:this.op.preservedPortTitles[t.name]});return t};this.initPorts=()=>{for(let e=0;e<I;e++)this.newPort();a();o()};this.checkNum=()=>{this.uiAttribs.multiPortNum=Math.max(I,this.uiAttribs.multiPortNum);while(this.ports.length<this.uiAttribs.multiPortNum)this.newPort();while(this.ports.length>this.uiAttribs.multiPortNum)if(this.ports[this.ports.length-1])this.ports.pop().remove();this.removeInvalidPorts()};this.incDec=e=>{this.uiAttribs.multiPortNum=this.uiAttribs.multiPortNum||I;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+e});this.checkNum();o()};this.toggleManual=()=>{this.setUiAttribs({multiPortManual:!this.uiAttribs.multiPortManual});this.op.refreshParams()};this.on("onUiAttrChange",e=>{if(e.hasOwnProperty("multiPortManual")){o();this.removeInvalidPorts();this.checkNum();this.countPorts();o()}});this.on("onUiAttrChange",this.checkNum.bind(this));this.checkNum();this.countPorts();this.removeInvalidPorts();o()}}class R extends f.A{static OP_VERSION_PREFIX="_v";static EVENT_INIT="init";static EVENT_UIATTR_CHANGE="onUiAttribsChange";#objName="";_log=new d.A("core_op");#shortOpName="";opId="";portsOut=[];patch=null;data={};storage={};portsIn=[];portsInData=[];uiAttribs={};enabled=true;onAnimFrame=null;preservedPortTitles={};preservedPortValues={};preservedPortLinks={};linkTimeRules={needsLinkedToWork:[],needsStringToWork:[],needsParentOp:null};shouldWork={};hasUiErrors=0;uiErrors={};hasAnimPort=false;patchId=null;constructor(e,t,i=null){super();this.opId=i;this.#objName=t;this.patch=e;this.#shortOpName=CABLES.getShortOpName(t);this.getTitle();this.id=i||(0,E.shortId)();this.onAddPort=null;this.onCreate=null;this.onResize=null;this.onLoaded=null;this.onDelete=null;this.onError=null;this._instances=null;this.preRender=null;this.init=null}isInBlueprint2(){return false}get name(){return this.getTitle()}set name(e){this.setTitle(e)}set _objName(e){this.#objName=e;this._log=new d.A("op "+e)}get objName(){return this.#objName}get shortName(){return this.#shortOpName}require(e){if(CABLES.platform&&CABLES.StandaloneElectron&&!CABLES.platform.frontendOptions.isElectron)this.setUiError("notstandalone","This op will only work in cables standalone version",3);return null}checkMainloopExists(){if(!CABLES.UI)return;if(!this.patch.tempData.mainloopOp)this.setUiError("nomainloop","patch should have a mainloop to use this op");else this.setUiError("nomainloop",null)}getTitle(){if(!this.uiAttribs)return"nouiattribs"+this.shortName;return this.uiAttribs.title||this.#shortOpName}setTitle(e){if(e!=this.getTitle())this._setUiAttrib({title:e})}setStorage(e){if(!e)return;this.storage=this.storage||{};let t=false;for(const i in e){if(this.storage[i]!=e[i])t=true;this.storage[i]=e[i]}if(t)this.emitEvent("onStorageChange",e)}isSubPatchOp(){if(this.patchId&&this.storage)return this.storage.subPatchVer||this.storage.blueprintVer||0;return false}setUiAttrib(e){this._setUiAttrib(e)}setUiAttribs(e){this._setUiAttrib(e)}uiAttr(e){this._setUiAttrib(e)}_setUiAttrib(e){if(!e)return;if(typeof e!="object")this._log.error("op.uiAttrib attribs are not of type object");if(!this.uiAttribs)this.uiAttribs={};let t=false;let i=false;if(CABLES.UI&&e.hasOwnProperty("translate")&&(!this.uiAttribs.translate||this.uiAttribs.translate.x!=e.translate.x||this.uiAttribs.translate.y!=e.translate.y))i=true;if(e.hasOwnProperty("title")&&e.title!=this.uiAttribs.title){this.uiAttribs.title=e.title;t=true}if(e.hasOwnProperty("disabled")){t=true;this.setEnabled(!e.disabled)}for(const r in e){if(this.uiAttribs[r]!=e[r])t=true;this.uiAttribs[r]=e[r]}if(this.uiAttribs.hasOwnProperty("highlighted")&&this.uiAttribs.highlighted==false)delete this.uiAttribs.highlighted;if(this.uiAttribs.hasOwnProperty("highlightedMore")&&this.uiAttribs.highlightedMore==false)delete this.uiAttribs.highlightedMore;if(this.uiAttribs.hasOwnProperty("selected")&&this.uiAttribs.selected==false)delete this.uiAttribs.selected;if(this.uiAttribs.hasOwnProperty("selected"))t=true;if(t){this.emitEvent(R.EVENT_UIATTR_CHANGE,e);this.patch.emitEvent("onUiAttribsChange",this,e)}if(i)this.emitEvent("move")}getName(){return this.#shortOpName}addOutPort(e){e.direction=F.a.PORT.PORT_DIR_OUT;if(e.op!=this)console.error("port op is not this...");this.portsOut.push(e);this.emitEvent("onPortAdd",e);return e}hasDynamicPort(){let e=0;for(e=0;e<this.portsIn.length;e++){if(this.portsIn[e].type==b.I.TYPE_DYNAMIC)return true;if(this.portsIn[e].getName()=="dyn")return true}for(e=0;e<this.portsOut.length;e++){if(this.portsOut[e].type==b.I.TYPE_DYNAMIC)return true;if(this.portsOut[e].getName()=="dyn")return true}return false}addInPort(e,t){e.direction=b.I.DIR_IN;e._op=this;if(!t){this.portsIn.push(e)}else{const i=this.portsIn.indexOf(t);this.portsIn.splice(i+1,0,e)}this.emitEvent("onPortAdd",e);return e}inFunction(e,t){return this.inTrigger(e,t)}inTrigger(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}inTriggerButton(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_FUNCTION,{display:"button"}));if(t!==undefined)i.set(t);return i}inUiTriggerButtons(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_FUNCTION,{display:"buttons"}));if(t!==undefined)i.set(t);return i}inValueFloat(e,t){return this.inFloat(e,t)}inValue(e,t){return this.inFloat(e,t)}inFloat(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_VALUE));i.setInitialValue(t);return i}inValueBool(e,t){return this.inBool(e,t)}inBool(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_NUMBER,{display:"bool"}));if(t===true)t=1;if(t===false)t=0;i.setInitialValue(t);return i}inMultiPort(e,t,i){const r={addPort:true,hidePort:true};const s=new M(this,e,t,b.I.DIR_IN,r,i);s.ignoreValueSerialize=true;this.addInPort(s);s.initPorts();return s}outMultiPort(e,t,i={}){const r=new M(this,e,t,F.a.PORT.PORT_DIR_OUT,{display:"multiport",hidePort:true},i);r.ignoreValueSerialize=true;this.addOutPort(r);r.initPorts();return r}inValueString(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_VALUE,{type:"string"}));i.value="";i.setInitialValue(t);return i}inString(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_STRING,{type:"string"}));t=t||"";i.setInitialValue(t);return i}inTextarea(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_STRING,{type:"string",display:"text"}));i.value="";if(t!==undefined){i.set(t);i.defaultValue=t}return i}inStringEditor(e,t,i,r=true){const s=this.addInPort(new b.I(this,e,b.I.TYPE_STRING,{type:"string",display:"editor",editShortcut:true,editorSyntax:i,hideFormatButton:r}));s.value="";if(t!==undefined){s.set(t);s.defaultValue=t}return s}inValueEditor(e,t,i,r=true){const s=this.addInPort(new b.I(this,e,b.I.TYPE_NUMBER,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:r}));s.value="";if(t!==undefined){s.set(t);s.defaultValue=t}return s}inValueSelect(e,t,i,r){return this.inDropDown(e,t,i,r)}inDropDown(e,t,i,r){let s=null;if(!r){const n=new b.I(this,e+" index",b.I.TYPE_NUMBER,{increment:"integer",hideParam:true});const a=this.addInPort(n);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new S(this,e,b.I.TYPE_NUMBER,{display:"dropdown",hidePort:true,type:"string",values:t},a);o.indexPort=n;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});n.onLinkChanged=()=>{o.setUiAttribs({greyout:n.isLinked()})};s=this.addInPort(o);if(i!==undefined){s.set(i);const l=t.findIndex(e=>{return e==i});a.setValue(l);s.defaultValue=i;a.defaultValue=l}}else{const o=new b.I(this,e,b.I.TYPE_VALUE,{display:"dropdown",hidePort:true,type:"string",values:t});s=this.addInPort(o)}return s}inSwitch(e,t,i,r){let s=null;if(!r){if(!i)i=t[0];const n=new b.I(this,e+" index",b.I.TYPE_VALUE,{increment:"integer",values:t,hideParam:true});const a=this.addInPort(n);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new B(this,e,b.I.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t},a);o.indexPort=n;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});n.onLinkChanged=function(){o.setUiAttribs({greyout:n.isLinked()})};s=this.addInPort(o);if(i!==undefined){s.set(i);const l=t.findIndex(e=>{return e==i});a.setValue(l);s.defaultValue=i;a.defaultValue=l}}else{const o=new b.I(this,e,b.I.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t});s=this.addInPort(o)}return s}inValueInt(e,t){return this.inInt(e,t)}inInt(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_VALUE,{increment:"integer"}));if(t!==undefined){i.set(t);i.defaultValue=t}return i}inFile(e,t,i){const r=this.addInPort(new b.I(this,e,b.I.TYPE_VALUE,{display:"file",type:"string",filter:t}));if(i!==undefined){r.set(i);r.defaultValue=i}return r}inUrl(e,t,i){const r=this.addInPort(new b.I(this,e,b.I.TYPE_STRING,{display:"file",type:"string",filter:t}));if(i!==undefined){r.set(i);r.defaultValue=i}return r}inTexture(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_OBJECT,{display:"texture",objType:"texture",preview:true}));i.ignoreValueSerialize=true;if(t!==undefined)i.set(t);return i}inObject(e,t,i){const r=this.addInPort(new b.I(this,e,b.I.TYPE_OBJECT,{objType:i}));r.ignoreValueSerialize=true;if(t!==undefined)r.set(t);return r}inGradient(e,t){const i=this.addInPort(new b.I(this,e,b.I.TYPE_VALUE,{display:"gradient"}));if(t!==undefined)i.set(t);return i}getPortVisibleIndex(t){let i=this.portsIn;if(t.direction==F.a.PORT_DIR_OUT)i=this.portsOut;let r=0;for(let e=0;e<i.length;e++){if(i[e].uiAttribs.hidePort)continue;r++;if(i[e]==t)return r}}inArray(e,t=undefined,i=undefined){let r=i;if(!i&&CABLES.isNumeric(t))r=t;const s=this.addInPort(new b.I(this,e,b.I.TYPE_ARRAY,{stride:r}));if(t!==undefined&&(Array.isArray(t)||t==null))s.set(t);return s}inValueSlider(e,t,i,r){return this.inFloatSlider(e,t,i,r)}inFloatSlider(e,t,i,r){const s={display:"range"};if(i!=undefined&&r!=undefined){s.min=i;s.max=r}const n=this.addInPort(new b.I(this,e,b.I.TYPE_VALUE,s));if(t!==undefined){n.set(t);n.defaultValue=t}return n}outFunction(e,t){return this.outTrigger(e,t)}outTrigger(e,t){const i=this.addOutPort(new b.I(this,e,b.I.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}outValue(e,t){return this.outNumber(e,t)}outNumber(e,t){const i=this.addOutPort(new b.I(this,e,b.I.TYPE_VALUE));if(t!==undefined)i.set(t);return i}outValueBool(e,t){return this.outBool(e,t)}outBool(e,t){const i=this.addOutPort(new b.I(this,e,b.I.TYPE_VALUE,{display:"bool"}));if(t!==undefined)i.set(t);else i.set(0);return i}outBoolNum(e,t){const i=this.addOutPort(new b.I(this,e,b.I.TYPE_VALUE,{display:"boolnum"}));i.set=function(e){this.setValue(e?1:0)}.bind(i);if(t!==undefined)i.set(t);else i.set(0);return i}outValueString(e,t){const i=this.addOutPort(new b.I(this,e,b.I.TYPE_VALUE,{type:"string"}));if(t!==undefined)i.set(t);return i}outString(e,t){const i=this.addOutPort(new b.I(this,e,b.I.TYPE_STRING,{type:"string"}));if(t!==undefined)i.set(t);else i.set("");return i}outObject(e,t,i){const r=this.addOutPort(new b.I(this,e,b.I.TYPE_OBJECT,{objType:i||null}));r.set(t||null);r.ignoreValueSerialize=true;return r}outArray(e,t,i){if(!i&&CABLES.isNumeric(t))i=t;const r=this.addOutPort(new b.I(this,e,b.I.TYPE_ARRAY,{stride:i}));if(t!==undefined&&(Array.isArray(t)||t==null))r.set(t);r.ignoreValueSerialize=true;return r}outTexture(e,t){const i=this.addOutPort(new b.I(this,e,b.I.TYPE_OBJECT,{preview:true,objType:"texture",display:"texture"}));if(t!==undefined)i.setRef(t||_.Rq.Texture.getEmptyTexture(this.patch.cgl));i.ignoreValueSerialize=true;return i}inDynamic(e,t,i,r){const s=new b.I(this,e,b.I.TYPE_DYNAMIC,i);s.shouldLink=()=>{if(t&&Array.isArray(t))return false;return true};this.addInPort(s);if(r!==undefined){s.set(r);s.defaultValue=r}return s}removeLinks(){for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].removeLinks();for(let e=0;e<this.portsOut.length;e++)this.portsOut[e].removeLinks()}getSerialized(){const t={};if(this.opId)t.opId=this.opId;if(this.patch.storeObjNames)t.objName=this.objName;t.id=this.id;t.uiAttribs=JSON.parse(JSON.stringify(this.uiAttribs))||{};if(this.storage&&Object.keys(this.storage).length>0)t.storage=JSON.parse(JSON.stringify(this.storage));if(this.uiAttribs.hasOwnProperty("working")&&this.uiAttribs.working==true)delete this.uiAttribs.working;if(t.uiAttribs.hasOwnProperty("uierrors"))delete t.uiAttribs.uierrors;if(t.uiAttribs.hasOwnProperty("highlighted"))delete t.uiAttribs.highlighted;if(t.uiAttribs.hasOwnProperty("highlightedMore"))delete t.uiAttribs.highlightedMore;if(t.uiAttribs.title==="")delete t.uiAttribs.title;if(t.uiAttribs.color===null)delete t.uiAttribs.color;if(t.uiAttribs.comment===null)delete t.uiAttribs.comment;if(t.uiAttribs.title==this.#shortOpName||(this.uiAttribs.title||"").toLowerCase()==this.#shortOpName.toLowerCase())delete t.uiAttribs.title;t.portsIn=[];t.portsOut=[];for(let e=0;e<this.portsIn.length;e++){const i=this.portsIn[e].getSerialized();if(i)t.portsIn.push(i)}for(let e=0;e<this.portsOut.length;e++){const i=this.portsOut[e].getSerialized();if(i)t.portsOut.push(i)}if(t.portsIn.length==0)delete t.portsIn;if(t.portsOut.length==0)delete t.portsOut;(0,E.cleanJson)(t);return t}getFirstOutPortByType(t){for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].type==t)return this.portsOut[e]}getFirstInPortByType(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].type==t)return this.portsIn[e]}getPort(e,t=false){return this.getPortByName(e,t)}getPortByName(t,e=false){if(e){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName().toLowerCase()==t||this.portsIn[e].id.toLowerCase()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName().toLowerCase()==t||this.portsOut[e].id.toLowerCase()==t)return this.portsOut[e]}else{for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName()==t||this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName()==t||this.portsOut[e].id==t)return this.portsOut[e]}}getPortById(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].id==t)return this.portsOut[e]}updateAnims(){if(this.hasAnimPort)for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].updateAnim()}log(){this._log.log(...arguments)}error(){this._log.error(...arguments)}logError(){this._log.error(...arguments)}warn(){this._log.warn(...arguments)}logWarn(){this._log.warn(...arguments)}verbose(){this._log.verbose(...arguments)}logVerbose(){this._log.verbose(...arguments)}profile(){for(let e=0;e<this.portsIn.length;e++){this.portsIn[e]._onTriggered=this.portsIn[e]._onTriggeredProfiling;this.portsIn[e].set=this.portsIn[e]._onSetProfiling}}cleanUp(){if(this._instances){for(let e=0;e<this._instances.length;e++)if(this._instances[e].onDelete)this._instances[e].onDelete();this._instances.length=0}for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].setAnimated(false);if(this.onAnimFrame)this.patch.removeOnAnimFrame(this)}instanced(e){return false}initInstancable(){}hasUiError(e){return this.uiErrors.hasOwnProperty(e)&&this.uiErrors[e]}setUiError(e,t,i=2,r={}){}setEnabled(e){this.enabled=e;this.emitEvent("onEnabledChange",e)}setPortGroup(t,i){for(let e=0;e<i.length;e++){if(i[e])if(i[e].setUiAttribs)i[e].setUiAttribs({group:t});else this._log.error("setPortGroup: invalid port!")}}setUiAxisPorts(e,t,i){if(e)e.setUiAttribs({axis:"X"});if(t)t.setUiAttribs({axis:"Y"});if(i)i.setUiAttribs({axis:"Z"})}removePort(t){for(let e=0;e<this.portsIn.length;e++){if(this.portsIn[e]==t){this.portsIn.splice(e,1);this.emitEvent(R.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}for(let e=0;e<this.portsOut.length;e++){if(this.portsOut[e]==t){this.portsOut.splice(e,1);this.emitEvent(R.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}}toWorkNeedsParent(e){this.linkTimeRules.needsParentOp=e}toWorkShouldNotBeChild(e,t){if(!this.patch.isEditorMode())return;this.linkTimeRules.forbiddenParent=e;if(t!=undefined)this.linkTimeRules.forbiddenParentType=t}toWorkPortsNeedsString(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsStringToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsStringToWork.push(arguments[e])}toWorkPortsNeedToBeLinked(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsLinkedToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsLinkedToWork.push(arguments[e])}toWorkPortsNeedToBeLinkedReset(){if(!this.patch.isEditorMode())return;this.linkTimeRules.needsLinkedToWork.length=0;if(this.checkLinkTimeWarnings)this.checkLinkTimeWarnings()}initVarPorts(){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getVariableName())this.portsIn[e].setVariable(this.portsIn[e].getVariableName())}checkLinkTimeWarnings(){}_checkLinksNeededToWork(){}refreshParams(){if(this.patch&&this.patch.isEditorMode()&&this.isCurrentUiOp())D.getGui().opParams.show(this)}isCurrentUiOp(){if(this.patch.isEditorMode())return D.getGui().patchView.isCurrentOp(this)}checkGraphicsApi(e=A.G.API_WEBGL){if(this.patch.isEditorMode())if(this.patch.cg&&this.patch.cg.gApi!=e)this.setUiError("wronggapi","Wrong graphics API",2)}}const O={};O.addPatch=function(e,t){let i=e;let r=(0,E.generateUUID)();if(typeof e=="string"){r=e;i=document.getElementById(r);if(!i){console.error(r+" Polyshape Container Element not found!");return}}const s=document.createElement("canvas");s.id="glcanvas_"+r;s.width=i.clientWidth;s.height=i.clientHeight;window.addEventListener("resize",function(){this.setAttribute("width",i.clientWidth);this.height=i.clientHeight}.bind(s));i.appendChild(s);t=t||{};t.glCanvasId=s.id;if(!t.onError){t.onError=function(e){console.error(e)}}CABLES.patch=new D(t);return s};const P=function(){let t=null;const i=[];this.onChanged=function(e){i.push(e)};this.getValue=function(){return t};this.setValue=function(e){t=e;this.emitChanged()};this.emitChanged=function(){for(let e=0;e<i.length;e++){i[e]()}}};var N=t(963);CABLES=CABLES||{};CABLES={...CABLES,...F.a.PORT,...F.a.PACO,...F.a.ANIM,...F.a.OP};CABLES.EMBED=O;CABLES.Link=m;CABLES.Port=b.I;CABLES.Op=R;CABLES.Profiler=T;CABLES.Patch=D;CABLES.Timer=x.M4;CABLES.Variable=P;CABLES.LoadingStatus=v;CABLES.now=x.tB;CABLES.internalNow=x.uw;CABLES.Anim=p.k;CABLES.AnimKey=N.rA;CABLES.shortId=E.shortId;CABLES.uuid=E.uuid;CABLES.getShortOpName=E.getShortOpName;CABLES.simpleId=E.simpleId;CABLES.clamp=E.clamp;CABLES.map=E.map;CABLES.shuffleArray=E.shuffleArray;CABLES.generateUUID=E.generateUUID;CABLES.prefixedHash=E.prefixedHash;CABLES.smoothStep=E.smoothStep;CABLES.smootherStep=E.smootherStep;CABLES.cacheBust=E.cacheBust;CABLES.copyArray=E.copyArray;CABLES.basename=E.basename;CABLES.logStack=E.logStack;CABLES.filename=E.filename;CABLES.ajax=E.ajax;CABLES.request=E.request;CABLES.logErrorConsole=E.logErrorConsole;CABLES.isNumeric=E.isNumeric;CABLES.uniqueArray=E.uniqueArray;CABLES.OPS=[];CABLES.utils=E;CABLES.CONSTANTS=F.a;CABLES.GLMatrix=i;CABLES.SHARED={};CABLES.SHARED.Events=f.A;CABLES.SHARED.Logger=d.A;const y=CABLES;if(!function(){return!this}())console.warn("not in strict mode: index core")},920:(e,t,i)=>{"use strict";i.d(t,{M4:()=>a,tB:()=>n,uw:()=>s});var r=i(125);const s=function(){return window.performance.now()};const n=function(){return s()};class a extends r.A{static EVENT_PLAY_PAUSE="playPause";static EVENT_TIME_CHANGED="timeChanged";constructor(){super();this._timeStart=s();this._timeOffset=0;this._currentTime=0;this._lastTime=0;this._paused=true;this._delay=0;this.overwriteTime=-1}_internalNow(){if(this._ts)return this._ts;return s()}_getTime(){this._lastTime=(this._internalNow()-this._timeStart)/1e3;return this._lastTime+this._timeOffset}setDelay(e){this._delay=e;this.emitEvent(a.EVENT_TIME_CHANGED)}isPlaying(){return!this._paused}update(e){if(e)this._ts=e;if(this._paused)return;this._currentTime=this._getTime();return this._currentTime}getMillis(){return this.get()*1e3}get(){return this.getTime()}getTime(){if(this.overwriteTime>=0)return this.overwriteTime-this._delay;return this._currentTime-this._delay}togglePlay(){if(this._paused)this.play();else this.pause()}setTime(e){if(isNaN(e)||e<0)e=0;this._timeStart=this._internalNow();this._timeOffset=e;this._currentTime=e;this.emitEvent(a.EVENT_TIME_CHANGED)}setOffset(e){if(this._currentTime+e<0){this._timeStart=this._internalNow();this._timeOffset=0;this._currentTime=0}else{this._timeOffset+=e;this._currentTime=this._lastTime+this._timeOffset}this.emitEvent(a.EVENT_TIME_CHANGED)}play(){this._timeStart=this._internalNow();this._paused=false;this.emitEvent(a.EVENT_PLAY_PAUSE)}pause(){this._timeOffset=this._currentTime;this._paused=true;this.emitEvent(a.EVENT_PLAY_PAUSE)}static now(){return window.performance.now()}}},562:(e,t,i)=>{"use strict";i.r(t);i.d(t,{ajax:()=>D,basename:()=>x,cacheBust:()=>F,clamp:()=>E,cleanJson:()=>g,copyArray:()=>v,escapeHTML:()=>P,filename:()=>C,float32Concat:()=>n,generateUUID:()=>c,getShortOpName:()=>a,isNumeric:()=>A,logErrorConsole:()=>S,logStack:()=>T,map:()=>b,prefixedHash:()=>f,request:()=>B,shortId:()=>h,shuffleArray:()=>o,simpleId:()=>p,smoothStep:()=>m,smootherStep:()=>_,uniqueArray:()=>I,uuid:()=>u});var r=i(440);Math.randomSeed=1;Math.setRandomSeed=function(e){Math.randomSeed=e*50728129;if(e!=0){Math.randomSeed=Math.seededRandom()*17624813;Math.randomSeed=Math.seededRandom()*9737333}};Math.seededRandom=function(e,t){if(Math.randomSeed===0)Math.randomSeed=Math.random()*999;e=e||1;t=t||0;Math.randomSeed=(Math.randomSeed*9301+49297)%233280;const i=Math.randomSeed/233280;return t+i*(e-t)};String.prototype.endl=function(){return this+"\n"};String.prototype.contains=function(e){console.warn("string.contains deprecated, use string.includes");console.log((new Error).stack);return this.includes(e)};function s(){}s();function n(e,t){if(!(e instanceof Float32Array))e=new Float32Array(e);if(!(t instanceof Float32Array))t=new Float32Array(t);const i=new Float32Array(e.length+t.length);i.set(e);i.set(t,e.length);return i}const a=function(e){let t=e.split(".")[e.split(".").length-1];if(t.includes(r.a.OP.OP_VERSION_PREFIX)){const i=t.split(r.a.OP.OP_VERSION_PREFIX)[1];t=t.substring(0,t.length-(r.a.OP.OP_VERSION_PREFIX+i).length)}return t};const o=function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.seededRandom()*(e+1));const r=t[e];t[e]=t[i];t[i]=r}return t};const l={};const h=function(){let e=Math.random().toString(36).substr(2,9);if(l.hasOwnProperty(e))e=h();l[e]=true;return e};const u=function(){let i=(new Date).getTime();const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e=="x"?t:t&3|8).toString(16)});return e};const c=u;function g(t){for(const e in t){if(t[e]&&typeof objValue==="object"&&t[e].constructor===Object)t[e]=g(t[e]);if(t[e]===null||t[e]===undefined)delete t[e];else if(Array.isArray(t[e])&&t[e].length==0)delete t[e]}return t}const f=function(i,e="id"){let r=0;if(i.length>0){for(let t=0;t<i.length;t++){let e=i.charCodeAt(t);r=(r<<5)-r+e;r&=r}}return e+""+r};let d=0;const p=function(){d++;return d};const m=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*(3-2*t);return e};const _=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*t*(t*(t*6-15)+10);return e};const E=function(e,t,i){return Math.min(Math.max(e,t),i)};const b=function(e,t,i,r,s,n=0,a=true){if(a){if(e>=i)return s;if(e<=t)return r}let o=false;const l=Math.min(t,i);const h=Math.max(t,i);if(l!=t)o=true;let u=false;const c=Math.min(r,s);const g=Math.max(r,s);if(c!=r)u=true;let f=0;let d=0;if(o)f=(h-e)*(g-c)/(h-l);else f=(e-l)*(g-c)/(h-l);if(u)d=g-f;else d=f+c;if(!n)return d;if(n==1){e=Math.max(0,Math.min(1,(d-r)/(s-r)));return r+e*e*(3-2*e)*(s-r)}if(n==2){e=Math.max(0,Math.min(1,(d-r)/(s-r)));return r+e*e*e*(e*(e*6-15)+10)*(s-r)}return d};function A(e){return!isNaN(parseFloat(e))&&isFinite(e)}const F=function(e=""){if(!e)return"";if(e.startsWith("data:"))return;if(e.includes("?"))e+="&";else e+="?";return e+"cache="+CABLES.uuid()};const v=function(t,i){if(!t)return null;i=i||[];i.length=t.length;for(let e=0;e<t.length;e++)i[e]=t[e];return i};const x=function(e){let t=CABLES.filename(e);const i=t.split(".");t=i[0];return t};const T=function(){console.log("logstack",(new Error).stack)};const C=function(e){let t="";if(!e)return"";if(e.startsWith("data:")&&e.includes(":")){const i=e.split(",");return i[0]}let i=(e+"").split("/");if(i.length>0){const r=i[i.length-1];let e=r.split("?");t=e[0]}return t||""};const D=function(e,t,i,r,s,n,a={},o={}){const l={url:e,cb:t,method:i,data:r,contenttype:s,sync:false,jsonP:n,headers:a};if(o&&o.credentials)l.credentials=o.credentials;B(l)};const B=function(t){if(!t.hasOwnProperty("asynch"))t.asynch=true;let i;try{i=new XMLHttpRequest}catch(e){}i.onreadystatechange=function(){if(i.readyState!=4)return;if(t.cb){if(i.status==200||i.status==0)t.cb(false,i.responseText,i);else t.cb(true,i.responseText,i)}};try{i.open(t.method?t.method.toUpperCase():"GET",t.url,!t.sync)}catch(e){if(t.cb&&e)t.cb(true,e.msg,i)}if(typeof t.headers==="object"){if(t.headers){const r=Object.keys(t.headers);for(let e=0;e<r.length;e++){const s=r[e];const n=t.headers[s];i.setRequestHeader(s,n)}}}if(t.credentials&&t.credentials!=="omit"){i.withCredentials=true}try{if(!t.post&&!t.data){i.send()}else{i.setRequestHeader("Content-type",t.contenttype?t.contenttype:"application/x-www-form-urlencoded");i.send(t.data||t.post)}}catch(e){if(t.cb)t.cb(true,e.msg,i)}};const S=function(e){CABLES.errorConsole=CABLES.errorConsole||{log:[]};CABLES.errorConsole.log.push({initiator:e,arguments:arguments});if(!CABLES.errorConsole.ele){const t=document.createElement("div");t.id="cablesErrorConsole";t.style.width="90%";t.style.height="300px";t.style.zIndex="9999999";t.style.display="inline-block";t.style.position="absolute";t.style.padding="10px";t.style.fontFamily="monospace";t.style.color="red";t.style.backgroundColor="#200";CABLES.errorConsole.ele=t;document.body.appendChild(t)}let r="ERROR<br/>for more info, open your browsers dev tools console (Ctrl+Shift+I or Command+Alt+I)<br/>";for(let i=0;i<CABLES.errorConsole.log.length;i++){r+=CABLES.errorConsole.log[i].initiator+" ";for(let e=1;e<CABLES.errorConsole.log[i].arguments.length;e++){if(e>2)r+=", ";let t=CABLES.errorConsole.log[i].arguments[e];if(t.constructor.name.indexOf("Error")>-1||t.constructor.name.indexOf("error")>-1){let e="Uncaught ErrorEvent ";if(t.message)e+=" message: "+t.message;r+=e}else if(typeof t=="string")r+=t;else if(typeof t=="number")r+=String(t)+" "}r+="<br/>"}CABLES.errorConsole.ele.innerHTML=r};function I(i){const r={},s=[];for(let e=0,t=i.length;e<t;++e){if(!r.hasOwnProperty(i[e])){s.push(i[e]);r[i[e]]=1}}return s}const M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};const R=/[&<>"']/g;const O=RegExp(R.source);const P=function(e){return e&&O.test(e)?e.replace(R,function(e){return M[e]}):e||""}},982:(e,t,i)=>{"use strict";i.d(t,{I:()=>a});var r=i(329);var s=i(684);var n=i(562);class a{constructor(e){this._init();this._first=true;this._wireMesh=null;if(e)this.applyGeom(e)}_init(){this._max=[-0,-0,-0];this._min=[0,0,0];this._center=[0,0,0];this._size=[0,0,0];this._maxAxis=0;this._first=true}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(e){return this.applyGeom(e)}applyGeom(t){if(!t)return;if(t instanceof a){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ);this.applyPos(e.minX,e.minY,e.minZ)}else{if(t.isGeometry)for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2])}this.calcCenterSize()}copy(){return new a(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,i){if(e==Number.MAX_VALUE||e==-Number.MAX_VALUE||t==Number.MAX_VALUE||t==-Number.MAX_VALUE||i==Number.MAX_VALUE||i==-Number.MAX_VALUE)return;if(!n.isNumeric(e)||!n.isNumeric(t)||!n.isNumeric(i))return;if(this._first){this._max[0]=e;this._max[1]=t;this._max[2]=i;this._min[0]=e;this._min[1]=t;this._min[2]=i;this._first=false;return}this._max[0]=Math.max(this._max[0],e);this._max[1]=Math.max(this._max[1],t);this._max[2]=Math.max(this._max[2],i);this._min[0]=Math.min(this._min[0],e);this._min[1]=Math.min(this._min[1],t);this._min[2]=Math.min(this._min[2],i)}calcCenterSize(){if(this._first)return;this._size[0]=this._max[0]-this._min[0];this._size[1]=this._max[1]-this._min[1];this._size[2]=this._max[2]-this._min[2];this._center[0]=(this._min[0]+this._max[0])/2;this._center[1]=(this._min[1]+this._max[1])/2;this._center[2]=(this._min[2]+this._max[2])/2;this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1]))}mulMat4(e){if(this._first){this._max[0]=0;this._max[1]=0;this._max[2]=0;this._min[0]=0;this._min[1]=0;this._min[2]=0;this._first=false}r.transformMat4(this._max,this._max,e);r.transformMat4(this._min,this._min,e);this.calcCenterSize()}render(e,t,i){if(!this._wireMesh)this._wireMesh=new CGL.WireCube(e);e.pushModelMatrix();s.translate(e.mMatrix,e.mMatrix,this._center);if(CABLES.UI&&i){CABLES.UI.OverlayMeshes.drawCube(i,this._size[0]/2,this._size[1]/2,this._size[2]/2)}e.popModelMatrix()}}},223:(e,t,i)=>{"use strict";i.d(t,{f:()=>s});var r=i(849);class s{hasFocus=false;forceAspect=0;pixelDensity=1;_oldWidthRp=-1;_oldHeightRp=-1;constructor(e){this._log=new r.A("CgCanvas");if(!e){this._log.error("CgCanvas no options")}else{this._canvasEle=e.canvasEle}if(!e.cg)this._log.error("CgCanvas options has no cg");this._cg=e.cg;if(this.canvasEle){this.canvasWidth=this.canvasEle.clientWidth;this.canvasHeight=this.canvasEle.clientHeight;this.setSize(this.canvasWidth,this.canvasHeight);this.canvasEle.addEventListener("focus",()=>{this.hasFocus=true});this.canvasEle.addEventListener("blur",()=>{this.hasFocus=false})}}get canvasEle(){return this._canvasEle}setSize(t,i,e=false){let r=0;if(this.forceAspect){let e=t/this.forceAspect;if(e<i)r=(i-e)/2;i=e}if(this._oldWidthRp!=t*this.pixelDensity||this._oldHeightRp!=i*this.pixelDensity){this._oldWidthRp=this.canvasEle.width=t*this.pixelDensity;this._oldHeightRp=this.canvasEle.height=i*this.pixelDensity;if(!e){this.canvasEle.style.width=t+"px";this.canvasEle.style.height=i+"px";this.canvasEle.style.marginTop=r+"px"}this.updateSize();this._cg.emitEvent("resize")}}updateSize(){this.canvasEle.width=this.canvasWidth=Math.ceil(this.canvasEle.clientWidth*this.pixelDensity);this.canvasEle.height=this.canvasHeight=Math.ceil(this.canvasEle.clientHeight*this.pixelDensity)}dispose(){if(this._canvasEle)this._canvasEle.remove();this._canvasEle=null}}},628:(e,t,i)=>{"use strict";i.d(t,{A:()=>c});var r=i(125);var s=i(849);var n=i(329);var a=i(684);var o=i(223);var l=i(868);var h=i(460);var u=i(294);class c extends r.A{static API_UNKNOWN=0;static API_WEBGL=1;static API_WEBGPU=2;static EVENT_RESIZE="resize";gApi=0;_textureslots=[];_pMatrixStack=new l.u;_mMatrixStack=new l.u;_vMatrixStack=new l.u;canvasScale=1;constructor(e){super();this._log=new s.A("cg_context",{onError:e.config.onError});this.tempData=this.frameStore=this.frameStore||{};this.fpsCounter=new u.K;this._identView=n.create();this._ident=n.create();n.set(this._identView,0,0,-2);n.set(this._ident,0,0,0);this._onetimeCallbacks=[];this.maxTexSize=2048;this._viewPort=[0,0,1,1];this._viewPortStack=[];this.patch=e;this.autoReSize=true;this.DEPTH_COMPARE_FUNC_NEVER=0;this.DEPTH_COMPARE_FUNC_LESS=1;this.DEPTH_COMPARE_FUNC_EQUAL=2;this.DEPTH_COMPARE_FUNC_LESSEQUAL=3;this.DEPTH_COMPARE_FUNC_GREATER=4;this.DEPTH_COMPARE_FUNC_NOTEQUAL=5;this.DEPTH_COMPARE_FUNC_GREATEREQUAL=6;this.DEPTH_COMPARE_FUNC_ALWAYS=7;this.profileData=new h.E(this);this.pMatrix=a.create();this.mMatrix=a.create();this.vMatrix=a.create();a.identity(this.mMatrix);a.identity(this.vMatrix);window.matchMedia("screen and (min-resolution: 2dppx)").addEventListener("change",()=>{this.emitEvent("resize")})}get canvasWidth(){return this.width}get canvasHeight(){return this.height}get width(){return this.cgCanvas.canvasWidth}get height(){return this.cgCanvas.canvasHeight}get widthCss(){return this.cgCanvas.canvasWidth/this.pixelDensity}get heightCss(){return this.cgCanvas.canvasHeight/this.pixelDensity}set pixelDensity(e){if(this.cgCanvas.pixelDensity!=e){this.cgCanvas.pixelDensity=e;this.cgCanvas.updateSize();this.emitEvent("resize")}}get pixelDensity(){return this.cgCanvas.pixelDensity}getGApiName(){return["unknown","WebGL","WebGPU"][this.gApi]}get canvas(){return this.cgCanvas.canvasEle}get viewPort(){return[0,0,this.canvasWidth,this.canvasHeight]}setCanvas(e){if(this.cgCanvas&&e==this.cgCanvas.canvasEle)return;if(typeof e==="string")e=document.getElementById(e);this.cgCanvas=new o.f({canvasEle:e,cg:this});if(!e)return;e.parentElement.classList.add("cablesContainer");if(this._setCanvas)this._setCanvas(e);this.updateSize()}_setCanvas(e){}updateSize(){this.cgCanvas.updateSize()}setSize(e,t,i=false){this.cgCanvas.setSize(e,t,i)}_resizeToWindowSize(){if(this.autoReSize){this.setSize(window.innerWidth,window.innerHeight);this.updateSize()}}_resizeToParentSize(){if(this.autoReSize){const e=this.canvas.parentElement;if(!e){this._log.error("cables: can not resize to container element");return}this.setSize(e.clientWidth,e.clientHeight);this.updateSize()}}setAutoResize(e){window.removeEventListener("resize",this._resizeToWindowSize.bind(this));window.removeEventListener("resize",this._resizeToParentSize.bind(this));if(e=="window"){window.addEventListener("resize",this._resizeToWindowSize.bind(this));window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this));this._resizeToWindowSize()}if(e=="parent"){window.addEventListener("resize",this._resizeToParentSize.bind(this));this._resizeToParentSize()}}pushPMatrix(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)}popPMatrix(){this.pMatrix=this._pMatrixStack.pop();return this.pMatrix}getProjectionMatrixStateCount(){return this._pMatrixStack.stateCounter}pushModelMatrix(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)}popModelMatrix(){this.mMatrix=this._mMatrixStack.pop();return this.mMatrix}modelMatrix(){return this.mMatrix}pushViewMatrix(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)}popViewMatrix(){this.vMatrix=this._vMatrixStack.pop()}getViewMatrixStateCount(){return this._vMatrixStack.stateCounter}_startMatrixStacks(e,t){e=e||this._ident;t=t||this._identView;a.perspective(this.pMatrix,45,this.canvasWidth/this.canvasHeight,.1,1e3);a.identity(this.mMatrix);a.identity(this.vMatrix);a.translate(this.mMatrix,this.mMatrix,e);a.translate(this.vMatrix,this.vMatrix,t);this.pushPMatrix();this.pushModelMatrix();this.pushViewMatrix()}_endMatrixStacks(){this.popViewMatrix();this.popModelMatrix();this.popPMatrix()}dispose(){this.aborted=true;if(this.cgCanvas)this.cgCanvas.dispose();if(this._dispose)this._dispose()}_dispose(){}shouldDrawHelpers(e){return false}addNextFrameOnceCallback(e){if(e&&this._onetimeCallbacks.indexOf(e)==-1)this._onetimeCallbacks.push(e)}_execOneTimeCallbacks(){if(this._onetimeCallbacks.length>0){for(let e=0;e<this._onetimeCallbacks.length;e++)this._onetimeCallbacks[e]();this._onetimeCallbacks.length=0}}checkTextureSize(e){e=e||1;e=Math.floor(e);e=Math.min(e,this.maxTexSize);e=Math.max(e,1);return e}screenShot(e,t,i,r){console.log("no screenshot function implemented")}saveScreenshot(i,r,e,t,s){this.patch.renderOneFrame();let n=this.canvas.clientWidth*this.pixelDensity;let a=this.canvas.clientHeight*this.pixelDensity;if(e){this.canvas.width=e;n=e}if(t){this.canvas.height=t;a=t}function o(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}const l=new Date;const h="".concat(String(l.getFullYear())+String(l.getMonth()+1)+String(l.getDate()),"_").concat(o(l.getHours(),2)).concat(o(l.getMinutes(),2)).concat(o(l.getSeconds(),2));if(!i)i="cables_"+h+".png";else i+=".png";this.screenShot(e=>{this.canvas.width=n;this.canvas.height=a;if(e){const t=document.createElement("a");t.download=i;t.href=URL.createObjectURL(e);console.log("scrrenshot");setTimeout(function(){t.click();if(r)r(e)},100)}else{this._log.log("screenshot: no blob")}})}hasFocus(){return this.cgCanvas.hasFocus}}},294:(e,t,i)=>{"use strict";i.d(t,{K:()=>n});var r=i(125);var s=i(920);class n extends r.A{#timeStartFrame=0;#timeStartSecond=0;#fpsCounter=0;#msCounter=0;#frameCount=0;logFps=false;constructor(){super();this.stats={ms:0,fps:0}}get frameCount(){return this.#frameCount}startFrame(){this.#timeStartFrame=(0,s.tB)()}endFrame(){this.#frameCount++;this.#fpsCounter++;const e=(0,s.tB)()-this.#timeStartFrame;this.#msCounter+=e;if((0,s.tB)()-this.#timeStartSecond>1e3)this.endSecond()}endSecond(){this.stats.fps=this.#fpsCounter;this.stats.ms=Math.round(this.#msCounter/this.#fpsCounter*100)/100;this.emitEvent("performance",this.stats);if(this.logFps)console.log(this.stats);this.#fpsCounter=0;this.#msCounter=0;this.#timeStartSecond=(0,s.tB)()}}},331:(e,t,i)=>{"use strict";i.d(t,{V:()=>u});var r=i(849);var L=i(329);var U=i(842);var s=i(562);var n=i(982);class u{isGeometry=true;constructor(e){this.name=e||"unknown";this._log=new r.A("cgl_geometry");this.faceVertCount=3;this.glPrimitive=null;this._attributes={};this._vertices=[];this.verticesIndices=[];this.morphTargets=[]}get vertices(){return this._vertices}set vertices(e){this.setVertices(e)}get texCoords(){const e=this.getAttribute("texCoords");if(!e)return[];return e.data}set texCoords(e){this.setAttribute("texCoords",e,2)}get vertexNormals(){const e=this.getAttribute("vertexNormals");if(!e)return[];return e.data}set vertexNormals(e){this.setAttribute("vertexNormals",e,3)}get tangents(){const e=this.getAttribute("tangents");if(!e)return[];return e.data}set tangents(e){this.setAttribute("tangents",e,3)}get biTangents(){const e=this.getAttribute("biTangents");if(!e)return[];return e.data}set biTangents(e){this.setAttribute("biTangents",e,3)}get vertexColors(){const e=this.getAttribute("vertexColors");if(!e)return[];return e.data}set vertexColors(e){this.setAttribute("vertexColors",e,4)}clear(){this._vertices=new Float32Array([]);this.verticesIndices=[];this.texCoords=new Float32Array([]);this.vertexNormals=new Float32Array([]);this.tangents=[];this.biTangents=[];this._attributes={}}getAttributes(){return this._attributes}getAttribute(t){for(const e in this._attributes){if(this._attributes[e].name==t)return this._attributes[e]}return null}setAttribute(e,t,i){let r="";if(!i||i>4){this._log.warn("itemsize wrong?",i,e);this._log.stack("itemsize");i=3}if(i==1)r="float";else if(i==2)r="vec2";else if(i==3)r="vec3";else if(i==4)r="vec4";const s={name:e,data:t,itemSize:i,type:r};this._attributes[e]=s}copyAttribute(e,t){const i=this.getAttribute(e);t.setAttribute(e,new Float32Array(i.data),i.itemSize)}setVertices(e){if(e instanceof Float32Array)this._vertices=e;else this._vertices=new Float32Array(e)}setTexCoords(e){if(e instanceof Float32Array)this.texCoords=e;else this.texCoords=new Float32Array(e)}calcNormals(e){const t={smooth:e};this.calculateNormals(t)}flipNormals(t,i,r){let s=L.create();if(t==undefined)t=1;if(i==undefined)i=1;if(r==undefined)r=1;for(let e=0;e<this.vertexNormals.length;e+=3){L.set(s,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]);s[0]*=-t;s[1]*=-i;s[2]*=-r;L.normalize(s,s);this.vertexNormals[e+0]=s[0];this.vertexNormals[e+1]=s[1];this.vertexNormals[e+2]=s[2]}}getNumTriangles(){if(this.verticesIndices&&this.verticesIndices.length)return this.verticesIndices.length/3;return this.vertices.length/3}flipVertDir(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3){t[e]=this.verticesIndices[e+2];t[e+1]=this.verticesIndices[e+1];t[e+2]=this.verticesIndices[e]}this.verticesIndices=t}setPointVertices(t){if(t.length%3!==0){this._log.error("SetPointVertices: Array must be multiple of three.");return}if(!(t instanceof Float32Array))this.vertices=new Float32Array(t);else this.vertices=t;if(!(this.texCoords instanceof Float32Array))this.texCoords=new Float32Array(t.length/3*2);this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++){this.verticesIndices[e]=e;this.texCoords[e*2]=0;this.texCoords[e*2+1]=0}}merge(t){if(!t)return;if(this.isIndexed()!=t.isIndexed()){if(this.isIndexed()){this.unIndex(false,true)}if(t.isIndexed()){const e=t.copy();e.unIndex(false,true);t=e}}const i=this.verticesIndices.length;const r=this._vertices.length/3;this.verticesIndices.length+=t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[i+e]=t.verticesIndices[e]+r;this.vertices=s.float32Concat(this._vertices,t.vertices);this.texCoords=s.float32Concat(this.texCoords,t.texCoords);this.vertexNormals=s.float32Concat(this.vertexNormals,t.vertexNormals);this.tangents=s.float32Concat(this.tangents,t.tangents);this.biTangents=s.float32Concat(this.biTangents,t.biTangents)}copy(){const t=new u(this.name+" copy");t.faceVertCount=this.faceVertCount;t.glPrimitive=this.glPrimitive;t.setVertices(this._vertices.slice(0));if(this.verticesIndices){t.verticesIndices.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e]}for(let e in this._attributes)this.copyAttribute(e,t);t.morphTargets.length=this.morphTargets.length;for(let e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];return t}calculateNormals(t=null){t=t||{};if(t.smooth===false)this.unIndex();const i=L.create();const r=L.create();const s=L.create();function n(e){L.subtract(i,e[0],e[1]);L.subtract(r,e[0],e[2]);L.cross(s,i,r);L.normalize(s,s);if(t&&t.forceZUp){if(s[2]<0){s[0]*=-1;s[1]*=-1;s[2]*=-1}}return s}this.getVertexVec=function(e){const t=[0,0,0];t[0]=this.vertices[e*3+0];t[1]=this.vertices[e*3+1];t[2]=this.vertices[e*3+2];return t};if(!(this.vertexNormals instanceof Float32Array)||this.vertexNormals.length!=this.vertices.length)this.vertexNormals=new Float32Array(this.vertices.length);for(let e=0;e<this.vertices.length;e++){this.vertexNormals[e]=0}if(!this.isIndexed()){const a=[];for(let e=0;e<this.vertices.length;e+=9){const o=[[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]];const l=n(o);a.push(l[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2])}this.vertexNormals=a}else{const h=[];h.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const o=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];h[e/3]=n(o);this.vertexNormals[this.verticesIndices[e+0]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+0]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+0]*3+2]+=h[e/3][2];this.vertexNormals[this.verticesIndices[e+1]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+1]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+1]*3+2]+=h[e/3][2];this.vertexNormals[this.verticesIndices[e+2]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+2]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+2]*3+2]+=h[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){const u=[this.vertexNormals[this.verticesIndices[t+e]*3+0],this.vertexNormals[this.verticesIndices[t+e]*3+1],this.vertexNormals[this.verticesIndices[t+e]*3+2]];L.normalize(u,u);this.vertexNormals[this.verticesIndices[t+e]*3+0]=u[0];this.vertexNormals[this.verticesIndices[t+e]*3+1]=u[1];this.vertexNormals[this.verticesIndices[t+e]*3+2]=u[2]}}}}calcTangentsBitangents(){if(!this.vertices.length){return}if(!this.vertexNormals.length){return}if(!this.texCoords.length){const A=this.vertices.length/3*2;this.texCoords=new Float32Array(A);for(let e=0;e<A;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length){return}if(this.verticesIndices.length%3!==0){this._log.error("Vertex indices mismatch!");return}const t=this.verticesIndices.length/3;const i=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length);this.biTangents=new Float32Array(this.vertexNormals.length);const r=[];r.length=i*2;const s=L.create();const n=L.create();const a=L.create();const o=U.create();const l=U.create();const h=U.create();const u=L.create();const c=L.create();for(let e=0;e<t;e+=1){const F=this.verticesIndices[e*3];const v=this.verticesIndices[e*3+1];const x=this.verticesIndices[e*3+2];L.set(s,this.vertices[F*3],this.vertices[F*3+1],this.vertices[F*3+2]);L.set(n,this.vertices[v*3],this.vertices[v*3+1],this.vertices[v*3+2]);L.set(a,this.vertices[x*3],this.vertices[x*3+1],this.vertices[x*3+2]);U.set(o,this.texCoords[F*2],this.texCoords[F*2+1]);U.set(l,this.texCoords[v*2],this.texCoords[v*2+1]);U.set(h,this.texCoords[x*2],this.texCoords[x*2+1]);const T=n[0]-s[0];const C=a[0]-s[0];const D=n[1]-s[1];const B=a[1]-s[1];const S=n[2]-s[2];const I=a[2]-s[2];const M=l[0]-o[0];const R=h[0]-o[0];const O=l[1]-o[1];const P=h[1]-o[1];const N=1/(M*P-R*O);L.set(u,(P*T-O*C)*N,(P*D-O*B)*N,(P*S-O*I)*N);L.set(c,(M*C-R*T)*N,(M*B-R*D)*N,(M*I-R*S)*N);r[F]=u;r[v]=u;r[x]=u;r[F+i]=c;r[v+i]=c;r[x+i]=c}const g=L.create();const f=L.create();const d=L.create();const p=L.create();const m=L.create();const _=L.create();const E=L.create();const b=L.create();for(let e=0;e<i;e+=1){if(!r[e])continue;L.set(g,this.vertexNormals[e*3],this.vertexNormals[e*3+1],this.vertexNormals[e*3+2]);L.set(f,r[e][0],r[e][1],r[e][2]);const y=L.dot(g,f);L.scale(m,g,y);L.subtract(_,f,m);L.normalize(b,_);L.cross(E,g,f);const w=1;L.scale(d,b,1/w);L.cross(p,g,d);this.tangents[e*3+0]=d[0];this.tangents[e*3+1]=d[1];this.tangents[e*3+2]=d[2];this.biTangents[e*3+0]=p[0];this.biTangents[e*3+1]=p[1];this.biTangents[e*3+2]=p[2]}}isIndexed(){if(this._vertices.length==0)return true;return this.verticesIndices.length!=0}unIndex(e=false,t=false){const i=[];const r=[];let s=0;for(let e in this._attributes){const n=this._attributes[e];let i=[];for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){if(n.itemSize==3)i.push(n.data[this.verticesIndices[t+e]*3+0],n.data[this.verticesIndices[t+e]*3+1],n.data[this.verticesIndices[t+e]*3+2]);else if(n.itemSize==4)i.push(n.data[this.verticesIndices[t+e]*4+0],n.data[this.verticesIndices[t+e]*4+1],n.data[this.verticesIndices[t+e]*4+2],n.data[this.verticesIndices[t+e]*4+3]);else if(n.itemSize==2)i.push(n.data[this.verticesIndices[t+e]*2+0],n.data[this.verticesIndices[t+e]*2+1]);else if(n.itemSize==1)i.push(n.data[this.verticesIndices[t+e]]);else this._log.warn("unknown attr",n)}}this.setAttribute(n.name,i,n.itemSize)}for(let e=0;e<this.verticesIndices.length;e+=3){i.push(this.vertices[this.verticesIndices[e+0]*3+0],this.vertices[this.verticesIndices[e+0]*3+1],this.vertices[this.verticesIndices[e+0]*3+2]);r.push(s);s++;i.push(this.vertices[this.verticesIndices[e+1]*3+0],this.vertices[this.verticesIndices[e+1]*3+1],this.vertices[this.verticesIndices[e+1]*3+2]);r.push(s);s++;i.push(this.vertices[this.verticesIndices[e+2]*3+0],this.vertices[this.verticesIndices[e+2]*3+1],this.vertices[this.verticesIndices[e+2]*3+2]);r.push(s);s++}this.vertices=i;this.verticesIndices=[];if(e)this.verticesIndices=r;if(!t)this.calculateNormals()}calcBarycentric(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let i=0;for(let e=0;e<this.vertices.length;e+=3){t[e+i]=1;i++;if(i==3)i=0}this.setAttribute("attrBarycentric",t,3)}getBounds(){return new n.I(this)}center(e,t,i){if(e===undefined){e=true;t=true;i=true}let r=0;const s=this.getBounds();const n=[s.minX+(s.maxX-s.minX)/2,s.minY+(s.maxY-s.minY)/2,s.minZ+(s.maxZ-s.minZ)/2];for(r=0;r<this.vertices.length;r+=3){if(this.vertices[r+0]==this.vertices[r+0]){if(e)this.vertices[r+0]-=n[0];if(t)this.vertices[r+1]-=n[1];if(i)this.vertices[r+2]-=n[2]}}return n}mapTexCoords2d(){const t=this.getBounds();const i=this.vertices.length/3;this.texCoords=new Float32Array(i*2);for(let e=0;e<i;e++){const r=this.vertices[e*3+0];const s=this.vertices[e*3+1];this.texCoords[e*2+0]=r/(t.maxX-t.minX)+.5;this.texCoords[e*2+1]=1-s/(t.maxY-t.minY)+.5}}getInfoOneLine(){let e="";if(this.faceVertCount==3&&this.verticesIndices)e+=this.verticesIndices.length/3;else e+=0;e+=" tris ";if(this.vertices)e+=this.vertices.length/3;else e+=0;e+=" verts";return e}getInfo(){const e={};e.name=this.name;e.class=this.constructor.name;if(this.faceVertCount==3&&this.verticesIndices)e.numFaces=this.verticesIndices.length/3;else e.numFaces=0;if(this.verticesIndices&&this.verticesIndices.length)e.indices=this.verticesIndices.length;if(this.vertices)e.numVerts=this.vertices.length/3;else e.numVerts=0;if(this.vertexNormals)e.numNormals=this.vertexNormals.length/3;else e.numNormals=0;if(this.texCoords)e.numTexCoords=this.texCoords.length/2;else e.numTexCoords=0;if(this.tangents)e.numTangents=this.tangents.length/3;else e.numTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.vertexColors)e.numVertexColors=this.vertexColors.length/4;else e.numVertexColors=0;if(this.getAttributes())e.numAttribs=Object.keys(this.getAttributes()).length;else e.numAttribs=0;e.isIndexed=this.isIndexed();return e}}u.buildFromFaces=function(t,e,i){const r=[];const s=[];for(let e=0;e<t.length;e+=3){const a=t[e+0];const o=t[e+1];const l=t[e+2];const h=[-1,-1,-1];if(i)for(let e=0;e<r.length;e+=3){if(r[e+0]==a[0]&&r[e+1]==a[1]&&r[e+2]==a[2])h[0]=e/3;if(r[e+0]==o[0]&&r[e+1]==o[1]&&r[e+2]==o[2])h[1]=e/3;if(r[e+0]==l[0]&&r[e+1]==l[1]&&r[e+2]==l[2])h[2]=e/3}if(h[0]==-1){r.push(a[0],a[1],a[2]);h[0]=(r.length-1)/3}if(h[1]==-1){r.push(o[0],o[1],o[2]);h[1]=(r.length-1)/3}if(h[2]==-1){r.push(l[0],l[1],l[2]);h[2]=(r.length-1)/3}s.push(h[0]);s.push(h[1]);s.push(h[2])}const n=new u(e);n.name=e;n.vertices=r;n.verticesIndices=s;return n}},868:(e,t,i)=>{"use strict";i.d(t,{u:()=>s});var r=i(684);class s{constructor(){this._arr=[r.create()];this._index=0;this.stateCounter=0}push(e){this._index++;this.stateCounter++;if(this._index==this._arr.length){const t=r.create();this._arr.push(t)}r.copy(this._arr[this._index],e||this._arr[this._index-1]);return this._arr[this._index]}pop(){this.stateCounter++;this._index--;if(this._index<0)this._index=0;return this._arr[this._index]}length(){return this._index}}},434:(e,t,i)=>{"use strict";i.d(t,{w:()=>r});class r{_name="unknown";constructor(){}}},694:(e,t,i)=>{"use strict";i.d(t,{U:()=>n});var r=i(125);var s=i(562);class n extends r.A{id=s.simpleId();_isValid=true;_defines=[];_moduleNames=[];_moduleNumId=0;_needsRecompile=true;_compileReason="initial";_modules=[];_compileCount=0;logError=true;num=-1;lastCompile=0;constructor(){super()}setWhyCompile(e){this._compileReason=e;this._needsRecompile=true}getWhyCompile(){return this._compileReason}needsRecompile(){return this._needsRecompile}removeUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName()==t){this._uniforms.splice(e,1)}}this.setWhyCompile("remove uniform "+t)}hasUniformInStage(t,e){let i=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)i=this.defaultUniBindingVert;if(e==GPUShaderStage.COMPUTE)i=this.defaultUniBindingCompute;for(let e=0;e<this._uniforms.length;e++){console.log("hasuniiiiiiiiiiiiiii",this._uniforms[e].getName(),t);if(this._uniforms[e].getName()==t)return true}return false}hasUniform(e){}toggleDefine(t,e){if(e&&typeof e=="object"&&e.addEventListener){if(e.changeListener)e.off(e.changeListener);e.onToggleDefine=e=>{this.toggleDefine(t,e)};e.changeListener=e.on("change",e.onToggleDefine);e=e.get()}if(e)this.define(t);else this.removeDefine(t)}define(t,i=""){if(i===null||i===undefined)i="";if(typeof i=="object"){i.removeEventListener("change",i.onDefineChange);i.onDefineChange=e=>{this.define(t,e)};i.on("change",i.onDefineChange);i=i.get()}for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t&&this._defines[e][1]==i)return;if(this._defines[e][0]==t){this._defines[e][1]=i;this.setWhyCompile("define "+t+" "+i);return}}this.setWhyCompile("define "+t+" "+i);this._defines.push([t,i])}getDefines(){return this._defines}getDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null}hasDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return true}removeDefine(t){for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t){this._defines.splice(e,1);this.setWhyCompile("define removed:"+t);return}}}hasModule(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return true;return false}setModules(e){this._moduleNames=e}removeModule(i){for(let e=0;e<this._modules.length;e++){if(i&&i.id){if(this._modules[e].id==i.id||!this._modules[e]){let t=true;while(t){t=false;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName().startsWith(i.prefix)){this._uniforms.splice(e,1);t=true;continue}}}this.setWhyCompile("remove module "+i.title);this._modules.splice(e,1);break}}}}getNumModules(){return this._modules.length}getCurrentModules(){return this._modules}addModule(e,t){if(this.hasModule(e.id))return;if(!e.id)e.id=s.simpleId();if(!e.numId)e.numId=this._moduleNumId;if(!e.num)e.num=this._modules.length;if(t&&!t.group)t.group=s.simpleId();if(!e.group)if(t)e.group=t.group;else e.group=s.simpleId();e.prefix="mod"+e.group+"_";this._modules.push(e);this.setWhyCompile("add module "+e.title);this._moduleNumId++;return e}isValid(){return this._isValid}}},356:(e,t,i)=>{"use strict";i.d(t,{U:()=>l});var r=i(562);const s=8;class l{constructor(e={}){this.id=r.uuid();this.width=0;this.height=0;this.name="unknown";e=e||{};this.pixelFormat=e.pixelFormat||l.PFORMATSTR_RGBA8UB;this.name=e.name||"unknown";if(!e.width)e.width=s;if(!e.height)e.height=s}}l.getDefaultTextureData=(e,n,a={})=>{if(e=="empty"){return new Uint8Array(n*n*4).fill(0)}else if(e=="color"){const s=new Uint8Array(n*n*4);let t=a.r||1;let i=a.g||1;let r=a.b||1;for(let e=0;e<n*n;e++){s[e*4+0]=t;s[e*4+1]=i;s[e*4+2]=r;s[e*4+3]=255}return s}else if(e=="randomUInt"){const s=new Uint8Array(n*n*4);for(let e=0;e<n*n;e++){s[e*4+0]=Math.random()*255;s[e*4+1]=Math.random()*255;s[e*4+2]=Math.random()*255;s[e*4+3]=255}return s}else if(e=="random"||e=="randomFloat"){const s=new Float32Array(n*n*4);for(let e=0;e<n*n;e++){s[e*4+0]=(Math.random()-.5)*2;s[e*4+1]=(Math.random()-.5)*2;s[e*4+2]=(Math.random()-.5)*2;s[e*4+3]=1}return s}else if(e=="stripes"){const o=[];let i=a.r;let r=a.g;let s=a.b;if(i===undefined)i=1;if(r===undefined)r=1;if(s===undefined)s=1;for(let t=0;t<n;t++){for(let e=0;e<n;e++){if((e+t)%64<32){o.push((200+t/n*25+e/n*25)*i);o.push((200+t/n*25+e/n*25)*r);o.push((200+t/n*25+e/n*25)*s)}else{o.push((40+t/n*25+e/n*25)*i);o.push((40+t/n*25+e/n*25)*r);o.push((40+t/n*25+e/n*25)*s)}o.push(255)}}return new Uint8Array(o)}else{console.warn("unknown default texture",e);return l.getDefaultTextureData("stripes",n,{r:1,g:0,b:0})}};l.FILTER_NEAREST=0;l.FILTER_LINEAR=1;l.FILTER_MIPMAP=2;l.WRAP_REPEAT=0;l.WRAP_MIRRORED_REPEAT=1;l.WRAP_CLAMP_TO_EDGE=2;l.TYPE_DEFAULT=0;l.TYPE_DEPTH=1;l.TYPE_FLOAT=2;l.PFORMATSTR_RGB565="RGB 5/6/5bit ubyte";l.PFORMATSTR_R8UB="R 8bit ubyte";l.PFORMATSTR_RG8UB="RG 8bit ubyte";l.PFORMATSTR_RGB8UB="RGB 8bit ubyte";l.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte";l.PFORMATSTR_SRGBA8="SRGBA 8bit ubyte";l.PFORMATSTR_R11FG11FB10F="RGB 11/11/10bit float";l.PFORMATSTR_R16F="R 16bit float";l.PFORMATSTR_RG16F="RG 16bit float";l.PFORMATSTR_RGB16F="RGB 16bit float";l.PFORMATSTR_RGBA16F="RGBA 16bit float";l.PFORMATSTR_R32F="R 32bit float";l.PFORMATSTR_RG32F="RG 32bit float";l.PFORMATSTR_RGB32F="RGB 32bit float";l.PFORMATSTR_RGBA32F="RGBA 32bit float";l.PFORMATSTR_DEPTH="DEPTH";l.PIXELFORMATS=[l.PFORMATSTR_RGB565,l.PFORMATSTR_R8UB,l.PFORMATSTR_RG8UB,l.PFORMATSTR_RGB8UB,l.PFORMATSTR_RGBA8UB,l.PFORMATSTR_SRGBA8,l.PFORMATSTR_R11FG11FB10F,l.PFORMATSTR_R16F,l.PFORMATSTR_RG16F,l.PFORMATSTR_RGBA16F,l.PFORMATSTR_R32F,l.PFORMATSTR_RGBA32F]},475:(e,t,i)=>{"use strict";i.d(t,{v:()=>r});var u=i(849);var c=i(50);class r{constructor(e,t,i,r,s,n,a,o,l,h){this._log=new u.A("cg_uniform");this._type=t;this._name=i;this._shader=e;this._value=1e-5;this._oldValue=null;this._port=null;this._structName=l;this._structUniformName=o;this._propertyName=h;if(this._shader._addUniform)this._shader._addUniform(this);this.needsUpdate=true;this.shaderType=null;this.comment=null;if(t=="f"){this.set=this.setValue=this.setValueF.bind(this);this.updateValue=this.updateValueF.bind(this)}else if(t=="f[]"){this.set=this.setValue=this.setValueArrayF.bind(this);this.updateValue=this.updateValueArrayF.bind(this)}else if(t=="2f[]"){this.set=this.setValue=this.setValueArray2F.bind(this);this.updateValue=this.updateValueArray2F.bind(this)}else if(t=="3f[]"){this.set=this.setValue=this.setValueArray3F.bind(this);this.updateValue=this.updateValueArray3F.bind(this)}else if(t=="4f[]"){this.set=this.setValue=this.setValueArray4F.bind(this);this.updateValue=this.updateValueArray4F.bind(this)}else if(t=="i"){this.set=this.setValue=this.setValueI.bind(this);this.updateValue=this.updateValueI.bind(this)}else if(t=="2i"){this.set=this.setValue=this.setValue2I.bind(this);this.updateValue=this.updateValue2I.bind(this)}else if(t=="3i"){this.set=this.setValue=this.setValue3I.bind(this);this.updateValue=this.updateValue3I.bind(this)}else if(t=="4i"){this.set=this.setValue=this.setValue4I.bind(this);this.updateValue=this.updateValue4I.bind(this)}else if(t=="b"){this.set=this.setValue=this.setValueBool.bind(this);this.updateValue=this.updateValueBool.bind(this)}else if(t=="4f"){this.set=this.setValue=this.setValue4F.bind(this);this.updateValue=this.updateValue4F.bind(this)}else if(t=="3f"){this.set=this.setValue=this.setValue3F.bind(this);this.updateValue=this.updateValue3F.bind(this)}else if(t=="2f"){this.set=this.setValue=this.setValue2F.bind(this);this.updateValue=this.updateValue2F.bind(this)}else if(t=="t"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="sampler"){if(this.setValueAny){this.set=this.setValue=this.setValueAny.bind(this);this.updateValue=this.updateValueAny.bind(this)}}else if(t=="tc"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="t[]"){this.set=this.setValue=this.setValueArrayT.bind(this);this.updateValue=this.updateValueArrayT.bind(this)}else if(t=="m4"||t=="m4[]"){this.set=this.setValue=this.setValueM4.bind(this);this.updateValue=this.updateValueM4.bind(this)}else{this._log.error("Unknown uniform type "+t,i,typeof this._shader)}if(typeof r=="object"&&r instanceof c.I){this._port=r;this._value=this._port.get();if(s&&n&&a){if(!(s instanceof c.I)||!(n instanceof c.I)||!(a instanceof c.I)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0,0];this._port2=s;this._port3=n;this._port4=a;this._port.on("change",this.updateFromPort4f.bind(this));this._port2.on("change",this.updateFromPort4f.bind(this));this._port3.on("change",this.updateFromPort4f.bind(this));this._port4.on("change",this.updateFromPort4f.bind(this));this.updateFromPort4f()}else if(s&&n){if(!(s instanceof c.I)||!(n instanceof c.I)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0];this._port2=s;this._port3=n;this._port.on("change",this.updateFromPort3f.bind(this));this._port2.on("change",this.updateFromPort3f.bind(this));this._port3.on("change",this.updateFromPort3f.bind(this));this.updateFromPort3f()}else if(s){if(!(s instanceof c.I)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0];this._port2=s;this._port.on("change",this.updateFromPort2f.bind(this));this._port2.on("change",this.updateFromPort2f.bind(this));this.updateFromPort2f()}else{this._port.on("change",this.updateFromPort.bind(this))}}else this._value=r;if(this._value==undefined){this._value=0}this.setValue(this._value);this.needsUpdate=true}getType(){return this._type}get type(){return this._type}get name(){return this._name}getName(){return this._name}getValue(){return this._value}getShaderType(){return this.shaderType}isStructMember(){return!!this._structName}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}get port(){return this._port}}},748:(e,t,i)=>{"use strict";var r=i(823);var s=i(522);var n=i(964);var a=i(409);var o=i(684);var l=i(221);var h=i(991);var u=i(842);var c=i(329);var g=i(796);var f=i(982);var d=i(223);var p=i(331);var m=i(294);const _={DEPTH_COMPARE_NEVER:0,DEPTH_COMPARE_LESS:1,DEPTH_COMPARE_EQUAL:2,DEPTH_COMPARE_LESSEQUAL:3,DEPTH_COMPARE_GREATER:4,DEPTH_COMPARE_NOTEQUAL:5,DEPTH_COMPARE_GREATEREQUAL:6,DEPTH_COMPARE_ALWAYS:7,CULL_NONE:0,CULL_BACK:1,CULL_FRONT:2,CULL_BOTH:3,Geometry:p.V,BoundingBox:f.I,FpsCounter:m.K,CgCanvas:d.f};window.CABLES=window.CABLES||{};window.CABLES.CG=window.CABLES.CG||_;window.CG=window.CG||_;window.glMatrix=r;window.mat2=s;window.mat2d=n;window.mat3=a;window.mat4=o;window.quat=l;window.quat2=h;window.vec2=u;window.vec3=c;window.vec4=g},264:(e,t,i)=>{"use strict";i.d(t,{C:()=>g,e:()=>o});var s=i(849);var n=i(562);var r=i(923);var c=i(997);var a=i(434);const g={};g.lastMesh=null;class o extends a.w{#cgl=null;#geom=null;#bufVerticesIndizes=null;constructor(e,t,i={}){super();this.#cgl=e;let r=i||{};if(n.isNumeric(r))r={glPrimitive:i};this._log=new s.A("cgl_mesh");this._bufVertexAttrib=null;this.#bufVerticesIndizes=this.#cgl.gl.createBuffer();this._indexType=this.#cgl.gl.UNSIGNED_SHORT;this._attributes=[];this._attribLocs={};this._lastShader=null;this._numInstances=0;this._glPrimitive=r.glPrimitive;this.opId=r.opId||"";this._preWireframeGeom=null;this.addVertexNumbers=false;this.feedBackAttributes=[];this.setGeom(t);this._feedBacks=[];this._feedBacksChanged=false;this._transformFeedBackLoc=-1;this._lastAttrUpdate=0;this.memFreed=false;this.#cgl.profileData.addHeavyEvent("mesh constructed",this._name);this._queryExt=null}get geom(){return this.#geom}get numInstances(){return this._numInstances}set numInstances(e){this.setNumInstances(e)}freeMem(){this.memFreed=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].floatArray=null}updateVertices(e){this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_POSITION,e.vertices,3);this._numVerts=e.vertices.length/3}setAttributePointer(t,i,r,s){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t){if(!this._attributes[e].pointer)this._attributes[e].pointer=[];this._attributes[e].pointer.push({loc:-1,name:i,stride:r,offset:s,instanced:t==c.a.SHADER.SHADERVAR_INSTANCE_MMATRIX})}}}getAttribute(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]}setAttributeRange(e,t,i,r){if(!e)return;if(!i&&!r)return;if(!e.name)this._log.stack("no attrname?!");const s=this.#cgl.gl;s.bindBuffer(s.ARRAY_BUFFER,e.buffer);this.#cgl.profileData.profileMeshAttributes+=r-i||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]=this.#cgl.profileData.profileSingleMeshAttribute[this._name]||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]+=r-i||0;if(e.numItems<t.length/e.itemSize){this._resizeAttr(t,e)}if(r>t.length&&!this.warned){this.warned=true;this._log.warn(this.#cgl.canvas.id+" "+e.name+" buffersubdata out of bounds ?",t.length,r,i,e);return}s.bufferSubData(s.ARRAY_BUFFER,i*4,t,i,r-i)}_resizeAttr(e,t){const i=this.#cgl.gl;if(t.buffer)i.deleteBuffer(t.buffer);t.buffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.buffer);this._bufferArray(e,t);t.numItems=e.length/t.itemSize}_bufferArray(e,t){let i=t.floatArray||null;if(!e)return;if(this.#cgl.debugOneFrame){console.log("_bufferArray",e.length,t.name)}if(!(e instanceof Float32Array)){if(t&&i&&i.length==e.length){i.set(e)}else{i=new Float32Array(e);if(this.#cgl.debugOneFrame){console.log("_bufferArray create new float32array",e.length,t.name)}if(e.length>1e4){this.#cgl.profileData.profileNonTypedAttrib++;this.#cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"}}}else i=e;t.arrayLength=i.length;t.floatArray=null;this.#cgl.gl.bufferData(this.#cgl.gl.ARRAY_BUFFER,i,this.#cgl.gl.DYNAMIC_DRAW)}addAttribute(e,t,i,r){this.setAttribute(e,t,i,r)}setAttribute(e,t,i,r={}){if(!t){this._log.error("mesh addAttribute - no array given! "+e);throw new Error}let s=null;let n=false;let a=0;const o=t.length/i;this.#cgl.profileData.profileMeshAttributes+=o||0;if(typeof r=="function"){s=r}if(typeof r=="object"){if(r.cb)s=r.cb;if(r.instanced)n=r.instanced}if(e==c.a.SHADER.SHADERVAR_INSTANCE_MMATRIX)n=true;for(a=0;a<this._attributes.length;a++){const u=this._attributes[a];if(u.name==e){if(u.numItems===o){}else{this._resizeAttr(t,u)}this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,u.buffer);this._bufferArray(t,u);return u}}const l=this.#cgl.gl.createBuffer();this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,l);let h=this.#cgl.gl.FLOAT;if(r&&r.type)h=r.type;const u={buffer:l,name:e,cb:s,itemSize:i,numItems:o,startItem:0,instanced:n,type:h};this._bufferArray(t,u);if(e==c.a.SHADER.SHADERVAR_VERTEX_POSITION)this._bufVertexAttrib=u;this._attributes.push(u);this._attribLocs={};return u}getAttributes(){return this._attributes}updateTexCoords(e){if(e.texCoords&&e.texCoords.length>0){this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_TEXCOORD,e.texCoords,2)}else{const t=new Float32Array(Math.round(e.vertices.length/3*2));this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_TEXCOORD,t,2)}}updateNormals(e){if(e.vertexNormals&&e.vertexNormals.length>0){this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_NORMAL,e.vertexNormals,3)}else{const t=new Float32Array(Math.round(e.vertices.length));this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_NORMAL,t,3)}}_setVertexNumbers(e=null){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,i)=>{if(!i.uniformNumVertices)i.uniformNumVertices=new r.n(i,"f","numVertices",this._numVerts);i.uniformNumVertices.setValue(this._numVerts)})}}setVertexIndices(t){if(!this.#bufVerticesIndizes){this._log.warn("no bufVerticesIndizes: "+this._name);return}if(t.length>0){if(t instanceof Float32Array)this._log.warn("vertIndices float32Array: "+this._name);for(let e=0;e<t.length;e++){if(t[e]>=this._numVerts){this._log.warn("invalid index in "+this._name,e,t[e]);return}}this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes);if(t.length>65535){this.vertIndicesTyped=new Uint32Array(t);this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(t instanceof Uint32Array){this.vertIndicesTyped=t;this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(!(t instanceof Uint16Array)){this.vertIndicesTyped=new Uint16Array(t);this._indexType=this.#cgl.gl.UNSIGNED_SHORT}else this.vertIndicesTyped=t;this.#cgl.gl.bufferData(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this.#cgl.gl.DYNAMIC_DRAW);this.#bufVerticesIndizes.itemSize=1;this.#bufVerticesIndizes.numItems=t.length}else this.#bufVerticesIndizes.numItems=0}setGeom(e,t=false){this.#geom=e;if(e.glPrimitive!=null)this._glPrimitive=e.glPrimitive;if(this.#geom&&this.#geom.name)this._name="mesh "+this.#geom.name;g.lastMesh=null;this.#cgl.profileData.profileMeshSetGeom++;this._disposeAttributes();this.updateVertices(this.#geom);this.setVertexIndices(this.#geom.verticesIndices);if(this.addVertexNumbers)this._setVertexNumbers();const i=this.#geom.getAttributes();const r={texCoords:c.a.SHADER.SHADERVAR_VERTEX_TEXCOORD,vertexNormals:c.a.SHADER.SHADERVAR_VERTEX_NORMAL,vertexColors:c.a.SHADER.SHADERVAR_VERTEX_COLOR,tangents:"attrTangent",biTangents:"attrBiTangent"};for(const s in i)if(i[s].data&&i[s].data.length)this.setAttribute(r[s]||s,i[s].data,i[s].itemSize);if(t){this.#geom=null}}_preBind(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].cb)this._attributes[e].cb(this._attributes[e],this.#geom,t)}_checkAttrLengths(){if(this.memFreed)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";if(this.#geom)e=this.#geom.name}}}_bind(t){if(!t)return;if(!t.isValid())return;let i=[];if(this._attribLocs[t.id])i=this._attribLocs[t.id];else this._attribLocs[t.id]=i;this._lastShader=t;if(t.lastCompile>this._lastAttrUpdate||i.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let e=0;e<this._attributes.length;e++)i[e]=-1}for(let e=0;e<this._attributes.length;e++){const r=this._attributes[e];if(i[e]==-1){if(r._attrLocationLastShaderTime!=t.lastCompile){r._attrLocationLastShaderTime=t.lastCompile;i[e]=this.#cgl.glGetAttribLocation(t.getProgram(),r.name);this.#cgl.profileData.profileAttrLoc++}}if(i[e]!=-1){this.#cgl.gl.enableVertexAttribArray(i[e]);this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,r.buffer);if(r.instanced){if(r.itemSize<=4){if(!r.itemSize||r.itemSize==0)this._log.warn("instanced attrib itemsize error",this.#geom.name,r);this.#cgl.gl.vertexAttribPointer(i[e],r.itemSize,r.type,false,r.itemSize*4,0);this.#cgl.gl.vertexAttribDivisor(i[e],1)}else if(r.itemSize==16){const s=16*4;this.#cgl.gl.vertexAttribPointer(i[e],4,r.type,false,s,0);this.#cgl.gl.enableVertexAttribArray(i[e]+1);this.#cgl.gl.vertexAttribPointer(i[e]+1,4,r.type,false,s,4*4*1);this.#cgl.gl.enableVertexAttribArray(i[e]+2);this.#cgl.gl.vertexAttribPointer(i[e]+2,4,r.type,false,s,4*4*2);this.#cgl.gl.enableVertexAttribArray(i[e]+3);this.#cgl.gl.vertexAttribPointer(i[e]+3,4,r.type,false,s,4*4*3);this.#cgl.gl.vertexAttribDivisor(i[e],1);this.#cgl.gl.vertexAttribDivisor(i[e]+1,1);this.#cgl.gl.vertexAttribDivisor(i[e]+2,1);this.#cgl.gl.vertexAttribDivisor(i[e]+3,1)}else{this._log.warn("unknown instance attrib size",r.name)}}else{if(!r.itemSize||r.itemSize==0)this._log.warn("attrib itemsize error",this._name,r);this.#cgl.gl.vertexAttribPointer(i[e],r.itemSize,r.type,false,r.itemSize*4,0);if(r.pointer){for(let e=0;e<r.pointer.length;e++){const n=r.pointer[e];if(n.loc==-1)n.loc=this.#cgl.glGetAttribLocation(t.getProgram(),n.name);this.#cgl.profileData.profileAttrLoc++;this.#cgl.gl.enableVertexAttribArray(n.loc);this.#cgl.gl.vertexAttribPointer(n.loc,r.itemSize,r.type,false,n.stride,n.offset)}}if(this.bindFeedback)this.bindFeedback(r)}}}if(this.#bufVerticesIndizes&&this.#bufVerticesIndizes.numItems!==0)this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes)}unBind(){const e=this._lastShader;this._lastShader=null;if(!e)return;let t=[];if(this._attribLocs[e.id])t=this._attribLocs[e.id];else this._attribLocs[e.id]=t;g.lastMesh=null;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].instanced){if(this._attributes[e].itemSize<=4){if(t[e]!=-1)this.#cgl.gl.vertexAttribDivisor(t[e],0);if(t[e]>=0)this.#cgl.gl.disableVertexAttribArray(t[e])}else{this.#cgl.gl.vertexAttribDivisor(t[e],0);this.#cgl.gl.vertexAttribDivisor(t[e]+1,0);this.#cgl.gl.vertexAttribDivisor(t[e]+2,0);this.#cgl.gl.vertexAttribDivisor(t[e]+3,0);this.#cgl.gl.disableVertexAttribArray(t[e]+1);this.#cgl.gl.disableVertexAttribArray(t[e]+2);this.#cgl.gl.disableVertexAttribArray(t[e]+3)}}if(t[e]!=-1)this.#cgl.gl.disableVertexAttribArray(t[e])}}meshChanged(){return this.#cgl.lastMesh&&this.#cgl.lastMesh!=this}printDebug(){console.log("--attributes");for(let e=0;e<this._attributes.length;e++){console.log("attribute "+e+" "+this._attributes[e].name)}}setNumVertices(e){this._bufVertexAttrib.numItems=e}getNumVertices(){return this._bufVertexAttrib.numItems}setNumIndices(e){this.#bufVerticesIndizes.numItems=e}getNumIndices(){return this.#bufVerticesIndizes.numItems}render(i){if(this.#cgl.aborted)return;i=i||this.#cgl.getShader();if(!i){return console.log("shader not valid")}if(!i.isValid()){i=this.#cgl.getErrorShader()}this._checkAttrLengths();if(this.#geom){if(this._preWireframeGeom&&!i.wireframe&&!this.#geom.isIndexed()){this.setGeom(this._preWireframeGeom);this._preWireframeGeom=null}if(i.wireframe){let e=false;if(this.#geom.isIndexed()){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}this.#geom.unIndex();e=true}if(!this.#geom.getAttribute("attrBarycentric")){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}e=true;this.#geom.calcBarycentric()}if(e)this.setGeom(this.#geom)}}let e=false;if(g.lastMesh!=this){if(g.lastMesh)g.lastMesh.unBind();e=true}if(e)this._preBind(i);if(!i.bind())return;this._bind(i);if(this.addVertexNumbers)this._setVertexNumbers();g.lastMesh=this;let t=this.#cgl.gl.TRIANGLES;if(this._glPrimitive!==undefined)t=this._glPrimitive;if(i.glPrimitive!==null)t=i.glPrimitive;let r=1;let s=this.#cgl.profileData.doProfileGlQuery;let n=false;if(s){let e=this._name+" - "+i.getName()+" #"+i.id;if(this._numInstances)e+=" instanced "+this._numInstances+"x";let t=this.#cgl.profileData.glQueryData[e];if(!t)t={id:e,num:0};if(i.opId)t.shaderOp=i.opId;if(this.opId)t.meshOp=this.opId;this.#cgl.profileData.glQueryData[e]=t;if(!this._queryExt&&this._queryExt!==false)this._queryExt=this.#cgl.enableExtension("EXT_disjoint_timer_query_webgl2")||false;if(this._queryExt){if(t._drawQuery){const a=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT_AVAILABLE);if(a){const o=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT);const l=o/1e6;t._times=t._times||0;t._times+=l;t._numcount++;t.when=performance.now();t._drawQuery=null;t.queryStarted=false}}if(!t.queryStarted){t._drawQuery=this.#cgl.gl.createQuery();this.#cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery);n=t.queryStarted=true}}}if(this.hasFeedbacks&&this.hasFeedbacks())this.drawFeedbacks(i,t);else if(!this.#bufVerticesIndizes||this.#bufVerticesIndizes.numItems===0){if(t==this.#cgl.gl.TRIANGLES)r=3;if(this._numInstances===0)this.#cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem);else this.#cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)}else{if(t==this.#cgl.gl.TRIANGLES)r=3;if(this._numInstances===0){this.#cgl.gl.drawElements(t,this.#bufVerticesIndizes.numItems,this._indexType,0)}else{this.#cgl.gl.drawElementsInstanced(t,this.#bufVerticesIndizes.numItems,this._indexType,0,this._numInstances)}}if(this.#cgl.debugOneFrame&&this.#cgl.gl.getError()!=this.#cgl.gl.NO_ERROR){this._log.error("mesh draw gl error");this._log.error("mesh",this);this._log.error("shader",i);const h=[];for(let e=0;e<this.#cgl.gl.getProgramParameter(i.getProgram(),this.#cgl.gl.ACTIVE_ATTRIBUTES);e++){const u=this.#cgl.gl.getActiveAttrib(i.getProgram(),e).name;this._log.error("attrib ",u)}}this.#cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/r*(this._numInstances||1);this.#cgl.profileData.profileMeshDraw++;if(s&&n){this.#cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT)}this.#cgl.printError("mesh render "+this._name);this.unBind()}setNumInstances(t){t=Math.max(0,t);if(this._numInstances!=t){this._numInstances=t;const i=new Float32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setAttribute(c.a.SHADER.SHADERVAR_INSTANCE_INDEX,i,1,{instanced:true})}}_disposeAttributes(){if(!this._attributes)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].buffer){this.#cgl.gl.deleteBuffer(this._attributes[e].buffer);this._attributes[e].buffer=null}}this._attributes.length=0}dispose(){if(this.#cgl.aborted)return;if(this._bufVertexAttrib&&this._bufVertexAttrib.buffer)this.#cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);if(this.#bufVerticesIndizes)this.#cgl.gl.deleteBuffer(this.#bufVerticesIndizes);this.#bufVerticesIndizes=null;this._disposeAttributes();return null}}},460:(e,t,i)=>{"use strict";i.d(t,{E:()=>r});class r{constructor(e){this._cgl=e;this._lastTime=0;this.pause=false;this.profileUniformCount=0;this.profileShaderBinds=0;this.profileUniformCount=0;this.profileShaderCompiles=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileEffectBuffercreate=0;this.profileShaderGetUniform=0;this.profileFrameBuffercreate=0;this.profileMeshSetGeom=0;this.profileTextureNew=0;this.profileGenMipMap=0;this.profileOnAnimFrameOps=0;this.profileFencedPixelRead=0;this.profileMainloopMs=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.shaderCompileTime=0;this.profileMeshNumElements=0;this.profileMeshAttributes=0;this.profileSingleMeshAttribute=[];this.heavyEvents=[];this.doProfileGlQuery=false;this.glQueryData={};this.counts={}}clear(){this.counts={};this.profileSingleMeshAttribute={};this.profileMeshAttributes=0;this.profileUniformCount=0;this.profileShaderGetUniform=0;this.profileShaderCompiles=0;this.profileShaderBinds=0;this.profileTextureResize=0;this.profileFrameBuffercreate=0;this.profileEffectBuffercreate=0;this.profileTextureDelete=0;this.profileMeshSetGeom=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileNonTypedAttrib=0;this.profileNonTypedAttribNames="";this.profileTextureNew=0;this.profileGenMipMap=0;this.profileFramebuffer=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.profileMeshNumElements=0;this.profileFencedPixelRead=0}clearGlQuery(){for(let e in this.glQueryData){if(!this.glQueryData[e].lastClear||performance.now()-this.glQueryData[e].lastClear>1e3){this.glQueryData[e].time=this.glQueryData[e]._times/this.glQueryData[e]._numcount;this.glQueryData[e].num=this.glQueryData[e]._numcount;this.glQueryData[e]._times=0;this.glQueryData[e]._numcount=0;this.glQueryData[e].lastClear=performance.now()}}}count(e,t){this.counts[e]=this.counts[e]||[];this.counts[e].push(t)}addHeavyEvent(e,t,i){const r={event:e,name:t,info:i,date:performance.now()};this.heavyEvents.push(r);this._cgl.emitEvent("heavyEvent",r)}}},24:(e,t,i)=>{"use strict";i.d(t,{M:()=>c});var r=i(849);var s=i(684);var v=i(920);var n=i(960);var x=i(264);var T=i(997);var a=i(694);var o=i(70);var l=i(923);const h=`
{{MODULES_HEAD}}
IN vec3 vPosition; //!@
IN vec2 attrTexCoord;
IN vec3 attrVertNormal;
IN vec3 attrTangent,attrBiTangent;

IN float attrVertIndex;

OUT vec2 texCoord;
OUT vec3 norm;
UNI mat4 projMatrix;
UNI mat4 viewMatrix;
UNI mat4 modelMatrix;

void main()
{
    texCoord=attrTexCoord;
    norm=attrVertNormal;
    vec4 pos=vec4(vPosition,  1.0);
    vec3 tangent=attrTangent;
    vec3 bitangent=attrBiTangent;
    mat4 mMatrix=modelMatrix;
    gl_PointSize=10.0;

    {{MODULE_VERTEX_POSITION}}

    mat4 modelViewMatrix=viewMatrix*mMatrix;
    {{MODULE_VERTEX_MODELVIEW}}

    gl_Position = projMatrix * modelViewMatrix * pos;
}
`;let u=0;function C(){return h}function D(e,t,i){if(e==undefined){e=.5;t=.5;i=.5}return""+T.nl+"IN vec2 texCoord;"+T.nl+"{{MODULES_HEAD}}"+T.nl+"void main()"+T.nl+"{"+T.nl+"    vec4 col=vec4("+e+","+t+","+i+",1.0);"+T.nl+"    {{MODULE_COLOR}}"+T.nl+"    outColor = col;"+T.nl+"}"}class c extends a.U{_uniforms=[];constructor(e,t,i){super();if(!e)throw new Error("shader constructed without cgl "+t);this._log=new r.A("cgl_shader");this._cgl=e;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";if(i)this.opId=i.id;this.glslVersion=0;if(e.glVersion>1)this.glslVersion=300;this._materialId=++u;this._program=null;this._drawBuffers=[true];this.error=null;this.ignoreMissingUniforms=false;this._projMatrixUniform=null;this._mvMatrixUniform=null;this._mMatrixUniform=null;this._vMatrixUniform=null;this._camPosUniform=null;this._normalMatrixUniform=null;this._inverseViewMatrixUniform=null;this._fromUserInteraction=false;this._attrVertexPos=-1;this.precision=e.patch.config.glslPrecision||"highp";this._pMatrixState=-1;this._vMatrixState=-1;this._countMissingUniforms=0;this._modGroupCount=0;this._feedBackNames=[];this._attributes=[];this.glPrimitive=null;this.offScreenPass=false;this._extensions=[];this.srcVert=C();this.srcFrag=D();this.lastCompile=0;this._libs=[];this._structNames=[];this._structUniformNames=[];this._textureStackUni=[];this._textureStackTex=[];this._textureStackType=[];this._textureStackTexCgl=[];this._tempNormalMatrix=s.create();this._tempCamPosMatrix=s.create();this._tempInverseViewMatrix=s.create();this._tempInverseProjMatrix=s.create();this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_NORMAL","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"])}isValid(){return this._isValid}getCgl(){return this._cgl}getName(){return this._name}enableExtension(e){this.setWhyCompile("enable extension "+e);this._extensions.push(e)}getAttrVertexPos(){return this._attrVertexPos}hasTextureUniforms(){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getType()=="t")return true;return false}copyUniformValues(t){for(let e=0;e<t._uniforms.length;e++){if(!this._uniforms[e]){this._log.log("unknown uniform?!");continue}this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())}this.popTextures();for(let e=0;e<t._textureStackUni.length;e++){this._textureStackUni[e]=t._textureStackUni[e];this._textureStackTex[e]=t._textureStackTex[e];this._textureStackType[e]=t._textureStackType[e];this._textureStackTexCgl[e]=t._textureStackTexCgl[e]}}copy(){const t=new c(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._modGroupCount=this._modGroupCount;t._moduleNames=this._moduleNames;t.glPrimitive=this.glPrimitive;t.offScreenPass=this.offScreenPass;t._extensions=this._extensions;t.wireframe=this.wireframe;t._attributes=this._attributes;for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e].copy(t);i.resetLoc()}t.setWhyCompile("copy");return t}setSource(e,t,i=false){this._fromUserInteraction=i;this.srcVert=e;this.srcFrag=t;this.setWhyCompile("Source changed");this._isValid=true}_addLibs(e){for(const t in n.y){if(e.includes(t)){const i=new n.y[t];e=e.replace("{{"+t+"}}",i.srcHeadFrag);this._libs.push(i);if(i.initUniforms)i.initUniforms(this)}}return e}createStructUniforms(){let r="";let s="";this._structNames=[];this._injectedStringsFrag={};this._injectedStringsVert={};this._structUniformNamesIndicesFrag=[];this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].isStructMember()){const n="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(!this._structNames.includes(this._uniforms[i]._structName)){const a="struct "+this._uniforms[i]._structName+" {"+T.nl+n+"};"+T.nl+T.nl;if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="frag")r=r.concat(a);if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="vert")s=s.concat(a);this._structNames.push(this._uniforms[i]._structName);this._injectedStringsFrag[this._uniforms[i]._structName]=[];this._injectedStringsVert[this._uniforms[i]._structName]=[]}let e="";if(this._uniforms[i].comment)e=" // "+this._uniforms[i].comment;let t="";if(this._uniforms[i].getGlslTypeString()==undefined)t+="//";t+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+e;if(this._uniforms[i].getShaderType()==="both"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)&&!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const o=r.lastIndexOf(n);const l=s.lastIndexOf(n);r=r.slice(0,o)+t+r.slice(o-1);s=s.slice(0,l)+t+s.slice(l-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i);if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}else if(this._uniforms[i].getShaderType()==="frag"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)){const o=r.lastIndexOf(n);r=r.slice(0,o)+t+r.slice(o-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i)}else if(this._uniforms[i].getShaderType()==="vert"){if(!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const l=s.lastIndexOf(n);s=s.slice(0,l)+t+s.slice(l-1);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}}}this._uniDeclarationsFrag=[];this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const t=this._structUniformNamesIndicesFrag[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+T.nl;if(!this._uniDeclarationsFrag.includes(i)){const n="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";r=r.replace(n,"");r+=i;this._uniDeclarationsFrag.push(i)}}for(let e=0;e<this._structUniformNamesIndicesVert.length;e+=1){const t=this._structUniformNamesIndicesVert[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+T.nl;if(!this._uniDeclarationsVert.includes(i)){const n="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";s=s.replace(n,"");s+=i;this._uniDeclarationsVert.push(i)}}return[s,r]}_getAttrSrc(e,t){const i={};if(e.name&&e.type){i.srcHeadVert="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.name+T.nl;i.srcHeadVert+="#define ATTRIB_"+e.name+T.nl;i.srcHeadVert+="IN "+e.type+" "+e.name+";"+T.nl;if(!t)i.srcHeadVert+="#endif"+T.nl;if(e.nameFrag){i.srcHeadVert+="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.nameFrag+T.nl;i.srcHeadVert+="#define ATTRIB_"+e.nameFrag+T.nl;i.srcHeadVert+="OUT "+e.type+" "+e.nameFrag+";"+T.nl;if(!t)i.srcHeadVert+="#endif"+T.nl;i.srcVert=""+T.nl+e.nameFrag+"="+e.name+";";i.srcHeadFrag="";if(!t)i.srcHeadFrag+="#ifndef ATTRIB_"+e.nameFrag+T.nl;i.srcHeadFrag+="#define ATTRIB_"+e.nameFrag+T.nl;i.srcHeadFrag+="IN "+e.type+" "+e.nameFrag+";"+T.nl;if(!t)i.srcHeadFrag+="#endif"+T.nl}}return i}compile(){if(this._cgl.aborted)return;const e=performance.now();this._cgl.profileData.profileShaderCompiles++;this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let t="";if(this._extensions)for(let e=0;e<this._extensions.length;e++)t+="#extension "+this._extensions[e]+" : enable"+T.nl;let i="";if(this._defines.length)i="\n// cgl generated"+T.nl;for(let e=0;e<this._defines.length;e++)i+="#define "+this._defines[e][0]+" "+this._defines[e][1]+""+T.nl;const r=this.createStructUniforms();this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]");this._compileReason="";if(this._uniforms){const m=this._uniforms.map(e=>{return e._name});const _=[];for(let e=0;e<this._uniforms.length;e++){const E=this._uniforms[e];const b=m.indexOf(E._name,e+1);if(b>-1)_.push(e)}for(let e=this._uniforms.length-1;e>=0;e-=1){if(_.includes(e))this._uniforms.splice(e,1);else this._uniforms[e].resetLoc()}}this._cgl.printError("uniform resets");this._compileCount++;if(this.hasTextureUniforms())i+="#define HAS_TEXTURES"+T.nl;let s="";let n="";if(!this.srcFrag){this._log.warn("[cgl shader] has no fragment source!",this._name,this);this.srcVert=C();this.srcFrag=D()}s="#version 300 es"+T.nl+"// "+T.nl+"// vertex shader "+this._name+T.nl+"// "+T.nl+"precision "+this.precision+" float;"+T.nl+"precision "+this.precision+" sampler2D;"+T.nl+""+T.nl+"#define WEBGL2"+T.nl+"#define texture2D texture"+T.nl+"#define UNI uniform"+T.nl+"#define IN in"+T.nl+"#define OUT out"+T.nl;n="#version 300 es"+T.nl+"// "+T.nl+"// fragment shader "+this._name+T.nl+"// "+T.nl+"precision "+this.precision+" float;"+T.nl+"precision "+this.precision+" sampler2D;"+T.nl+""+T.nl+"#define WEBGL2"+T.nl+"#define texture2D texture"+T.nl+"#define IN in"+T.nl+"#define OUT out"+T.nl+"#define UNI uniform"+T.nl+"{{DRAWBUFFER}}"+T.nl;let a="\n// cgl generated"+T.nl;let o="\n// cgl generated"+T.nl;n+="\n// active mods: --------------- ";s+="\n// active mods: --------------- ";let l=false;let h=false;for(let t=0;t<this._moduleNames.length;t++){for(let e=0;e<this._modules.length;e++){if(this._modules[e].name==this._moduleNames[t]){if(this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag){l=true;n+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"}if(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert){s+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")";h=true}}}}if(!h)n+="\n// no mods used...";if(!l)n+="\n// no mods used...";n+="\n";s+="\n";for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].shaderType&&!this._uniforms[i].isStructMember()){let e="";if(!this._uniforms[i].getGlslTypeString())e+="// ";e+="UNI "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName();let t="";if(this._uniforms[i].comment)t=" // "+this._uniforms[i].comment;if(this._uniforms[i].shaderType=="vert"||this._uniforms[i].shaderType=="both")if(!this.srcVert.includes(e)&&!this.srcVert.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))a+=e+";"+t+T.nl;if(this._uniforms[i].shaderType=="frag"||this._uniforms[i].shaderType=="both")if(!this.srcFrag.includes(e)&&!this.srcFrag.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))o+=e+";"+t+T.nl}}let u=0;let c=0;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].shaderType&&!this._uniforms[e].isStructMember()){if(this._uniforms[e].shaderType=="vert"||this._uniforms[e].shaderType=="both")c++;if(this._uniforms[e].shaderType=="frag"||this._uniforms[e].shaderType=="both")u++}}if(u>=this._cgl.maxUniformsFrag)this._log.warn("[cgl_shader] num uniforms frag: "+u+" / "+this._cgl.maxUniformsFrag);if(c>=this._cgl.maxUniformsVert)this._log.warn("[cgl_shader] num uniforms vert: "+c+" / "+this._cgl.maxUniformsVert);if(!n.includes("precision"))n="precision "+this.precision+" float;"+T.nl+n;if(!s.includes("precision"))s="precision "+this.precision+" float;"+T.nl+s;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){n+="#define MOBILE"+T.nl;s+="#define MOBILE"+T.nl}s=t+s+i+r[0]+a+"\n// -- \n"+this.srcVert;n=t+n+i+r[1]+o+"\n// -- \n"+this.srcFrag;let g="";let f="";this._modules.sort(function(e,t){return e.priority||0-t.priority||0});let d=false;for(let r=0;r<this._moduleNames.length;r++){let t="";let i="";if(!d){d=true;for(let e=0;e<this._attributes.length;e++){const A=this._getAttrSrc(this._attributes[e],true);if(A.srcHeadVert)g+=A.srcHeadVert;if(A.srcVert)t+=A.srcVert;if(A.srcHeadFrag)f+=A.srcHeadFrag}}for(let e=0;e<this._modules.length;e++){const F=this._modules[e];if(F.name==this._moduleNames[r]){g+="\n//---- MOD: group:"+F.group+": idx:"+e+" - prfx:"+F.prefix+" - "+F.title+" ------\n";f+="\n//---- MOD: group:"+F.group+": idx:"+e+" - prfx:"+F.prefix+" - "+F.title+" ------\n";t+="\n\n//---- MOD: "+F.title+" / "+F.priority+" ------\n";i+="\n\n//---- MOD: "+F.title+" / "+F.priority+" ------\n";if(F.attributes)for(let e=0;e<F.attributes.length;e++){const A=this._getAttrSrc(F.attributes[e],false);if(A.srcHeadVert)g+=A.srcHeadVert;if(A.srcVert)t+=A.srcVert;if(A.srcHeadFrag)f+=A.srcHeadFrag}g+=F.srcHeadVert||"";f+=F.srcHeadFrag||"";t+=F.srcBodyVert||"";i+=F.srcBodyFrag||"";g+="\n//---- end mod ------\n";f+="\n//---- end mod ------\n";t+="\n//---- end mod ------\n";i+="\n//---- end mod ------\n";t=t.replace(/{{mod}}/g,F.prefix);i=i.replace(/{{mod}}/g,F.prefix);g=g.replace(/{{mod}}/g,F.prefix);f=f.replace(/{{mod}}/g,F.prefix);t=t.replace(/MOD_/g,F.prefix);i=i.replace(/MOD_/g,F.prefix);g=g.replace(/MOD_/g,F.prefix);f=f.replace(/MOD_/g,F.prefix)}}s=s.replace("{{"+this._moduleNames[r]+"}}",t);n=n.replace("{{"+this._moduleNames[r]+"}}",i)}s=s.replace("{{MODULES_HEAD}}",g);n=n.replace("{{MODULES_HEAD}}",f);s=this._addLibs(s);n=this._addLibs(n);let p="";for(let e=0;e<16;e++)if(n.includes("outColor"+e))this._drawBuffers[e]=true;if(this._drawBuffers.length==1){p="out vec4 outColor;"+T.nl;p+="#define gl_FragColor outColor"+T.nl}else{p+="#define MULTI_COLORTARGETS"+T.nl;p+="vec4 outColor;"+T.nl;let t=0;for(let e=0;e<this._drawBuffers.length;e++){if(t==0)p+="#define gl_FragColor outColor"+e+""+T.nl;p+="layout(location = "+e+") out vec4 outColor"+e+";"+T.nl;t++}}n=n.replace("{{DRAWBUFFER}}",p);if(!this._program){this._program=this._createProgram(s,n)}else{this._program=this._createProgram(s,n);this._projMatrixUniform=null;for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].resetLoc()}this.finalShaderFrag=n;this.finalShaderVert=s;x.C.lastMesh=null;x.C.lastShader=null;this._countMissingUniforms=0;this._needsRecompile=false;this.lastCompile=(0,v.tB)();this._cgl.profileData.shaderCompileTime+=performance.now()-e}bind(){if(!this._isValid||this._cgl.aborted)return;x.C.lastShader=this;if(!this._program||this.needsRecompile())this.compile();if(!this._isValid)return;if(!this._projMatrixUniform&&!this.ignoreMissingUniforms){this._countMissingUniforms++;if(this._countMissingUniforms<10){this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,T.a.SHADER.SHADERVAR_UNI_PROJMAT);this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,T.a.SHADER.SHADERVAR_VERTEX_POSITION);this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix");this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,T.a.SHADER.SHADERVAR_UNI_VIEWMAT);this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,T.a.SHADER.SHADERVAR_UNI_MODELMAT);this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,T.a.SHADER.SHADERVAR_UNI_VIEWPOS);this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,T.a.SHADER.SHADERVAR_UNI_NORMALMAT);this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,T.a.SHADER.SHADERVAR_UNI_INVVIEWMAT);this._inverseProjMatrixUniform=this._cgl.gl.getUniformLocation(this._program,T.a.SHADER.SHADERVAR_UNI_INVPROJMAT);this._materialIdUniform=this._cgl.gl.getUniformLocation(this._program,T.a.SHADER.SHADERVAR_UNI_MATERIALID);this._objectIdUniform=this._cgl.gl.getUniformLocation(this._program,T.a.SHADER.SHADERVAR_UNI_OBJECTID);for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].needsUpdate=true}}if(this._cgl.currentProgram!=this._program){this._cgl.profileData.profileShaderBinds++;this._cgl.gl.useProgram(this._program);this._cgl.currentProgram=this._program}for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].needsUpdate)this._uniforms[e].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()){this._pMatrixState=this._cgl.getProjectionMatrixStateCount();this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,false,this._cgl.pMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._objectIdUniform)this._cgl.gl.uniform1f(this._objectIdUniform,++this._cgl.tempData.objectIdCounter);if(this._materialIdUniform)this._cgl.gl.uniform1f(this._materialIdUniform,this._materialId);if(this._vMatrixUniform){if(this._vMatrixState!=this._cgl.getViewMatrixStateCount()){this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,false,this._cgl.vMatrix);this._cgl.profileData.profileMVPMatrixCount++;this._vMatrixState=this._cgl.getViewMatrixStateCount();if(this._inverseViewMatrixUniform){s.invert(this._tempInverseViewMatrix,this._cgl.vMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,false,this._tempInverseViewMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._inverseProjMatrixUniform){s.invert(this._tempInverseProjMatrix,this._cgl.pMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform,false,this._tempInverseProjMatrix);this._cgl.profileData.profileMVPMatrixCount++}}this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,false,this._cgl.mMatrix);this._cgl.profileData.profileMVPMatrixCount++;if(this._camPosUniform){s.invert(this._tempCamPosMatrix,this._cgl.vMatrix);this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]);this._cgl.profileData.profileMVPMatrixCount++}}else{const e=s.create();s.mul(e,this._cgl.vMatrix,this._cgl.mMatrix);this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,false,e);this._cgl.profileData.profileMVPMatrixCount++}if(this._normalMatrixUniform){s.invert(this._tempNormalMatrix,this._cgl.mMatrix);s.transpose(this._tempNormalMatrix,this._tempNormalMatrix);this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,false,this._tempNormalMatrix);this._cgl.profileData.profileMVPMatrixCount++}for(let e=0;e<this._libs.length;e++){if(this._libs[e].onBind)this._libs[e].onBind.bind(this._libs[e])(this._cgl,this)}this._bindTextures();return this._isValid}unBind(){}dispose(){if(this._program&&this._cgl&&this._cgl.gl)this._cgl.gl.deleteProgram(this._program);this._program=null}setDrawBuffers(e){this._log.warn("useless drawbuffers...?!")}getUniforms(){return this._uniforms}getUniform(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null}removeAllUniforms(){this._uniforms=[]}_addUniform(e){this._uniforms.push(e);this.setWhyCompile("add uniform "+name)}addUniformFrag(e,t,i,r,s,n){const a=new l.n(this,e,t,i,r,s,n);a.shaderType="frag";return a}addUniformVert(e,t,i,r,s,n){const a=new l.n(this,e,t,i,r,s,n);a.shaderType="vert";return a}addUniformBoth(e,t,i,r,s,n){const a=new l.n(this,e,t,i,r,s,n);a.shaderType="both";return a}addUniformStructFrag(t,i,r){const s={};if(!r)return s;for(let e=0;e<r.length;e+=1){const n=r[e];if(!this.hasUniform(i+"."+n.name)){const a=new l.n(this,n.type,i+"."+n.name,n.v1,n.v2,n.v3,n.v4,i,t,n.name);a.shaderType="frag";s[i+"."+n.name]=a}}return s}addUniformStructVert(t,i,r){const s={};if(!r)return s;for(let e=0;e<r.length;e+=1){const n=r[e];if(!this.hasUniform(i+"."+n.name)){const a=new l.n(this,n.type,i+"."+n.name,n.v1,n.v2,n.v3,n.v4,i,t,n.name);a.shaderType="vert";s[i+"."+n.name]=a}}return s}addUniformStructBoth(t,i,r){const s={};if(!r)return s;for(let e=0;e<r.length;e+=1){const n=r[e];if(n.type==="2i"||n.type==="i"||n.type==="3i")this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",n.name," of type:",n.type,".");if(!this.hasUniform(i+"."+n.name)){const a=new l.n(this,n.type,i+"."+n.name,n.v1,n.v2,n.v3,n.v4,i,t,n.name);a.shaderType="both";s[i+"."+n.name]=a}}return s}_createProgram(e,t){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();this.vshader=c.createShader(this._cgl,e,this._cgl.gl.VERTEX_SHADER,this);this.fshader=c.createShader(this._cgl,t,this._cgl.gl.FRAGMENT_SHADER,this);if(this.vshader&&this.fshader){this._cgl.gl.attachShader(i,this.vshader);this._cgl.gl.attachShader(i,this.fshader);this._linkProgram(i,e,t)}else{this._isValid=false;this._cgl.printError("shader _createProgram");this._log.error("could not link shaderprogram");return null}this._cgl.printError("shader _createProgram");return i}hasErrors(){return this._hasErrors}_linkProgram(e,t,i){this._cgl.printError("before _linkprogram");if(this._feedBackNames.length>0){this._cgl.gl.transformFeedbackVaryings(e,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS)}this._cgl.gl.linkProgram(e);this._cgl.printError("gl.linkprogram");this._isValid=true;this._hasErrors=false;if(this._cgl.patch.config.glValidateShader!==false){this._cgl.gl.validateProgram(e);if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.VALIDATE_STATUS)){this._log.log("shaderprogram validation failed...");this._cgl.gl.getProgramInfoLog(e)}if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.LINK_STATUS)){this._hasErrors=true;const r=this._cgl.gl.getShaderInfoLog(this.fshader);const s=this._cgl.gl.getShaderInfoLog(this.vshader);if(this.logError)this._log.error(this._name+" shader linking fail...");else this._log.warn(this._name+" shader linking fail...");if(r)this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));if(s)this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));this._cgl.gl.getProgramInfoLog(e);if(!CABLES.UI)this._log.log(this);this._isValid=false;this._cgl.printError("shader link err")}}}getProgram(){return this._program}setFeedbackNames(e){this.setWhyCompile("setFeedbackNames");this._feedBackNames=e}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t);this.setWhyCompile("addAttribute")}bindTextures(){this._bindTextures()}_bindTextures(){if(this._textureStackTex.length>this._cgl.maxTextureUnits){this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits)}for(let i=0;i<this._textureStackTex.length;i++){if(!this._textureStackTex[i]&&!this._textureStackTexCgl[i]){this._log.warn("no texture for pushtexture",this._name)}else{let e=this._textureStackTex[i];if(this._textureStackTexCgl[i]){e=this._textureStackTexCgl[i].tex||CGL.Texture.getEmptyTexture(this._cgl).tex}let t=true;if(!this._textureStackUni[i]){this._log.warn("no uniform for pushtexture",this._name);t=this._cgl.setTexture(i,e,this._textureStackType[i])}else{this._textureStackUni[i].setValue(i);t=this._cgl.setTexture(i,e,this._textureStackType[i])}if(!t)this._log.warn("tex bind failed",this.getName(),this._textureStackUni[i])}}}setUniformTexture(t,i){i=i||o.g.getTempTexture(this._cgl);for(let e=0;e<this._textureStackUni.length;e++)if(this._textureStackUni[e]==t){const r=this._textureStackTex[e]||this._textureStackTexCgl[e];if(i.hasOwnProperty("tex")){this._textureStackTexCgl[e]=i;this._textureStackTex[e]=null}else{this._textureStackTexCgl[e]=null;this._textureStackTex[e]=i}return r}return null}pushTexture(e,t,i){if(!e){return}if(!t){return}if(!t.hasOwnProperty("tex")&&!(t instanceof WebGLTexture)){this._log.warn(new Error("invalid texture").stack);this._log.warn("[cgl_shader] invalid texture...",t);return}this._textureStackUni.push(e);if(t.hasOwnProperty("tex")){this._textureStackTexCgl.push(t);this._textureStackTex.push(null)}else{this._textureStackTexCgl.push(null);this._textureStackTex.push(t)}this._textureStackType.push(i)}popTexture(){this._textureStackUni.pop();this._textureStackTex.pop();this._textureStackTexCgl.pop();this._textureStackType.pop()}popTextures(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0}getMaterialId(){return this._materialId}getInfo(){const e={};e.name=this._name;e.defines=this.getDefines();e.hasErrors=this.hasErrors();return e}getDefaultFragmentShader(e,t,i,r){return D(e,t,i,r)}getDefaultVertexShader(){return C()}}c.getDefaultVertexShader=C;c.getDefaultFragmentShader=D;c.getErrorFragmentShader=function(){return""+T.nl+"void main()"+T.nl+"{"+T.nl+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"+T.nl+"   g= step(0.1,g);"+T.nl+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"+T.nl+"}"};c.createShader=function(e,t,i,r){if(e.aborted)return;const s=e.gl.createShader(i);e.gl.shaderSource(s,t);e.gl.compileShader(s);if(!e.gl.getShaderParameter(s,e.gl.COMPILE_STATUS)){r.error={str:t,infoLog:e.gl.getShaderInfoLog(s)};if(CABLES.UI)gui.emitEvent("ShaderError",r);if(!r.error.infoLog){r._log.warn("empty shader info log",this._name);return}r.setSource(c.getDefaultVertexShader(),c.getErrorFragmentShader())}return s}},960:(e,t,i)=>{"use strict";i.d(t,{y:()=>a});var r=i(923);var s=i(771);var n=i(70);const a={"CGL.BLENDMODES":function(){this.name="blendmodes";this.srcHeadFrag=s.p.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3";this.srcHeadFrag=s.p.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance";this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex";this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}";this.initUniforms=function(e){return[new r.n(e,"t","CGLRNDTEX",7)]};this.onBind=function(e,t){n.g.getRandomTexture(e);e.setTexture(7,n.g.getRandomTexture(e).tex)}}}},923:(e,t,i)=>{"use strict";i.d(t,{n:()=>s});var r=i(475);class s extends r.v{constructor(e,t,i,r,s,n,a,o,l,h){super(e,t,i,r,s,n,a,o,l,h);this._loc=-1;this._cgl=e._cgl}get name(){return this._name}copy(e){const t=new s(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);t.shaderType=this.shaderType;return t}getGlslTypeString(){return s.glslTypeString(this._type)}_isValidLoc(){return this._loc!=-1}resetLoc(){this._loc=-1;this.needsUpdate=true}bindTextures(){}getLoc(){return this._loc}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}updateValueF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1f(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueF(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}updateValueI(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValue2I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue3I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue4I(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValueI(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValue2I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}setValue3I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}setValue4I(e){this.needsUpdate=true;this._value=e||vec4.create()}updateValueBool(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0);this._cgl.profileData.profileUniformCount++}setValueBool(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValueArray4F(e){this.needsUpdate=true;this._value=e}updateValueArray4F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform4fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray3F(e){this.needsUpdate=true;this._value=e}updateValueArray3F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform3fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray2F(e){this.needsUpdate=true;this._value=e}updateValueArray2F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform2fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayF(e){this.needsUpdate=true;this._value=e}updateValueArrayF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayT(e){this.needsUpdate=true;this._value=e}updateValue3F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue3F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValue2F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue2F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}updateValue4F(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value){this._log.warn("no value for uniform",this._name,this);this._value=[0,0,0,0]}this.needsUpdate=false;this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValue4F(e){if(typeof this.value=="number")this.value=vec4.create();if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2,3];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]||e[3]!=this._oldValue[3]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValueM4(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,false,this._value);this._cgl.profileData.profileUniformCount++}setValueM4(e){this.needsUpdate=true;this._value=e||mat4.create()}updateValueArrayT(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1iv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValueT(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._cgl.profileData.profileUniformCount++;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this.needsUpdate=false}setValueT(e){this.needsUpdate=true;this._value=e}}s.glslTypeString=e=>{if(e=="f")return"float";if(e=="b")return"bool";if(e=="i")return"int";if(e=="2i")return"ivec2";if(e=="2f")return"vec2";if(e=="3f")return"vec3";if(e=="4f")return"vec4";if(e=="m4")return"mat4";if(e=="t")return"sampler2D";if(e=="tc")return"samplerCube";if(e=="3f[]")return null;if(e=="m4[]")return null;if(e=="f[]")return null;console.warn("[CGL UNIFORM] unknown glsl type string ",e)}},273:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});var s=i(331);var r=i(264);const n={};n.getSimpleRect=function(e,t,i=1){const r=new s.V(t);r.vertices=[1*i,1*i,0,-1*i,1*i,0,1*i,-1*i,0,-1*i,-1*i,0];r.texCoords=[1,1,0,1,1,0,0,0];r.verticesIndices=[0,1,2,2,1,3];r.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0];return e.createMesh(r)};n.getSimpleCube=function(e,t){const i=new s.V(t);i.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];i.setTexCoords([0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0]);i.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];i.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);i.tangents=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);i.biTangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);return new r.e(e,i)}},308:(e,t,i)=>{"use strict";i.d(t,{G:()=>c});var r=i(849);var s=i(562);var n=i(997);var a=i(24);var o=i(628);var l=i(264);var h=i(70);const u={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};class c extends o.A{#cursor="auto";constructor(e){super(e);this.gApi=o.A.API_WEBGL;this.aborted=false;this.pushMvMatrix=this.pushModelMatrix;this.popMvMatrix=this.popmMatrix=this.popModelMatrix;this._log=new r.A("cgl_context",{onError:e.config.onError});this.glVersion=0;this.glUseHalfFloatTex=false;this.clearCanvasTransparent=true;this.clearCanvasDepth=true;this.debugOneFrame=false;this.checkGlErrors=false;this.maxTextureUnits=0;this.maxVaryingVectors=0;this.currentProgram=null;this._hadStackError=false;this.glSlowRendere=false;this._isSafariCrap=false;this.temporaryTexture=null;this.gl=null;this.#cursor="auto";this._currentCursor="";this._viewPortStack=[];this._glFrameBufferStack=[];this._frameBufferStack=[];this._shaderStack=[];this._stackDepthTest=[];this.mainloopOp=null;this._stackBlendMode=[];this._stackBlendModePremul=[];this._stackBlend=[];this._stackDepthFunc=[];this._stackCullFaceFacing=[];this._stackCullFace=[];this._stackDepthWrite=[];this._stackDepthTest=[];this._stackStencil=[];this._simpleShader=new a.M(this,"simpleshader");this._simpleShader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);this._simpleShader.setSource(a.M.getDefaultVertexShader(),a.M.getDefaultFragmentShader());this._currentShader=this._simpleShader;this._oldCanvasWidth=-1;this._oldCanvasHeight=-1;this._enabledExtensions={};this.errorShader=null}get viewPort(){if(this._viewPortStack.length>3){const e=this._viewPortStack.length;return[this._viewPortStack[e-4],this._viewPortStack[e-3],this._viewPortStack[e-2],this._viewPortStack[e-1]]}else{return this._viewPort}}get mvMatrix(){return this.mMatrix}set mvMatrix(e){this.mMatrix=e}_setCanvas(e){if(!e)this._log.stack("_setCanvas undef");if(!this.patch.config.canvas)this.patch.config.canvas={};if(!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer"))this.patch.config.canvas.preserveDrawingBuffer=true;if(!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha"))this.patch.config.canvas.premultipliedAlpha=false;if(!this.patch.config.canvas.hasOwnProperty("alpha"))this.patch.config.canvas.alpha=false;this.patch.config.canvas.stencil=true;if(this.patch.config.hasOwnProperty("clearCanvasColor"))this.clearCanvasTransparent=this.patch.config.clearCanvasColor;if(this.patch.config.hasOwnProperty("clearCanvasDepth"))this.clearCanvasDepth=this.patch.config.clearCanvasDepth;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this._isSafariCrap=true;this.glUseHalfFloatTex=true}if(!this.patch.config.canvas.forceWebGl1)this.gl=e.getContext("webgl2",this.patch.config.canvas);if(!this.gl||this.gl.isContextLost()){this.aborted=true;this._log.error("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");return}if(this.gl.getParameter(this.gl.VERSION)!="WebGL 1.0"){this.glVersion=2}else{this.gl=e.getContext("webgl",this.patch.config.canvas)||e.getContext("experimental-webgl",this.patch.config.canvas);this.glVersion=1;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){if(!this.patch.config.canvas.hasOwnProperty("powerPreference"))this.patch.config.canvas.powerPreference="high-performance"}this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}const t=this.enableExtension("WEBGL_debug_renderer_info");if(t){this.glRenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL);if(this.glRenderer==="Google SwiftShader")this.glSlowRenderer=true}this.canvas.addEventListener("webglcontextlost",e=>{if(this.aborted)return this._log.warn("[cgl_state] aborted context lost... can be ignored...");this._log.error("canvas lost...",e);this.emitEvent("webglcontextlost");this.aborted=true});this.maxAnisotropic=0;if(this.enableExtension("EXT_texture_filter_anisotropic"))this.maxAnisotropic=this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxSamples=0;if(this.gl.MAX_SAMPLES)this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES);if(this.glVersion==1){this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}this.DEPTH_FUNCS=[this.gl.NEVER,this.gl.ALWAYS,this.gl.LESS,this.gl.LEQUAL,this.gl.GREATER,this.gl.GEQUAL,this.gl.EQUAL,this.gl.NOTEQUAL];this.CULL_MODES=[null,this.gl.BACK,this.gl.FRONT,this.gl.FRONT_AND_BACK]}getInfo(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}}popViewPort(){this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();if(this._viewPortStack.length==0)this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);else this.setViewPort(this._viewPortStack[this._viewPort.length-4],this._viewPortStack[this._viewPort.length-3],this._viewPortStack[this._viewPort.length-2],this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,r){this._viewPortStack.push(e,t,i,r);this.setViewPort(e,t,i,r)}getViewPort(){return this._viewPort}resetViewPort(){this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}setViewPort(e,t,i,r){this._viewPort[0]=Math.round(e);this._viewPort[1]=Math.round(t);this._viewPort[2]=Math.round(i);this._viewPort[3]=Math.round(r);this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}screenShot(t,e,i,r){if(e){this.gl.clearColor(1,1,1,1);this.gl.colorMask(false,false,false,true);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.colorMask(true,true,true,true)}if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,r)}}endFrame(){if(this.patch.isEditorMode())CABLES.GL_MARKER.drawMarkerLayer(this);this.setPreviousShader();if(this._vMatrixStack.length()>0)this.logStackError("view matrix stack length !=0 at end of rendering...");if(this._mMatrixStack.length()>0)this.logStackError("mvmatrix stack length !=0 at end of rendering...");if(this._pMatrixStack.length()>0)this.logStackError("pmatrix stack length !=0 at end of rendering...");if(this._glFrameBufferStack.length>0)this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");if(this._stackDepthTest.length>0)this.logStackError("depthtest stack length !=0 at end of rendering...");if(this._stackDepthWrite.length>0)this.logStackError("depthwrite stack length !=0 at end of rendering...");if(this._stackDepthFunc.length>0)this.logStackError("depthfunc stack length !=0 at end of rendering...");if(this._stackBlend.length>0)this.logStackError("blend stack length !=0 at end of rendering...");if(this._stackBlendMode.length>0)this.logStackError("blendMode stack length !=0 at end of rendering...");if(this._shaderStack.length>0)this.logStackError("this._shaderStack length !=0 at end of rendering...");if(this._stackCullFace.length>0)this.logStackError("this._stackCullFace length !=0 at end of rendering...");if(this._stackCullFaceFacing.length>0)this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");if(this._viewPortStack.length>0)this.logStackError("viewport stack length !=0 at end of rendering...");this._frameStarted=false;if(this._oldCanvasWidth!=this.canvasWidth||this._oldCanvasHeight!=this.canvasHeight){this._oldCanvasWidth=this.canvasWidth;this._oldCanvasHeight=this.canvasHeight;this.emitEvent(o.A.EVENT_RESIZE)}if(this.#cursor!=this._currentCursor){this._currentCursor=this.canvas.style.cursor=this.#cursor}this.emitEvent("endframe");this.fpsCounter.endFrame()}logStackError(e){if(!this._hadStackError){this._hadStackError=true;this._log.warn("["+this.canvas.id+"]: ",e)}}getShader(){if(this._currentShader)if(!this.tempData||this.tempData.renderOffscreen===true==this._currentShader.offScreenPass===true)return this._currentShader;for(let e=this._shaderStack.length-1;e>=0;e--)if(this._shaderStack[e])if(this.tempData.renderOffscreen==this._shaderStack[e].offScreenPass)return this._shaderStack[e]}getDefaultShader(){return this._simpleShader}setShader(e){this.pushShader(e)}pushShader(t){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){t=this.tempData.forceShaderMods[e].bind(t,false)}}this._shaderStack.push(t);this._currentShader=t}popShader(){this.setPreviousShader()}setPreviousShader(){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){this.tempData.forceShaderMods[e].unbind(false)}}if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop();this._currentShader=this._shaderStack[this._shaderStack.length-1]}pushGlFrameBuffer(e){this._glFrameBufferStack.push(e)}popGlFrameBuffer(){if(this._glFrameBufferStack.length==0)return null;this._glFrameBufferStack.pop();return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}getCurrentGlFrameBuffer(){if(this._glFrameBufferStack.length===0)return null;return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}pushFrameBuffer(e){this._frameBufferStack.push(e)}popFrameBuffer(){if(this._frameBufferStack.length==0)return null;this._frameBufferStack.pop();return this._frameBufferStack[this._frameBufferStack.length-1]}getCurrentFrameBuffer(){if(this._frameBufferStack.length===0)return null;return this._frameBufferStack[this._frameBufferStack.length-1]}renderStart(e,t,i){this.fpsCounter.startFrame();this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc(e.gl.LEQUAL);this.pushCullFaceFacing(e.gl.BACK);this.pushCullFace(false);e.setViewPort(0,0,e.canvasWidth,e.canvasHeight);this._startMatrixStacks(t,i);e.pushBlendMode(n.a.BLEND_MODES.BLEND_NORMAL,false);for(let e=0;e<this._textureslots.length;e++)this._textureslots[e]=null;this.pushShader(this._simpleShader);this._frameStarted=true;this._execOneTimeCallbacks();for(let e=0;e<this._textureslots.length;e++){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this._textureslots[e]=null}this.emitEvent("beginFrame")}renderEnd(e){this._endMatrixStacks();this.popDepthTest();this.popDepthWrite();this.popDepthFunc();this.popCullFaceFacing();this.popCullFace();this.popBlend();this.popBlendMode();e.endFrame();this.emitEvent("endFrame")}getTexture(e){return this._textureslots[e]}hasFrameStarted(){return this._frameStarted}checkFrameStarted(e){if(!this._frameStarted){this._log.warn("frame not started "+e);Error.stackTraceLimit=25;s.logStack();this.patch.printTriggerStack()}}setTexture(e,t,i){this.checkFrameStarted("cgl setTexture");if(t===null)t=h.g.getEmptyTexture(this).tex;if(this._textureslots[e]!=t){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(i||this.gl.TEXTURE_2D,t);this._textureslots[e]=t}return true}fullScreen(){if(this.canvas.requestFullscreen)this.canvas.requestFullscreen();else if(this.canvas.mozRequestFullScreen)this.canvas.mozRequestFullScreen();else if(this.canvas.webkitRequestFullscreen)this.canvas.webkitRequestFullscreen();else if(this.canvas.msRequestFullscreen)this.canvas.msRequestFullscreen()}printError(t){if(!this.checkGlErrors)return;let i=false;let r=this.gl.getError();if(r!=this.gl.NO_ERROR){let e="";if(r==this.gl.OUT_OF_MEMORY)e="OUT_OF_MEMORY";if(r==this.gl.INVALID_ENUM)e="INVALID_ENUM";if(r==this.gl.INVALID_OPERATION)e="INVALID_OPERATION";if(r==this.gl.INVALID_FRAMEBUFFER_OPERATION)e="INVALID_FRAMEBUFFER_OPERATION";if(r==this.gl.INVALID_VALUE)e="INVALID_VALUE";if(r==this.gl.CONTEXT_LOST_WEBGL){this.aborted=true;e="CONTEXT_LOST_WEBGL"}if(r==this.gl.NO_ERROR)e="NO_ERROR";i=true;this._log.warn("gl error ["+this.canvas.id+"]: ",t,r,e);if(this.canvas.id.includes("glGuiCanvas"))if(!this._loggedGlError){this.patch.printTriggerStack();this._log.stack("glerror");this._loggedGlError=true}}r=this.gl.getError();return i}_dispose(){this._simpleShader.dispose();this.gl=null}pushDepthTest(e){this._stackDepthTest.push(e);if(!e)this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop();if(!this._stackDepthTest[this._stackDepthTest.length-1])this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e);this.gl.depthMask(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop();this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||false)}pushCullFace(e){this._stackCullFace.push(e);if(e)this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}stateCullFace(){return this._stackCullFace[this._stackCullFace.length-1]}popCullFace(){this._stackCullFace.pop();if(this._stackCullFace[this._stackCullFace.length-1])this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e);this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop();if(this._stackCullFaceFacing.length>0)this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}pushDepthFunc(e){this._stackDepthFunc.push(e);this.gl.depthFunc(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return false}popDepthFunc(){this._stackDepthFunc.pop();if(this._stackDepthFunc.length>0)this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])}pushBlend(e){this._stackBlend.push(e);if(!e)this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}popBlend(){this._stackBlend.pop();if(!this._stackBlend[this._stackBlend.length-1])this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}pushBlendMode(e,t){this._stackBlendMode.push(e);this._stackBlendModePremul.push(t);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==n.a.BLEND_MODES.BLEND_NONE);this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])}popBlendMode(){this._stackBlendMode.pop();this._stackBlendModePremul.pop();const e=this._stackBlendMode.length-1;this.popBlend();if(e>=0)this._setBlendMode(this._stackBlendMode[e],this._stackBlendModePremul[e])}pushStencil(e){this._stackStencil.push(e);if(!e)this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}popStencil(){this._stackStencil.pop();if(!this._stackStencil[this._stackStencil.length-1])this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}glGetAttribLocation(e,t){const i=this.gl.getAttribLocation(e,t);return i}shouldDrawHelpers(e){if(this.tempData.shadowPass)return false;if(!e.patch.isEditorMode())return false;return gui.shouldDrawOverlay}_setBlendMode(e,t){const i=this.gl;if(e==n.a.BLEND_MODES.BLEND_NONE){}else if(e==n.a.BLEND_MODES.BLEND_ADD){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.SRC_ALPHA,i.ONE)}}else if(e==n.a.BLEND_MODES.BLEND_SUB){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)}}else if(e==n.a.BLEND_MODES.BLEND_MUL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.SRC_COLOR)}}else if(e==n.a.BLEND_MODES.BLEND_NORMAL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}}else{this._log.log("setblendmode: unknown blendmode")}}createMesh(e,t){if(s.isNumeric(t))t={glPrimitive:t};return new l.e(this,e,t)}setCursor(e){this.#cursor=e}enableExtension(e){if(!this.gl)return null;if(this._enabledExtensions.hasOwnProperty(e))return this._enabledExtensions[e];const t=this.gl.getExtension(e);this._enabledExtensions[e]=t;if(!t)this._log.warn("[cgl_state] extension not available "+e);return t}getErrorShader(){if(this.errorShader)return this.errorShader;this.errorShader=new a.M(this,"errormaterial");this.errorShader.setSource(a.M.getDefaultVertexShader(),a.M.getErrorFragmentShader());return this.errorShader}}},70:(e,t,i)=>{"use strict";i.d(t,{g:()=>u});var r=i(849);var h=i(562);var s=i(356);const n=8;const a=new r.A("cgl_texture");class u extends s.U{constructor(e,t={}){super(t);if(!e)throw new Error("no cgl");this._cgl=e;this._log=new r.A("tex");this.tex=this._cgl.gl.createTexture();this.loading=false;this.flip=true;this.flipped=false;this.shadowMap=false;this.deleted=false;this.image=null;this.anisotropic=0;this.filter=u.FILTER_NEAREST;this.wrap=u.WRAP_CLAMP_TO_EDGE;this.texTarget=this._cgl.gl.TEXTURE_2D;if(t&&t.type)this.texTarget=t.type;this.textureType=u.TYPE_DEFAULT;this.unpackAlpha=true;this._fromData=true;this._glDataType=-1;this._glInternalFormat=-1;this._glDataFormat=-1;if(t){if(t.isDepthTexture)this.textureType=u.TYPE_DEPTH;if(t.isFloatingPointTexture===true)this.textureType=u.TYPE_FLOAT;if("textureType"in t)this.textureType=t.textureType;if("filter"in t)this.filter=t.filter;if("wrap"in t)this.wrap=t.wrap;if("unpackAlpha"in t)this.unpackAlpha=t.unpackAlpha;if("flip"in t)this.flip=t.flip;if("shadowMap"in t)this.shadowMap=t.shadowMap;if("anisotropic"in t)this.anisotropic=t.anisotropic}else{t={}}if(!t.pixelFormat&&t.isFloatingPointTexture)this.pixelFormat=u.PFORMATSTR_RGBA32F;if(this.textureType==u.TYPE_DEPTH)this.pixelFormat=u.PFORMATSTR_DEPTH;this._cgl.profileData.profileTextureNew++;this.setFormat(u.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height);this.setSize(t.width,t.height);this.getInfoOneLine()}isFloatingPoint(){return u.isPixelFormatFloat(this.pixelFormat)}compareSettings(e){if(!e)return false;return e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip}clone(){const e=new u(this._cgl,{name:this.name,filter:this.filter,anisotropic:this.anisotropic,wrap:this.wrap,textureType:this.textureType,pixelFormat:this.pixelFormat,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height);if(!this.compareSettings(e)){this._log.error("Cloned texture settings do not compare!");this._log.error(this);this._log.error(e)}return e}setFormat(e){this.pixelFormat=e.pixelFormat;this._glDataFormat=e.glDataFormat;this._glInternalFormat=e.glInternalFormat;this._glDataType=e.glDataType}setSize(e,t){if(this._cgl.aborted)return;if(e!=e||e<=0||!e)e=n;if(t!=t||t<=0||!t)t=n;if(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)this._log.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize);e=Math.min(e,this._cgl.maxTexSize);t=Math.min(t,this._cgl.maxTexSize);e=Math.floor(e);t=Math.floor(t);if(this.width==e&&this.height==t)return;e=this._cgl.checkTextureSize(e);t=this._cgl.checkTextureSize(t);this.width=e;this.height=t;this.deleted=false;this.setFormat(u.setUpGlPixelFormat(this._cgl,this.pixelFormat));this.shortInfoString=this.getInfoOneLine();this._cgl.gl.bindTexture(this.texTarget,this.tex);this._cgl.profileData.profileTextureResize++;const i=null;this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,e,t,0,this._glDataFormat,this._glDataType,i);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null)}initFromData(e,t,i,r,s){this.filter=r;this.wrap=s;if(r==undefined)this.filter=u.FILTER_LINEAR;if(s==undefined)this.wrap=u.WRAP_CLAMP_TO_EDGE;this.width=t;this.height=i;this._fromData=true;this.deleted=false;if(this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const n=CGL.Texture.getTempTexture(this._cgl);this.width=n.width;this.height=n.height;this.tex=n.tex;this._log.warn("[cgl_texture] texture size too big!",this.width,this.height,this._cgl.maxTexSize);return}if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip);this._cgl.gl.bindTexture(this.texTarget,this.tex);this.setFormat(u.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,t,i,0,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this._cgl.gl.bindTexture(this.texTarget,null)}updateMipMap(){if((this._cgl.glVersion==2||this.isPowerOfTwo())&&this.filter==u.FILTER_MIPMAP){this._cgl.gl.generateMipmap(this.texTarget);this._cgl.profileData.profileGenMipMap++}}initTexture(e,t=null){this._cgl.printError("before initTexture");this._cgl.checkFrameStarted("texture inittexture");this._fromData=false;this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha);if(e.width||e.videoWidth)this.width=e.videoWidth||e.width;if(e.height||e.videoHeight)this.height=e.videoHeight||e.height;if(t!==null)this.filter=t;if(e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const i=CGL.Texture.getTempTexture(this._cgl);this.width=i.width;this.height=i.height;this.tex=i.tex;this._log.warn("[cgl_texture] texture size too big!",e.width,e.height,this._cgl.maxTexSize);return}this._cgl.gl.bindTexture(this.texTarget,this.tex);this.deleted=false;this.flipped=!this.flip;if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped);this.setFormat(u.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null);this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this.getInfoOneLine();this._cgl.printError("initTexture")}dispose(){this.delete()}delete(){if(this.loading){return}this.deleted=true;this.width=0;this.height=0;this._cgl.profileData.profileTextureDelete++;this._cgl.gl.deleteTexture(this.tex);this.image=null;this.tex=null}isPowerOfTwo(){return u.isPowerOfTwo(this.width)&&u.isPowerOfTwo(this.height)}printInfo(){a.log(this.getInfo())}getInfoReadable(){const t=this.getInfo();let i="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t){i+="* "+e+":  **"+t[e]+"**\n"}return i}getInfoOneLine(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;if(this.filter===u.FILTER_NEAREST)e+=" nearest";if(this.filter===u.FILTER_LINEAR)e+=" linear";if(this.filter===u.FILTER_MIPMAP)e+=" mipmap";if(this.wrap===u.WRAP_CLAMP_TO_EDGE)e+=" clamp";if(this.wrap===u.WRAP_REPEAT)e+=" repeat";if(this.wrap===u.WRAP_MIRRORED_REPEAT)e+=" repeatmir";this.shortInfoString=e;return e}getInfoOneLineShort(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;this.shortInfoString=e;return e}getInfo(){return u.getTexInfo(this)}_setFilter(){this._cgl.printError("before _setFilter");if(!this._fromData){this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha)}if(this.shadowMap){this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE);this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)}if(this.textureType==u.TYPE_FLOAT&&this.filter==u.FILTER_MIPMAP){this.filter=u.FILTER_LINEAR;this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")}if(this._cgl.glVersion==1&&!this.isPowerOfTwo()){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);this.filter=u.FILTER_NEAREST;this.wrap=u.WRAP_CLAMP_TO_EDGE}else{if(this.wrap==u.WRAP_CLAMP_TO_EDGE){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)}else if(this.wrap==u.WRAP_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)}else if(this.wrap==u.WRAP_MIRRORED_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==u.FILTER_NEAREST){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST)}else if(this.filter==u.FILTER_LINEAR){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR)}else if(this.filter==u.FILTER_MIPMAP){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}else{this._log.log("unknown texture filter!",this.filter);throw new Error("unknown texture filter!"+this.filter)}if(this.anisotropic){const e=this._cgl.enableExtension("EXT_texture_filter_anisotropic");if(this._cgl.maxAnisotropic){const t=Math.min(this._cgl.maxAnisotropic,this.anisotropic);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}}this.getInfoOneLine();this._cgl.printError("_setFilter")}}u.load=function(i,r,s,e){if(!r)return s({error:true});let n=null;if(!i.patch.loading.existByName(r))n=i.patch.loading.start("cgl.texture",r);const a=new u(i);a.name=r;a.image=new Image;a.image.crossOrigin="anonymous";a.loading=true;if(e&&e.hasOwnProperty("filter"))a.filter=e.filter;if(e&&e.hasOwnProperty("flip"))a.flip=e.flip;if(e&&e.hasOwnProperty("wrap"))a.wrap=e.wrap;if(e&&e.hasOwnProperty("anisotropic"))a.anisotropic=e.anisotropic;if(e&&e.hasOwnProperty("unpackAlpha"))a.unpackAlpha=e.unpackAlpha;if(e&&e.hasOwnProperty("pixelFormat"))a.pixelFormat=e.pixelFormat;a.image.onabort=a.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",r,e);a.loading=false;if(n)i.patch.loading.finished(n);const t={error:true};if(s)s(t,a)};a.image.onload=function(e){i.addNextFrameOnceCallback(()=>{a.initTexture(a.image);if(n)i.patch.loading.finished(n);a.loading=false;if(s)s(null,a)})};a.image.src=r;return a};u.getTempTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.tempTexture)e.tempTexture=u.getTemporaryTexture(e,256,u.FILTER_LINEAR,u.REPEAT);return e.tempTexture};u.getErrorTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.errorTexture)e.errorTexture=u.getTemporaryTexture(e,256,u.FILTER_LINEAR,u.REPEAT,1,.2,.2);return e.errorTexture};u.getEmptyTexture=function(e,t){if(t)return u.getEmptyTextureFloat(e);if(!e)console.error("[getEmptyTexture] no cgl!");if(e.tempTextureEmpty)return e.tempTextureEmpty;let i=8;e.tempTextureEmpty=new u(e,{name:"emptyTexture"});const r=u.getDefaultTextureData("empty",i);e.tempTextureEmpty.initFromData(r,i,i,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.tempTextureEmpty};u.getEmptyTextureFloat=function(e){if(!e)console.error("[getEmptyTextureFloat] no cgl!");if(e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new u(e,{name:"emptyTexture",isFloatingPointTexture:true});const t=new Float32Array(8*8*4).fill(1);for(let e=0;e<8*8*4;e+=4)t[e+3]=0;e.tempTextureEmptyFloat.initFromData(t,8,8,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.tempTextureEmptyFloat};u.getRandomTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.randomTexture)return e.randomTexture;const t=256;const i=u.getDefaultTextureData("randomUInt",t);e.randomTexture=new u(e);e.randomTexture.initFromData(i,t,t,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.randomTexture};u.getRandomFloatTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.getRandomFloatTexture)return e.getRandomFloatTexture;const t=256;const i=u.getDefaultTextureData("randomFloat",t);e.getRandomFloatTexture=new u(e,{isFloatingPointTexture:true});e.getRandomFloatTexture.initFromData(i,t,t,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.getRandomFloatTexture};u.getBlackTexture=function(e){if(e.blackTexture)return e.blackTexture;const t=8;const i=u.getDefaultTextureData("color",t,{r:0,g:0,b:0});e.blackTexture=new u(e);e.blackTexture.initFromData(i,t,t,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.blackTexture};u.getEmptyCubemapTexture=function(t){const i=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];const e=t.gl.createTexture();const r=t.gl.TEXTURE_CUBE_MAP;const s=u.FILTER_NEAREST;const n=u.WRAP_CLAMP_TO_EDGE;const a=8;const o=8;t.profileData.profileTextureNew++;t.gl.bindTexture(r,e);t.profileData.profileTextureResize++;for(let e=0;e<6;e+=1){const l=new Uint8Array(8*8*4);t.gl.texImage2D(i[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l);t.gl.texParameteri(r,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST);t.gl.texParameteri(r,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST);t.gl.texParameteri(r,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE);t.gl.texParameteri(r,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}t.gl.bindTexture(r,null);return{id:h.uuid(),tex:e,cubemap:e,width:a,height:o,filter:s,wrap:n,unpackAlpha:true,flip:true,_fromData:true,name:"emptyCubemapTexture",anisotropic:0}};u.getTempGradientTexture=function(e){if(!e)console.error("[getTempGradientTexture] no cgl!");return u.getTempTexture(e)};u.getTemporaryTexture=function(e,t,i,r,s,n,a){const o=u.getDefaultTextureData("stripes",256,{r:s,g:n,b:a});const l=new u(e);l.initFromData(o,t,t,i,r);return l};u.createFromImage=function(e,t,i){i=i||{};const r=new u(e,i);r.flip=false;r.image=t;r.width=t.videoWidth||t.width||8;r.height=t.videoHeight||t.height||8;if(i.hasOwnProperty("wrap"))r.wrap=i.wrap;r.initTexture(t,i.filter);return r};u.fromImage=function(e,t,i,r){console.error("deprecated texture from image...");const s=new u(e);s.flip=false;if(i)s.filter=i;if(r)s.wrap=r;s.image=t;s.initTexture(t);return s};u.isPowerOfTwo=function(e){return e==1||e==2||e==4||e==8||e==16||e==32||e==64||e==128||e==256||e==512||e==1024||e==2048||e==4096||e==8192||e==16384};u.getTexInfo=function(e){const t={};t.name=e.name;t["power of two"]=e.isPowerOfTwo();t.size=e.width+" x "+e.height;let i=e.texTarget;if(e.texTarget==e._cgl.gl.TEXTURE_2D)i="TEXTURE_2D";t.target=i;t.unpackAlpha=e.unpackAlpha;if(e.cubemap)t.cubemap=true;if(e.textureType==u.TYPE_FLOAT)t.textureType="TYPE_FLOAT";if(e.textureType==u.TYPE_HALF_FLOAT)t.textureType="TYPE_HALF_FLOAT";else if(e.textureType==u.TYPE_DEPTH)t.textureType="TYPE_DEPTH";else if(e.textureType==u.TYPE_DEFAULT)t.textureType="TYPE_DEFAULT";else t.textureType="UNKNOWN "+this.textureType;if(e.wrap==u.WRAP_CLAMP_TO_EDGE)t.wrap="CLAMP_TO_EDGE";else if(e.wrap==u.WRAP_REPEAT)t.wrap="WRAP_REPEAT";else if(e.wrap==u.WRAP_MIRRORED_REPEAT)t.wrap="WRAP_MIRRORED_REPEAT";else t.wrap="UNKNOWN";if(e.filter==u.FILTER_NEAREST)t.filter="FILTER_NEAREST";else if(e.filter==u.FILTER_LINEAR)t.filter="FILTER_LINEAR";else if(e.filter==u.FILTER_MIPMAP)t.filter="FILTER_MIPMAP";else t.filter="UNKNOWN";t.pixelFormat=e.pixelFormat||"unknown";return t};u.setUpGlPixelFormat=function(e,t){const i={};if(!t){e._log.error("no pixelformatstr!");e._log.log(new Error);t=u.PFORMATSTR_RGBA8UB}i.pixelFormatBase=t;i.pixelFormat=t;i.glDataType=e.gl.UNSIGNED_BYTE;i.glInternalFormat=e.gl.RGBA8;i.glDataFormat=e.gl.RGBA;let r=e.gl.FLOAT;if(e.glUseHalfFloatTex){if(t==u.PFORMATSTR_RGBA32F)t=u.PFORMATSTR_RGBA16F;if(t==u.PFORMATSTR_RG32F)t=u.PFORMATSTR_RG16F;if(t==u.PFORMATSTR_R32F)t=u.PFORMATSTR_R16F}if(t.includes("16bit")){if(e.glVersion==2){const s=e.enableExtension("EXT_color_buffer_half_float");if(!s){console.warn("no 16bit extension, fallback to 32bit",t);if(t==u.PFORMATSTR_RGBA16F)t=u.PFORMATSTR_RGBA32F;if(t==u.PFORMATSTR_RGB16F)t=u.PFORMATSTR_RGB32F;if(t==u.PFORMATSTR_RG16F)t=u.PFORMATSTR_RG32F;if(t==u.PFORMATSTR_R16F)t=u.PFORMATSTR_R32F}else{r=e.gl.HALF_FLOAT}}}if(e.glVersion==1){i.glInternalFormat=e.gl.RGBA;if(t==u.PFORMATSTR_RGBA16F||t==u.PFORMATSTR_RG16F||t==u.PFORMATSTR_R16F){const n=e.enableExtension("OES_texture_half_float");if(!n)throw new Error("no half float texture extension");r=n.HALF_FLOAT_OES}}if(t==u.PFORMATSTR_RGBA8UB){}else if(t==u.PFORMATSTR_RGB565){i.glInternalFormat=e.gl.RGB565;i.glDataFormat=e.gl.RGB}else if(t==u.PFORMATSTR_R8UB){i.glInternalFormat=e.gl.R8;i.glDataFormat=e.gl.RED}else if(t==u.PFORMATSTR_RG8UB){i.glInternalFormat=e.gl.RG8;i.glDataFormat=e.gl.RG}else if(t==u.PFORMATSTR_RGB8UB){i.glInternalFormat=e.gl.RGB8;i.glDataFormat=e.gl.RGB}else if(t==u.PFORMATSTR_SRGBA8){i.glInternalFormat=e.gl.SRGB8_ALPHA8}else if(t==u.PFORMATSTR_R32F){i.glInternalFormat=e.gl.R32F;i.glDataFormat=e.gl.RED;i.glDataType=r}else if(t==u.PFORMATSTR_R16F){i.glInternalFormat=e.gl.R16F;i.glDataType=r;i.glDataFormat=e.gl.RED}else if(t==u.PFORMATSTR_RG16F){i.glInternalFormat=e.gl.RG16F;i.glDataType=r;i.glDataFormat=e.gl.RG}else if(t==u.PFORMATSTR_RGBA16F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA16F;i.glDataType=r}else if(t==u.PFORMATSTR_R11FG11FB10F){i.glInternalFormat=e.gl.R11F_G11F_B10F;i.glDataType=r;i.glDataFormat=e.gl.RGB}else if(t==u.PFORMATSTR_RGBA32F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA32F;i.glDataType=r}else if(t==u.PFORMATSTR_DEPTH){if(e.glVersion==1){i.glInternalFormat=e.gl.DEPTH_COMPONENT;i.glDataType=e.gl.UNSIGNED_SHORT;i.glDataFormat=e.gl.DEPTH_COMPONENT}else{i.glInternalFormat=e.gl.DEPTH_COMPONENT32F;i.glDataType=e.gl.FLOAT;i.glDataFormat=e.gl.DEPTH_COMPONENT}}else{a.log("unknown pixelformat ",t)}if(t.includes("32bit")||t==u.PFORMATSTR_R11FG11FB10F){if(e.glVersion==2)e.enableExtension("EXT_color_buffer_float");if(e.glVersion==2)e.enableExtension("EXT_float_blend");e.enableExtension("OES_texture_float_linear")}i.numColorChannels=u.getPixelFormatNumChannels(t);if(!i.glDataType||!i.glInternalFormat||!i.glDataFormat)a.log("pixelformat wrong ?!",t,i.glDataType,i.glInternalFormat,i.glDataFormat,this);return i};u.getPixelFormatNumChannels=e=>{if(e.startsWith("RGBA"))return 4;if(e.startsWith("RGB"))return 3;if(e.startsWith("RG"))return 2;return 1};u.isPixelFormatFloat=e=>{return(e||"").includes("float")};u.isPixelFormatHalfFloat=e=>{return(e||"").includes("float")&&(e||"").includes("16bit")}},771:(e,t,i)=>{"use strict";i.d(t,{p:()=>o});var r=i(849);var s=i(70);var n=i(273);class o{constructor(e,t){this._cgl=e;this._log=new r.A("cgl_TextureEffect");if(!e.TextureEffectMesh)this.createMesh();this._textureSource=null;this._options=t;this.name=t.name||"unknown";this.imgCompVer=0;this.aspectRatio=1;this._textureTarget=null;this._frameBuf=this._cgl.gl.createFramebuffer();this._frameBuf2=this._cgl.gl.createFramebuffer();this._renderbuffer=this._cgl.gl.createRenderbuffer();this._renderbuffer2=this._cgl.gl.createRenderbuffer();this.switched=false;this.depth=false}dispose(){if(this._renderbuffer)this._cgl.gl.deleteRenderbuffer(this._renderbuffer);if(this._frameBuf)this._cgl.gl.deleteFramebuffer(this._frameBuf);if(this._renderbuffer2)this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);if(this._frameBuf2)this._cgl.gl.deleteFramebuffer(this._frameBuf2)}getWidth(){return this._textureSource.width}getHeight(){return this._textureSource.height}setSourceTexture(e){if(e===null){this._textureSource=new s.g(this._cgl);this._textureSource.setSize(16,16)}else{this._textureSource=e}if(!this._textureSource.compareSettings(this._textureTarget)){if(this._textureTarget)this._textureTarget.delete();this._textureTarget=this._textureSource.clone();this._cgl.profileData.profileEffectBuffercreate++;this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}this.aspectRatio=this._textureSource.width/this._textureSource.height}continueEffect(){this._cgl.pushDepthTest(false);this._cgl.pushModelMatrix();this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height);mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100);this._cgl.pushPMatrix();mat4.identity(this._cgl.pMatrix);this._cgl.pushViewMatrix();mat4.identity(this._cgl.vMatrix);this._cgl.pushModelMatrix();mat4.identity(this._cgl.mMatrix)}startEffect(e){if(!this._textureTarget){this._log.warn("effect has no target");return}this.switched=false;this.continueEffect();if(e){this._bgTex=e}this._countEffects=0}endEffect(){this._cgl.popDepthTest();this._cgl.popModelMatrix();this._cgl.popPMatrix();this._cgl.popModelMatrix();this._cgl.popViewMatrix();this._cgl.popPMatrix();this._cgl.popViewPort()}bind(){if(this._textureSource===null){this._log.warn("no base texture set!");return}if(!this.switched){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.pushGlFrameBuffer(this._frameBuf)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.pushGlFrameBuffer(this._frameBuf2)}}finish(){if(this._textureSource===null){this._log.warn("no base texture set!");return}this._cgl.TextureEffectMesh.render(this._cgl.getShader());this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.profileData.profileTextureEffect++;if(this._textureTarget.filter==s.g.FILTER_MIPMAP){if(!this.switched){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex);this._textureTarget.updateMipMap()}else{this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex);this._textureSource.updateMipMap()}this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}this.switched=!this.switched;this._countEffects++}getCurrentTargetTexture(){if(this.switched)return this._textureSource;return this._textureTarget}getCurrentSourceTexture(){if(this._countEffects==0&&this._bgTex)return this._bgTex;if(this.switched)return this._textureTarget;return this._textureSource}delete(){if(this._textureTarget)this._textureTarget.delete();if(this._textureSource)this._textureSource.delete();this._cgl.gl.deleteRenderbuffer(this._renderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuf)}createMesh(){this._cgl.TextureEffectMesh=n.S.getSimpleRect(this._cgl,"texEffectRect")}}o.checkOpNotInTextureEffect=function(e){if(!e.patch.cgl)return true;if(e.uiAttribs.error&&!e.patch.cgl.currentTextureEffect){e.setUiError("textureeffect",null);return true}if(!e.patch.cgl.currentTextureEffect)return true;if(e.patch.cgl.currentTextureEffect&&!e.uiAttribs.error){e.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0);return false}if(e.patch.cgl.currentTextureEffect)return false;return true};o.checkOpInEffect=function(e,t){t=t||0;if(e.patch.cgl.currentTextureEffect){if(e.uiAttribs.uierrors&&e.patch.cgl.currentTextureEffect.imgCompVer>=t){e.setUiError("texeffect",null);return true}if(t&&e.patch.cgl.currentTextureEffect.imgCompVer<t){e.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+t+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+e.id+"','"+e.name+"')\">Downgrade</span> to previous version",1)}}if(e.patch.cgl.currentTextureEffect)return true;if(!e.patch.cgl.currentTextureEffect&&(!e.uiAttribs.uierrors||e.uiAttribs.uierrors.length==0)){e.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://cables.gl/docs/image_composition/image_composition.html" target="_blank">here</a>. ',1);return false}if(!e.patch.cgl.currentTextureEffect)return false;return true};o.getBlendCode=function(e){let t="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();if(!e)t+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl();if(e>=3)t+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"#ifdef BM_MATH_ADD".endl()+"   return vec4(base.rgb+col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_SUB".endl()+"   return vec4(base.rgb-col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_MUL".endl()+"   return vec4(base.rgb*col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_DIV".endl()+"   return vec4(base.rgb/col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifndef BM_MATH".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"#endif".endl()+"}".endl();return t};o.onChangeBlendSelect=function(e,t,i=false){t=String(t);e.toggleDefine("BM_NORMAL",t=="normal");e.toggleDefine("BM_MULTIPLY",t=="multiply");e.toggleDefine("BM_MULTIPLY_INV",t=="multiply invert");e.toggleDefine("BM_AVERAGE",t=="average");e.toggleDefine("BM_ADD",t=="add");e.toggleDefine("BM_SUBTRACT_ONE",t=="subtract one");e.toggleDefine("BM_SUBTRACT",t=="subtract");e.toggleDefine("BM_DIFFERENCE",t=="difference");e.toggleDefine("BM_NEGATION",t=="negation");e.toggleDefine("BM_EXCLUSION",t=="exclusion");e.toggleDefine("BM_LIGHTEN",t=="lighten");e.toggleDefine("BM_DARKEN",t=="darken");e.toggleDefine("BM_OVERLAY",t=="overlay");e.toggleDefine("BM_SCREEN",t=="screen");e.toggleDefine("BM_SOFTLIGHT",t=="softlight");e.toggleDefine("BM_HARDLIGHT",t=="hardlight");e.toggleDefine("BM_COLORDODGE",t=="color dodge");e.toggleDefine("BM_COLORBURN",t=="color burn");e.toggleDefine("BM_MATH_ADD",t=="Math Add");e.toggleDefine("BM_MATH_SUB",t=="Math Subtract");e.toggleDefine("BM_MATH_MUL",t=="Math Multiply");e.toggleDefine("BM_MATH_DIV",t=="Math Divide");e.toggleDefine("BM_MATH",t.indexOf("Math ")==0);e.toggleDefine("BM_ALPHAMASKED",i)};o.AddBlendSelect=function(e,t,i){const r=e.inValueSelect(t||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one","Math Add","Math Subtract","Math Multiply","Math Divide"],i||"normal");return r};o.AddBlendAlphaMask=function(e,t,i){const r=e.inSwitch(t||"Alpha Mask",["Off","On"],i||"Off");return r};o.setupBlending=function(i,r,s,e,n){const t=()=>{let e=false;if(n)e=n.get()=="On";o.onChangeBlendSelect(r,s.get(),e);let t=s.get();if(t=="normal")t=null;else if(t=="multiply")t="mul";else if(t=="multiply invert")t="mulinv";else if(t=="lighten")t="light";else if(t=="darken")t="darken";else if(t=="average")t="avg";else if(t=="subtract one")t="sub one";else if(t=="subtract")t="sub";else if(t=="difference")t="diff";else if(t=="negation")t="neg";else if(t=="exclusion")t="exc";else if(t=="overlay")t="ovl";else if(t=="color dodge")t="dodge";else if(t=="color burn")t="burn";else if(t=="softlight")t="soft";else if(t=="hardlight")t="hard";else if(t=="Math Add")t="+";else if(t=="Math Subtract")t="-";else if(t=="Math Multiply")t="*";else if(t=="Math Divide")t="/";i.setUiAttrib({extendTitle:t})};i.setPortGroup("Blending",[s,e,n]);let a=false;s.onChange=t;if(n){n.onChange=t;a=n.get()=="On"}o.onChangeBlendSelect(r,s.get(),a)}},997:(e,t,i)=>{"use strict";i.d(t,{a:()=>o,nl:()=>l});const r={SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_INSTANCE_INDEX:"instanceIndex",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_INVPROJMAT:"invProjMatrix",SHADERVAR_UNI_MATERIALID:"materialId",SHADERVAR_UNI_OBJECTID:"objectId",SHADERVAR_UNI_VIEWPOS:"camPos"};const s={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};const n=180/Math.PI;const a=Math.PI/180;const o={MATH:{DEG2RAD:a,RAD2DEG:n},SHADER:r,BLEND_MODES:s};const l="\n"},772:(e,t,i)=>{"use strict";i.d(t,{Rq:()=>M});var c=i(344);var a=i(849);var l=i(70);class r{constructor(t,e,i,r){this._log=new a.A("cgl_framebuffer2");if(t.glVersion==1)this._log.error("framebuffer2 used on webgl1");this.Framebuffer2DrawTargetsDefault=null;this.Framebuffer2BlittingFramebuffer=null;this.Framebuffer2FinalFramebuffer=null;this._cgl=t;this._cgl.printError("before framebuffer2 constructor");this._width=0;this._height=0;this.valid=true;this._depthRenderbuffer=null;this._frameBuffer=null;this._textureFrameBuffer=null;this._colorRenderbuffers=[];this._drawTargetArray=[];this._disposed=false;if(!this.Framebuffer2BlittingFramebuffer)this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2FinalFramebuffer)this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2DrawTargetsDefault)this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0];this._options=r||{isFloatingPointTexture:false};this.name=this._options.name||"unknown";this._cgl.profileData.addHeavyEvent("framebuffer create",this.name);if(!this._options.hasOwnProperty("numRenderBuffers"))this._options.numRenderBuffers=1;if(!this._options.hasOwnProperty("depth"))this._options.depth=true;if(!this._options.hasOwnProperty("clear"))this._options.clear=true;if(!this._options.hasOwnProperty("multisampling")){this._options.multisampling=false;this._options.multisamplingSamples=0}if(this._options.multisamplingSamples){if(this._cgl.glSlowRenderer)this._options.multisamplingSamples=0;if(!this._cgl.gl.MAX_SAMPLES)this._options.multisamplingSamples=0;else this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples)}if(!this._options.hasOwnProperty("filter"))this._options.filter=l.g.FILTER_LINEAR;if(!this._options.hasOwnProperty("wrap"))this._options.wrap=l.g.WRAP_REPEAT;this._numRenderBuffers=this._options.numRenderBuffers;this._colorTextures=[];this.clearColors=[];for(let e=0;e<this._numRenderBuffers;e++)this.clearColors.push([0,0,0,1]);if(!r.pixelFormat){if(r.isFloatingPointTexture)this._options.pixelFormat=l.g.PFORMATSTR_RGBA32F;else this._options.pixelFormat=l.g.PFORMATSTR_RGBA8UB}for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e]=new l.g(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,anisotropic:this._options.anisotropic||0,pixelFormat:this._options.pixelFormat,filter:this._options.filter,wrap:this._options.wrap})}let s=l.g.FILTER_NEAREST;if(this._options.shadowMap)s=l.g.FILTER_LINEAR;const n=512;if(this._options.depth){this._textureDepth=new l.g(t,{name:"fb2 depth "+this.name,isDepthTexture:true,filter:s,shadowMap:this._options.shadowMap||false,width:e||n,height:i||n})}if(t.aborted)return;this.setSize(e||n,i||n);this._cgl.printError("framebuffer2 constructor")}getWidth(){return this._width}getHeight(){return this._height}getGlFrameBuffer(){return this._frameBuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this._colorTextures[0]}getTextureColorNum(e){return this._colorTextures[e]}getTextureDepth(){return this._textureDepth}setFilter(t){for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e].filter=t;this._colorTextures[e].setSize(this._width,this._height)}}delete(){this.dispose()}dispose(){this._disposed=true;let e=0;for(e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].delete();if(this._textureDepth)this._textureDepth.delete();for(e=0;e<this._numRenderBuffers;e++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[e]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}setSize(e,t){if(this._disposed)return this._log.warn("disposed framebuffer setsize...");this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;this._width=this._cgl.checkTextureSize(e);this._height=this._cgl.checkTextureSize(t);this._cgl.profileData.profileFrameBuffercreate++;if(this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer();this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const r=this._options.depth;for(i=0;i<this._numRenderBuffers;i++){this._colorTextures[i].setSize(this._width,this._height)}for(i=0;i<this._numRenderBuffers;i++){const a=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,a);const o=l.g.setUpGlPixelFormat(this._cgl,this._options.pixelFormat);let e=o.glInternalFormat;if(CGL.Texture.isPixelFormatHalfFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._options.filter=l.g.FILTER_NEAREST;this.setFilter(this._options.filter)}}else if(CGL.Texture.isPixelFormatFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._log.warn("no linear pixelformat,using nearest");this._options.filter=l.g.FILTER_NEAREST;this.setFilter(this._options.filter)}}if(this._options.multisampling&&this._options.multisamplingSamples){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,e,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,e,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,a);this._colorRenderbuffers[i]=a}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer);for(i=0;i<this._numRenderBuffers;i++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0)}if(this._options.depth){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let s=this._cgl.gl.DEPTH_COMPONENT32F;if(this._cgl.glSlowRenderer)s=this._cgl.gl.DEPTH_COMPONENT16;if(r){this._textureDepth.setSize(this._width,this._height);this._depthRenderbuffer=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);if(this._options.isFloatingPointTexture){if(this._options.multisampling)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,s,this._width,this._height);else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,s,this._width,this._height)}else if(this._options.multisampling){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,s,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,s,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)}this._drawTargetArray.length=0;for(i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);if(!this._cgl.gl.isFramebuffer(this._textureFrameBuffer))this._log.warn("invalid framebuffer");const n=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(n!=this._cgl.gl.FRAMEBUFFER_COMPLETE){this._log.error("framebuffer incomplete: "+this.name,this);this._log.log("options",this._options);this._log.log("options pixelformat",this._options.pixelFormat);switch(n){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this);throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:this._log.warn("FRAMEBUFFER_UNSUPPORTED");throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:this.valid=false;this._log.error("incomplete framebuffer",n,this._frameBuffer);this._cgl.printError();this._frameBuffer=null;throw new Error("Incomplete framebuffer: "+n)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)}renderStart(){if(this._disposed)return this._log.warn("disposed framebuffer renderStart...");this._cgl.checkFrameStarted("fb2 renderstart");this._cgl.pushModelMatrix();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.pushGlFrameBuffer(this._frameBuffer);this._cgl.pushFrameBuffer(this);this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this._width,this._height);this._cgl.gl.drawBuffers(this._drawTargetArray);if(this._options.clear){this._cgl.gl.clearColor(0,0,0,0);this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)}}clear(){if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)}else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.drawBuffers(this._drawTargetArray);for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+e,this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex,0);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,e,this.clearColors[e])}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}renderEnd(){if(this._disposed)return this._log.warn("disposed framebuffer renderEnd...");this._cgl.popPMatrix();this._cgl.profileData.profileFramebuffer++;if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);let e=this._cgl.gl.COLOR_BUFFER_BIT;if(t==0)e|=this._cgl.gl.DEPTH_BUFFER_BIT;this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.popFrameBuffer();this._cgl.popModelMatrix();this._cgl.popViewPort();if(this._colorTextures[0].filter==l.g.FILTER_MIPMAP){for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex);this._colorTextures[e].updateMipMap();this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}}}}const s=function(e){this.draw=function(e,t,i){}};const n=function(e){this.render=function(e,t){}};const o=function(e){this.render=function(e,t,i,r){}};var h=i(264);var u=i(923);var g=i(960);class f{constructor(e){this.shader=new CGL.Shader(e,"markermaterial");const t="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}";const i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,t);this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(e,t,i,r){this.coloruni.set(e,t,i,r)}}var d=i(24);var p=i(273);const m=Math.PI/180;const _=180/Math.PI;const E=null;const b=window.navigator.userAgent.includes("Windows");const A=function(t){let i;if(t.wheelDelta){i=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30;i*=-1.5;if(b)i*=2}else{let e=t.deltaY;if(t.shiftKey)e=t.deltaX;const r=e||t.detail;i=-(r%3?r*10:r/3);i*=-3}if(i>20)i=20;if(i<-20)i=-20;return i};const F=A;const v=A;var x=i(771);var T=i(997);var C=i(460);var D=i(331);var B=i(982);var S=i(868);var I=i(308);const M={Framebuffer2:r,Geometry:D.V,BoundingBox:B.I,Marker:s,WirePoint:n,WireCube:o,MatrixStack:S.u,Mesh:h.e,MESH:h.C,ShaderLibMods:g.y,Shader:d.M,Uniform:u.n,MESHES:p.S,getWheelSpeed:F,getWheelDelta:v,Context:I.G,Texture:l.g,TextureEffect:x.p,onLoadingAssetsFinished:E,ProfileData:C.E,UniColorShader:f,...T.a.BLEND_MODES,...T.a.SHADER,...T.a.MATH,...T.a.BLEND_MODES};window.CABLES=window.CABLES||{};window.CABLES.CGL=window.CABLES.CGL||M;window.CGL=window.CGL||M;c.k.slerpQuaternion=function(e,t,i,r,s,n){if(!c.k.slerpQuaternion.q1){c.k.slerpQuaternion.q1=quat.create();c.k.slerpQuaternion.q2=quat.create()}const a=i.getKeyIndex(e);let o=a+1;if(o>=i.keys.length)o=i.keys.length-1;if(a==o){quat.set(t,i.keys[a].value,r.keys[a].value,s.keys[a].value,n.keys[a].value)}else{const l=i.keys[a].time;const h=i.keys[o].time;const u=(e-l)/(h-l);quat.set(c.k.slerpQuaternion.q1,i.keys[a].value,r.keys[a].value,s.keys[a].value,n.keys[a].value);quat.set(c.k.slerpQuaternion.q2,i.keys[o].value,r.keys[o].value,s.keys[o].value,n.keys[o].value);quat.slerp(t,c.k.slerpQuaternion.q1,c.k.slerpQuaternion.q2,u)}return t}},626:(e,t,i)=>{"use strict";var s=i(849);var r=i(628);var n=i(356);var a=i(684);var o=i(920);var l=i(475);class h extends l.v{#cgp=null;gpuBuffer=null;gpuBufferChanged=false;constructor(e,t,i,r,s,n,a){super(e,t,i,r,s,n,a);this.#cgp=e._cgp;if(!r||r.get&&!r.get()){if(this.getType()=="t"){this._value=this.#cgp.getEmptyTexture()}}}getInfo(){return{name:this.name,type:this.type,value:this.getValue()}}updateValueF(){}updateValueArrayF(){}setValueArrayF(e){this.needsUpdate=true;this._value=e}setValueF(e){this.needsUpdate=true;this._value=e}updateValue2F(){}setValue2F(e){this.needsUpdate=true;this._value=e}updateValue3F(){}setValue3F(e){this.needsUpdate=true;this._value=e}updateValue4F(){}setValue4F(e){if(e[0]==undefined){this._log.stack("uniform value undefined");console.error("uniform value undefined")}this.needsUpdate=true;this._value=e}setValueT(e){this.needsUpdate=true;this._value=e}updateValueM4(e){}setValueM4(e){this.needsUpdate=true;this._value=e}setValueAny(e){this.needsUpdate=true;this._value=e}updateValueAny(){}updateValueT(){}setGpuBuffer(e){this.gpuBufferChanged=true;this.gpuBuffer=e}copyToBuffer(t,i=0){if(this._type=="f"){t[i]=this._value}else if(this._type=="t"){}else if(this._type=="4f"){t[i]=this._value[0];t[i+1]=this._value[1];t[i+2]=this._value[2];t[i+3]=this._value[3]}else if(this._type=="2f"){t[i]=this._value[0];t[i+1]=this._value[1]}else if(this._type=="3f"){t[i]=this._value[0];t[i+1]=this._value[1];t[i+2]=this._value[2]}else if(this._type=="f[]"){for(let e=0;e<this._value.length;e++)t[i+e]=this._value[e]}else if(this._type=="m4"){for(let e=0;e<16;e++)t[i+e]=this._value[e]}else{this._log.warn("uniform copy to buffer unknown",this._type)}}getWgslTypeStr(){if(this._type=="m4")return"mat4x4f";if(this._type=="4f")return"vec4f";if(this._type=="3f")return"vec3f";if(this._type=="2f")return"vec2f";if(this._type=="f")return"f32";if(this._type=="f[]")return"array<vec4f>";if(this._type=="i")return"int";if(this._type=="sampler")return"sampler";if(this._type=="t")return"texture_2d<f32>";this._log.warn("unknown type getWgslTypeStr",this._type);return"???"}getSizeBytes(){const e=4;const t=4;if(this._type=="t")return 4;if(this._type=="sampler")return 4;if(this._type=="f")return 1*e;if(this._type=="2f")return 2*e;if(this._type=="3f")return 3*e;if(this._type=="4f")return 4*e;if(this._type=="f[]")return this._value.length*e;if(this._type=="m4")return 4*4*e;if(this._type=="i")return 1*t;if(this._type=="2i")return 2*t;this._log.warn("unknown type getSizeBytes",this._type);return 4}copy(e){const t=new h(e,this._type,this._name,this._value,this._port2,this._port3,this._port4);t.shaderType=this.shaderType;return t}}function u(e,r){if(!e){console.warn("shader preproc no shader code given")}e=e||"";const s=e.split("\n");const n=[];let a=[];for(let i=0;i<s.length;i++){let e=s[i].trim();let t=e.split(" ");if(e.startsWith("#ifdef ")){const l=r[t[1]];a.push({state:l});continue}if(e.startsWith("#ifndef ")){const l=r[t[1]];a.push({state:!l});continue}if(e.startsWith("#endif")){a.pop();continue}const o=a[a.length-1];if(e.startsWith("#else")){o.state=!o.state;continue}if(!o||o.state){n.push(s[i])}}return n.join("\n")}var c=i(694);class g{#gpuBindGroups=[];#bindings=[];name="";needsPipelineUpdate=false;bla=1;#cgp;constructor(e,t){this.#cgp=e;this.name=t}hasBinding(e){return this.#bindings.includes(e)}getBindingByName(t){for(let e=0;e<this.#bindings.length;e++){if(this.#bindings[e].name==t)return this.#bindings[e]}}removeBinding(e){const t=this.#bindings.indexOf(e);this.#bindings.splice(t,1)}addBinding(e){const t=this.getBindingByName(e.name);if(t)this.removeBinding(t);e.needsRebuildBindgroup=true;e.bindNum=this.#bindings.length;this.#bindings.push(e);return e}getLayoutEntries(t){const i=[];for(let e=0;e<this.#bindings.length;e++){i.push(this.#bindings[e].getLayoutEntry(t))}if(i.length==0){}return i}getEntries(t){const i=[];for(let e=0;e<this.#bindings.length;e++){i.push(this.#bindings[e].getBindgroupEntry(t))}if(i.length==0){}return i}getLayout(e){const t=this.#cgp.device.createBindGroupLayout({label:"bindgrouplayout "+this.name,entries:this.getLayoutEntries(e)});return t}create(e){const t={label:" "+this.name+" i"+e,layout:this.getLayout(),entries:this.getEntries(e)};this.#cgp.profileData.count("bindgroup created",this.name);try{this.#gpuBindGroups[e]=this.#cgp.device.createBindGroup(t);this.needsRebuildBindgroup=true}catch(e){console.log(t);console.error(e)}this.updateValues(e)}updateValues(t){for(let e=0;e<this.#bindings.length;e++){this.#bindings[e].updateValues(t)}}bind(t=0,e=null,i=0){for(let e=0;e<this.#bindings.length;e++)if(this.#bindings[e].needsRebuildBindgroup){this.create(t);this.#bindings[e].needsRebuildBindgroup=false;this.#gpuBindGroups=[]}if(!this.#gpuBindGroups[t])this.create(t);(e||this.#cgp.passEncoder).setBindGroup(i,this.#gpuBindGroups[t])}getShaderHeaderCode(i,r){const s={vertex:"",fragment:"",compute:""};this.#cgp.profileData.count("bindgroup shadercode",this.name);for(let t=0;t<this.#bindings.length;t++){const n=this.#bindings[t];let e="";e+=n.getShaderHeaderCode(i,r);if(n.stage&GPUShaderStage.VERTEX)s.vertex+=e;else if(n.stage===GPUShaderStage.FRAGMENT)s.fragment+=e;else if(n.stage&GPUShaderStage.COMPUTE)s.compute+=e}return s}copy(t){const i=new g(this.#cgp,this.name);for(let e=0;e<this.#bindings.length;e++){i.addBinding(this.#bindings[e].copy(t))}return i}setBindingNums(){for(let e=0;e<this.#bindings.length;e++){this.#bindings[e].setBindNum(e)}}getInfo(){const t={name:this.name,bindings:[]};for(let e=0;e<this.#bindings.length;e++){t.bindings.push(this.#bindings[e].getInfo())}return t}}var f=i(562);var d=i(997);class p{id=f.simpleId();name="";bindNum=0;stage=GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT;define="";log=new s.A("binding");needsRebuildBindgroup=false;cgp=null;constructor(e,t,i){this.cgp=e;this.name=t;if(!t)this.log.error("no binding name given");this.options=i||{};if(i.hasOwnProperty("stage"))this.stage=i.stage}getResource(e){return null}setBindNum(e){if(this.bindNum!=e)this.needsRebuildBindgroup=true;this.bindNum=e}getLayoutEntry(e){this.log.warn("unknown binding type?",this);return null}getBindgroupEntry(e){let t="layout "+this.name+" ["+this.constructor.name;t+="]";return{binding:this.bindNum,resource:this.getResource(e)}}isActiveByDefine(e){if(!this.define)return true;return true}updateValues(e){}getShaderHeaderCode(e,t){return"//getShaderHeaderCode function not emplemented "+d.nl}copy(e){return null}getInfo(){const e={name:this.name,id:this.id,class:this.constructor.name};return e}}var m=i(125);class _ extends m.A{#name="unknown";#cgp=null;#gpuBuffer=null;buffCfg=null;#length=0;id=f.shortId();floatArr=null;needsUpdate=true;#log;constructor(e,t,i=null,r={}){super();this.#log=new s.A("cgpGpubuffer");if(!e.supported)return;this.#name=t;this.buffCfg=r.buffCfg||{};if(i)this.setData(i);if(r.length)this.setLength(r.length);this.buffCfg.usage=this.buffCfg.usage||GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC;this.updateGpuBuffer(e)}setData(e){this.floatArr=new Float32Array(e);this.setLength(this.floatArr.length);this.needsUpdate=true}setLength(e){this.#length=e;if(!this.floatArr||e!=this.floatArr.length){this.floatArr=new Float32Array(this.#length);this.needsUpdate=true}}hasUsage(e){return(this.buffCfg.usage&e)===e}updateGpuBuffer(e=null){if(e)this.#cgp=e;if(!this.#cgp||!this.#cgp.device){this.#log.warn("no cgp...",this.#name,this.#cgp);return}this.#cgp.pushErrorScope("updateGpuBuffer");if(!this.#gpuBuffer||this.buffCfg.mappedAtCreation){this.buffCfg=this.buffCfg||{};this.buffCfg.label="gpuBuffer-"+this.#name;if(!this.buffCfg.hasOwnProperty("size")&&this.floatArr)this.buffCfg.size=this.floatArr.length*4;this.#gpuBuffer=this.#cgp.device.createBuffer(this.buffCfg)}if(this.floatArr){if(this.buffCfg.mappedAtCreation){new Float32Array(this.#gpuBuffer.getMappedRange()).set(this.floatArr);this.#gpuBuffer.unmap()}else this.#cgp.device.queue.writeBuffer(this.#gpuBuffer,0,this.floatArr.buffer,this.floatArr.byteOffset,this.floatArr.byteLength)}this.#cgp.popErrorScope();this.needsUpdate=false}get name(){return this.#name}get gpuBuffer(){if(!this.#gpuBuffer||this.needsUpdate)this.updateGpuBuffer();return this.#gpuBuffer}get length(){return this.#length}getSizeBytes(){return this.floatArr.length*4}dispose(){}}class E extends p{#uniforms=[];cgpBuffer=[];constructor(e,t,i){super(e,t,i);console.log("new binding uniform",this.id)}copy(r){const s=new E(this.cgp,this.name,this.options);console.log("copybinuni",this.id,s.id);s.stage=this.stage;for(let i=0;i<this.#uniforms.length;i++){let t=false;for(let e=0;e<r.worldUniforms.length;e++){if(r.worldUniforms[e].getName()==this.#uniforms[i].getName()){s.addUniform(r.worldUniforms[e]);t=true}}if(!t)s.addUniform(this.#uniforms[i])}return s}addUniform(e){this.#uniforms.push(e);this.needsRebuildBindgroup=true;console.log(this.#uniforms,this);return e}getResource(e){this.updateBuffer(e);return{buffer:this.cgpBuffer[e].gpuBuffer}}getSizeBytes(){let t=0;for(let e=0;e<this.#uniforms.length;e++)t+=this.#uniforms[e].getSizeBytes();return t}getUniform(t){for(let e=0;e<this.#uniforms.length;e++){if(this.#uniforms[e].name==t)return this.#uniforms[e]}return null}removeUniformByName(t){for(let e=0;e<this.#uniforms.length;e++)if(this.#uniforms[e].name==t){this.needsRebuildBindgroup=true;return this.#uniforms.splice(e,1)}}createBuffer(e){let t={label:this.name,size:this.getSizeBytes(),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM};this.cgpBuffer[e]=new _(this.cgp,this.name+" buff",null,{buffCfg:t})}pipelineUpdated(){this.needsRebuildBindgroup=false}needsPipeUpdate(){return this.needsRebuildBindgroup}updateBuffer(t){let i={name:this.#uniforms.length+" uniforms","stage ":F.getStageString(this.stage),uniforms:[]};let e=this.getSizeBytes()/4;i.s=this.getSizeBytes();if(e==16)e=16;if(!this.cgpBuffer[t]){this.createBuffer(t)}this.cgpBuffer[t].setLength(e);let r=0;for(let e=0;e<this.#uniforms.length;e++){this.#uniforms[e].copyToBuffer(this.cgpBuffer[t].floatArr,r);if(this.#uniforms[e].gpuBufferChanged)console.log("un changed",this.cgpBuffer[t].floatArr);i.uniforms.push(this.#uniforms[e].getInfo());r+=this.#uniforms[e].getSizeBytes()/4}if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("binding update buff",F.getStageString(this.stage),{info:i});this.cgpBuffer[t].updateGpuBuffer();if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}getShaderHeaderCode(e,t){this.cgp.profileData.count("shadercode uni",this.name);let i="";let r="";let s=this.name;i+='//   [binding_uniform] - "'+this.name+'" '+this.id+" uniforms:"+this.#uniforms.length+"\n";if(!this.isActiveByDefine(e)){i+="// "+r+" "+this.name+": excluded because define "+this.define+"\n";return i}if(this.#uniforms.length>1){r="strct_"+s;i+="struct "+r+"\n";i+="{\n";for(let e=0;e<this.#uniforms.length;e++){i+="    "+this.#uniforms[e].name+": "+this.#uniforms[e].getWgslTypeStr();if(e!=this.#uniforms.length-1)i+=",";i+="\n"}i+="};\n"}else if(this.#uniforms.length==1){r=this.#uniforms[0].getWgslTypeStr();s=this.#uniforms[0].name}else if(this.#uniforms.length==0){return i}i+="@group("+t+") ";i+="@binding("+this.bindNum+") ";i+="var<uniform> ";i+=s+": "+r+";\n";return i+"\n"}getLayoutEntry(){return{visibility:this.stage,binding:this.bindNum,minBindingSize:this.getSizeBytes(),hasDynamicOffset:0,buffer:{}}}updateValues(e){for(let e=0;e<this.#uniforms.length;e++){}return this.updateBuffer(e)}getInfo(){const t={name:this.name,id:this.id,stage:this.stage,class:this.constructor.name,uniforms:[]};for(let e=0;e<this.#uniforms.length;e++){t.uniforms.push(this.#uniforms[e].getInfo())}return t}}class b extends p{smplDesc={addressModeU:"mirror-repeat",addressModeV:"mirror-repeat",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"};sampler=null;constructor(e,t,i){super(e,t,i);this.sampler=this.cgp.device.createSampler(this.smplDesc)}copy(){const e=new b(this.cgp,this.name,this.options);return e}getResource(){return this.sampler}getLayoutEntry(){return{visibility:this.stage,binding:this.bindNum,sampler:{}}}getShaderHeaderCode(e,t){let i="@group("+t+") @binding("+this.bindNum+") ";i+="var "+this.name+": sampler;".endl();return i}}class A extends p{sampler=null;uniform=null;constructor(e,t,i){super(e,t,i);this.uniform=i.uniform;if(this.uniform.port){this.uniform.port.on("change",()=>{this.needsRebuildBindgroup=true})}console.log(this.uniform)}copy(){const e=new A(this.cgp,this.name,this.options);return e}getResource(){if(this.uniform.getValue()&&this.uniform.getValue().gpuTexture)return this.uniform.getValue().gpuTexture.createView();else return this.cgp.getDefaultTexture().createView()}getLayoutEntry(){return{visibility:this.stage,binding:this.bindNum,texture:{}}}getShaderHeaderCode(e,t){let i="@group("+t+") @binding("+this.bindNum+") ";i+="var "+this.name+": "+this.uniform.getWgslTypeStr()+";\n";return i}}class F extends c.U{#lastCompileReason="first";uniModelMatrix;uniViewMatrix;uniProjMatrix;compilationInfo;constructor(e,t,i={}){super();if(!e)throw new Error("shader constructed without cgp "+t);this._log=new s.A("cgp_shader");this._cgp=e;this._name=t;this.options=i;this.options.compute=this.options.compute||false;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";this.gpuShaderModule=null;this.frameUsageCounter=0;this.lastFrameUsageCounter=-2;this.frameUsageFrame=-1;this._bindingIndexCount=0;this.compileCount=0;this.worldUniforms=[];this.defaultBindGroup=new g(e,this._name);this.modsBindGroup=new g(e,this._name);this.bindGroups=[this.defaultBindGroup,this.modsBindGroup];if(!this.options.compute){this.defaultUniBindingVert=new E(e,"uniVert",{stage:GPUShaderStage.VERTEX});this.defaultBindGroup.addBinding(this.defaultUniBindingVert);this.defaultUniBindingFrag=new E(e,"uniFrag",{stage:GPUShaderStage.FRAGMENT});this.defaultBindGroup.addBinding(this.defaultUniBindingFrag)}else{this.defaultUniBindingCompute=new E(e,"uniCompute",{stage:GPUShaderStage.COMPUTE});this.defaultBindGroup.addBinding(this.defaultUniBindingCompute)}if(!this.options.compute){this.uniModelMatrix=this.addUniform(new h(this,"m4","modelMatrix"),GPUShaderStage.VERTEX);this.uniViewMatrix=this.addUniform(new h(this,"m4","viewMatrix"),GPUShaderStage.VERTEX);this.uniProjMatrix=this.addUniform(new h(this,"m4","projMatrix"),GPUShaderStage.VERTEX);this.uniNormalMatrix=this.addUniform(new h(this,"m4","normalMatrix"),GPUShaderStage.VERTEX);this.uniModelViewMatrix=this.addUniform(new h(this,"m4","modelViewMatrix"),GPUShaderStage.VERTEX);this._tempNormalMatrix=a.create();this._tempModelViewMatrix=a.create();this.worldUniforms.push(this.uniModelMatrix,this.uniViewMatrix,this.uniProjMatrix,this.uniNormalMatrix,this.uniModelViewMatrix)}this._src="";this._cgp.on("deviceChange",()=>{this.gpuShaderModule=null;this.setWhyCompile("device changed")})}reInit(){}isValid(){return this._isValid}getName(){return this._name}incFrameUsageCount(){if(this.frameUsageFrame!=this._cgp.frame){this.lastFrameUsageCounter=this.frameUsageCounter;this.frameUsageCounter=0}else this.frameUsageCounter++;this.frameUsageFrame=this._cgp.frame;return this.frameUsageCounter}getNewBindingGroupIndex(){return++this._bindingIndexCount}setSource(e){this._src=e;this.setWhyCompile("Source changed")}_replaceModPrefixes(e,t){return t.replace(/MOD_/g,e.prefix)}_replaceMods(e,r){let s="";for(let i=0;i<this._moduleNames.length;i++){let t="";for(let e=0;e<this._modules.length;e++){const n=this._modules[e];if(n.name==this._moduleNames[i]){s+=d.nl+d.nl+"//---- MOD: group:"+n.group+": idx:"+e+" - prfx:"+n.prefix+" - "+n.title+" ------"+d.nl;t+=d.nl+d.nl+"//---- MOD: "+n.title+" / "+n.priority+" ------"+d.nl;if(n.attributes)for(let e=0;e<n.attributes.length;e++){const a=this._getAttrSrc(n.attributes[e],false);if(a.srcHeadVert)s+=a.srcHeadVert;if(a.srcVert)t+=a.srcVert}s+=n.srcHead||"";t+=n.srcBody||"";s+=d.nl+"//---- end mod ------"+d.nl;t+=d.nl+"//---- end mod ------"+d.nl;t=this._replaceModPrefixes(n,t);s=this._replaceModPrefixes(n,s)}}t=u(t,r);e=e.replace("{{"+this._moduleNames[i]+"}}",t)}s=u(s,r);e=e.replace("{{MODULES_HEAD}}",s);return e}_replaceVertexOutputs(s=""){const n="{{VERTEX_OUTPUT";const i=s.indexOf(n);if(i>-1){try{let e=s.substring(i+n.length,i+100);let t=e.indexOf("}}");let r=parseInt(e.substring(0,t));for(let i=0;i<this._modules.length;i++){if(!this._modules[i].outputs)continue;let e=this._modules[i].outputs;let t=0;while(e.indexOf("@location("+t+")")>-1){e=e.replaceAll("@location("+t+")","@location("+(t+r)+")")}e=this._replaceModPrefixes(this._modules[i],e);s=s.replaceAll(n+" "+r+"}}",e)}}catch(e){console.log(e)}}return s}getDefines(){return this._defines}getProcessedSource(){const t={};for(let e=0;e<this._defines.length;e++)t[this._defines[e][0]]=this._defines[e][1]||true;let s="";s+=u(this._src,t);let i="";for(let e=0;e<this._defines.length;e++)i+="// #define "+this._defines[e]+"\n";let r="";let n="";let a="";for(let e=0;e<this.bindGroups.length;e++){const s=this.bindGroups[e].getShaderHeaderCode(this,e);n+=s.fragment||"";r+=s.vertex||"";a+=s.compute||""}if(this.options.compute)s=a+"\n\n////////////////\n\n"+s;else s=n+"\n\n////////////////\n\n"+r+"\n\n////////////////\n\n"+s;s=this._replaceMods(s,t);s=this._replaceVertexOutputs(s);const o="{{VERTEX_OUTPUT";const l=s.indexOf(o);if(l>-1){try{let e=s.substring(l+o.length,l+100);let t=e.indexOf("}}");let i=parseInt(e.substring(0,t));let r="@location("+i+") pos:vec4f, // generated";s=s.replaceAll(o+" "+i+"}}",r)}catch(e){console.log(e)}}s=i+"\n"+s;let e="//"+d.nl+"// ";if(this.options.compute)e+="Compute ";else e+="Render ";e+="Shader: "+this._name+" - "+this.id+d.nl;e+="//"+d.nl;return e+s}compile(){this._isValid=true;this._cgp.pushErrorScope("cgp_shader "+this._name);if(this._cgp.branchProfiler)this._cgp.branchProfiler.push("shadercompile",this._name,{info:this.getInfo()});this._cgp.profileData.count("shader compile",this._name);this.gpuShaderModule=this._cgp.device.createShaderModule({code:this.getProcessedSource(),label:this._name});this.gpuShaderModule.getCompilationInfo().then(t=>{this.compilationInfo=t;if(t.messages.length>0){let e=false;for(const i of t.messages){switch(i.type){case"error":console.error("Shader "+i.type+" at line "+i.lineNum+":"+i.linePos+" :"+i.message);e=true;case"warning":console.warn("Shader "+i.type+" at line "+i.lineNum+":"+i.linePos+" :"+i.message);break;case"info":console.info("Shader "+i.type+" at line "+i.lineNum+":"+i.linePos+" :"+i.message);break}}if(e){console.log("has errrrrrrrrrr");CABLES.UI.showShaderErrorCgp(this,t,this.getProcessedSource())}}});this._cgp.popErrorScope(this.error.bind(this));this.#lastCompileReason=this._compileReason;this.lastCompile=(0,o.tB)();this.emitEvent("compiled",this._compileReason);this._needsRecompile=false;this._compileReason="none";this.compileCount++;if(this._cgp.branchProfiler)this._cgp.branchProfiler.pop()}error(e){this._isValid=false}bind(t=null){this.incFrameUsageCount();if(!this.options.compute){this.uniModelMatrix.setValue(this._cgp.mMatrix);this.uniViewMatrix.setValue(this._cgp.vMatrix);this.uniProjMatrix.setValue(this._cgp.pMatrix);a.mul(this._tempModelViewMatrix,this._cgp.vMatrix,this._cgp.mMatrix);this.uniModelViewMatrix.setValue(this._tempModelViewMatrix);a.copy(this._tempNormalMatrix,this._cgp.mMatrix);a.invert(this._tempNormalMatrix,this._tempNormalMatrix);a.transpose(this._tempNormalMatrix,this._tempNormalMatrix);this.uniNormalMatrix.setValue(this._tempNormalMatrix)}for(let e=0;e<this.bindGroups.length;e++){this.bindGroups[e].updateValues(this.frameUsageCounter);this.bindGroups[e].bind(this.frameUsageCounter,t,e)}if(this._needsRecompile)this.compile()}getDefaultUniBinding(e){let t=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)t=this.defaultUniBindingVert;if(this.options.compute&&e==GPUShaderStage.COMPUTE)t=this.defaultUniBindingCompute;return t}pipelineUpdated(){if(this.defaultUniBindingFrag)this.defaultUniBindingFrag.pipelineUpdated();if(this.defaultUniBindingVert)this.defaultUniBindingVert.pipelineUpdated();if(this.defaultUniBindingCompute)this.defaultUniBindingCompute.pipelineUpdated()}bindingsNeedPipeUpdate(){return this.defaultUniBindingFrag&&this.defaultUniBindingFrag.needsPipeUpdate()||this.defaultUniBindingVert&&this.defaultUniBindingVert.needsPipeUpdate()||this.defaultUniBindingCompute&&this.defaultUniBindingCompute.needsPipeUpdate()}hasUniformInStage(e,t){let i=this.getDefaultUniBinding(t);if(!i)return false;return!!i.getUniform(e)}hasUniform(e){return this.hasUniformInStage(e,GPUShaderStage.FRAGMENT)||this.hasUniformInStage(e,GPUShaderStage.VERTEX)||this.hasUniformInStage(e,GPUShaderStage.COMPUTE)}addUniform(e,t){const i=this.getDefaultUniBinding(t);if(e.type=="t")this.defaultBindGroup.addBinding(new A(this._cgp,e.name,{uniform:e}));else if(e.type=="sampler")this.defaultBindGroup.addBinding(new b(this._cgp,e.name,{uniform:e}));else{i.addUniform(e)}this.needsPipelineUpdate="add uniform";console.log("adduni2",this._name,e.name,this.id,i,F.getStageString(t));console.log("code",i.getShaderHeaderCode(this,0));return e}removeUniformByName(e){const t=this.getDefaultUniBinding(stage);t.removeUniformByName(e)}copy(){this.bind();const t=new F(this._cgp,this._name+" copy",this.options);console.log("copyyyyyy",this.id,t.id);t.setSource(this._src);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._moduleNames=this._moduleNames;t.bindGroups=[];for(let e=0;e<this.bindGroups.length;e++){const i=this.bindGroups[e].copy(t);t.bindGroups.push(i);if(this.bindGroups[e]==this.defaultBindGroup)t.defaultBindGroup=i;i.setBindingNums()}t.setWhyCompile("copy");t.compile();return t}dispose(){}static getStageString(e){if(e==GPUShaderStage.FRAGMENT)return"frag";if(e==GPUShaderStage.VERTEX)return"vertex";if(e==(GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX))return"frag+vertex";if(e==(GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE))return"frag+vertex+comp";if(e==GPUShaderStage.COMPUTE)return"compute";return"unknown"+e}getInfo(){const t={class:this.constructor.name,id:this.id,name:this._name,needsPipelineUpdate:this.needsPipelineUpdate,frameUsageCounter:this.lastFrameUsageCounter,lastCompileReason:this.#lastCompileReason,compileCount:this.compileCount,defines:this._defines,isCompute:this.options.compute,modules:[],bindgroups:[]};for(let e=0;e<this.bindGroups.length;e++){t.bindgroups.push(this.bindGroups[e].getInfo())}for(let e=0;e<this._modules.length;e++){t.modules.push(this._modules[e].title+" "+this._modules[e].name+" "+this._modules[e].group)}return t}copyUniformValues(e){}}class v extends n.U{#log=new s.A("cgp_texture");#cgp=null;gpuTexture=null;gpuTextureDescriptor=null;name="unknown";width=8;height=8;textureType="???";samplerDesc={};constructor(e,t={}){super(t);t=t||{};this.#cgp=e;if(!this.#cgp)throw new Error("no cgp");if(t.name)this.name=t.name;if(t.height&&t.width)this.setSize(t.width,t.height);this.#cgp.on("deviceChange",()=>{});this.samplerDesc={addressModeU:t.wrap||t.addressModeU||"clamp-to-edge",addressModeV:t.wrap||t.addressModeV||"clamp-to-edge",magFilter:t.magFilter||t.filter||"linear",minFilter:t.minFilter||t.filter||"linear"}}setSize(e,t){this.width=e;this.height=t}initTexture(e,t){this.width=e.width;this.height=e.height;const i="rgba8unorm";this.#cgp.pushErrorScope("inittexture",{logger:this.#log});this.gpuTextureDescriptor={size:{width:e.width,height:e.height},format:i,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};this.gpuTexture=this.#cgp.device.createTexture(this.gpuTextureDescriptor);this.#cgp.device.queue.copyExternalImageToTexture({source:e},{texture:this.gpuTexture},this.gpuTextureDescriptor.size);this.#cgp.popErrorScope();return this.gpuTexture}dispose(){console.log("todo dispose")}getInfo(){const e={};e.name=this.name||"???";e.size=this.width+" x "+this.height;e.textureType=this.textureType;return e}createView(){if(!this.gpuTexture){console.log("no gputexture...");return null}return this.gpuTexture.createView()}getSampler(){return this.samplerDesc}initFromData(e,t,i,r,s){if(!t||!i)this.#log.error("texture size is 0");this.width=t;this.height=i;this.gpuTexture=this.#cgp.device.createTexture({size:[t,i],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});this.#cgp.device.queue.writeTexture({texture:this.gpuTexture},e,{bytesPerRow:t*4},{width:t,height:i})}setWrap(e){this.samplerDesc.addressModeU=this.samplerDesc.addressModeV=e}setFilter(e){this.samplerDesc.minFilter=this.samplerDesc.magFilter=e}}v.load=function(i,r,s,e){fetch(r).then(e=>{const t=new v(i,{name:r});e.blob().then(e=>{createImageBitmap(e).then(e=>{t.initTexture(e);if(s)s(t);else console.log("Texture.load no onFinished callback")}).catch(e=>{if(s)s(i.getErrorTexture())})})})};class x{static TYPE_RENDER=0;static TYPE_COMPUTE=1;#log=new s.A("pipeline");name="";#cgp=null;#isValid=true;presentationFormat=null;#pipeCfg=null;bindGroupLayout=null;#shaderListeners=[];#type=-1;lastRebuildReason="first";rebuildCount=0;profile=false;bindingGroupLayoutEntries=[];constructor(e,t,i=0){if(!e)throw new Error("Pipeline constructed without cgp "+t);this.name=t;this.#cgp=e;this.#type=i}get passEncoder(){return this.#cgp.passEncoder}get log(){return this.#log}get cgp(){return this.#cgp}get isValid(){return this.#isValid}setName(e){this.name=e}getInfo(){const e={class:this.constructor.name,name:this.name,rebuildReason:this.lastRebuildReason,rebuildCount:this.rebuildCount,bindingGroupLayoutEntries:this.bindingGroupLayoutEntries};if(this.#type==x.TYPE_COMPUTE)e.type="COMPUTE";if(this.#type==x.TYPE_RENDER)e.type="RENDER";return e}pushDebug(){this.#cgp.currentPipeDebug={name:this.name,rebuildreason:this.lastRebuildReason,rebuildCount:this.rebuildCount,cfg:this.#pipeCfg,bindingGroupLayoutEntries:this.bindingGroupLayoutEntries}}_bindUniforms(e){e.bind()}dispose(){}}class T extends x{static DEPTH_COMPARE_FUNCS_STRINGS=["never","less","equal","lessequal","greater","notequal","greaterequal","always"];#isValid=true;presentationFormat=null;#pipeCfg=null;#renderPipeline=null;bindGroupLayout=null;#passEncoder;#old={};#type=T.TYPE_RENDER;lastRebuildReason="first";#rebuildNumBindingGroups=false;#compileCount=-1;constructor(e,t){super(e,t,x.TYPE_RENDER)}setPipeline(t,e=null){if(this.#type==T.TYPE_RENDER){if(!e){this.log.log("pipeline unknown mesh");return}}if(!t){this.log.log("pipeline unknown shader");return}if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("setPipeline",this.name,{info:this.getInfo(),shader:t.getInfo()});let i="";if(!this.#renderPipeline)i="no renderpipeline";if(!this.#pipeCfg)i="no pipecfg";if(this.#old.mesh!=e)i="no mesh";if(this.#old.shader!=t){i="shader changed"}if(t.needsPipelineUpdate){i="shader needs update: "+t.needsPipelineUpdate;t.needsPipelineUpdate=""}if(this.#type==T.TYPE_RENDER&&e.needsPipelineUpdate){i="mesh needs update";e.needsPipelineUpdate=false}if(this.bindingGroupLayoutEntries.length!=t.defaultBindGroup.getLayoutEntries(t).length){i="num bindgroup layouts wrong..."}if(t.bindingsNeedPipeUpdate()){console.log("binding needs uptate");i="bindings needs update";this.needsRebuildBindgroup=true}if(this.#pipeCfg){this.#pipeCfg=this.#pipeCfg||{};if(this.#pipeCfg.depthStencil.depthWriteEnabled!=this.cgp.stateDepthWrite())i="depth changed";if(this.#pipeCfg.fragment.targets[0].blend!=this.cgp.stateBlend()){i="blend changed";this.#pipeCfg.fragment.targets[0].blend=this.cgp.stateBlend()}if(this.#pipeCfg.depthStencil.depthCompare!=this.cgp.getDepthCompare())i="depth compare changed";if(this.#pipeCfg.primitive.cullMode!=this.cgp.stateCullFaceFacing())i="cullmode change";if(this.#pipeCfg.multisample.count!=this.cgp.stateMultisampling())i="multisample change"}if(this.#compileCount!=t.compileCount){i="shader compiled "+t.compileCount}this.pushDebug();if(i!=""){this.cgp.profileData.addHeavyEvent("pipeline created",this.name,i);this.lastRebuildReason=i;this.rebuildCount++;this.cgp.pushErrorScope("createPipeline",{logger:this.log});this.#rebuildNumBindingGroups=false;this.#pipeCfg=this.getPipelineObject(t);this.#old.device=this.cgp.device;this.#old.shader=t;this.#old.mesh=e;this.#isValid=true;this.#compileCount=t.compileCount;t.pipelineUpdated();try{this.#renderPipeline=this.cgp.device.createRenderPipeline(this.#pipeCfg)}catch(e){console.error("pipe error catch...",e.message,this.#pipeCfg);this.#isValid=false}this.cgp.popErrorScope(()=>{console.log("this.#pipeCfg",this.#pipeCfg)})}if(this.#renderPipeline&&this.#isValid){this.cgp.pushErrorScope("setpipeline",{logger:this.log});let e=this.cgp.passEncoder;if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("pipe updateUniforms",this.name,{shader:t.getInfo()});t.bind();e.setPipeline(this.#renderPipeline);if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop();this.cgp.popErrorScope()}if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}getPipelineObject(e){this.bindingGroupLayoutEntries=[];this.bindingGroupLayoutEntries=e.defaultBindGroup.getLayoutEntries(e);const t=[e.defaultBindGroup.getLayout(e)];const i=this.cgp.device.createPipelineLayout({label:"pipe layout "+this.name,bindGroupLayouts:t});let r=[{arrayStride:3*4,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]},{arrayStride:2*4,attributes:[{shaderLocation:2,offset:0,format:"float32x2"}]},{arrayStride:3*4,attributes:[{shaderLocation:1,offset:0,format:"float32x3"}]}];let s={label:this.name,layout:i,primitive:{topology:"triangle-list",cullMode:this.cgp.stateCullFaceFacing()},multisample:{count:this.cgp.stateMultisampling(),alphaToCoverageEnabled:false},depthStencil:{depthWriteEnabled:this.cgp.stateDepthWrite(),depthCompare:this.cgp.getDepthCompare(),format:"depth24plus"},vertex:{module:e.gpuShaderModule,entryPoint:"myVSMain",buffers:r},fragment:{module:e.gpuShaderModule,entryPoint:"myFSMain",targets:[{format:this.cgp.presentationFormat,blend:this.cgp.stateBlend()}]}};return s}dispose(){}}var C=i(434);class D extends C.w{#log=new s.A("cgl_mesh");needsPipelineUpdate=false;constructor(e,t){super();this.cgp=e;this._geom=null;this.numIndex=0;this.instances=1;this._pipe=new T(this.cgp,"pipe mesh "+t.name);this._numNonIndexed=0;this._positionBuffer=null;this._attributes=[];if(t)this.setGeom(t)}_createBuffer(e,t,i){let r={size:t.byteLength,usage:i,mappedAtCreation:true};const s=e.createBuffer(r);const n=new t.constructor(s.getMappedRange());n.set(t);s.unmap();return s}setGeom(e){this.needsPipelineUpdate=true;this._geom=e;this._disposeAttributes();this._positionBuffer=this._createBuffer(this.cgp.device,new Float32Array(e.vertices),GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST);let t=e.verticesIndices;if(!e.isIndexed())t=Array.from(Array(e.vertices.length/3).keys());this._numIndices=t.length;this._indicesBuffer=this._createBuffer(this.cgp.device,new Uint32Array(t),GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST);if(e.texCoords&&e.texCoords.length)this.setAttribute("texCoords",e.texCoords,2);if(e.vertexNormals&&e.vertexNormals.length)this.setAttribute("normals",e.vertexNormals,3);this.setAttribute("normals",e.vertexNormals,3)}_disposeAttributes(){this.needsPipelineUpdate=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].buffer.destroy();this._attributes.length=0}dispose(){this._disposeAttributes()}setAttribute(e,t,i,r={}){if(!t){this.#log.error("mesh addAttribute - no array given! "+e);throw new Error}let s=false;if(r.instanced)s=r.instanced;const n=this._createBuffer(this.cgp.device,new Float32Array(t),GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST);const a={buffer:n,name:e,instanced:s};this._attributes.push(a);return a}render(e){if(!this._positionBuffer)return;if(this.instances<=0)return;if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("mesh.render()","geom "+this._geom.name);e=e||this.cgp.getShader();if(e)e.bind();if(!e||!e.isValid){return}this._pipe.setName("mesh.render "+this._geom.name+" "+e.getName()+" "+e.id);this._pipe.setPipeline(e,this);if(this._pipe.isValid){if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("mesh.render().draw","geom "+this._geom.name,{geom:this._geom.getInfo(),shader:e.getInfo(),numAttributes:this._attributes.length});this.cgp.passEncoder.setVertexBuffer(0,this._positionBuffer);for(let e=0;e<this._attributes.length;e++)this.cgp.passEncoder.setVertexBuffer(e+1,this._attributes[e].buffer);this.cgp.passEncoder.setIndexBuffer(this._indicesBuffer,"uint32");this.cgp.profileData.count("draw mesh",this._name);if(this._numNonIndexed)this.cgp.passEncoder.draw(this._numIndices,this.instances);else this.cgp.passEncoder.drawIndexed(this._numIndices,this.instances);if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}else{if(this.cgp.branchProfiler){this.cgp.branchProfiler.push("mesh invalid pipeline ","geom "+this._geom.name);this.cgp.branchProfiler.pop()}}if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}}const B=`
struct MyVSInput
{
    @location(0) position: vec3<f32>,
    @location(1) normal: vec3<f32>,
    @location(2) texcoord: vec2<f32>,
};

struct MyVSOutput
{
    @builtin(position) position: vec4<f32>,
    @location(0) normal: vec3<f32>,
    @location(1) texcoord: vec2<f32>,
};

@vertex
fn myVSMain(v: MyVSInput) -> MyVSOutput
{
    var vsOut: MyVSOutput;
    var pos =vec4<f32>(v.position, 1.0);

    var mvMatrix=uniVert.viewMatrix * uniVert.modelMatrix;
    vsOut.position = uniVert.projMatrix * mvMatrix * pos;

    vsOut.normal = v.normal;
    vsOut.texcoord = v.texcoord;
    return vsOut;
}

@fragment
fn myFSMain(v: MyVSOutput) -> @location(0) vec4<f32>
{
    return vec4<f32>(.5,.5,.5,1.0);
}
`;class S extends r.A{branchProfiler=null;constructor(e){super(e);this.patch=e;this.lastErrorMsg="";this._log=new s.A("WebGpuContext");this.gApi=r.A.API_WEBGPU;this._viewport=[0,0,256,256];this._shaderStack=[];this._simpleShader=null;this.frame=0;this.catchErrors=true;this._stackCullFaceFacing=[];this._stackDepthTest=[];this._stackCullFace=[];this._stackDepthFunc=[];this._stackDepthWrite=[];this._stackErrorScope=[];this._stackBlend=[];this._stackErrorScopeLogs=[];this._stackMultisampling=[];this.currentPipeDebug=null;this.canvasAttachments=[];this.device=null;this.passEncoder=null;this._defaultBlend={color:{operation:"add",srcFactor:"one",dstFactor:"zero"},alpha:{operation:"add",srcFactor:"one",dstFactor:"zero"}};this.DEPTH_FUNCS=["never","always","less","less-equal","greater","greater-equal","equal","not-equal"];this.CULL_MODES=["none","back","front","none"];this.presentationFormat="bgra8unorm"}get supported(){return!!navigator.gpu}renderStart(e,t,i){this.frame++;this.pushErrorScope("cgpstate internal",{scope:"internal"});this.pushErrorScope("cgpstate out-of-memory",{scope:"out-of-memory"});if(!this._simpleShader){this._simpleShader=new F(this,"simple default shader");this._simpleShader.setSource(B);this._simpleShader.addUniform(new h(this._simpleShader,"4f","color",[1,1,0,1]),GPUShaderStage.FRAGMENT)}this.fpsCounter.startFrame();this._startMatrixStacks(t,i);this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);this.pushShader(this._simpleShader);this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc("less-equal");this.pushBlend(this._defaultBlend);this._execOneTimeCallbacks();this.emitEvent("beginFrame")}renderEnd(){this._endMatrixStacks();this.popShader();this.popDepthFunc();this.popDepthWrite();this.popDepthTest();this.popErrorScope();this.popErrorScope();if(this._stackErrorScope.length>0)console.log("error scope stack length invalid...");this._stackErrorScope.length=0;this.emitEvent("endFrame");this.fpsCounter.endFrame()}setViewPort(e,t,i,r){this._viewport=[e,t,i,r]}getViewPort(){return this._viewPort}createMesh(e,t){return new D(this,e)}popViewPort(){this._viewPortStack.pop();if(this._viewPortStack.length==0)this._viewPort=[0,0,this.canvasWidth,this.canvasHeight];else this.setViewPort(this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,r){this._viewPortStack.push([e,t,i,r]);this._viewPort=[e,t,i,r]}pushShader(e){this._shaderStack.push(e)}popShader(){if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop()}getShader(){return this._shaderStack[this._shaderStack.length-1]}setDevice(e){this.device=e;if(this._emptyTexture)this._emptyTexture=this._emptyTexture.dispose();if(this._defaultTexture)this._defaultTexture=this._defaultTexture.dispose();if(this._errorTexture)this._errorTexture=this._errorTexture.dispose();this.emitEvent("deviceChange")}pushErrorScope(e,t={}){if(this.catchErrors){this._stackErrorScope.push(e);this._stackErrorScopeLogs.push(t.logger||null);this.device.pushErrorScope(t.scope||"validation")}}popErrorScope(i){if(this.catchErrors){const r=this._stackErrorScope.pop();const t=this._stackErrorScopeLogs.pop();this.device.popErrorScope().then(e=>{if(e){if(this.lastErrorMsg==e.message){}else{(t||this._log).error(e.constructor.name,"in ERROR SCOPE:",r);(t||this._log).error(e.message)}this.lastErrorMsg=e.message;if(i)i(e)}})}}pushDepthTest(e){this._stackDepthTest.push(e)}getDepthCompare(){let e=this.stateDepthFunc();if(!this.stateDepthTest())e="always";return e}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop()}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop()}pushDepthFunc(e){this._stackDepthFunc.push(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return"less"}popDepthFunc(){this._stackDepthFunc.pop()}pushCullFace(e){this._stackCullFace.push(e)}stateMultisampling(){return this._stackMultisampling[this._stackMultisampling.length-1]}pushMultisampling(e){this._stackMultisampling.push(e)}popMultisampling(){this._stackMultisampling.pop()}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e)}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop()}pushBlend(e){this._stackBlend.push(e)}popBlend(){this._stackBlend.pop()}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}getEmptyTexture(){if(this._emptyTexture)return this._emptyTexture;const e=8;this._emptyTexture=new v(this,{});this._emptyTexture.initFromData(n.U.getDefaultTextureData("empty",e),e,e);return this._emptyTexture}getErrorTexture(){const e=256;this._errorTexture=new v(this,{});this._errorTexture.initFromData(n.U.getDefaultTextureData("stripes",e,{r:1,g:0,b:0}),e,e);return this._errorTexture}getDefaultTexture(){if(this._defaultTexture)return this._defaultTexture;const e=256;this._defaultTexture=new v(this,{});this._defaultTexture.initFromData(n.U.getDefaultTextureData("stripes",e),e,e);return this._defaultTexture}screenShot(t,e,i,r){if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,r)}}}var I=i(273);class M{#canvas=null;#cgp=null;#ctx=null;constructor(e){this.#cgp=e;this.#canvas=document.createElement("canvas");this.#canvas.id="webgpucanvasOut";this.#canvas.style.width=128+"px";this.#canvas.style.height=128+"px"}get canvas(){return this.#canvas}render(e){const t=this.#cgp.canvas;if(this.#canvas.width!=t.width||this.#canvas.height!=t.height){this.#canvas.style.width=t.width+"px";this.#canvas.style.height=t.height+"px";this.#canvas.width=t.width;this.#canvas.height=t.height}if(!this.#ctx){this.#ctx=this.#canvas.getContext("webgpu");if(!this.#ctx)return console.log("no context",this.#canvas,this.#ctx);this.#ctx.configure({device:this.#cgp.device,format:this.#cgp.presentationFormat})}this.#cgp.renderPassDescriptor={label:"preview renderpass",colorAttachments:[{view:this.#ctx.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.#cgp.canvasInfo.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}};this.#cgp.passEncoder=this.#cgp.commandEncoder.beginRenderPass(this.#cgp.renderPassDescriptor);this.#cgp.textureView=this.#ctx.getCurrentTexture().createView();this.#cgp.renderStart();e();this.#cgp.tempPrevCanvas=this.#canvas;this.#cgp.renderEnd();this.#cgp.passEncoder.end()}}class R extends p{cgpbuffer=null;bindingType="read-only-storage";constructor(e,t,i){super(e,t,i);this.cgpbuffer=i.cgpBuffer||new _(e,"temp",[0,0,0,0])}copy(){const e=new R(this.cgp,this.name,this.options);return e}getResource(e){return{buffer:this.cgpbuffer.gpuBuffer}}getLayoutEntry(e=null){let t="read-only-storage";if(this.stage&GPUShaderStage.COMPUTE)if(this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_SRC)&&this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_DST))t="storage";return{visibility:this.stage,binding:this.bindNum,buffer:{type:t}}}getShaderHeaderCode(e,t){this.cgp.profileData.count("shadercode storage",this.name);let i="";let r="read";if(this.stage&GPUShaderStage.COMPUTE)if(this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_SRC)&&this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_DST))r="read_write";else if(this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_DST))r="write";i+="@group("+t+") ";i+="@binding("+this.bindNum+") ";i+="var<storage,"+r+"> ";let s="array<f32>";i+=this.name+": "+s+";\n";return i+"\n"}}class O extends x{#isValid=true;presentationFormat=null;#pipeCfg=null;#computePipeline=null;bindGroupLayout=null;#computePassEncoder;#shaderListeners=[];#old={};#errorCount=0;lastRebuildReason="first";rebuildCount=0;profile=false;#rebuildNumBindingGroups=false;constructor(e,t){super(e,t,x.TYPE_COMPUTE)}setPipeline(e,t=null){if(!e){this.log.log("pipeline unknown shader");return}let i="";if(!this.#pipeCfg)i="no pipecfg";if(this.#old.mesh!=t)i="no mesh";if(this.#old.shader!=e){i="shader changed"}if(e.needsPipelineUpdate){i="shader needs update: "+e.needsPipelineUpdate;e.needsPipelineUpdate=""}if(this.#rebuildNumBindingGroups){i="num bindgroups wrong..."}this.pushDebug();if(i!=""){this.cgp.profileData.count("pipeline created",this.name);this.lastRebuildReason=i;this.rebuildCount++;this.cgp.pushErrorScope("createPipeline",{logger:this.log});this.#rebuildNumBindingGroups=false;this.#pipeCfg=this.getPipelineObject(e);console.log(this.#pipeCfg);this.#old.device=this.cgp.device;this.#old.shader=e;this.#old.mesh=t;this.#isValid=true;console.log(this.#pipeCfg);try{this.#computePipeline=this.cgp.device.createComputePipeline(this.#pipeCfg)}catch(e){console.error("pipe error catch...",e.message,this.#pipeCfg);this.#isValid=false}this.cgp.popErrorScope(()=>{console.log("this.#pipeCfg",this.#pipeCfg)})}if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}getPipelineObject(e){this.bindingGroupLayoutEntries=[];this.bindingGroupLayoutEntries=e.defaultBindGroup.getLayoutEntries(e);const t=[e.defaultBindGroup.getLayout(e)];const i=this.cgp.device.createPipelineLayout({label:"pipe layout "+this.name,bindGroupLayouts:t});let r={label:this.name,layout:i,compute:{module:e.gpuShaderModule,entryPoint:e.options.entryPoint||"main"}};console.log("pipecft",r,t);return r}compute(e,t=[8,8]){if(!e.gpuShaderModule)e.compile();const i=this.cgp.device.createCommandEncoder();this.#computePassEncoder=i.beginComputePass({label:"computepass "+e.getName()});this.setPipeline(e);if(!this.#computePipeline){this.log.warn("no render pipe");return}this.#computePassEncoder.setPipeline(this.#computePipeline);e.bind(this.#computePassEncoder);if(t.length==1)this.#computePassEncoder.dispatchWorkgroups(t[0]||8);else if(t.length==2)this.#computePassEncoder.dispatchWorkgroups(t[0]||8,t[1]||8);else if(t.length==3)this.#computePassEncoder.dispatchWorkgroups(t[0]||8,t[1]||8,t[2]||8);else console.log("workgroups length wrong,,,");this.#computePassEncoder.end();this.cgp.profileData.count("compute pipe",this.name);const r=i.finish();this.cgp.device.queue.submit([r]);this.pushDebug()}dispose(){}}class P{onBind=null;constructor(e,t,i){this._cgl=e;this._name=t;this._origShaders={};this._uniforms=[];this._structUniforms=[];this._definesToggled={};this._defines={};this._mods=[];this._textures=[];this._boundShader=null;this._changedDefines=true;this._changedUniforms=true;this._modulesChanged=false;this.needsTexturePush=false;this._lastShader=null;this._attributes=[];if(i&&i.opId)this.opId=i.opId}bind(e,t=true){const i=e||this._cgl.getShader();if(!i)return;this._boundShader=this._origShaders[i.id];let r=false;if(this._boundShader&&this._lastShader!=this._boundShader.shader){if(!this._boundShader.shader.hasModule(this._mods[0].id))r=true}if(r)console.warn("copy because  (missingMod)");if(!this._boundShader)console.warn("copy because  (!this._boundShader)");else if(i.lastCompile!=this._boundShader.lastCompile)console.warn("copy because  shader.lastCompile");if(this._modulesChanged)console.warn("copy because  this._modulesChanged");if(i._needsRecompile)console.warn("copy because  shader._needsRecompile ",i._compileReason);if(r||!this._boundShader||i.lastCompile!=this._boundShader.lastCompile||this._modulesChanged||i._needsRecompile){if(this._boundShader)this._boundShader.shader.dispose();if(i._needsRecompile)i.compile();this.needsTexturePush=true;this._boundShader=this._origShaders[i.id]={lastCompile:i.lastCompile,orig:i,shader:i.copy()};console.log("mod shaderrrrrrrrrrr",i.getName(),this._boundShader.shader.getName());this._addModulesToShader(this._boundShader.shader);this._updateDefinesShader(this._boundShader.shader);this._updateUniformsShader(this._boundShader.shader)}this._boundShader.wireframe=i.wireframe;if(this._changedDefines)this._updateDefines();if(this._changedUniforms)this._updateUniforms();if(t){this._cgl.pushShader(this._boundShader.shader)}if(this.needsTexturePush){for(let e=0;e<this._textures.length;e++){const s=this._textures[e][0];const n=this._textures[e][1];const a=this._textures[e][2];if(this._getUniform(s)){const o=this.getPrefixedName(s);const l=this._boundShader.shader.getUniform(o);if(l)this._boundShader.shader.pushTexture(l,n,a)}}this.needsTexturePush=false;this._textures.length=0}this._modulesChanged=false;this._boundShader.shader.fromMod=this;if(this.onBind)this.onBind(this._boundShader.shader);return this._boundShader.shader}unbind(e=true){if(this._boundShader)if(e)this._cgl.popShader();this._boundShader=null}_addModulesToShader(t){let i;if(this._mods.length>1)i=this._mods[0];for(let e=0;e<this._mods.length;e++)t.addModule(this._mods[e],i)}_removeModulesFromShader(e){for(const t in this._origShaders)this._origShaders[t].shader.removeModule(e)}addModule(e){this._mods.push(e);this._modulesChanged=true}removeModule(t){const i=[];let r=false;for(let e=0;e<this._mods.length;e++){if(this._mods[e].title==t){r=true;this._removeModulesFromShader(this._mods[e]);i.push(e)}}for(let e=i.length-1;e>=0;e-=1)this._mods.splice(i[e],1);this._modulesChanged=true}_updateUniformsShader(t){for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e];const r=this.getPrefixedName(i.name);if(!t.hasUniform(r)){console.log("shadermod uni ",r,t.id,i.stage);const s=new h(t,i.type,r,i.v1,i.v2,i.v3,i.v4);console.log(i);t.addUniform(s,i.stage)}}}_updateUniforms(){for(const e in this._origShaders)this._updateUniformsShader(this._origShaders[e].shader);this._changedUniforms=false}_setUniformValue(e,t,i){const r=e.getUniform(t);if(r)r.setValue(i)}setUniformValue(e,t){const i=this._getUniform(e);if(!i)return;const r=this.getPrefixedName(e);for(const s in this._origShaders){this._setUniformValue(this._origShaders[s].shader,r,t)}}hasUniform(e){return!!this._getUniform(e)}_getUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].name==t)return this._uniforms[e]}return null}addUniform(e,t,i,r,s,n,a){if(!this._getUniform(i)){this._uniforms.push({name:i,stage:e,type:t,v1:r,v2:s,v3:n,v4:a});this._changedUniforms=true}}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t)}pushTexture(e,t,i){if(!t)throw new Error("no texture given to texturestack");this._textures.push([e,t,i]);this.needsTexturePush=true}_removeUniformFromShader(e,t){if(t.hasUniform(e))t.removeUniform(e)}removeUniform(t){if(this._getUniform(t)){for(let e=this._uniforms.length-1;e>=0;e-=1){const i=t;if(this._uniforms[e].name==t){for(const r in this._origShaders){this._removeUniformFromShader(this.getPrefixedName(i),this._origShaders[r].shader)}this._uniforms.splice(e,1)}}this._changedUniforms=true}}getPrefixedName(e){const t=this._mods[0].group;if(t===undefined){return}if(e.startsWith("MOD_")){e=e.substr("MOD_".length);e="mod"+t+"_"+e}return e}_updateDefinesShader(t){for(const e in this._defines){const i=this.getPrefixedName(e);if(this._defines[e]!==null&&this._defines[e]!==undefined)t.define(i,this._defines[e]);else t.removeDefine(i)}for(const e in this._definesToggled){const i=this.getPrefixedName(e);t.toggleDefine(i,this._definesToggled[e])}}_updateDefines(){for(const e in this._origShaders)this._updateDefinesShader(this._origShaders[e].shader);this._changedDefines=false}define(e,t){if(t===undefined)t=true;this._defines[e]=t;this._changedDefines=true}removeDefine(e){this._defines[e]=null;this._changedDefines=true}hasDefine(e){if(this._defines[e]!==null&&this._defines[e]!==undefined)return true;return false}toggleDefine(e,t){this._changedDefines=true;this._definesToggled[e]=t}currentShader(){if(!this._boundShader)return null;return this._boundShader.shader}dispose(){}}const N={Context:S,Shader:F,Mesh:D,Texture:v,Uniform:h,MESHES:I.S,GPUBuffer:_};window.CABLES=window.CABLES||{};window.CABLES.CGP=window.CABLES.CGP||N;window.CGP=window.CGP||N;window.CGP.WebGpuCanvasAttachment=M;window.CGP.RenderPipeline=T;window.CGP.ComputePipeline=O;window.CGP.ShaderModifier=P;window.CGP.BindingStorage=R;window.CGP.BindingUniform=E;window.CGP.BindingTexture=A;window.CGP.BindingSampler=b},564:(e,t,i)=>{"use strict";var a=i(440);class r{constructor(){this.toneJsInitialized=false}createAudioContext(e){window.AudioContext=window.AudioContext||window.webkitAudioContext;if(window.AudioContext){if(!window.audioContext){window.audioContext=new AudioContext}if(window.Tone&&!this.toneJsInitialized){if(Tone.setContext)Tone.setContext(window.audioContext,true);this.toneJsInitialized=true}}else{if(e.patch.config.onError)e.logError("NO_WEBAUDIO","Web Audio is not supported in this browser.");return}return window.audioContext}_getAudioContext(){return window.audioContext}createAudioInPort(i,e,t,r){if(!i||!e||!t){const n="ERROR: createAudioInPort needs three parameters, op, portName and audioNode";i.log(n);throw new Error(n)}if(!r){r=0}i.webAudio=i.webAudio||{};i.webAudio.audioInPorts=i.webAudio.audioInPorts||[];const s=i.inObject(e);s.webAudio={};s.webAudio.previousAudioInNode=null;s.webAudio.audioNode=t;i.webAudio.audioInPorts[e]=s;s.onChange=function(){const t=s.get();if(!t){if(s.webAudio.previousAudioInNode){try{if(s.webAudio.previousAudioInNode.disconnect)s.webAudio.previousAudioInNode.disconnect(s.webAudio.audioNode,0,r);i.setUiError("audioCtx",null)}catch(t){try{s.webAudio.previousAudioInNode.disconnect(s.webAudio.audioNode)}catch(e){i.log("Disconnecting audio node with in/out port index, as well as without in/out-port-index did not work ",t);if(t.printStackTrace){t.printStackTrace()}throw t}}}}else{try{if(t.connect){t.connect(s.webAudio.audioNode,0,r);i.setUiError("audioCtx",null)}else i.setUiError("audioCtx","The passed input is not an audio context. Please make sure you connect an audio context to the input.",2)}catch(e){i.log("Error: Failed to connect web audio node!",e);i.log("port.webAudio.audioNode",s.webAudio.audioNode);i.log("audioInNode: ",t);i.log("inputChannelIndex:",r);i.log("audioInNode.connect: ",t.connect);throw e}}s.webAudio.previousAudioInNode=t};return s}createAudioOutPort(e,t,i){if(!e||!t||!i){const s="ERROR: createAudioOutPort needs three parameters, op, portName and audioNode";e.log(s);throw new Error(s)}const r=e.outObject(t);r.set(i);return r}createAudioParamInPort(r,e,t,i,s){if(!r||!e||!t){r.log("ERROR: createAudioParamInPort needs three parameters, op, portName and audioNode");if(r&&r.name)r.log("opname: ",r.name);r.log("portName",e);r.log("audioNode: ",t);return}r.webAudio=r.webAudio||{};r.webAudio.audioInPorts=r.webAudio.audioInPorts||[];const n=r.inDynamic(e,[a.a.OP.OP_PORT_TYPE_VALUE,a.a.OP.OP_PORT_TYPE_OBJECT],i,s);n.webAudio={};n.webAudio.previousAudioInNode=null;n.webAudio.audioNode=t;r.webAudio.audioInPorts[e]=n;n.onChange=()=>{const e=n.get();const t=n.webAudio.audioNode;const i=this._getAudioContext();if(e!=undefined){if(typeof e==="object"&&e.connect){try{e.connect(t)}catch(e){r.log("Could not connect audio node: ",e);if(e.printStackTrace){e.printStackTrace()}throw e}n.webAudio.previousAudioInNode=e}else{if(t._param&&t._param.minValue&&t._param.maxValue){if(e>=t._param.minValue&&e<=t._param.maxValue){try{if(t.setValueAtTime){t.setValueAtTime(e,i.currentTime)}else{t.value=e}}catch(e){r.log("Possible AudioParam problem with tone.js op: ",e);if(e.printStackTrace){e.printStackTrace()}throw e}}else{r.log("Warning: The value for an audio parameter is out of range!")}}else if(t.minValue&&t.maxValue){if(e>=t.minValue&&e<=t.maxValue){try{if(t.setValueAtTime){t.setValueAtTime(e,i.currentTime)}else{t.value=e}}catch(e){r.log("AudioParam has minValue / maxValue defined, and value is in range, but setting the value failed! ",e);if(e.printStackTrace){e.printStackTrace()}throw e}}else{r.log("Warning: The value for an audio parameter is out of range!")}}else{try{if(t.setValueAtTime){t.setValueAtTime(e,i.currentTime)}else{t.value=e}}catch(e){r.log("Possible AudioParam problem (without minValue / maxValue): ",e);if(e.printStackTrace){e.printStackTrace()}throw e}}if(n.webAudio.previousAudioInNode&&n.webAudio.previousAudioInNode.disconnect){try{n.webAudio.previousAudioInNode.disconnect(t)}catch(e){r.log("Could not disconnect previous audio node: ",e);throw e}n.webAudio.previousAudioInNode=undefined}}}else{if(n.webAudio.previousAudioInNode){}}};return n}loadAudioFile(e,t,i,r,s){const n=this.createAudioContext();if(!n)r(new Error("No Audiocontext"));let a=null;if(s||s===undefined){a=e.loading.start("audio",t);if(e.isEditorMode())gui.jobs().start({id:"loadaudio"+a,title:" loading audio ("+t+")"})}const o=new XMLHttpRequest;if(!t)return;o.open("GET",t,true);o.responseType="arraybuffer";o.onload=function(){e.loading.finished(a);if(e.isEditorMode())gui.jobs().finish("loadaudio"+a);n.decodeAudioData(o.response,i,r).catch(e=>{r(e)})};o.send()}isValidToneTime(e){try{const t=new Tone.Time(e)}catch(e){return false}return true}isValidToneNote(e){try{Tone.Frequency(e)}catch(e){return false}return true}}const s=new r;window.CABLES=window.CABLES||{};window.CABLES.WEBAUDIO=s},125:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});class n{constructor(e,t,i,r){this.targetObj=e;this.id=t;this.eventName=i;this.cb=r}remove(){this.targetObj.off(this.id)}}class r{constructor(){this._simpleIdCounter=0}uuid(){let i=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e==="x"?t:t&3|8).toString(16)})}isNumeric(e){const t=parseFloat(e);return!isNaN(t)&&isFinite(t)}simpleId(){this._simpleIdCounter++;return this._simpleIdCounter}pathLookup(e,t){const i=t.split(".");if(i.length==1){return e[i[0]]}return this.pathLookup(e[i[0]],i.slice(1).join("."))}}const a=new r;var s=i(849);class o{#eventLog=new s.A("eventtarget");#listeners={};#logEvents=false;#logName="";#eventCallbacks={};#countErrorUnknowns=0;eventsPaused=false;constructor(){}on(e,t,i=""){const r=(i||"")+a.simpleId();const s=new n(this,r,e,t);if(!this.#eventCallbacks[e])this.#eventCallbacks[e]=[s];else this.#eventCallbacks[e].push(s);this.#listeners[s.id]=s;return s}removeAllEventListeners(){for(const e in this.#listeners){this.off(this.#listeners[e])}}addEventListener(e,t,i=""){return this.on(e,t,i)}hasEventListener(e,t=null){if(e&&!t){if(typeof e=="string")return!!this.#listeners[e];else return!!this.#listeners[e.id]}else{this.#eventLog.warn("old eventtarget function haseventlistener!");if(e&&t){if(this.#eventCallbacks[e]){const i=this.#eventCallbacks[e].indexOf(t);return i!==-1}}}}hasListenerForEventName(e){return this.#eventCallbacks[e]&&this.#eventCallbacks[e].length>0}removeEventListener(e){return this.off(e)}off(e){if(e===null||e===undefined){this.#eventLog.warn("removeEventListener id null",e);return}let i=e;if(e.eventName)i=e.id;if(typeof i!="string"){console.log("old function signature: removeEventListener! use listener id");return}const r=this.#listeners[i];if(!r){if(this.#countErrorUnknowns==20)this.#eventLog.warn("stopped reporting unknown events");if(this.#countErrorUnknowns<20)this.#eventLog.warn("could not find event...",i,r);this.#countErrorUnknowns++;return}let s=0;let n=true;while(n){n=false;let t=-1;for(let e=0;e<this.#eventCallbacks[r.eventName].length;e++){if(this.#eventCallbacks[r.eventName][e].id.indexOf(i)===0){n=true;t=e}}if(t!==-1){this.#eventCallbacks[r.eventName].splice(t,1);delete this.#listeners[i];s++}}if(s==0)console.log("no events removed",r.eventName,i);return}logEvents(e,t){this.#logEvents=e;this.#logName=t}emitEvent(t,i=null,r=null,s=null,n=null,a=null,o=null,l=null,h=null){if(this.eventsPaused)return;if(this.#logEvents)this.#eventLog.log("[event] ",this.#logName,t,this.#eventCallbacks);if(this.#eventCallbacks[t]){for(let e=0;e<this.#eventCallbacks[t].length;e++){if(this.#eventCallbacks[t][e]){this.#eventCallbacks[t][e].cb(i,r,s,n,a,o,l,h)}}}else{if(this.#logEvents)this.#eventLog.log("[event] has no event callback",t,this.#eventCallbacks)}}}},849:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});class r{constructor(e,t){this.initiator=e;this._options=t;if(!this.initiator){console.error("no log initator given");CABLES.logStack()}}stack(e){console.info("["+this.initiator+"] ",e);console.log((new Error).stack)}groupCollapsed(e){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments);console.groupCollapsed("["+this.initiator+"] "+e)}table(e){console.table(e)}groupEnd(){console.groupEnd()}error(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)||!CABLES.UI){console.error("["+this.initiator+"]",...arguments)}if(this._options&&this._options.onError){this._options.onError(this.initiator,...arguments)}}errorGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)}warn(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:1},...arguments)||!CABLES.logSilent)console.warn("["+this.initiator+"]",...arguments)}verbose(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}info(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.info("["+this.initiator+"]",...arguments)}log(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}logGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)}userInteraction(e){}}}};var s={};function n(e){var t=s[e];if(t!==undefined){return t.exports}var i=s[e]={exports:{}};r[e](i,i.exports,n);return i.exports}(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();n(748);n(772);n(626);n(564);var e=n(606);var t=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var i in e)t[i]=e[i];if(e.__esModule)Object.defineProperty(t,"__esModule",{value:true})})();var CABLES=CABLES||{};CABLES.build={timestamp:1762939324787,created:"2025-11-12T09:22:04.787Z",git:{branch:"master",commit:"e3510a22f6f8dccb8f89330c372f5c0de285d823",date:"1762939264",message:"dev"}};if(!CABLES.exportedPatches)CABLES.exportedPatches={};CABLES.exportedPatches["2yD4jY"]={_id:"68dc213d565e9124a07fdb1a",ops:[{id:"5bkjiarp1",uiAttribs:{},portsIn:[{name:"Max Pixel Density (DPR)",value:2},{name:"FPS Limit",value:0},{name:"Reduce FPS unfocussed",value:0},{name:"Transparent",value:0},{name:"Active",value:1},{name:"Focus canvas",value:1}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"0jb3oy9xy",objOut:"5bkjiarp1"}]},{name:"width",value:950},{name:"height",value:525},{name:"Pixel Density",value:1.25}],objName:"Ops.Gl.MainLoop_v2"},{id:"kyl3hg7si",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Canvas"},{name:"texture width",value:950},{name:"texture height",value:525},{name:"Auto Aspect",value:1},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Depth",value:1},{name:"Clear",value:1}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"sdourssgz",objOut:"kyl3hg7si"}]},{name:"texture",links:[{portIn:"Base Texture",portOut:"texture",objIn:"kfjrbmb73",objOut:"kyl3hg7si"}]}],objName:"Ops.Gl.RenderToTexture_v3"},{id:"rm5xvgtty",uiAttribs:{},portsIn:[{name:"Scale index",value:1},{name:"Scale",value:"Fit"},{name:"Flip Y",value:0},{name:"Flip X",value:0}],objName:"Ops.Gl.Meshes.FullscreenRectangle_v2"},{id:"kfjrbmb73",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"y2xku0wjc",objOut:"kfjrbmb73"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"pwad3aosx",objOut:"kfjrbmb73"},{portIn:"Texture",portOut:"texture_out",objIn:"mf796z11m",objOut:"kfjrbmb73"},{portIn:"Texture",portOut:"texture_out",objIn:"fecu6781c",objOut:"kfjrbmb73"}]},{name:"Aspect Ratio",value:1.8095238095238095},{name:"Texture Width",value:950},{name:"Texture Height",value:525}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"0jb3oy9xy",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"Render",portOut:"trigger 0",objIn:"q6up4lfpi",objOut:"0jb3oy9xy"}]},{name:"trigger 2",links:[{portIn:"render",portOut:"trigger 2",objIn:"kyl3hg7si",objOut:"0jb3oy9xy"}]},{name:"trigger 4",links:[{portIn:"Render",portOut:"trigger 4",objIn:"kfjrbmb73",objOut:"0jb3oy9xy"}]},{name:"trigger 9",links:[{portIn:"render",portOut:"trigger 9",objIn:"fecu6781c",objOut:"0jb3oy9xy"}]},{name:"trigger 15",links:[{portIn:"render",portOut:"trigger 15",objIn:"rm5xvgtty",objOut:"0jb3oy9xy"}]}],objName:"Ops.Trigger.Sequence"},{id:"sdourssgz",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"exe",portOut:"trigger 0",objIn:"tbz237kox",objOut:"sdourssgz"}]}],objName:"Ops.Trigger.Sequence"},{id:"r66mf4762",uiAttribs:{},portsIn:[{name:"Element index",value:0},{name:"Element",value:"Canvas"}],portsOut:[{name:"Is Fullscreen",value:0},{name:"Supported",value:1}],objName:"Ops.Html.FullscreenMode"},{id:"be2u96zcu",uiAttribs:{},portsIn:[{name:"Text",value:"Start Fullscreen"},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"vcdmcth3e",objOut:"be2u96zcu"}]},{name:"Pressed Trigger",links:[{portIn:"Request Fullscreen",portOut:"Pressed Trigger",objIn:"r66mf4762",objOut:"be2u96zcu"}]}],objName:"Ops.Sidebar.Button_v2"},{id:"bje4r7a3v",uiAttribs:{},portsIn:[{name:"Visible",value:1},{name:"Opacity",value:1},{name:"Default Minimized",value:0},{name:"Minimized Opacity",value:.5},{name:"Show undo button",value:0},{name:"Show Minimize",value:0},{name:"Title",value:""},{name:"Side",value:0},{name:"Default CSS",value:1}],portsOut:[{name:"childs",title:"Children",links:[{portIn:"link",portOut:"childs",objIn:"be2u96zcu",objOut:"bje4r7a3v"}]},{name:"Opfened",value:true,title:"Opened"}],objName:"Ops.Sidebar.Sidebar"},{id:"vcdmcth3e",uiAttribs:{},portsIn:[{name:"Text",value:"End Fullscreen"},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"Pressed Trigger",links:[{portIn:"Exit Fullscreen",portOut:"Pressed Trigger",objIn:"r66mf4762",objOut:"vcdmcth3e"}]}],objName:"Ops.Sidebar.Button_v2"},{id:"od8n7mki3",uiAttribs:{},portsIn:[{name:"Num",value:5},{name:"Spacing",value:.5},{name:"Center",value:1},{name:"Axis index",value:0},{name:"Axis",value:"XY"}],objName:"Ops.Gl.Meshes.Grid"},{id:"d55dpafku",uiAttribs:{},portsIn:[{name:"r",value:1},{name:"g",value:.017822265625},{name:"b",value:.017822265625},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"uqqxfqcbb",objOut:"d55dpafku"},{portIn:"exe",portOut:"trigger",objIn:"r4yuzwgo3",objOut:"d55dpafku"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"safsbgw6e",uiAttribs:{},portsIn:[{name:"Width",value:1},{name:"Height",value:1},{name:"Thickness",value:.02},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"Draw Top",value:1},{name:"Draw Bottom",value:1},{name:"Draw Left",value:1},{name:"Draw Right",value:1},{name:"Active",value:1}],objName:"Ops.Gl.Meshes.RectangleFrame_v2"},{id:"8yk5y30xy",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"wiikdxo89",portOut:"Next",objIn:"0ti51e5mf",objOut:"8yk5y30xy"}]}],objName:"Ops.Trigger.TriggerExtender"},{id:"qg87dck1q",uiAttribs:{},portsIn:[{name:"Width",value:2},{name:"Height",value:2},{name:"Thickness",value:.02},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"Draw Top",value:1},{name:"Draw Bottom",value:1},{name:"Draw Left",value:1},{name:"Draw Right",value:1},{name:"Active",value:1}],objName:"Ops.Gl.Meshes.RectangleFrame_v2"},{id:"lgudn5er4",uiAttribs:{},portsIn:[{name:"r",value:1},{name:"g",value:.019607843137254943},{name:"b",value:.019607843137254943},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"qg87dck1q",objOut:"lgudn5er4"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"vccf5lkq5",uiAttribs:{},portsIn:[{name:"r",value:.9746666669845581},{name:"g",value:.9596391070822515},{name:"b",value:.02041661318809105},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"od8n7mki3",objOut:"vccf5lkq5"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"tk0wc1iu5",uiAttribs:{},portsIn:[{name:"Width",value:3},{name:"Height",value:2},{name:"Thickness",value:.02},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"Draw Top",value:1},{name:"Draw Bottom",value:1},{name:"Draw Left",value:1},{name:"Draw Right",value:1},{name:"Active",value:1}],objName:"Ops.Gl.Meshes.RectangleFrame_v2"},{id:"ak9pw20wg",uiAttribs:{},portsIn:[{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"tk0wc1iu5",objOut:"ak9pw20wg"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"eczt2ifsj",uiAttribs:{},portsIn:[{name:"Width",value:3.9},{name:"Height",value:2},{name:"Thickness",value:.02},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"Draw Top",value:1},{name:"Draw Bottom",value:1},{name:"Draw Left",value:1},{name:"Draw Right",value:1},{name:"Active",value:1}],objName:"Ops.Gl.Meshes.RectangleFrame_v2"},{id:"deelfg0ue",uiAttribs:{},portsIn:[{name:"r",value:.43599965413411457},{name:"g",value:.43238034989698027},{name:"b",value:.43238034989698027},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"eczt2ifsj",objOut:"deelfg0ue"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"zmh83pzqe",uiAttribs:{},portsIn:[{name:"Title",value:"Reference grids"}],objName:"Ops.Ui.Area"},{id:"7tbc5tlns",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:.75},{name:"posZ",value:0},{name:"scale",value:4},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"yx0j46gqs",objOut:"7tbc5tlns"}]}],objName:"Ops.Graphics.Transform"},{id:"gdz87bng8",uiAttribs:{},portsIn:[{name:"a",value:1},{name:"colorizeTexture",value:1},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"7tbc5tlns",objOut:"gdz87bng8"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"ky0liuq8e",uiAttribs:{},portsIn:[{name:"interval",value:950},{name:"Active",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Trigger In",portOut:"trigger",objIn:"nj72pbrj1",objOut:"ky0liuq8e"}]}],objName:"Ops.Trigger.Interval"},{id:"6vf1y7fd0",uiAttribs:{},portsIn:[{name:"Variable",value:"computetext_subjectcomplement"}],objName:"Ops.Vars.VarSetString_v2"},{id:"favjwqyrf",uiAttribs:{},portsIn:[{name:"Title",value:"Compute text"}],objName:"Ops.Ui.Area"},{id:"iyshi331b",uiAttribs:{},portsIn:[{name:"Title",value:"Full screen"}],objName:"Ops.Ui.Area"},{id:"xkr4veb1m",uiAttribs:{},portsIn:[{name:"Variable",value:"computetext_subject"}],objName:"Ops.Vars.VarSetString_v2"},{id:"kplmli3yh",uiAttribs:{},portsIn:[{name:"Variable",value:"computetext_verb"}],objName:"Ops.Vars.VarSetString_v2"},{id:"7pglnwwf3",uiAttribs:{},portsIn:[{name:"Variable",value:"computetext_subject"}],portsOut:[{name:"Value",links:[{portIn:"text",portOut:"Value",objIn:"75zw96n45",objOut:"7pglnwwf3"}]}],objName:"Ops.Vars.VarGetString"},{id:"75zw96n45",uiAttribs:{},portsIn:[{name:"Draw Mesh",value:0},{name:"Scale Mesh",value:.5},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:512},{name:"Height",value:512},{name:"Auto Height",value:1},{name:"Auto Line Breaks",value:1},{name:"font",value:"Arial"},{name:"weight",value:"normal"},{name:"fontSize",value:300},{name:"align index",value:1},{name:"align",value:"center"},{name:"Vertical align index",value:0},{name:"Vertical align",value:"Top"},{name:"Letter Spacing",value:0},{name:"Line Height Add",value:0},{name:"Padding Y Top",value:3},{name:"Padding Y Bottom",value:3},{name:"Padding X",value:0},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:2},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:0},{name:"Reuse Texture",value:1},{name:"Show Debug",value:0},{name:"Redraw On Font Load",value:1},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"Opacity",value:1},{name:"background R",value:0},{name:"background G",value:0},{name:"background B",value:0},{name:"background A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"gdz87bng8",objOut:"75zw96n45"}]},{name:"Ratio",value:.13621922160444797},{name:"texture",links:[{portIn:"texture",portOut:"texture",objIn:"gdz87bng8",objOut:"75zw96n45"}]},{name:"Aspect",links:[{portIn:"Number",portOut:"Aspect",objIn:"qpluu25w3",objOut:"75zw96n45"},{portIn:"number2",portOut:"Aspect",objIn:"em6oe8ze6",objOut:"75zw96n45"}]},{name:"Num Lines",value:1}],objName:"Ops.Gl.Textures.TextTexture_v6"},{id:"yx0j46gqs",uiAttribs:{},portsIn:[{name:"render",title:"Trigger"},{name:"Render Mesh",value:1,title:"Render"},{name:"width",value:1},{name:"pivot x index",value:1},{name:"pivot x",value:"center"},{name:"pivot y index",value:1},{name:"pivot y",value:"center"},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Flip TexCoord X",value:0},{name:"Flip TexCoord Y",value:1},{name:"num columns",value:1},{name:"num rows",value:1}],objName:"Ops.Graphics.Meshes.Rectangle_v4"},{id:"co57fttqd",uiAttribs:{},portsOut:[{name:"trigger 2",links:[{portIn:"Execute",portOut:"trigger 2",objIn:"nk5ng6ydf",objOut:"co57fttqd"}]},{name:"trigger 3",links:[{portIn:"Execute",portOut:"trigger 3",objIn:"cuw4r08ub",objOut:"co57fttqd"}]},{name:"trigger 4",links:[{portIn:"Execute",portOut:"trigger 4",objIn:"8v145wsu9",objOut:"co57fttqd"}]}],objName:"Ops.Gl.LayerSequence"},{id:"nk5ng6ydf",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"75zw96n45",objOut:"nk5ng6ydf"},{portIn:"render",portOut:"Next",objIn:"vx1s7hy4s",objOut:"nk5ng6ydf"}]}],objName:"Ops.Trigger.TriggerExtender"},{id:"qpluu25w3",uiAttribs:{},portsOut:[{name:"Result",value:7.341107871720117}],objName:"Ops.Ui.VizNumber"},{id:"em6oe8ze6",uiAttribs:{},portsIn:[{name:"number1",value:1}],portsOut:[{name:"result",links:[{portIn:"height",portOut:"result",objIn:"yx0j46gqs",objOut:"em6oe8ze6"},{portIn:"Height",portOut:"result",objIn:"ywmevzxtj",objOut:"em6oe8ze6"}]}],objName:"Ops.Math.Divide"},{id:"ywmevzxtj",uiAttribs:{},portsIn:[{name:"Width",value:1},{name:"Thickness",value:.002},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"Draw Top",value:1},{name:"Draw Bottom",value:1},{name:"Draw Left",value:1},{name:"Draw Right",value:1},{name:"Active",value:1}],objName:"Ops.Gl.Meshes.RectangleFrame_v2"},{id:"vx1s7hy4s",uiAttribs:{},portsIn:[{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"dqxqqb9d4",objOut:"vx1s7hy4s"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"dqxqqb9d4",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:.75},{name:"posZ",value:0},{name:"scale",value:4},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"ywmevzxtj",objOut:"dqxqqb9d4"}]}],objName:"Ops.Graphics.Transform"},{id:"nqd5jsmf7",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:-.75},{name:"posZ",value:0},{name:"scale",value:4},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"ybxdxms6q",objOut:"nqd5jsmf7"}]}],objName:"Ops.Graphics.Transform"},{id:"47bsq3crs",uiAttribs:{},portsIn:[{name:"a",value:1},{name:"colorizeTexture",value:1},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:3},{name:"Alpha Mask Source",value:"B"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"nqd5jsmf7",objOut:"47bsq3crs"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"z0h2g2luz",uiAttribs:{},portsIn:[{name:"Draw Mesh",value:0},{name:"Scale Mesh",value:.5},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:512},{name:"Height",value:512},{name:"Auto Height",value:1},{name:"Auto Line Breaks",value:1},{name:"font",value:"Arial"},{name:"weight",value:"normal"},{name:"fontSize",value:300},{name:"align index",value:1},{name:"align",value:"center"},{name:"Vertical align index",value:0},{name:"Vertical align",value:"Top"},{name:"Letter Spacing",value:0},{name:"Line Height Add",value:0},{name:"Padding Y Top",value:3},{name:"Padding Y Bottom",value:3},{name:"Padding X",value:0},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:2},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:0},{name:"Reuse Texture",value:1},{name:"Show Debug",value:0},{name:"Redraw On Font Load",value:1},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"Opacity",value:1},{name:"background R",value:0},{name:"background G",value:0},{name:"background B",value:0},{name:"background A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"47bsq3crs",objOut:"z0h2g2luz"}]},{name:"Ratio",value:.20991432068543453},{name:"texture",links:[{portIn:"texture",portOut:"texture",objIn:"47bsq3crs",objOut:"z0h2g2luz"}]},{name:"Aspect",links:[{portIn:"Number",portOut:"Aspect",objIn:"41t5pbeg0",objOut:"z0h2g2luz"},{portIn:"number2",portOut:"Aspect",objIn:"lljybh33y",objOut:"z0h2g2luz"}]},{name:"Num Lines",value:1}],objName:"Ops.Gl.Textures.TextTexture_v6"},{id:"ybxdxms6q",uiAttribs:{},portsIn:[{name:"render",title:"Trigger"},{name:"Render Mesh",value:1,title:"Render"},{name:"width",value:1},{name:"pivot x index",value:1},{name:"pivot x",value:"center"},{name:"pivot y index",value:1},{name:"pivot y",value:"center"},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Flip TexCoord X",value:0},{name:"Flip TexCoord Y",value:1},{name:"num columns",value:1},{name:"num rows",value:1}],objName:"Ops.Graphics.Meshes.Rectangle_v4"},{id:"8v145wsu9",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"z0h2g2luz",objOut:"8v145wsu9"},{portIn:"render",portOut:"Next",objIn:"vtoxdwmql",objOut:"8v145wsu9"}]}],objName:"Ops.Trigger.TriggerExtender"},{id:"41t5pbeg0",uiAttribs:{},portsOut:[{name:"Result",value:4.763848396501458}],objName:"Ops.Ui.VizNumber"},{id:"lljybh33y",uiAttribs:{},portsIn:[{name:"number1",value:1}],portsOut:[{name:"result",links:[{portIn:"height",portOut:"result",objIn:"ybxdxms6q",objOut:"lljybh33y"},{portIn:"Height",portOut:"result",objIn:"0apvkngqt",objOut:"lljybh33y"}]}],objName:"Ops.Math.Divide"},{id:"0apvkngqt",uiAttribs:{},portsIn:[{name:"Width",value:1},{name:"Thickness",value:.002},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"Draw Top",value:1},{name:"Draw Bottom",value:1},{name:"Draw Left",value:1},{name:"Draw Right",value:1},{name:"Active",value:1}],objName:"Ops.Gl.Meshes.RectangleFrame_v2"},{id:"vtoxdwmql",uiAttribs:{},portsIn:[{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"khzhtnn4g",objOut:"vtoxdwmql"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"khzhtnn4g",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:-.75},{name:"posZ",value:0},{name:"scale",value:4},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"0apvkngqt",objOut:"khzhtnn4g"}]}],objName:"Ops.Graphics.Transform"},{id:"givinf39d",uiAttribs:{},portsIn:[{name:"Variable",value:"computetext_subjectcomplement"}],portsOut:[{name:"Value",links:[{portIn:"text",portOut:"Value",objIn:"z0h2g2luz",objOut:"givinf39d"}]}],objName:"Ops.Vars.VarGetString"},{id:"id6wz2u23",uiAttribs:{},portsIn:[{name:"Size index",value:1},{name:"Size",value:"Manual"},{name:"filter index",value:0},{name:"filter",value:"nearest"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Texture",links:[{portIn:"Texture In",portOut:"Texture",objIn:"v779pcm94",objOut:"id6wz2u23"},{portIn:"Texture",portOut:"Texture",objIn:"rm5xvgtty",objOut:"id6wz2u23"}]}],objName:"Ops.Gl.Shader.ShaderToTexture_v2"},{id:"pbj5lmehw",uiAttribs:{},portsIn:[{name:"Fragment Code",value:"\nIN vec2 texCoord;\nIN vec4 col;\n\n{{MODULES_HEAD}}\n\nUNI vec2 uResolution;\nUNI sampler2D uTexture;\n\nfloat character(int n, vec2 p) {\n    p = floor(p * vec2(-4.0f, 4.0f) + 2.5f);\n    if(clamp(p.x, 0.0f, 4.0f) == p.x) {\n        if(clamp(p.y, 0.0f, 4.0f) == p.y) {\n        int a = int(round(p.x) + 5.0f * round(p.y));\n        if(((n >> a) & 1) == 1)\n            return 1.0f;\n        }\n    }\n    return 0.0f;\n}\n\nvoid main() {\n    vec2 pix = gl_FragCoord.xy;\n    vec3 col = texture(uTexture, floor(pix / 16.0f) * 16.0f / uResolution.xy).rgb;\n\n    float gray = 0.3f * col.r + 0.59f * col.g + 0.11f * col.b;\n\n    int n = 4096;\n\n    if (gray > 0.0233) n = 4096;\n    if (gray > 0.0465) n = 131200;\n    if (gray > 0.0698) n = 4329476;\n    if (gray > 0.0930) n = 459200;\n    if (gray > 0.1163) n = 4591748;\n    if (gray > 0.1395) n = 12652620;\n    if (gray > 0.1628) n = 14749828;\n    if (gray > 0.1860) n = 18393220;\n    if (gray > 0.2093) n = 15239300;\n    if (gray > 0.2326) n = 17318431;\n    if (gray > 0.2558) n = 32641156;\n    if (gray > 0.2791) n = 18393412;\n    if (gray > 0.3023) n = 18157905;\n    if (gray > 0.3256) n = 17463428;\n    if (gray > 0.3488) n = 14954572;\n    if (gray > 0.3721) n = 13177118;\n    if (gray > 0.3953) n = 6566222;\n    if (gray > 0.4186) n = 16269839;\n    if (gray > 0.4419) n = 18444881;\n    if (gray > 0.4651) n = 18400814;\n    if (gray > 0.4884) n = 33061392;\n    if (gray > 0.5116) n = 15255086;\n    if (gray > 0.5349) n = 32045584;\n    if (gray > 0.5581) n = 18405034;\n    if (gray > 0.5814) n = 15022158;\n    if (gray > 0.6047) n = 15018318;\n    if (gray > 0.6279) n = 16272942;\n    if (gray > 0.6512) n = 18415153;\n    if (gray > 0.6744) n = 32641183;\n    if (gray > 0.6977) n = 32540207;\n    if (gray > 0.7209) n = 18732593;\n    if (gray > 0.7442) n = 18667121;\n    if (gray > 0.7674) n = 16267326;\n    if (gray > 0.7907) n = 32575775;\n    if (gray > 0.8140) n = 15022414;\n    if (gray > 0.8372) n = 15255537;\n    if (gray > 0.8605) n = 32032318;\n    if (gray > 0.8837) n = 32045617;\n    if (gray > 0.9070) n = 33081316;\n    if (gray > 0.9302) n = 32045630;\n    if (gray > 0.9535) n = 33061407;\n    if (gray > 0.9767) n = 11512810;\n\n    vec2 p = mod(pix / 8.0f, 2.0f) - vec2(1.0f);\n    col = col * character(n, p);\n    {{MODULE_COLOR}}\n    outColor = vec4(col, 1.0f);\n}"},{name:"Vertex Code",value:"\n{{MODULES_HEAD}}\nIN vec3 vPosition; //!@\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    mat4 modelViewMatrix=viewMatrix*mMatrix;\n    {{MODULE_VERTEX_MODELVIEW}}\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n"},{name:"Use As Material",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"id6wz2u23",objOut:"pbj5lmehw"}]},{name:"Shader",links:[{portIn:"Shader",portOut:"Shader",objIn:"id6wz2u23",objOut:"pbj5lmehw"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"pwad3aosx",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"v779pcm94",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"ub3l6w60s",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"width",portOut:"result",objIn:"fecu6781c",objOut:"ub3l6w60s"},{portIn:"uResolution X",portOut:"result",objIn:"pbj5lmehw",objOut:"ub3l6w60s"},{portIn:"Width",portOut:"result",objIn:"id6wz2u23",objOut:"ub3l6w60s"}]}],objName:"Ops.Math.Multiply"},{id:"a8fv55t1j",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"height",portOut:"result",objIn:"fecu6781c",objOut:"a8fv55t1j"},{portIn:"uResolution Y",portOut:"result",objIn:"pbj5lmehw",objOut:"a8fv55t1j"},{portIn:"Height",portOut:"result",objIn:"id6wz2u23",objOut:"a8fv55t1j"}]}],objName:"Ops.Math.Multiply"},{id:"fecu6781c",uiAttribs:{},portsIn:[{name:"use original size",value:0},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"A"},{name:"Convert Greyscale index",value:0},{name:"Convert Greyscale",value:"Off"},{name:"Invert R",value:0},{name:"Invert G",value:0},{name:"Invert B",value:0},{name:"Invert A",value:0},{name:"Flip X",value:0},{name:"Flip Y",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"pbj5lmehw",objOut:"fecu6781c"}]},{name:"texture_out",links:[{portIn:"uTexture",portOut:"texture_out",objIn:"pbj5lmehw",objOut:"fecu6781c"}]},{name:"Aspect Ratio",value:1.8683473389355743}],objName:"Ops.Gl.Textures.CopyTexture_v3"},{id:"mf796z11m",uiAttribs:{},portsOut:[{name:"Name",value:"image_compose_v2_kfjrbmb73"},{name:"PixelFormat",value:"RGBA 8bit ubyte"},{name:"Width",links:[{portIn:"number1",portOut:"Width",objIn:"ub3l6w60s",objOut:"mf796z11m"}]},{name:"Height",links:[{portIn:"number1",portOut:"Height",objIn:"a8fv55t1j",objOut:"mf796z11m"}]},{name:"Ratio",value:1.8095238095238095},{name:"Filter",value:"1 linear"},{name:"Wrap",value:"0 repeat"},{name:"Flipped",value:0},{name:"HDR",value:0,title:"Float Texture"},{name:"Is Empty Default Texture",value:0},{name:"Is Default Texture",value:0},{name:"Is Cubemap",value:0},{name:"Id",value:"5f6576e8-56fe-461f-98ad-4b142650cad3"}],objName:"Ops.Gl.Textures.TextureInfo_v2"},{id:"lim3bk3k7",uiAttribs:{},portsIn:[{name:"Title",value:"Main rendering loop"}],objName:"Ops.Ui.Area"},{id:"0ar4isehh",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"ip34w2ny0",title:"Index"},{name:"wiikdxo89",title:"exe"},{name:"s0ddunhhz",value:1,title:"Duration"},{name:"patchId",value:"bp2sub_0ar4isehh"}],portsOut:[{name:"4gu5lv66h",value:.9650119182615063,title:"Out Value"},{name:"qutsn94pc",title:"Trigger 0",links:[{portIn:"render",portOut:"qutsn94pc",objIn:"vicix6gwk",objOut:"0ar4isehh"}]},{name:"8xpkgorjm",title:"Trigger 1",links:[{portIn:"exe",portOut:"8xpkgorjm",objIn:"2fsfct1u2",objOut:"0ar4isehh"}]},{name:"hvyzlh9o8",title:"Trigger 2",links:[{portIn:"render",portOut:"hvyzlh9o8",objIn:"tzuvspw73",objOut:"0ar4isehh"}]},{name:"367wv95xd",title:"Trigger 3",links:[{portIn:"render",portOut:"367wv95xd",objIn:"aikdealwl",objOut:"0ar4isehh"}]},{name:"7ju3j2fy0",title:"Trigger 4",links:[{portIn:"render",portOut:"7ju3j2fy0",objIn:"bb1ix3hcd",objOut:"0ar4isehh"}]}],objName:"Ops.Trigger.RouteTriggerAnimated"},{id:"vicix6gwk",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:18},{name:"Blend Mode",value:"Math Add"},{name:"Amount",value:1},{name:"Pixel",value:15},{name:"Smooth",value:1}],objName:"Ops.Gl.ImageCompose.ChromaticAberration_v2"},{id:"gd67pix9p",uiAttribs:{},portsIn:[{name:"Amount",value:1},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"frequency",value:1},{name:"strength",value:1},{name:"Block size small x",value:15},{name:"Block size small y",value:10},{name:"Block size large x",value:7},{name:"Block size large y",value:5},{name:"Scroll X",value:0},{name:"Scroll Y",value:0}],objName:"Ops.Gl.ImageCompose.Noise.GlitchNoise_v2"},{id:"q6up4lfpi",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:360},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"gd67pix9p",objOut:"q6up4lfpi"},{portIn:"exe",portOut:"Next",objIn:"2xry3yd9a",objOut:"q6up4lfpi"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"swxuvkth0",objOut:"q6up4lfpi"},{portIn:"Value",portOut:"texture_out",objIn:"pna3dz40m",objOut:"q6up4lfpi"}]},{name:"Aspect Ratio",value:1.8095238095238095},{name:"Texture Width",value:950},{name:"Texture Height",value:525}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"swxuvkth0",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"tzuvspw73",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:5},{name:"Blend Mode",value:"average"},{name:"Amount",value:1},{name:"amount X",value:0},{name:"amount Y",value:1},{name:"Wrap index",value:2},{name:"Wrap",value:"Repeat"},{name:"Input index",value:0},{name:"Input",value:"Luminance"},{name:"Zero Displace index",value:0},{name:"Zero Displace",value:"Grey"},{name:"Pixel Mapping index",value:0},{name:"Pixel Mapping",value:"Stretch"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"stmc66g81",objOut:"tzuvspw73"}]}],objName:"Ops.Gl.ImageCompose.PixelDisplacement_v4"},{id:"stmc66g81",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Pixel",value:59.5},{name:"Lens Distort",value:0},{name:"Smooth",value:0}],objName:"Ops.Gl.ImageCompose.ChromaticAberration_v2"},{id:"aikdealwl",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:20},{name:"Blend Mode",value:"Math Multiply"},{name:"Amount",value:1},{name:"Pixel",value:8},{name:"Lens Distort",value:.25},{name:"Smooth",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"gjym3u1yv",objOut:"aikdealwl"}]}],objName:"Ops.Gl.ImageCompose.ChromaticAberration_v2"},{id:"bb1ix3hcd",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:1},{name:"Blend Mode",value:"lighten"},{name:"Amount",value:1},{name:"amount X",value:0},{name:"amount Y",value:1},{name:"Wrap index",value:2},{name:"Wrap",value:"Repeat"},{name:"Input index",value:0},{name:"Input",value:"Luminance"},{name:"Zero Displace index",value:0},{name:"Zero Displace",value:"Grey"},{name:"Pixel Mapping index",value:0},{name:"Pixel Mapping",value:"Stretch"}],objName:"Ops.Gl.ImageCompose.PixelDisplacement_v4"},{id:"1cxwjjw1x",uiAttribs:{},portsIn:[{name:"Variable",value:"computetext_verb"}],portsOut:[{name:"Value",links:[{portIn:"text",portOut:"Value",objIn:"fcoybrqit",objOut:"1cxwjjw1x"}]}],objName:"Ops.Vars.VarGetString"},{id:"95mf5boy6",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:0},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"kxaiutg8o",objOut:"95mf5boy6"}]}],objName:"Ops.Graphics.Transform"},{id:"3q8sdmcr8",uiAttribs:{},portsIn:[{name:"a",value:1},{name:"colorizeTexture",value:1},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:3},{name:"Alpha Mask Source",value:"B"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"95mf5boy6",objOut:"3q8sdmcr8"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"fcoybrqit",uiAttribs:{},portsIn:[{name:"Draw Mesh",value:0},{name:"Scale Mesh",value:.5},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:512},{name:"Height",value:512},{name:"Auto Height",value:1},{name:"Auto Line Breaks",value:1},{name:"font",value:"Arial"},{name:"weight",value:"normal"},{name:"fontSize",value:300},{name:"align index",value:1},{name:"align",value:"center"},{name:"Vertical align index",value:0},{name:"Vertical align",value:"Top"},{name:"Letter Spacing",value:0},{name:"Line Height Add",value:0},{name:"Padding Y Top",value:3},{name:"Padding Y Bottom",value:3},{name:"Padding X",value:0},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:2},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:0},{name:"Reuse Texture",value:1},{name:"Show Debug",value:0},{name:"Redraw On Font Load",value:1},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"Opacity",value:1},{name:"background R",value:0},{name:"background G",value:0},{name:"background B",value:0},{name:"background A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"3q8sdmcr8",objOut:"fcoybrqit"}]},{name:"Ratio",value:.15946071594607159},{name:"texture",links:[{portIn:"texture",portOut:"texture",objIn:"3q8sdmcr8",objOut:"fcoybrqit"}]},{name:"Aspect",links:[{portIn:"Number",portOut:"Aspect",objIn:"k05sxjb59",objOut:"fcoybrqit"},{portIn:"number2",portOut:"Aspect",objIn:"h2qxj1zr6",objOut:"fcoybrqit"},{portIn:"value",portOut:"Aspect",objIn:"ucqy77n96",objOut:"fcoybrqit"}]},{name:"Num Lines",value:1}],objName:"Ops.Gl.Textures.TextTexture_v6"},{id:"kxaiutg8o",uiAttribs:{},portsIn:[{name:"render",title:"Trigger"},{name:"Render Mesh",value:1,title:"Render"},{name:"width",value:1},{name:"pivot x index",value:1},{name:"pivot x",value:"center"},{name:"pivot y index",value:1},{name:"pivot y",value:"center"},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Flip TexCoord X",value:0},{name:"Flip TexCoord Y",value:1},{name:"num columns",value:1},{name:"num rows",value:1}],objName:"Ops.Graphics.Meshes.Rectangle_v4"},{id:"cuw4r08ub",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"fcoybrqit",objOut:"cuw4r08ub"},{portIn:"render",portOut:"Next",objIn:"2rx19o54s",objOut:"cuw4r08ub"}]}],objName:"Ops.Trigger.TriggerExtender"},{id:"k05sxjb59",uiAttribs:{},portsOut:[{name:"Result",value:6.271137026239067}],objName:"Ops.Ui.VizNumber"},{id:"hrrw314kf",uiAttribs:{},portsIn:[{name:"Width",value:1},{name:"Thickness",value:.002},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"Draw Top",value:1},{name:"Draw Bottom",value:1},{name:"Draw Left",value:1},{name:"Draw Right",value:1},{name:"Active",value:1}],objName:"Ops.Gl.Meshes.RectangleFrame_v2"},{id:"2rx19o54s",uiAttribs:{},portsIn:[{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"xvin4k6xp",objOut:"2rx19o54s"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"xvin4k6xp",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:0},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"hrrw314kf",objOut:"xvin4k6xp"}]}],objName:"Ops.Graphics.Transform"},{id:"h2qxj1zr6",uiAttribs:{},portsIn:[{name:"number1",value:1}],portsOut:[{name:"result",links:[{portIn:"Height",portOut:"result",objIn:"hrrw314kf",objOut:"h2qxj1zr6"},{portIn:"height",portOut:"result",objIn:"kxaiutg8o",objOut:"h2qxj1zr6"}]}],objName:"Ops.Math.Divide"},{id:"ucqy77n96",uiAttribs:{},portsIn:[{name:"old min",value:0},{name:"old max",value:9},{name:"new min",value:1},{name:"new max",value:4},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"scale",portOut:"result",objIn:"xvin4k6xp",objOut:"ucqy77n96"},{portIn:"scale",portOut:"result",objIn:"95mf5boy6",objOut:"ucqy77n96"}]}],objName:"Ops.Math.MapRange"},{id:"oq7i702ki",uiAttribs:{},portsIn:[{name:"Title",value:"Render glitch texture"}],objName:"Ops.Ui.Area"},{id:"pna3dz40m",uiAttribs:{},portsIn:[{name:"Variable",value:"var_texture_glitch"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"uc7jy5pqa",uiAttribs:{},portsIn:[{name:"Variable",value:"var_texture_glitch"}],portsOut:[{name:"Value",links:[{portIn:"displaceTex",portOut:"Value",objIn:"bb1ix3hcd",objOut:"uc7jy5pqa"},{portIn:"Mask",portOut:"Value",objIn:"aikdealwl",objOut:"uc7jy5pqa"},{portIn:"displaceTex",portOut:"Value",objIn:"tzuvspw73",objOut:"uc7jy5pqa"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"2xry3yd9a",uiAttribs:{},portsIn:[{name:"min",value:0},{name:"max",value:6},{name:"duration",value:3},{name:"pause between",value:1.25},{name:"easing index",value:0},{name:"easing",value:"linear"}],portsOut:[{name:"result",links:[{portIn:"Seed",portOut:"result",objIn:"gd67pix9p",objOut:"2xry3yd9a"}]}],objName:"Ops.Anim.RandomAnim_v2"},{id:"8sv97iwsd",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:6},{name:"Blend Mode",value:"add"},{name:"Amount",value:2},{name:"Pixel",value:9},{name:"Lens Distort",value:.766},{name:"Smooth",value:0}],objName:"Ops.Gl.ImageCompose.ChromaticAberration_v2"},{id:"0nz57rc0n",uiAttribs:{},portsIn:[{name:"Mode index",value:0},{name:"Mode",value:"Sine"},{name:"phase",value:0},{name:"frequency",value:.1},{name:"amplitude",value:1}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"bjbx1oclc",objOut:"0nz57rc0n"}]}],objName:"Ops.Anim.SineAnim"},{id:"bjbx1oclc",uiAttribs:{},portsIn:[{name:"old min",value:-1},{name:"old max",value:1},{name:"new min",value:0},{name:"new max",value:1},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"Lens Distort",portOut:"result",objIn:"vicix6gwk",objOut:"bjbx1oclc"}]}],objName:"Ops.Math.MapRange"},{id:"2fsfct1u2",uiAttribs:{},portsIn:[{name:"min",value:0},{name:"max",value:6},{name:"duration",value:4},{name:"pause between",value:1.25},{name:"easing index",value:0},{name:"easing",value:"linear"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"g4mv32wzz",objOut:"2fsfct1u2"}]},{name:"result",links:[{portIn:"Seed",portOut:"result",objIn:"g4mv32wzz",objOut:"2fsfct1u2"}]}],objName:"Ops.Anim.RandomAnim_v2"},{id:"g4mv32wzz",uiAttribs:{},portsIn:[{name:"Amount",value:1},{name:"Blend Mode index",value:18},{name:"Blend Mode",value:"Math Add"},{name:"Alpha Mask index",value:1},{name:"Alpha Mask",value:"On"},{name:"frequency",value:1},{name:"strength",value:1},{name:"Block size small x",value:7},{name:"Block size small y",value:13},{name:"Block size large x",value:5},{name:"Block size large y",value:7},{name:"Scroll X",value:0},{name:"Scroll Y",value:0}],objName:"Ops.Gl.ImageCompose.Noise.GlitchNoise_v2"},{id:"y2xku0wjc",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"exe",portOut:"Next",objIn:"0nz57rc0n",objOut:"y2xku0wjc"},{portIn:"wiikdxo89",portOut:"Next",objIn:"0ar4isehh",objOut:"y2xku0wjc"}]}],objName:"Ops.Trigger.TriggerExtender"},{id:"gjym3u1yv",uiAttribs:{},portsIn:[{name:"amount",value:.5},{name:"Lumi Scale",value:1},{name:"X or Y",value:0},{name:"Line Size",value:30},{name:"Displacement",value:.04},{name:"Add",value:.03}],objName:"Ops.Gl.ImageCompose.Interlace"},{id:"zz3jby7lu",uiAttribs:{},portsIn:[{name:"Limit",value:0},{name:"Length",value:10},{name:"Mode index",value:0},{name:"Mode",value:"Rewind"},{name:"Default",value:0}],portsOut:[{name:"Value",links:[{portIn:"scroll",portOut:"Value",objIn:"gjym3u1yv",objOut:"zz3jby7lu"}]}],objName:"Ops.Math.Incrementor"},{id:"xvctunrug",uiAttribs:{},portsIn:[{name:"interval",value:60},{name:"Active",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Increment",portOut:"trigger",objIn:"zz3jby7lu",objOut:"xvctunrug"}]}],objName:"Ops.Trigger.Interval"},{id:"0pumt8ww2",uiAttribs:{},portsIn:[{name:"min",value:0},{name:"max",value:4},{name:"Integer",value:1},{name:"No consecutive duplicates",value:1}],portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"k6klzr81f",objOut:"0pumt8ww2"},{portIn:"ip34w2ny0",portOut:"result",objIn:"0ar4isehh",objOut:"0pumt8ww2"}]}],objName:"Ops.Math.TriggerRandomNumber_v3"},{id:"3ubm8ccx0",uiAttribs:{},portsIn:[{name:"interval",value:1250},{name:"Active",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Generate",portOut:"trigger",objIn:"0pumt8ww2",objOut:"3ubm8ccx0"}]}],objName:"Ops.Trigger.Interval"},{id:"k6klzr81f",uiAttribs:{},portsOut:[{name:"Result",value:3}],objName:"Ops.Ui.VizNumber"},{id:"lv78wguig",uiAttribs:{},portsIn:[{name:"Title",value:"Post processing effects"}],objName:"Ops.Ui.Area"},{id:"tbz237kox",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"exe",portOut:"trigger 0",objIn:"co57fttqd",objOut:"tbz237kox"}]},{name:"trigger 2",links:[{portIn:"Execute",portOut:"trigger 2",objIn:"8yk5y30xy",objOut:"tbz237kox"}]}],objName:"Ops.Gl.LayerSequence"},{id:"0ti51e5mf",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"ip34w2ny0",title:"Index"},{name:"wiikdxo89",title:"exe"},{name:"s0ddunhhz",value:1,title:"Duration"},{name:"patchId",value:"bp2sub_0ti51e5mf"}],portsOut:[{name:"4gu5lv66h",value:1,title:"Out Value"},{name:"qutsn94pc",title:"Trigger 0",links:[{portIn:"render",portOut:"qutsn94pc",objIn:"vccf5lkq5",objOut:"0ti51e5mf"}]},{name:"8xpkgorjm",title:"Trigger 1",links:[{portIn:"render",portOut:"8xpkgorjm",objIn:"d55dpafku",objOut:"0ti51e5mf"}]},{name:"hvyzlh9o8",title:"Trigger 2",links:[{portIn:"render",portOut:"hvyzlh9o8",objIn:"lgudn5er4",objOut:"0ti51e5mf"}]},{name:"367wv95xd",title:"Trigger 3",links:[{portIn:"render",portOut:"367wv95xd",objIn:"ak9pw20wg",objOut:"0ti51e5mf"}]},{name:"7ju3j2fy0",title:"Trigger 4",links:[{portIn:"render",portOut:"7ju3j2fy0",objIn:"deelfg0ue",objOut:"0ti51e5mf"}]},{name:"t8dvyjuoq",title:"Trigger 5",links:[{portIn:"render",portOut:"t8dvyjuoq",objIn:"onrso8tno",objOut:"0ti51e5mf"}]},{name:"72naih78e",title:"Trigger 6",links:[{portIn:"render",portOut:"72naih78e",objIn:"dd2vz0n1a",objOut:"0ti51e5mf"}]},{name:"0s04tm21u",title:"Trigger 7",links:[{portIn:"render",portOut:"0s04tm21u",objIn:"ee6dp0jj1",objOut:"0ti51e5mf"}]},{name:"93jpxulns",title:"Trigger 8",links:[{portIn:"render",portOut:"93jpxulns",objIn:"uxb68ef37",objOut:"0ti51e5mf"}]}],objName:"Ops.Trigger.RouteTriggerAnimated"},{id:"0t4tu0hh2",uiAttribs:{},portsIn:[{name:"min",value:0},{name:"max",value:8},{name:"Integer",value:1},{name:"No consecutive duplicates",value:1}],portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"pw5f80u2c",objOut:"0t4tu0hh2"},{portIn:"ip34w2ny0",portOut:"result",objIn:"0ti51e5mf",objOut:"0t4tu0hh2"}]}],objName:"Ops.Math.TriggerRandomNumber_v3"},{id:"wcn5662h1",uiAttribs:{},portsIn:[{name:"interval",value:2100},{name:"Active",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Generate",portOut:"trigger",objIn:"0t4tu0hh2",objOut:"wcn5662h1"}]}],objName:"Ops.Trigger.Interval"},{id:"pw5f80u2c",uiAttribs:{},portsOut:[{name:"Result",value:0}],objName:"Ops.Ui.VizNumber"},{id:"zhuvbb4pw",uiAttribs:{},portsIn:[{name:"value",value:2}],portsOut:[{name:"result",links:[{portIn:"number2",portOut:"result",objIn:"a8fv55t1j",objOut:"zhuvbb4pw"},{portIn:"number2",portOut:"result",objIn:"ub3l6w60s",objOut:"zhuvbb4pw"}]}],objName:"Ops.Number.Number"},{id:"j146vevzi",uiAttribs:{},portsOut:[{name:"Subject Out",value:""},{name:"Verb Out",value:""},{name:"SubjectComplement Out",value:""}],objName:"Ops.Patch.P2yD4jY.TargetArchitectureIs.ComputeText"},{id:"nj72pbrj1",uiAttribs:{},portsOut:[{name:"Subject Out",links:[{portIn:"Value",portOut:"Subject Out",objIn:"xkr4veb1m",objOut:"nj72pbrj1"}]},{name:"Verb Out",links:[{portIn:"Value",portOut:"Verb Out",objIn:"kplmli3yh",objOut:"nj72pbrj1"}]},{name:"SubjectComplement Out",links:[{portIn:"Value",portOut:"SubjectComplement Out",objIn:"6vf1y7fd0",objOut:"nj72pbrj1"}]}],objName:"Ops.Patch.P2yD4jY.TargetArchitectureIs.ComputeText"},{id:"seh5fkhje",uiAttribs:{},portsIn:[{name:"Speed",value:.1},{name:"Play",value:1},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",value:182.7315899999969}],objName:"Ops.Anim.Timer_v2"},{id:"llaj77s17",uiAttribs:{},portsIn:[{name:"min",value:0},{name:"max",value:100},{name:"Integer",value:1},{name:"No consecutive duplicates",value:1}],portsOut:[{name:"result",links:[{portIn:"Index",portOut:"result",objIn:"a1l6hvwn7",objOut:"llaj77s17"}]}],objName:"Ops.Math.TriggerRandomNumber_v3"},{id:"shu8tdq9t",uiAttribs:{},portsIn:[{name:"interval",value:1900},{name:"Active",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Generate",portOut:"trigger",objIn:"llaj77s17",objOut:"shu8tdq9t"}]}],objName:"Ops.Trigger.Interval"},{id:"a1l6hvwn7",uiAttribs:{},portsIn:[{name:"Smooth",value:0}],portsOut:[{name:"Color Array",links:[{portIn:"Array",portOut:"Color Array",objIn:"2dtdzovd0",objOut:"a1l6hvwn7"},{portIn:"Array",portOut:"Color Array",objIn:"nru47jkev",objOut:"a1l6hvwn7"},{portIn:"Array",portOut:"Color Array",objIn:"mdmrx5yu7",objOut:"a1l6hvwn7"}]}],objName:"Ops.Color.ColorPalettes"},{id:"2dtdzovd0",uiAttribs:{},portsIn:[{name:"Index",value:1}],portsOut:[{name:"X",links:[{portIn:"r",portOut:"X",objIn:"vx1s7hy4s",objOut:"2dtdzovd0"},{portIn:"r",portOut:"X",objIn:"2rx19o54s",objOut:"2dtdzovd0"},{portIn:"r",portOut:"X",objIn:"vtoxdwmql",objOut:"2dtdzovd0"}]},{name:"Y",links:[{portIn:"g",portOut:"Y",objIn:"vx1s7hy4s",objOut:"2dtdzovd0"},{portIn:"g",portOut:"Y",objIn:"2rx19o54s",objOut:"2dtdzovd0"},{portIn:"g",portOut:"Y",objIn:"vtoxdwmql",objOut:"2dtdzovd0"}]},{name:"Z",links:[{portIn:"b",portOut:"Z",objIn:"vx1s7hy4s",objOut:"2dtdzovd0"},{portIn:"b",portOut:"Z",objIn:"2rx19o54s",objOut:"2dtdzovd0"},{portIn:"b",portOut:"Z",objIn:"vtoxdwmql",objOut:"2dtdzovd0"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"nru47jkev",uiAttribs:{},portsIn:[{name:"Index",value:2}],portsOut:[{name:"X",links:[{portIn:"r",portOut:"X",objIn:"gdz87bng8",objOut:"nru47jkev"}]},{name:"Y",links:[{portIn:"g",portOut:"Y",objIn:"gdz87bng8",objOut:"nru47jkev"}]},{name:"Z",links:[{portIn:"b",portOut:"Z",objIn:"gdz87bng8",objOut:"nru47jkev"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"mdmrx5yu7",uiAttribs:{},portsIn:[{name:"Index",value:3}],portsOut:[{name:"X",links:[{portIn:"r",portOut:"X",objIn:"3q8sdmcr8",objOut:"mdmrx5yu7"},{portIn:"r",portOut:"X",objIn:"47bsq3crs",objOut:"mdmrx5yu7"}]},{name:"Y",links:[{portIn:"g",portOut:"Y",objIn:"3q8sdmcr8",objOut:"mdmrx5yu7"},{portIn:"g",portOut:"Y",objIn:"47bsq3crs",objOut:"mdmrx5yu7"}]},{name:"Z",links:[{portIn:"b",portOut:"Z",objIn:"3q8sdmcr8",objOut:"mdmrx5yu7"},{portIn:"b",portOut:"Z",objIn:"47bsq3crs",objOut:"mdmrx5yu7"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"p4vmw3w5r",uiAttribs:{},portsIn:[{name:"Width",value:2},{name:"Height",value:2},{name:"Thickness",value:.02},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"Draw Top",value:1},{name:"Draw Bottom",value:1},{name:"Draw Left",value:1},{name:"Draw Right",value:1},{name:"Active",value:1}],objName:"Ops.Gl.Meshes.RectangleFrame_v2"},{id:"onrso8tno",uiAttribs:{},portsIn:[{name:"r",value:.8274509953517546},{name:"g",value:.019607843137254943},{name:"b",value:1},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"jqcre6jn6",objOut:"onrso8tno"},{portIn:"render",portOut:"trigger",objIn:"qjspql9ik",objOut:"onrso8tno"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"jqcre6jn6",uiAttribs:{},portsIn:[{name:"min",value:0},{name:"max",value:90},{name:"duration",value:10},{name:"pause between",value:.5},{name:"easing index",value:0},{name:"easing",value:"linear"}],portsOut:[{name:"result",links:[{portIn:"rotY",portOut:"result",objIn:"qjspql9ik",objOut:"jqcre6jn6"}]}],objName:"Ops.Anim.RandomAnim_v2"},{id:"qjspql9ik",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"p4vmw3w5r",objOut:"qjspql9ik"}]}],objName:"Ops.Graphics.Transform"},{id:"t61279mk3",uiAttribs:{},portsIn:[{name:"Width",value:2},{name:"Height",value:2},{name:"Thickness",value:.02},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"Draw Top",value:1},{name:"Draw Bottom",value:1},{name:"Draw Left",value:1},{name:"Draw Right",value:1},{name:"Active",value:1}],objName:"Ops.Gl.Meshes.RectangleFrame_v2"},{id:"dd2vz0n1a",uiAttribs:{},portsIn:[{name:"r",value:.019607843137254943},{name:"g",value:1},{name:"b",value:.6235273772594977},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"fb6sa9lcw",objOut:"dd2vz0n1a"},{portIn:"render",portOut:"trigger",objIn:"jvubbcw97",objOut:"dd2vz0n1a"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"fb6sa9lcw",uiAttribs:{},portsIn:[{name:"min",value:0},{name:"max",value:180},{name:"duration",value:10},{name:"pause between",value:.5},{name:"easing index",value:0},{name:"easing",value:"linear"}],portsOut:[{name:"result",links:[{portIn:"rotZ",portOut:"result",objIn:"jvubbcw97",objOut:"fb6sa9lcw"}]}],objName:"Ops.Anim.RandomAnim_v2"},{id:"jvubbcw97",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"t61279mk3",objOut:"jvubbcw97"}]}],objName:"Ops.Graphics.Transform"},{id:"r4yuzwgo3",uiAttribs:{},portsIn:[{name:"min",value:-3},{name:"max",value:3},{name:"duration",value:10},{name:"pause between",value:1},{name:"easing index",value:0},{name:"easing",value:"linear"}],portsOut:[{name:"result",links:[{portIn:"posX",portOut:"result",objIn:"uqqxfqcbb",objOut:"r4yuzwgo3"}]}],objName:"Ops.Anim.RandomAnim_v2"},{id:"uqqxfqcbb",uiAttribs:{},portsIn:[{name:"posY",value:0},{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"safsbgw6e",objOut:"uqqxfqcbb"}]}],objName:"Ops.Graphics.Transform"},{id:"jfl0re74b",uiAttribs:{},portsIn:[{name:"width",value:5},{name:"height",value:1},{name:"Logarithmic",value:1},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"num columns",value:1},{name:"num rows",value:20},{name:"axis index",value:0},{name:"axis",value:"xy"}],objName:"Ops.Gl.Meshes.LinesArray"},{id:"ee6dp0jj1",uiAttribs:{},portsIn:[{name:"r",value:.07450986375995738},{name:"g",value:1},{name:"b",value:.019607843137254943},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"vndke6wus",objOut:"ee6dp0jj1"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"vndke6wus",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:0},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"jfl0re74b",objOut:"vndke6wus"}]}],objName:"Ops.Graphics.Transform"},{id:"eysglbhlz",uiAttribs:{},portsIn:[{name:"min",value:1},{name:"max",value:2},{name:"Integer",value:0},{name:"No consecutive duplicates",value:1}],portsOut:[{name:"result",links:[{portIn:"scale",portOut:"result",objIn:"vndke6wus",objOut:"eysglbhlz"},{portIn:"scale",portOut:"result",objIn:"c4g5ul13s",objOut:"eysglbhlz"}]}],objName:"Ops.Math.TriggerRandomNumber_v3"},{id:"zcjidil5l",uiAttribs:{},portsIn:[{name:"interval",value:1e3},{name:"Active",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Generate",portOut:"trigger",objIn:"eysglbhlz",objOut:"zcjidil5l"}]}],objName:"Ops.Trigger.Interval"},{id:"x5v1n8nw2",uiAttribs:{},portsIn:[{name:"width",value:10},{name:"height",value:2},{name:"Logarithmic",value:1},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"num columns",value:1},{name:"num rows",value:10},{name:"axis index",value:0},{name:"axis",value:"xy"}],objName:"Ops.Gl.Meshes.LinesArray"},{id:"uxb68ef37",uiAttribs:{},portsIn:[{name:"r",value:.05450209002272842},{name:"g",value:.7826663462320964},{name:"b",value:.02537551977435366},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"c4g5ul13s",objOut:"uxb68ef37"},{portIn:"exe",portOut:"trigger",objIn:"507rniyaf",objOut:"uxb68ef37"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"c4g5ul13s",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:0},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"x5v1n8nw2",objOut:"c4g5ul13s"}]}],objName:"Ops.Graphics.Transform"},{id:"507rniyaf",uiAttribs:{},portsIn:[{name:"min",value:0},{name:"max",value:5},{name:"duration",value:5},{name:"pause between",value:1},{name:"easing index",value:0},{name:"easing",value:"linear"}],portsOut:[{name:"result",links:[{portIn:"rotZ",portOut:"result",objIn:"c4g5ul13s",objOut:"507rniyaf"}]}],objName:"Ops.Anim.RandomAnim_v2"}],export:{time:"2025-11-13 22:08",service:"github",exportNumber:15}};if(!CABLES.exportedPatch){CABLES.exportedPatch=CABLES.exportedPatches["2yD4jY"]}"use strict";var CABLES=CABLES||{};CABLES.OPS=CABLES.OPS||{};var Ops=Ops||{};Ops.Gl=Ops.Gl||{};Ops.Ui=Ops.Ui||{};Ops.Anim=Ops.Anim||{};Ops.Html=Ops.Html||{};Ops.Math=Ops.Math||{};Ops.Vars=Ops.Vars||{};Ops.Array=Ops.Array||{};Ops.Color=Ops.Color||{};Ops.Patch=Ops.Patch||{};Ops.Number=Ops.Number||{};Ops.Boolean=Ops.Boolean||{};Ops.Sidebar=Ops.Sidebar||{};Ops.Trigger=Ops.Trigger||{};Ops.Graphics=Ops.Graphics||{};Ops.Gl.Meshes=Ops.Gl.Meshes||{};Ops.Gl.Shader=Ops.Gl.Shader||{};Ops.Gl.Textures=Ops.Gl.Textures||{};Ops.Patch.P2yD4jY=Ops.Patch.P2yD4jY||{};Ops.Gl.ImageCompose=Ops.Gl.ImageCompose||{};Ops.Graphics.Meshes=Ops.Graphics.Meshes||{};Ops.Gl.ImageCompose.Noise=Ops.Gl.ImageCompose.Noise||{};Ops.Patch.P2yD4jY.TargetArchitectureIs=Ops.Patch.P2yD4jY.TargetArchitectureIs||{};Ops.Trigger.RouteTriggerAnimated=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const i=e.attachments={inc_gen_ports_js:'const port_ip34w2ny0 = op.inFloat("ip34w2ny0", 0);\nport_ip34w2ny0.setUiAttribs({ "title": "Index", "increment": "integer", });\n\nconst port_wiikdxo89 = op.inTrigger("wiikdxo89");\nport_wiikdxo89.setUiAttribs({ "title": "exe", });\n\nconst port_s0ddunhhz = op.inFloat("s0ddunhhz", 1);\nport_s0ddunhhz.setUiAttribs({ "title": "Duration", });\n\nconst port_4gu5lv66h = op.outNumber("4gu5lv66h");\nport_4gu5lv66h.setUiAttribs({ "title": "Out Value", });\n\nconst port_qutsn94pc = op.outTrigger("qutsn94pc");\nport_qutsn94pc.setUiAttribs({ "title": "Trigger 0", });\n\nconst port_8xpkgorjm = op.outTrigger("8xpkgorjm");\nport_8xpkgorjm.setUiAttribs({ "title": "Trigger 1", });\n\nconst port_hvyzlh9o8 = op.outTrigger("hvyzlh9o8");\nport_hvyzlh9o8.setUiAttribs({ "title": "Trigger 2", });\n\nconst port_367wv95xd = op.outTrigger("367wv95xd");\nport_367wv95xd.setUiAttribs({ "title": "Trigger 3", });\n\nconst port_7ju3j2fy0 = op.outTrigger("7ju3j2fy0");\nport_7ju3j2fy0.setUiAttribs({ "title": "Trigger 4", });\n\nconst port_t8dvyjuoq = op.outTrigger("t8dvyjuoq");\nport_t8dvyjuoq.setUiAttribs({ "title": "Trigger 5", });\n\nconst port_72naih78e = op.outTrigger("72naih78e");\nport_72naih78e.setUiAttribs({ "title": "Trigger 6", });\n\nconst port_0s04tm21u = op.outTrigger("0s04tm21u");\nport_0s04tm21u.setUiAttribs({ "title": "Trigger 7", });\n\nconst port_93jpxulns = op.outTrigger("93jpxulns");\nport_93jpxulns.setUiAttribs({ "title": "Trigger 8", });\n\nconst port_a0w7orgi8 = op.outTrigger("a0w7orgi8");\nport_a0w7orgi8.setUiAttribs({ "title": "Trigger 9", });\n\nconst port_r8h4qx4z8 = op.outTrigger("r8h4qx4z8");\nport_r8h4qx4z8.setUiAttribs({ "title": "Trigger 10", });\n\nconst port_cr80a86xi = op.outTrigger("cr80a86xi");\nport_cr80a86xi.setUiAttribs({ "title": "Trigger 11", });\n\nop.initInnerPorts = function (addedOps)\n{\n    for (let i = 0; i < addedOps.length; i++)\n    {\n        if (addedOps[i].innerInput)\n        {\n            const innerOut_ip34w2ny0 = addedOps[i].outNumber("innerOut_ip34w2ny0");\n            innerOut_ip34w2ny0.set(port_ip34w2ny0.get());\n            innerOut_ip34w2ny0.setUiAttribs({ "title": "Index" });\n            port_ip34w2ny0.on("change", (a, v) => { innerOut_ip34w2ny0.set(a); });\n\n            const innerOut_wiikdxo89 = addedOps[i].outTrigger("innerOut_wiikdxo89");\n            innerOut_wiikdxo89.setUiAttribs({ "title": "exe" });\n            port_wiikdxo89.onTriggered = () => { innerOut_wiikdxo89.trigger(); };\n\n            const innerOut_s0ddunhhz = addedOps[i].outNumber("innerOut_s0ddunhhz");\n            innerOut_s0ddunhhz.set(port_s0ddunhhz.get());\n            innerOut_s0ddunhhz.setUiAttribs({ "title": "Duration" });\n            port_s0ddunhhz.on("change", (a, v) => { innerOut_s0ddunhhz.set(a); });\n        }\n        if (addedOps[i].innerOutput)\n        {\n            const innerIn_4gu5lv66h = addedOps[i].inFloat("innerIn_4gu5lv66h");\n            innerIn_4gu5lv66h.setUiAttribs({ "title": "Out Value" });\n            innerIn_4gu5lv66h.on("change", (a, v) => { port_4gu5lv66h.set(a); });\n\n            const innerIn_qutsn94pc = addedOps[i].inTrigger("innerIn_qutsn94pc");\n            innerIn_qutsn94pc.setUiAttribs({ "title": "Trigger 0" });\n            innerIn_qutsn94pc.onTriggered = () => { port_qutsn94pc.trigger(); };\n\n            const innerIn_8xpkgorjm = addedOps[i].inTrigger("innerIn_8xpkgorjm");\n            innerIn_8xpkgorjm.setUiAttribs({ "title": "Trigger 1" });\n            innerIn_8xpkgorjm.onTriggered = () => { port_8xpkgorjm.trigger(); };\n\n            const innerIn_hvyzlh9o8 = addedOps[i].inTrigger("innerIn_hvyzlh9o8");\n            innerIn_hvyzlh9o8.setUiAttribs({ "title": "Trigger 2" });\n            innerIn_hvyzlh9o8.onTriggered = () => { port_hvyzlh9o8.trigger(); };\n\n            const innerIn_367wv95xd = addedOps[i].inTrigger("innerIn_367wv95xd");\n            innerIn_367wv95xd.setUiAttribs({ "title": "Trigger 3" });\n            innerIn_367wv95xd.onTriggered = () => { port_367wv95xd.trigger(); };\n\n            const innerIn_7ju3j2fy0 = addedOps[i].inTrigger("innerIn_7ju3j2fy0");\n            innerIn_7ju3j2fy0.setUiAttribs({ "title": "Trigger 4" });\n            innerIn_7ju3j2fy0.onTriggered = () => { port_7ju3j2fy0.trigger(); };\n\n            const innerIn_t8dvyjuoq = addedOps[i].inTrigger("innerIn_t8dvyjuoq");\n            innerIn_t8dvyjuoq.setUiAttribs({ "title": "Trigger 5" });\n            innerIn_t8dvyjuoq.onTriggered = () => { port_t8dvyjuoq.trigger(); };\n\n            const innerIn_72naih78e = addedOps[i].inTrigger("innerIn_72naih78e");\n            innerIn_72naih78e.setUiAttribs({ "title": "Trigger 6" });\n            innerIn_72naih78e.onTriggered = () => { port_72naih78e.trigger(); };\n\n            const innerIn_0s04tm21u = addedOps[i].inTrigger("innerIn_0s04tm21u");\n            innerIn_0s04tm21u.setUiAttribs({ "title": "Trigger 7" });\n            innerIn_0s04tm21u.onTriggered = () => { port_0s04tm21u.trigger(); };\n\n            const innerIn_93jpxulns = addedOps[i].inTrigger("innerIn_93jpxulns");\n            innerIn_93jpxulns.setUiAttribs({ "title": "Trigger 8" });\n            innerIn_93jpxulns.onTriggered = () => { port_93jpxulns.trigger(); };\n\n            const innerIn_a0w7orgi8 = addedOps[i].inTrigger("innerIn_a0w7orgi8");\n            innerIn_a0w7orgi8.setUiAttribs({ "title": "Trigger 9" });\n            innerIn_a0w7orgi8.onTriggered = () => { port_a0w7orgi8.trigger(); };\n\n            const innerIn_r8h4qx4z8 = addedOps[i].inTrigger("innerIn_r8h4qx4z8");\n            innerIn_r8h4qx4z8.setUiAttribs({ "title": "Trigger 10" });\n            innerIn_r8h4qx4z8.onTriggered = () => { port_r8h4qx4z8.trigger(); };\n\n            const innerIn_cr80a86xi = addedOps[i].inTrigger("innerIn_cr80a86xi");\n            innerIn_cr80a86xi.setUiAttribs({ "title": "Trigger 11" });\n            innerIn_cr80a86xi.onTriggered = () => { port_cr80a86xi.trigger(); };\n        }\n    }\n};\n',subpatch_json:'{"ops":[{"id":"sp0-0","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"Switched Value","value":0},{"name":"Trigger 0","links":[{"portIn":"innerIn_qutsn94pc","portOut":"Trigger 0","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 1","links":[{"portIn":"innerIn_8xpkgorjm","portOut":"Trigger 1","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 2","links":[{"portIn":"innerIn_hvyzlh9o8","portOut":"Trigger 2","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 3","links":[{"portIn":"innerIn_367wv95xd","portOut":"Trigger 3","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 4","links":[{"portIn":"innerIn_7ju3j2fy0","portOut":"Trigger 4","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 5","links":[{"portIn":"innerIn_t8dvyjuoq","portOut":"Trigger 5","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 6","links":[{"portIn":"innerIn_72naih78e","portOut":"Trigger 6","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 7","links":[{"portIn":"innerIn_0s04tm21u","portOut":"Trigger 7","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 8","links":[{"portIn":"innerIn_93jpxulns","portOut":"Trigger 8","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 9","links":[{"portIn":"innerIn_a0w7orgi8","portOut":"Trigger 9","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 10","links":[{"portIn":"innerIn_r8h4qx4z8","portOut":"Trigger 10","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Trigger 11","links":[{"portIn":"innerIn_cr80a86xi","portOut":"Trigger 11","objIn":"sp0-3","objOut":"sp0-0"}]},{"name":"Highest Index","value":11}],"objName":"Ops.Trigger.RouteTrigger"},{"id":"sp0-1","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"Switched Value","value":1},{"name":"Trigger 0","links":[{"portIn":"innerIn_qutsn94pc","portOut":"Trigger 0","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 1","links":[{"portIn":"innerIn_8xpkgorjm","portOut":"Trigger 1","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 2","links":[{"portIn":"innerIn_hvyzlh9o8","portOut":"Trigger 2","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 3","links":[{"portIn":"innerIn_367wv95xd","portOut":"Trigger 3","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 4","links":[{"portIn":"innerIn_7ju3j2fy0","portOut":"Trigger 4","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 5","links":[{"portIn":"innerIn_t8dvyjuoq","portOut":"Trigger 5","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 6","links":[{"portIn":"innerIn_72naih78e","portOut":"Trigger 6","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 7","links":[{"portIn":"innerIn_0s04tm21u","portOut":"Trigger 7","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 8","links":[{"portIn":"innerIn_93jpxulns","portOut":"Trigger 8","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 9","links":[{"portIn":"innerIn_a0w7orgi8","portOut":"Trigger 9","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 10","links":[{"portIn":"innerIn_r8h4qx4z8","portOut":"Trigger 10","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Trigger 11","links":[{"portIn":"innerIn_cr80a86xi","portOut":"Trigger 11","objIn":"sp0-3","objOut":"sp0-1"}]},{"name":"Highest Index","value":11}],"objName":"Ops.Trigger.RouteTrigger"},{"id":"sp0-2","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"innerOut_ip34w2ny0","title":"Index","links":[{"portIn":"Value","portOut":"innerOut_ip34w2ny0","objIn":"sp0-15","objOut":"sp0-2"}]},{"name":"innerOut_wiikdxo89","title":"exe","links":[{"portIn":"exe","portOut":"innerOut_wiikdxo89","objIn":"sp0-4","objOut":"sp0-2"}]},{"name":"innerOut_s0ddunhhz","title":"Duration","links":[{"portIn":"value","portOut":"innerOut_s0ddunhhz","objIn":"sp0-13","objOut":"sp0-2"}]}],"objName":"Ops.Ui.SubPatchInput"},{"id":"sp0-3","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsIn":[{"name":"innerIn_4gu5lv66h","title":"Out Value"},{"name":"innerIn_qutsn94pc","title":"Trigger 0"},{"name":"innerIn_8xpkgorjm","title":"Trigger 1"},{"name":"innerIn_hvyzlh9o8","title":"Trigger 2"},{"name":"innerIn_367wv95xd","title":"Trigger 3"},{"name":"innerIn_7ju3j2fy0","title":"Trigger 4"},{"name":"innerIn_t8dvyjuoq","title":"Trigger 5"},{"name":"innerIn_72naih78e","title":"Trigger 6"},{"name":"innerIn_0s04tm21u","title":"Trigger 7"},{"name":"innerIn_93jpxulns","title":"Trigger 8"},{"name":"innerIn_a0w7orgi8","title":"Trigger 9"},{"name":"innerIn_r8h4qx4z8","title":"Trigger 10"},{"name":"innerIn_cr80a86xi","title":"Trigger 11"}],"objName":"Ops.Ui.SubPatchOutput"},{"id":"sp0-4","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"trigger 0","links":[{"portIn":"exe","portOut":"trigger 0","objIn":"sp0-6","objOut":"sp0-4"},{"portIn":"exe","portOut":"trigger 0","objIn":"sp0-8","objOut":"sp0-4"}]},{"name":"trigger 13","links":[{"portIn":"exe","portOut":"trigger 13","objIn":"sp0-14","objOut":"sp0-4"}]},{"name":"trigger 14","links":[{"portIn":"Set","portOut":"trigger 14","objIn":"sp0-10","objOut":"sp0-4"}]}],"objName":"Ops.Trigger.Sequence"},{"id":"sp0-5","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"Current Value","links":[{"portIn":"Switch Value","portOut":"Current Value","objIn":"sp0-0","objOut":"sp0-5"}]},{"name":"Previous Value","links":[{"portIn":"Switch Value","portOut":"Previous Value","objIn":"sp0-1","objOut":"sp0-5"}]}],"objName":"Ops.Number.PreviousNumberStore"},{"id":"sp0-6","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsIn":[{"name":"start","value":0},{"name":"end","value":1},{"name":"loop","value":0},{"name":"Wait for Reset","value":1},{"name":"easing index","value":11},{"name":"easing","value":"Sin Out"}],"portsOut":[{"name":"result","links":[{"portIn":"Number","portOut":"result","objIn":"sp0-7","objOut":"sp0-6"}]},{"name":"finished","value":true}],"objName":"Ops.Anim.SimpleAnim"},{"id":"sp0-7","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"Result","links":[{"portIn":"Number","portOut":"Result","objIn":"sp0-10","objOut":"sp0-7"}]}],"objName":"Ops.Ui.VizNumber"},{"id":"sp0-8","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsIn":[{"name":"start","value":1},{"name":"end","value":0},{"name":"loop","value":0},{"name":"Wait for Reset","value":1},{"name":"easing index","value":0},{"name":"easing","value":"linear"}],"portsOut":[{"name":"result","links":[{"portIn":"Number","portOut":"result","objIn":"sp0-9","objOut":"sp0-8"}]},{"name":"finished","value":true}],"objName":"Ops.Anim.SimpleAnim"},{"id":"sp0-9","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"Result","links":[{"portIn":"Number","portOut":"Result","objIn":"sp0-11","objOut":"sp0-9"},{"portIn":"boolean","portOut":"Result","objIn":"sp0-14","objOut":"sp0-9"}]}],"objName":"Ops.Ui.VizNumber"},{"id":"sp0-10","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"Next","links":[{"portIn":"Execute","portOut":"Next","objIn":"sp0-0","objOut":"sp0-10"}]},{"name":"Out Value","links":[{"portIn":"innerIn_4gu5lv66h","portOut":"Out Value","objIn":"sp0-3","objOut":"sp0-10"}]}],"objName":"Ops.Trigger.TriggerNumber"},{"id":"sp0-11","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"Next","links":[{"portIn":"Execute","portOut":"Next","objIn":"sp0-1","objOut":"sp0-11"}]},{"name":"Out Value","links":[{"portIn":"innerIn_4gu5lv66h","portOut":"Out Value","objIn":"sp0-3","objOut":"sp0-11"}]}],"objName":"Ops.Trigger.TriggerNumber"},{"id":"sp0-12","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"trigger","links":[{"portIn":"Set","portOut":"trigger","objIn":"sp0-11","objOut":"sp0-12"}]}],"objName":"Ops.Gl.ClearDepth"},{"id":"sp0-13","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"duration","portOut":"result","objIn":"sp0-8","objOut":"sp0-13"},{"portIn":"duration","portOut":"result","objIn":"sp0-6","objOut":"sp0-13"}]}],"objName":"Ops.Number.Number"},{"id":"sp0-14","uiAttribs":{"subPatch":"cuyljyrg6"},"storage":{},"portsOut":[{"name":"then","links":[{"portIn":"render","portOut":"then","objIn":"sp0-12","objOut":"sp0-14"}]}],"objName":"Ops.Boolean.IfTrueThen_v2"},{"id":"sp0-15","uiAttribs":{"subPatch":"cuyljyrg6"},"portsOut":[{"name":"Next","links":[{"portIn":"reset","portOut":"Next","objIn":"sp0-6","objOut":"sp0-15"},{"portIn":"reset","portOut":"Next","objIn":"sp0-8","objOut":"sp0-15"}]},{"name":"Number","links":[{"portIn":"Value","portOut":"Number","objIn":"sp0-5","objOut":"sp0-15"}]}],"storage":{"ref":"sp0-15"},"objName":"Ops.Number.TriggerOnChangeNumber_v2"}]}'};const E=e.inFloat("ip34w2ny0",0);E.setUiAttribs({title:"Index",increment:"integer"});const b=e.inTrigger("wiikdxo89");b.setUiAttribs({title:"exe"});const A=e.inFloat("s0ddunhhz",1);A.setUiAttribs({title:"Duration"});const F=e.outNumber("4gu5lv66h");F.setUiAttribs({title:"Out Value"});const v=e.outTrigger("qutsn94pc");v.setUiAttribs({title:"Trigger 0"});const x=e.outTrigger("8xpkgorjm");x.setUiAttribs({title:"Trigger 1"});const T=e.outTrigger("hvyzlh9o8");T.setUiAttribs({title:"Trigger 2"});const C=e.outTrigger("367wv95xd");C.setUiAttribs({title:"Trigger 3"});const D=e.outTrigger("7ju3j2fy0");D.setUiAttribs({title:"Trigger 4"});const B=e.outTrigger("t8dvyjuoq");B.setUiAttribs({title:"Trigger 5"});const S=e.outTrigger("72naih78e");S.setUiAttribs({title:"Trigger 6"});const I=e.outTrigger("0s04tm21u");I.setUiAttribs({title:"Trigger 7"});const M=e.outTrigger("93jpxulns");M.setUiAttribs({title:"Trigger 8"});const R=e.outTrigger("a0w7orgi8");R.setUiAttribs({title:"Trigger 9"});const O=e.outTrigger("r8h4qx4z8");O.setUiAttribs({title:"Trigger 10"});const P=e.outTrigger("cr80a86xi");P.setUiAttribs({title:"Trigger 11"});e.initInnerPorts=function(t){for(let e=0;e<t.length;e++){if(t[e].innerInput){const i=t[e].outNumber("innerOut_ip34w2ny0");i.set(E.get());i.setUiAttribs({title:"Index"});E.on("change",(e,t)=>{i.set(e)});const r=t[e].outTrigger("innerOut_wiikdxo89");r.setUiAttribs({title:"exe"});b.onTriggered=()=>{r.trigger()};const s=t[e].outNumber("innerOut_s0ddunhhz");s.set(A.get());s.setUiAttribs({title:"Duration"});A.on("change",(e,t)=>{s.set(e)})}if(t[e].innerOutput){const n=t[e].inFloat("innerIn_4gu5lv66h");n.setUiAttribs({title:"Out Value"});n.on("change",(e,t)=>{F.set(e)});const a=t[e].inTrigger("innerIn_qutsn94pc");a.setUiAttribs({title:"Trigger 0"});a.onTriggered=()=>{v.trigger()};const o=t[e].inTrigger("innerIn_8xpkgorjm");o.setUiAttribs({title:"Trigger 1"});o.onTriggered=()=>{x.trigger()};const l=t[e].inTrigger("innerIn_hvyzlh9o8");l.setUiAttribs({title:"Trigger 2"});l.onTriggered=()=>{T.trigger()};const h=t[e].inTrigger("innerIn_367wv95xd");h.setUiAttribs({title:"Trigger 3"});h.onTriggered=()=>{C.trigger()};const u=t[e].inTrigger("innerIn_7ju3j2fy0");u.setUiAttribs({title:"Trigger 4"});u.onTriggered=()=>{D.trigger()};const c=t[e].inTrigger("innerIn_t8dvyjuoq");c.setUiAttribs({title:"Trigger 5"});c.onTriggered=()=>{B.trigger()};const g=t[e].inTrigger("innerIn_72naih78e");g.setUiAttribs({title:"Trigger 6"});g.onTriggered=()=>{S.trigger()};const f=t[e].inTrigger("innerIn_0s04tm21u");f.setUiAttribs({title:"Trigger 7"});f.onTriggered=()=>{I.trigger()};const d=t[e].inTrigger("innerIn_93jpxulns");d.setUiAttribs({title:"Trigger 8"});d.onTriggered=()=>{M.trigger()};const p=t[e].inTrigger("innerIn_a0w7orgi8");p.setUiAttribs({title:"Trigger 9"});p.onTriggered=()=>{R.trigger()};const m=t[e].inTrigger("innerIn_r8h4qx4z8");m.setUiAttribs({title:"Trigger 10"});m.onTriggered=()=>{O.trigger()};const _=t[e].inTrigger("innerIn_cr80a86xi");_.setUiAttribs({title:"Trigger 11"});_.onTriggered=()=>{P.trigger()}}}};const r="bp2sub_"+e.id;new CABLES.SubPatchOp(e,{subId:r});t();function t(){const t=JSON.parse(i.subpatch_json);CABLES.Patch.replaceOpIds(t,{parentSubPatchId:r,prefixHash:r,oldIdAsRef:true,doNotUnlinkLostLinks:true});for(let e=0;e<t.ops.length;e++){t.ops[e].uiAttribs.blueprintSubpatch2=true}e.patch.deSerialize(t,{opsCreated:e.initInnerPorts});if(CABLES.UI)gui.savedState.setSaved("blueprintloaded",r);e.patch.emitEvent("subpatchExpose",r);e.setStorage({blueprintVer:2});e.patch.emitEvent("subpatchExpose",r)}}};CABLES.OPS["563afe75-045b-4c49-b58d-5f4ea4d0e807"]={f:Ops.Trigger.RouteTriggerAnimated,objName:"Ops.Trigger.RouteTriggerAnimated"};Ops.Trigger.RouteTrigger=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=24;const r=t.inTriggerButton("Execute"),s=t.inValueInt("Switch Value"),n=t.outTrigger("Next Trigger"),a=t.outNumber("Switched Value");const o=[];r.onTriggered=u;s.setUiAttribs({tlEase:1});for(let e=0;e<i;e++){o[e]=t.outTrigger("Trigger "+e);o[e].onLinkChanged=c}const l=t.outTrigger("Default Trigger"),h=t.outNumber("Highest Index");function u(){const e=Math.round(s.get());if(e>=0&&e<i){a.set(e);o[e].trigger()}else{a.set(-1);l.trigger()}n.trigger()}function c(){let t=0;for(let e=0;e<o.length;e++)if(o[e]&&o[e].isLinked())t=e;h.set(t)}}};CABLES.OPS["44ceb5d8-b040-4722-b189-a6fb8172517d"]={f:Ops.Trigger.RouteTrigger,objName:"Ops.Trigger.RouteTrigger"};Ops.Ui.SubPatchInput=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};t.innerInput=true;const i=t.inTriggerButton("Goto SubPatchOp");i.setUiAttribs({hidePort:true});i.onTriggered=()=>{const e=t.patch.getSubPatchOuterOp(t.uiAttribs.subPatch);gui.patchView.centerSelectOp(e.id)}}};CABLES.OPS["c4e4e933-136e-479e-8de8-0b35b75d9217"]={f:Ops.Ui.SubPatchInput,objName:"Ops.Ui.SubPatchInput"};Ops.Ui.SubPatchOutput=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};e.innerOutput=true}};CABLES.OPS["02d45073-7936-4830-81ad-59a162febf1f"]={f:Ops.Ui.SubPatchOutput,objName:"Ops.Ui.SubPatchOutput"};Ops.Trigger.Sequence=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inTrigger("exe"),i=n.inTriggerButton("Clean up connections");n.setUiAttrib({resizable:true,resizableY:false,stretchPorts:true});const r=[],a=[],s=16;let o=null,l=[];t.onTriggered=c;i.onTriggered=g;i.setUiAttribs({hideParam:true,hidePort:true});for(let t=0;t<s;t++){const f=n.outTrigger("trigger "+t);a.push(f);f.onLinkChanged=u;if(t<s-1){let e=n.inTrigger("exe "+t);e.onTriggered=c;r.push(e)}}h();function h(){l.length=0;for(let e=0;e<a.length;e++)if(a[e].links.length>0)l.push(a[e])}function u(){h();clearTimeout(o);o=setTimeout(()=>{let t=false;for(let e=0;e<a.length;e++)if(a[e].links.length>1)t=true;i.setUiAttribs({hideParam:!t});if(n.isCurrentUiOp())n.refreshParams()},60)}function c(){for(let e=0;e<l.length;e++)l[e].trigger()}function g(){let r=0;for(let i=0;i<a.length;i++){let t=[];if(a[i].links.length>1)for(let e=1;e<a[i].links.length;e++){while(a[r].links.length>0)r++;t.push(a[i].links[e]);const s=a[i].links[e].getOtherPort(a[i]);n.patch.link(n,"trigger "+r,s.op,s.name);r++}for(let e=0;e<t.length;e++)t[e].remove()}u();h()}}};CABLES.OPS["a466bc1f-06e9-4595-8849-bffb9fe22f99"]={f:Ops.Trigger.Sequence,objName:"Ops.Trigger.Sequence"};Ops.Number.PreviousNumberStore=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("Value"),r=e.outNumber("Current Value"),s=e.outNumber("Previous Value");let n=0;i.onChange=function(){s.set(n);n=i.get();r.set(i.get())}}};CABLES.OPS["01716872-67bd-4b31-a4a2-e0ccadf48411"]={f:Ops.Number.PreviousNumberStore,objName:"Ops.Number.PreviousNumberStore"};Ops.Anim.SimpleAnim=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("exe"),r=e.inTriggerButton("reset"),s=e.inTriggerButton("rewind"),n=e.inValueFloat("start",0),a=e.inValueFloat("end",1),o=e.inValueFloat("duration",.5),l=e.inValueBool("loop"),h=e.inValueBool("Wait for Reset",true),u=e.outTrigger("Next"),c=e.outNumber("result"),g=e.outNumber("finished"),f=e.outTrigger("Finished Trigger");const d=new CABLES.Anim;let p=false;let m=-1;d.createPort(e,"easing",_);l.onChange=_;_();o.onChange=_;function _(){if(d.keys.length!=3){d.setValue(0,0);d.setValue(1,0);d.setValue(2,0)}d.keys[0].time=CABLES.now()/1e3;d.keys[0].value=n.get();if(d.defaultEasing!=m)d.keys[0].setEasing(d.defaultEasing);d.keys[1].time=o.get()+CABLES.now()/1e3;d.keys[1].value=a.get();if(d.defaultEasing!=m)d.keys[1].setEasing(d.defaultEasing);d.loop=l.get();if(d.loop){}else{d.keys[2].time=d.keys[1].time;d.keys[2].value=d.keys[1].value;if(d.defaultEasing!=m)d.keys[2].setEasing(d.defaultEasing)}g.set(false);m=d.defaultEasing}r.onTriggered=function(){p=true;_()};s.onTriggered=function(){d.keys[0].time=CABLES.now()/1e3;d.keys[0].value=n.get();d.keys[1].time=CABLES.now()/1e3;d.keys[1].value=n.get();d.keys[2].time=CABLES.now()/1e3;d.keys[2].value=n.get();c.set(n.get())};i.onTriggered=function(){if(h.get()&&!p){c.set(n.get());u.trigger();return}let e=CABLES.now()/1e3;let t=d.getValue(e);c.set(t);if(d.hasEnded(e)){if(!g.get())f.trigger();g.set(true)}u.trigger()}}};CABLES.OPS["5b244b6e-c505-4743-b2cc-8119ef720028"]={f:Ops.Anim.SimpleAnim,objName:"Ops.Anim.SimpleAnim"};Ops.Ui.VizNumber=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inFloat("Number",0);const r=t.outNumber("Result");t.setUiAttrib({widthOnlyGrow:true});i.onChange=s;s();function s(){let e=i.get();t.setUiAttribs({extendTitle:i.getValueForDisplay()});r.set(e)}}};CABLES.OPS["2b60d12d-2884-4ad0-bda4-0caeb6882f5c"]={f:Ops.Ui.VizNumber,objName:"Ops.Ui.VizNumber"};Ops.Trigger.TriggerNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Set"),r=e.inValueFloat("Number"),s=e.outTrigger("Next"),n=e.outNumber("Out Value");n.changeAlways=true;i.onTriggered=function(){n.set(r.get());s.trigger()}}};CABLES.OPS["9989b1c0-1073-4d5f-bfa0-36dd98b66e27"]={f:Ops.Trigger.TriggerNumber,objName:"Ops.Trigger.TriggerNumber"};Ops.Gl.ClearDepth=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("render"),r=e.outTrigger("trigger"),s=e.patch.cgl;i.onTriggered=function(){s.gl.clear(s.gl.DEPTH_BUFFER_BIT);r.trigger()}}};CABLES.OPS["9e8a4b73-4ba7-4c4f-b266-81c5f9db9b7a"]={f:Ops.Gl.ClearDepth,objName:"Ops.Gl.ClearDepth"};Ops.Number.Number=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("value"),r=e.outNumber("result");i.onChange=n;let s=false;i.onLinkChanged=()=>{if(!s&&i.isLinked())e.setUiAttribs({extendTitle:null});s=i.isLinked()};function n(){if(CABLES.UI&&!s)e.setUiAttribs({extendTitle:i.get()});r.set(Number(i.get()))}}};CABLES.OPS["8fb2bb5d-665a-4d0a-8079-12710ae453be"]={f:Ops.Number.Number,objName:"Ops.Number.Number"};Ops.Boolean.IfTrueThen_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("exe"),r=e.inValueBool("boolean",false),s=e.outTrigger("then"),n=e.outTrigger("else");i.onTriggered=a;function a(){if(r.get())s.trigger();else n.trigger()}}};CABLES.OPS["9549e2ed-a544-4d33-a672-05c7854ccf5d"]={f:Ops.Boolean.IfTrueThen_v2,objName:"Ops.Boolean.IfTrueThen_v2"};Ops.Number.TriggerOnChangeNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inFloat("Value"),r=e.outTrigger("Next"),s=e.outNumber("Number");i.onChange=function(){s.set(i.get());r.trigger()};e.init=()=>{if(i.isLinked())r.trigger()}}};CABLES.OPS["63ec7ad7-a436-4f72-8b5e-257cc20049d4"]={f:Ops.Number.TriggerOnChangeNumber_v2,objName:"Ops.Number.TriggerOnChangeNumber_v2"};Ops.Gl.MainLoop_v2=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inFloat("Max Pixel Density (DPR)",2),r=i.inValue("FPS Limit",0),s=i.inValueBool("Reduce FPS unfocussed",false),n=i.inValueBool("Transparent",false),a=i.inValueBool("Active",1),o=i.inValueBool("Focus canvas",1),l=i.outTrigger("trigger"),h=i.outNumber("width"),u=i.outNumber("height"),c=i.outNumber("Pixel Density");i.onAnimFrame=D;t.onChange=x;const g=i.patch.cg=i.patch.cgl;let f=0;let d=0;let p=null;let m=false;if(!i.patch.cgl)i.uiAttr({error:"No webgl cgl context"});const _=vec3.create();vec3.set(_,0,0,0);const E=vec3.create();vec3.set(E,0,0,-2);let b=true;let A=null;let F=true;let v=true;window.addEventListener("blur",()=>{F=false});window.addEventListener("focus",()=>{F=true});document.addEventListener("visibilitychange",()=>{v=!document.hidden});B();i.patch.tempData.mainloopOp=this;function x(){C();if(CABLES.UI){if(t.get()<1)i.patch.cgl.canvas.style.imageRendering="pixelated"}i.patch.cgl.updateSize();if(CABLES.UI)gui.setLayout()}a.onChange=function(){i.patch.removeOnAnimFrame(i);if(a.get()){i.setUiAttrib({extendTitle:""});i.onAnimFrame=D;i.patch.addOnAnimFrame(i);i.log("adding again!")}else{i.setUiAttrib({extendTitle:"Inactive"})}};function T(){if(s.get()){if(!v)return 10;if(!F)return 30}return r.get()}i.onDelete=function(){g.gl.clearColor(0,0,0,0);g.gl.clear(g.gl.COLOR_BUFFER_BIT|g.gl.DEPTH_BUFFER_BIT)};function C(){if(t.get()!=0)i.patch.cgl.pixelDensity=Math.min(t.get(),window.devicePixelRatio);else i.patch.cgl.pixelDensity=window.devicePixelRatio}function D(e){if(!a.get())return;if(g.aborted||g.canvas.clientWidth===0||g.canvas.clientHeight===0)return;i.patch.cg=g;C();const t=performance.now();i.patch.config.fpsLimit=T();if(g.canvasWidth==-1){g.setCanvas(i.patch.config.glCanvasId);return}if(g.canvasWidth!=h.get()||g.canvasHeight!=u.get()){h.set(g.canvasWidth/1);u.set(g.canvasHeight/1)}if(CABLES.now()-d>1e3){CGL.fpsReport=CGL.fpsReport||[];if(i.patch.loading.getProgress()>=1&&d!==0)CGL.fpsReport.push(f);f=0;d=CABLES.now()}CGL.MESH.lastShader=null;CGL.MESH.lastMesh=null;g.renderStart(g,_,E);if(!n.get())g.gl.clearColor(0,0,0,1);else g.gl.clearColor(0,0,0,0);g.gl.clear(g.gl.COLOR_BUFFER_BIT|g.gl.DEPTH_BUFFER_BIT);l.trigger();if(CGL.MESH.lastMesh)CGL.MESH.lastMesh.unBind();if(CGL.Texture.previewTexture){if(!CGL.Texture.texturePreviewer)CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(g);CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)}g.renderEnd(g);i.patch.cg=null;if(!n.get()){g.gl.clearColor(1,1,1,1);g.gl.colorMask(false,false,false,true);g.gl.clear(g.gl.COLOR_BUFFER_BIT);g.gl.colorMask(true,true,true,true)}if(!g.tempData.phong)g.tempData.phong={};f++;if(b){if(o.get())g.canvas.focus();b=false}c.set(i.patch.cgl.pixelDensity);i.patch.cgl.profileData.profileMainloopMs=performance.now()-t}function B(){clearTimeout(p);p=setTimeout(()=>{if(i.patch.getOpsByObjName(i.name).length>1){i.setUiError("multimainloop","there should only be one mainloop op!");if(!m)m=i.patch.addEventListener("onOpDelete",B)}else i.setUiError("multimainloop",null,1)},500)}}};CABLES.OPS["f1029550-d877-42da-9b1e-63a5163a0350"]={f:Ops.Gl.MainLoop_v2,objName:"Ops.Gl.MainLoop_v2"};Ops.Gl.RenderToTexture_v3=class extends CABLES.Op{constructor(){super(...arguments);const s=this;const e=s.attachments={};const t=s.inTrigger("render"),i=s.inSwitch("Size",["Canvas","Manual"],"Canvas"),r=s.inValueInt("texture width",512),n=s.inValueInt("texture height",512),a=s.inBool("Auto Aspect",true),o=s.inSwitch("filter",["nearest","linear","mipmap"],"linear"),l=s.inSwitch("Wrap",["Clamp","Repeat","Mirror"],"Repeat"),h=s.inSwitch("MSAA",["none","2x","4x","8x"],"none"),u=s.outTrigger("trigger"),c=s.outTexture("texture"),g=s.outTexture("textureDepth"),f=s.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),d=s.inValueBool("Depth",true),p=s.inValueBool("Clear",true);const m=s.patch.cgl;let _=null;let E=true;s.setPortGroup("Size",[i,r,n,a]);f.onChange=d.onChange=p.onChange=o.onChange=l.onChange=h.onChange=A;i.onChange=b;t.onTriggered=s.preRender=F;b();function b(){r.setUiAttribs({greyout:i.get()!="Manual"});n.setUiAttribs({greyout:i.get()!="Manual"});a.setUiAttribs({greyout:i.get()!="Manual"})}function A(){E=true}function F(){CGL.TextureEffect.checkOpNotInTextureEffect(s);if(!_||E){if(_)_.delete();let i=CGL.Texture.WRAP_REPEAT;if(l.get()=="Clamp")i=CGL.Texture.WRAP_CLAMP_TO_EDGE;else if(l.get()=="Mirror")i=CGL.Texture.WRAP_MIRRORED_REPEAT;let r=CGL.Texture.FILTER_NEAREST;if(o.get()=="nearest")r=CGL.Texture.FILTER_NEAREST;else if(o.get()=="linear")r=CGL.Texture.FILTER_LINEAR;else if(o.get()=="mipmap")r=CGL.Texture.FILTER_MIPMAP;if(f.get().indexOf("loat")>-1&&o.get()=="mipmap")s.setUiError("fpmipmap","Can't use mipmap and float texture at the same time");else s.setUiError("fpmipmap",null);if(m.glVersion>=2){let e=true;let t=4;if(h.get()=="none"){t=0;e=false}if(h.get()=="2x")t=2;if(h.get()=="4x")t=4;if(h.get()=="8x")t=8;_=new CGL.Framebuffer2(m,8,8,{name:"render2texture "+s.id,pixelFormat:f.get(),multisampling:e,multisamplingSamples:t,wrap:i,filter:r,depth:d.get(),clear:p.get()})}else{_=new CGL.Framebuffer(m,8,8,{isFloatingPointTexture:false,clear:p.get()})}if(_&&_.valid){g.setRef(_.getTextureDepth());E=false}else{_=null;E=true}}let e=a.get();if(i.get()=="Canvas"){e=true;r.set(s.patch.cgl.checkTextureSize(m.canvasWidth));n.set(s.patch.cgl.checkTextureSize(m.canvasHeight))}if(_.getWidth()!=s.patch.cgl.checkTextureSize(r.get())||_.getHeight()!=s.patch.cgl.checkTextureSize(n.get())){_.setSize(s.patch.cgl.checkTextureSize(r.get()),s.patch.cgl.checkTextureSize(n.get()))}_.renderStart(m);m.pushViewPort(0,0,r.get(),n.get());if(e)mat4.perspective(m.pMatrix,45,r.get()/n.get(),.1,1e3);u.trigger();_.renderEnd(m);m.popViewPort();g.setRef(_.getTextureDepth());c.setRef(_.getTextureColor())}}};CABLES.OPS["41eec5c7-c480-477a-be81-04c3efac8357"]={f:Ops.Gl.RenderToTexture_v3,objName:"Ops.Gl.RenderToTexture_v3"};Ops.Gl.Meshes.FullscreenRectangle_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={shader_frag:"UNI sampler2D tex;\nIN vec2 texCoord;\n\nvoid main()\n{\n    outColor= texture(tex,texCoord);\n}\n\n",shader_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n   vec4 pos=vec4(vPosition,  1.0);\n\n   texCoord=vec2(attrTexCoord.x,(1.0-attrTexCoord.y));\n\n   gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const i=e.inTrigger("render"),r=e.inSwitch("Scale",["Stretch","Fit"],"Fit"),s=e.inValueBool("Flip Y"),n=e.inValueBool("Flip X"),a=e.inTexture("Texture"),o=e.outTrigger("trigger");const l=e.patch.cgl;let h=null;let u=new CGL.Geometry("fullscreen rectangle");let c=0,g=0,f=0,d=0;e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);e.toWorkPortsNeedToBeLinked(i);n.onChange=x;s.onChange=x;i.onTriggered=v;a.onLinkChanged=b;r.onChange=F;const p=new CGL.Shader(l,"fullscreenrectangle",this);p.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);p.setSource(t.shader_vert,t.shader_frag);p.fullscreenRectUniform=new CGL.Uniform(p,"t","tex",0);p.aspectUni=new CGL.Uniform(p,"f","aspectTex",0);let m=false;let _=true;let E=false;b();F();a.onChange=function(){_=true};function b(){if(!CABLES.UI)return;s.setUiAttribs({greyout:!a.isLinked()});n.setUiAttribs({greyout:!a.isLinked()});r.setUiAttribs({greyout:!a.isLinked()})}function A(){let e=a.get();if(e)m=true;else m=false}e.preRender=function(){A();p.bind();if(h)h.render(p);v()};function F(){E=r.get()=="Fit"}function v(){if(l.viewPort[2]!=f||l.viewPort[3]!=d||!h)T();if(_)A();l.pushPMatrix();mat4.identity(l.pMatrix);mat4.ortho(l.pMatrix,0,f,d,0,-10,1e3);l.pushModelMatrix();mat4.identity(l.mMatrix);l.pushViewMatrix();mat4.identity(l.vMatrix);if(E&&a.get()){const i=a.get().width/a.get().height;let e=d;let t=d*i;if(t>f){e=f*1/i;t=f}l.pushViewPort((f-t)/2,(d-e)/2,t,e)}if(m){if(a.get())l.setTexture(0,a.get().tex);h.render(p)}else{h.render(l.getShader())}l.gl.clear(l.gl.DEPTH_BUFFER_BIT);l.popPMatrix();l.popModelMatrix();l.popViewMatrix();if(E&&a.get())l.popViewPort();o.trigger()}function x(){h=null}function T(){if(l.viewPort[2]==f&&l.viewPort[3]==d&&h)return;let e=0,t=0;f=l.viewPort[2];d=l.viewPort[3];u.vertices=new Float32Array([e+f,t+d,0,e,t+d,0,e+f,t,0,e,t,0]);let i=null;if(s.get())i=new Float32Array([1,0,0,0,1,1,0,1]);else i=new Float32Array([1,1,0,1,1,0,0,0]);if(n.get()){i[0]=0;i[2]=1;i[4]=0;i[6]=1}u.setTexCoords(i);u.verticesIndices=new Uint16Array([2,1,0,3,1,2]);u.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);u.tangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0]);u.biTangents==new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0]);if(!h)h=new CGL.Mesh(l,u);else h.setGeom(u)}}};CABLES.OPS["fb70721a-eac2-4ff5-a5a2-5c59e2393972"]={f:Ops.Gl.Meshes.FullscreenRectangle_v2,objName:"Ops.Gl.Meshes.FullscreenRectangle_v2"};Ops.Gl.ImageCompose.ImageCompose_v4=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={imgcomp_frag:"IN vec2 texCoord;\nUNI vec4 bgColor;\nUNI sampler2D tex;\n#ifdef USE_UVTEX\nUNI sampler2D UVTex;\n#endif\n\nvoid main()\n{\n\n    #ifndef USE_TEX\n        outColor=bgColor;\n    #endif\n    #ifdef USE_TEX\n        #ifndef USE_UVTEX\n        outColor=texture(tex,texCoord);\n        #else\n        outColor=texture(tex,texture(UVTex,texCoord).xy);\n        #endif\n    #endif\n\n\n\n}\n"};const t=i.patch.cgl,r=i.inTrigger("Render"),s=i.inTexture("Base Texture"),n=i.inTexture("UV Texture"),a=i.inSwitch("Size",["Auto","Canvas","Manual"],"Auto"),o=i.inValueInt("Width",640),l=i.inValueInt("Height",480),h=i.inSwitch("Filter",["nearest","linear","mipmap"],"linear"),u=i.inValueSelect("Wrap",["clamp to edge","repeat","mirrored repeat"],"repeat"),c=i.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),g=i.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),f=i.inBool("Clear",true),d=i.inValueSlider("R",0),p=i.inValueSlider("G",0),m=i.inValueSlider("B",0),_=i.inValueSlider("A",0),E=i.outTrigger("Next"),b=i.outTexture("texture_out",CGL.Texture.getEmptyTexture(t)),A=i.outNumber("Aspect Ratio"),y=i.outNumber("Texture Width"),w=i.outNumber("Texture Height");i.setPortGroup("Texture Size",[a,o,l]);i.setPortGroup("Texture Parameters",[u,c,h,g]);d.setUiAttribs({colorPick:true});i.setPortGroup("Color",[d,p,m,_,f]);i.toWorkPortsNeedToBeLinked(r);const L=[0,0,0,0];let F=null;let v=null;let x=true;let U=false;let T=null;let k=null;let V=null;let G=null;u.onChange=h.onChange=c.onChange=g.onChange=j;s.onLinkChanged=f.onChange=a.onChange=n.onChange=O;r.onTriggered=i.preRender=N;O();function C(){if(F)F.delete();if(v)v.delete();v=null;F=new CGL.TextureEffect(t,{isFloatingPointTexture:CGL.Texture.isPixelFormatFloat(g.get()),name:i.name});const e=Math.min(t.maxAnisotropic,parseFloat(c.get()));v=new CGL.Texture(t,{anisotropic:e,name:"image_compose_v2_"+i.id,pixelFormat:g.get(),filter:D(),wrap:B(),width:S(),height:I()});F.setSourceTexture(v);y.set(S());w.set(I());A.set(S()/I());b.setRef(CGL.Texture.getEmptyTexture(t));x=false;O()}function D(){if(h.get()=="nearest")return CGL.Texture.FILTER_NEAREST;else if(h.get()=="linear")return CGL.Texture.FILTER_LINEAR;else if(h.get()=="mipmap")return CGL.Texture.FILTER_MIPMAP}function B(){if(u.get()=="repeat")return CGL.Texture.WRAP_REPEAT;else if(u.get()=="mirrored repeat")return CGL.Texture.WRAP_MIRRORED_REPEAT;else if(u.get()=="clamp to edge")return CGL.Texture.WRAP_CLAMP_TO_EDGE}function S(){let e=0;if(s.get()&&a.get()=="Auto")e=s.get().width;else if(a.get()=="Auto"||a.get()=="Canvas")e=t.canvasWidth;else if(a.get()=="ViewPort")e=t.getViewPort()[2];else e=Math.ceil(o.get());return i.patch.cgl.checkTextureSize(e)}function I(){let e=0;if(s.get()&&a.get()=="Auto")e=s.get().height;else if(a.get()=="Auto"||a.get()=="Canvas")e=t.canvasHeight;else if(a.get()=="ViewPort")e=t.getViewPort()[3];else e=Math.ceil(l.get());return i.patch.cgl.checkTextureSize(e)}function j(){x=true}function z(){if((S()!=v.width||I()!=v.height||v.pixelFormat!=g.get()||v.filter!=D()||v.wrap!=B())&&(S()!==0&&I()!==0)){C();F.setSourceTexture(v);b.setRef(v);M();P()}}function M(){let e=null;if(a.get()=="Manual"){e=null}else if(a.get()=="Auto"){if(s.get())e="Input Texture";else e="Canvas Size";e+=": "+S()+" x "+I()}let t=false;t=a.uiAttribs.info!=e;a.setUiAttribs({info:e});if(t)i.refreshParams()}function R(){if(T)T.toggleDefine("USE_TEX",s.isLinked()||!f.get());if(T)T.toggleDefine("USE_UVTEX",n.isLinked())}function O(){c.setUiAttribs({greyout:D()!=CGL.Texture.FILTER_MIPMAP});d.setUiAttribs({greyout:s.isLinked()});m.setUiAttribs({greyout:s.isLinked()});p.setUiAttribs({greyout:s.isLinked()});_.setUiAttribs({greyout:s.isLinked()});f.setUiAttribs({greyout:s.isLinked()});o.setUiAttribs({greyout:a.get()!="Manual"});l.setUiAttribs({greyout:a.get()!="Manual"});if(v)if(CGL.Texture.isPixelFormatFloat(g.get())&&D()==CGL.Texture.FILTER_MIPMAP)i.setUiError("fpmipmap","Don't use mipmap and 32bit at the same time, many systems do not support this.");else i.setUiError("fpmipmap",null);M();R();P()}function P(){if(v)if(s.isLinked()&&s.get()&&v.isFloatingPoint()<s.get().isFloatingPoint())i.setUiError("textypediff","Warning: Mixing floating point and non floating point texture can result in data/precision loss",1);else i.setUiError("textypediff",null)}i.preRender=()=>{N()};function H(){if(!T){T=new CGL.Shader(t,"copytextureshader");T.setSource(T.getDefaultVertexShader(),e.imgcomp_frag);k=new CGL.Uniform(T,"t","tex",0);V=new CGL.Uniform(T,"t","UVTex",1);G=new CGL.Uniform(T,"4f","bgColor",d,p,m,_);R()}t.pushShader(T);t.currentTextureEffect.bind();if(s.get())t.setTexture(0,s.get().tex);else if(!f.get()&&b.get())t.setTexture(0,b.get().tex);if(n.get())t.setTexture(1,n.get().tex);t.currentTextureEffect.finish();t.popShader()}function N(){if(!F||x)C();t.pushBlend(false);z();const e=t.currentTextureEffect;t.currentTextureEffect=F;t.currentTextureEffect.imgCompVer=3;t.currentTextureEffect.width=o.get();t.currentTextureEffect.height=l.get();F.setSourceTexture(v);F.startEffect(s.get()||CGL.Texture.getEmptyTexture(t,U),true);H();E.trigger();t.pushViewPort(0,0,o.get(),l.get());F.endEffect();b.setRef(F.getCurrentSourceTexture());t.popViewPort();t.popBlend();t.currentTextureEffect=e}}};CABLES.OPS["17212e2b-d692-464c-8f8d-2d511dd3410a"]={f:Ops.Gl.ImageCompose.ImageCompose_v4,objName:"Ops.Gl.ImageCompose.ImageCompose_v4"};Ops.Html.FullscreenMode=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const r=i.inTriggerButton("Request Fullscreen"),t=i.inTriggerButton("Exit Fullscreen"),s=i.inSwitch("Element",["Canvas","Document"],"Canvas"),n=i.outBoolNum("Is Fullscreen"),a=i.outBoolNum("Supported",document.fullscreenEnabled);t.onTriggered=g;r.onTriggered=c;let o=0;let l=null;function h(){n.set(!!document.fullscreenElement);clearTimeout(l);if(n.get())l=setTimeout(h,500)}function u(e){i.warn(e)}function c(){o++;if(o>30){r.onTriggered=null;i.setUiAttrib({error:"Fullscreen Request shound not triggered that often: op disabled"});g()}let e=null;if(s=="Canvas")e=i.patch.cgl.canvas.parentElement;else e=i.patch.getDocument().documentElement;let t=null;if(e.requestFullScreen)t=e.requestFullScreen();else if(e.mozRequestFullScreen)t=e.mozRequestFullScreen();else if(e.webkitRequestFullScreen)t=e.webkitRequestFullScreen();else if(e.msRequestFullScreen)t=e.msRequestFullScreen();if(t&&t.catch)t.catch(u);setTimeout(h,100);setTimeout(h,500);setTimeout(h,1e3)}function g(){o--;if(i.patch.getDocument().exitFullscreen)i.patch.getDocument().exitFullscreen().catch(u);else if(i.patch.getDocument().mozCancelFullScreen)i.patch.getDocument().mozCancelFullScreen().catch(u);else if(i.patch.getDocument().webkitExitFullscreen)i.patch.getDocument().webkitExitFullscreen().catch(u);else if(i.patch.getDocument().msExitFullscreen)i.patch.getDocument().msExitFullscreen().catch(u);setTimeout(h,100);setTimeout(h,500);setTimeout(h,1e3)}}};CABLES.OPS["fe933b35-696d-4738-be03-c0c011ed67a0"]={f:Ops.Html.FullscreenMode,objName:"Ops.Html.FullscreenMode"};Ops.Sidebar.Button_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inObject("link");const r=t.inString("Text","Button");const s=t.outObject("childs");const n=t.outTrigger("Pressed Trigger");const a=t.inBool("Grey Out",false);const o=t.inBool("Visible",true);const l=document.createElement("div");l.dataset.op=t.id;l.classList.add("cablesEle");l.classList.add("sidebar__item");l.classList.add("sidebar--button");const h=document.createElement("button");h.classList.add("sidebar__button-input");l.appendChild(h);h.addEventListener("click",g);h.style.width="100%";const u=document.createTextNode(r.get());h.appendChild(u);t.toWorkNeedsParent("Ops.Sidebar.Sidebar");i.onChange=d;r.onChange=f;t.onDelete=_;const c=document.createElement("div");c.classList.add("sidebar__greyout");l.appendChild(c);c.style.display="none";a.onChange=function(){c.style.display=a.get()?"block":"none"};o.onChange=function(){l.style.display=o.get()?"block":"none"};function g(){n.trigger()}function f(){const e=r.get();h.textContent=e;h.setAttribute("aria-label","button "+r.get());if(CABLES.UI)t.setUiAttrib({extendTitle:e})}function d(){s.set(null);const e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(l);s.set(e)}else{if(l.parentElement){l.parentElement.removeChild(l)}}}function p(e){if(e){e.style.display="block"}}function m(e){if(e){e.style.display="none"}}function _(){E(l)}function E(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}}};CABLES.OPS["5e9c6933-0605-4bf7-8671-a016d917f327"]={f:Ops.Sidebar.Button_v2,objName:"Ops.Sidebar.Button_v2"};Ops.Sidebar.Sidebar=class extends CABLES.Op{constructor(){super(...arguments);const a=this;const i=a.attachments={style_css:" /*\n * SIDEBAR\n  http://danielstern.ca/range.css/#/\n  https://developer.mozilla.org/en-US/docs/Web/CSS/::-webkit-progress-value\n */\n\n.sidebar-icon-undo\n{\n    width:10px;\n    height:10px;\n    background-image: url(\"data:image/svg+xml;charset=utf8, %3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='none' stroke='grey' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M3 7v6h6'/%3E%3Cpath d='M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13'/%3E%3C/svg%3E\");\n    background-size: 19px;\n    background-repeat: no-repeat;\n    top: -19px;\n    margin-top: -7px;\n}\n\n.icon-chevron-down {\n    top: 2px;\n    right: 9px;\n}\n\n.iconsidebar-chevron-up,.sidebar__close-button {\n\tbackground-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n}\n\n.iconsidebar-minimizebutton {\n    background-position: 98% center;\n    background-repeat: no-repeat;\n}\n\n.sidebar-cables-right\n{\n    right: 15px;\n    left: initial !important;\n}\n\n.sidebar-cables *\n{\n    color: #BBBBBB !important;\n    font-family: Arial;\n}\n\n.sidebar-cables {\n    --sidebar-color: #07f78c;\n    --sidebar-width: 220px;\n    --sidebar-border-radius: 10px;\n    --sidebar-monospace-font-stack: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n    --sidebar-hover-transition-time: .2s;\n\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    border-radius: var(--sidebar-border-radius);\n    z-index: 100000;\n    width: var(--sidebar-width);\n    max-height: 100%;\n    box-sizing: border-box;\n    overflow-y: auto;\n    overflow-x: hidden;\n    font-size: 13px;\n    line-height: 1em; /* prevent emojis from breaking height of the title */\n}\n\n.sidebar-cables::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar-cables::-webkit-scrollbar {\n    background-color: transparent;\n    --cables-scrollbar-width: 8px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-track {\n    background-color: transparent;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-thumb {\n    background-color: #333333;\n    border-radius: 4px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables--closed {\n    width: auto;\n}\n\n.sidebar__close-button {\n    background-color: #222;\n    /*-webkit-user-select: none;  */\n    /*-moz-user-select: none;     */\n    /*-ms-user-select: none;      */\n    /*user-select: none;          */\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    /*color: #CCCCCC;*/\n    height: 2px;\n    /*border-bottom:20px solid #222;*/\n\n    /*box-sizing: border-box;*/\n    /*padding-top: 2px;*/\n    /*text-align: center;*/\n    /*cursor: pointer;*/\n    /*border-radius: 0 0 var(--sidebar-border-radius) var(--sidebar-border-radius);*/\n    /*opacity: 1.0;*/\n    /*transition: opacity 0.3s;*/\n    /*overflow: hidden;*/\n}\n\n.sidebar__close-button-icon {\n    display: inline-block;\n    /*opacity: 0;*/\n    width: 20px;\n    height: 20px;\n    /*position: relative;*/\n    /*top: -1px;*/\n\n\n}\n\n.sidebar--closed {\n    width: auto;\n    margin-right: 20px;\n}\n\n.sidebar--closed .sidebar__close-button {\n    margin-top: 8px;\n    margin-left: 8px;\n    padding:10px;\n\n    height: 25px;\n    width:25px;\n    border-radius: 50%;\n    cursor: pointer;\n    opacity: 0.3;\n    background-repeat: no-repeat;\n    background-position: center center;\n    transform:rotate(180deg);\n}\n\n.sidebar--closed .sidebar__group\n{\n    display:none;\n\n}\n.sidebar--closed .sidebar__close-button-icon {\n    background-position: 0px 0px;\n}\n\n.sidebar__close-button:hover {\n    background-color: #111111;\n    opacity: 1.0 !important;\n}\n\n/*\n * SIDEBAR ITEMS\n */\n\n.sidebar__items {\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5;*/\n    background-color: #222;\n    padding-bottom: 20px;\n}\n\n.sidebar--closed .sidebar__items {\n    /* max-height: 0; */\n    height: 0;\n    display: none;\n    pointer-interactions: none;\n}\n\n.sidebar__item__right {\n    float: right;\n}\n\n/*\n * SIDEBAR GROUP\n */\n\n.sidebar__group {\n    /*background-color: #1A1A1A;*/\n    overflow: hidden;\n    box-sizing: border-box;\n    animate: height;\n    /*background-color: #151515;*/\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5s; */\n--sidebar-group-header-height: 33px;\n}\n\n.sidebar__group-items\n{\n    padding-top: 15px;\n    padding-bottom: 15px;\n}\n\n.sidebar__group--closed {\n    /* max-height: 13px; */\n    height: var(--sidebar-group-header-height);\n}\n\n.sidebar__group-header {\n    box-sizing: border-box;\n    color: #EEEEEE;\n    background-color: #151515;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n\n    /*height: 100%;//var(--sidebar-group-header-height);*/\n\n    padding-top: 7px;\n    text-transform: uppercase;\n    letter-spacing: 0.08em;\n    cursor: pointer;\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    position: relative;\n}\n\n.sidebar__group-header:hover {\n  background-color: #111111;\n}\n\n.sidebar__group-header-title {\n  /*float: left;*/\n  overflow: hidden;\n  padding: 0 15px;\n  padding-top:5px;\n  padding-bottom:10px;\n  font-weight:bold;\n}\n\n.sidebar__group-header-undo {\n    float: right;\n    overflow: hidden;\n    padding-right: 15px;\n    padding-top:5px;\n    font-weight:bold;\n  }\n\n.sidebar__group-header-icon {\n    width: 17px;\n    height: 14px;\n    background-repeat: no-repeat;\n    display: inline-block;\n    position: absolute;\n    background-size: cover;\n\n    /* icon open */\n    /* feather icon: chevron up */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n    top: 4px;\n    right: 5px;\n    opacity: 0.0;\n    transition: opacity 0.3;\n}\n\n.sidebar__group-header:hover .sidebar__group-header-icon {\n    opacity: 1.0;\n}\n\n/* icon closed */\n.sidebar__group--closed .sidebar__group-header-icon {\n    /* feather icon: chevron down */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);\n    top: 4px;\n    right: 5px;\n}\n\n/*\n * SIDEBAR ITEM\n */\n\n.sidebar__item\n{\n    box-sizing: border-box;\n    padding: 7px;\n    padding-left:15px;\n    padding-right:15px;\n\n    overflow: hidden;\n    position: relative;\n}\n\n.sidebar__item-label {\n    display: inline-block;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    width: calc(50% - 7px);\n    margin-right: 7px;\n    margin-top: 2px;\n    text-overflow: ellipsis;\n    /* overflow: hidden; */\n}\n\n.sidebar__item-value-label {\n    font-family: var(--sidebar-monospace-font-stack);\n    display: inline-block;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    max-width: 60%;\n}\n\n.sidebar__item-value-label::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar__item + .sidebar__item,\n.sidebar__item + .sidebar__group,\n.sidebar__group + .sidebar__item,\n.sidebar__group + .sidebar__group {\n    /*border-top: 1px solid #272727;*/\n}\n\n/*\n * SIDEBAR ITEM TOGGLE\n */\n\n/*.sidebar__toggle */\n.icon_toggle{\n    cursor: pointer;\n}\n\n.sidebar__toggle-input {\n    --sidebar-toggle-input-color: #CCCCCC;\n    --sidebar-toggle-input-color-hover: #EEEEEE;\n    --sidebar-toggle-input-border-size: 2px;\n    display: inline;\n    float: right;\n    box-sizing: border-box;\n    border-radius: 50%;\n    /*outline-style: solid;*/\n    /*outline-color:red;*/\n    cursor: pointer;\n    --toggle-size: 11px;\n    margin-top: 2px;\n    background-color: transparent !important;\n    border: var(--sidebar-toggle-input-border-size) solid var(--sidebar-toggle-input-color);\n    width: var(--toggle-size);\n    height: var(--toggle-size);\n    transition: background-color var(--sidebar-hover-transition-time);\n    transition: border-color var(--sidebar-hover-transition-time);\n}\n.sidebar__toggle:hover .sidebar__toggle-input {\n    border-color: var(--sidebar-toggle-input-color-hover);\n}\n\n.sidebar__toggle .sidebar__item-value-label {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    max-width: calc(50% - 12px);\n}\n.sidebar__toggle-input::after { clear: both; }\n\n.sidebar__toggle--active .icon_toggle\n{\n\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjMDZmNzhiIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzA2Zjc4YiIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjMDZmNzhiIiBzdHJva2U9IiMwNmY3OGIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwNmY3OGIiIHN0cm9rZT0iIzA2Zjc4YiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    opacity: 1;\n    transform: rotate(0deg);\n    background-position: -4px -9px;\n}\n\n\n.icon_toggle\n{\n    float: right;\n    width:40px;\n    height:18px;\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjYWFhYWFhIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI2FhYWFhYSIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjYWFhYWFhIiBzdHJva2U9IiNhYWFhYWEiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNhYWFhYWEiIHN0cm9rZT0iI2FhYWFhYSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    background-size: 50px 37px;\n    background-position: -6px -10px;\n    transform: rotate(180deg);\n    opacity: 0.4;\n}\n\n\n\n/*.sidebar__toggle--active .sidebar__toggle-input {*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    background-color: var(--sidebar-toggle-input-color);*/\n/*}*/\n/*.sidebar__toggle--active .sidebar__toggle-input:hover*/\n/*{*/\n/*    background-color: var(--sidebar-toggle-input-color-hover);*/\n/*    border-color: var(--sidebar-toggle-input-color-hover);*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    transition: border-color var(--sidebar-hover-transition-time);*/\n/*}*/\n\n/*\n * SIDEBAR ITEM BUTTON\n */\n\n.sidebar__button {}\n\n.sidebar__button-input:active\n{\n    background-color: #555 !important;\n}\n\n.sidebar__button-input {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    min-height: 24px;\n    background-color: transparent;\n    color: #CCCCCC;\n    box-sizing: border-box;\n    padding-top: 3px;\n    text-align: center;\n    border-radius: 125px;\n    border:2px solid #555;\n    cursor: pointer;\n    padding-bottom: 3px;\n    display:block;\n}\n\n.sidebar__button-input.plus, .sidebar__button-input.minus {\n    display: inline-block;\n    min-width: 20px;\n}\n\n.sidebar__button-input:hover {\n  background-color: #333;\n  border:2px solid var(--sidebar-color);\n}\n\n/*\n * VALUE DISPLAY (shows a value)\n */\n\n.sidebar__value-display {}\n\n/*\n * SLIDER\n */\n\n.sidebar__slider {\n    --sidebar-slider-input-height: 3px;\n}\n\n.sidebar__slider-input-wrapper {\n    width: 100%;\n\n    margin-top: 8px;\n    position: relative;\n}\n\n.sidebar__slider-input {\n    -webkit-appearance: none;\n    appearance: none;\n    margin: 0;\n    width: 100%;\n    height: var(--sidebar-slider-input-height);\n    background: #555;\n    cursor: pointer;\n    /*outline: 0;*/\n\n    -webkit-transition: .2s;\n    transition: background-color .2s;\n    border: none;\n}\n\n.sidebar__slider-input:focus, .sidebar__slider-input:hover {\n    border: none;\n}\n\n.sidebar__slider-input-active-track {\n    user-select: none;\n    position: absolute;\n    z-index: 11;\n    top: 0;\n    left: 0;\n    background-color: var(--sidebar-color);\n    pointer-events: none;\n    height: var(--sidebar-slider-input-height);\n    max-width: 100%;\n}\n\n/* Mouse-over effects */\n.sidebar__slider-input:hover {\n    /*background-color: #444444;*/\n}\n\n/*.sidebar__slider-input::-webkit-progress-value {*/\n/*    background-color: green;*/\n/*    color:green;*/\n\n/*    }*/\n\n/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */\n\n.sidebar__slider-input::-moz-range-thumb\n{\n    position: absolute;\n    height: 15px;\n    width: 15px;\n    z-index: 900 !important;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: var(--sidebar-color) !important;\n    user-select: none;\n\n}\n\n.sidebar__slider-input::-webkit-slider-thumb\n{\n    position: relative;\n    appearance: none;\n    -webkit-appearance: none;\n    user-select: none;\n    height: 15px;\n    width: 15px;\n    display: block;\n    z-index: 900 !important;\n    border: 0;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: #777 !important;\n}\n\n.sidebar__slider-input:hover ::-webkit-slider-thumb {\n    background-color: #EEEEEE !important;\n}\n\n/*.sidebar__slider-input::-moz-range-thumb {*/\n\n/*    width: 0 !important;*/\n/*    height: var(--sidebar-slider-input-height);*/\n/*    background: #EEEEEE;*/\n/*    cursor: pointer;*/\n/*    border-radius: 0 !important;*/\n/*    border: none;*/\n/*    outline: 0;*/\n/*    z-index: 100 !important;*/\n/*}*/\n\n.sidebar__slider-input::-moz-range-track {\n    background-color: transparent;\n    z-index: 11;\n}\n\n.sidebar__slider input[type=text],\n.sidebar__slider input[type=paddword]\n{\n    box-sizing: border-box;\n    /*background-color: #333333;*/\n    text-align: right;\n    color: #BBBBBB;\n    display: inline-block;\n    background-color: transparent !important;\n\n    width: 40%;\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n}\n\n.sidebar__slider input[type=text]:active,\n.sidebar__slider input[type=text]:focus,\n.sidebar__slider input[type=text]:hover,\n.sidebar__slider input[type=password]:active,\n.sidebar__slider input[type=password]:focus,\n.sidebar__slider input[type=password]:hover\n{\n\n    color: #EEEEEE;\n}\n\n/*\n * TEXT / DESCRIPTION\n */\n\n.sidebar__text .sidebar__item-label {\n    width: auto;\n    display: block;\n    max-height: none;\n    margin-right: 0;\n    line-height: 1.1em;\n}\n\n/*\n * SIDEBAR INPUT\n */\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=date],\n.sidebar__text-input input[type=datetime-local],\n.sidebar__text-input input[type=text],\n.sidebar__text-input input[type=search],\n.sidebar__text-input input[type=password] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: 50%;\n    height: 18px;\n\n\n    border: none;\n    border-radius: 0;\n    border:1px solid #666;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    color-scheme: dark;\n}\n\n.sidebar__text-input textarea:focus::placeholder {\n  color: transparent;\n}\n\n\n\n\n\n.sidebar__color-picker .sidebar__item-label\n{\n    width:45%;\n}\n\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=text]:active,\n.sidebar__text-input input[type=text]:focus,\n.sidebar__text-input input[type=text]:hover,\n.sidebar__text-input input[type=search]:active,\n.sidebar__text-input input[type=search]:focus,\n.sidebar__text-input input[type=search]:hover,\n.sidebar__text-input input[type=password]:active,\n.sidebar__text-input input[type=password]:focus,\n.sidebar__text-input input[type=password]:hover {\n    background-color: transparent;\n    color: #EEEEEE;\n\n}\n\n.sidebar__text-input textarea\n{\n    margin-top:10px;\n    height:60px;\n    width:100%;\n}\n\n/*\n * SIDEBAR SELECT\n */\n\n\n\n .sidebar__select {}\n .sidebar__select-select {\n    color: #BBBBBB;\n    /*-webkit-appearance: none;*/\n    /*-moz-appearance: none;*/\n    appearance: none;\n    /*box-sizing: border-box;*/\n    width: 50%;\n    /*height: 20px;*/\n    background-color: #333333;\n    /*background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);*/\n    background-repeat: no-repeat;\n    background-position: right center;\n    background-size: 16px 16px;\n    margin: 0;\n    /*padding: 0 2 2 6px;*/\n    border-radius: 5px;\n    border: 1px solid #777;\n    background-color: #444;\n    cursor: pointer;\n    /*outline: none;*/\n    padding-left: 5px;\n\n }\n\n.sidebar__select-select:hover,\n.sidebar__select-select:active,\n.sidebar__select-select:inactive {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\n/*.sidebar__select-select option*/\n/*{*/\n/*    background-color: #444444;*/\n/*    color: #bbb;*/\n/*}*/\n\n.sidebar__select-select option:checked\n{\n    background-color: #000;\n    color: #FFF;\n}\n\n\n/*\n * COLOR PICKER\n */\n\n\n .sidebar__color-picker input[type=text] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: calc(50% - 21px); /* 50% minus space of picker circle */\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    margin-right: 7px;\n}\n\n.sidebar__color-picker input[type=text]:active,\n.sidebar__color-picker input[type=text]:focus,\n.sidebar__color-picker input[type=text]:hover {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\ndiv.sidebar__color-picker-color-input,\n.sidebar__color-picker input[type=color],\n.sidebar__palette-picker input[type=color] {\n    display: inline-block;\n    border-radius: 100%;\n    height: 14px;\n    width: 14px;\n\n    padding: 0;\n    border: none;\n    /*border:2px solid red;*/\n    border-color: transparent;\n    outline: none;\n    background: none;\n    appearance: none;\n    -moz-appearance: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n    position: relative;\n    top: 3px;\n}\n.sidebar__color-picker input[type=color]:focus,\n.sidebar__palette-picker input[type=color]:focus {\n    outline: none;\n}\n.sidebar__color-picker input[type=color]::-moz-color-swatch,\n.sidebar__palette-picker input[type=color]::-moz-color-swatch {\n    border: none;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch-wrapper,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch-wrapper {\n    padding: 0;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch {\n    border: none;\n    border-radius: 100%;\n}\n\n/*\n * Palette Picker\n */\n.sidebar__palette-picker .sidebar__palette-picker-color-input.first {\n    margin-left: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input.last {\n    margin-right: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input {\n    margin: 0 4px;\n}\n\n.sidebar__palette-picker .circlebutton {\n    width: 14px;\n    height: 14px;\n    border-radius: 1em;\n    display: inline-block;\n    top: 3px;\n    position: relative;\n}\n\n/*\n * Preset\n */\n.sidebar__item-presets-preset\n{\n    padding:4px;\n    cursor:pointer;\n    padding-left:8px;\n    padding-right:8px;\n    margin-right:4px;\n    background-color:#444;\n}\n\n.sidebar__item-presets-preset:hover\n{\n    background-color:#666;\n}\n\n.sidebar__greyout\n{\n    background: #222;\n    opacity: 0.8;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    z-index: 1000;\n    right: 0;\n    top: 0;\n}\n\n.sidebar_tabs\n{\n    background-color: #151515;\n    padding-bottom: 0px;\n}\n\n.sidebar_switchs\n{\n    float: right;\n}\n\n.sidebar_tab\n{\n    float:left;\n    background-color: #151515;\n    border-bottom:1px solid transparent;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_tab_active\n{\n    background-color: #272727;\n    color:white;\n}\n\n.sidebar_tab:hover\n{\n    border-bottom:1px solid #777;\n    color:white;\n}\n\n\n.sidebar_switch\n{\n    float:left;\n    background-color: #444;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_switch:last-child\n{\n    border-top-right-radius: 7px;\n    border-bottom-right-radius: 7px;\n}\n\n.sidebar_switch:first-child\n{\n    border-top-left-radius: 7px;\n    border-bottom-left-radius: 7px;\n}\n\n\n.sidebar_switch_active\n{\n    background-color: #999;\n    color:white;\n}\n\n.sidebar_switch:hover\n{\n    color:white;\n}\n\n.sidebar__text-input-input::focus-visible,\n/*.sidebar__text-input-input:active,*/\n.sidebar__button-input:focus-visible,\n.sidebar__text-input:focus-visible\n/*.sidebar__text-input:active*/\n{\n    outline-style: solid;\n    outline-color:white;\n    outline-width: 1px;\n\n}\n\n"};const r="cables-sidebar-style";const s="cables-sidebar-dynamic-style";const o="sidebar-cables";const l="sidebar"+CABLES.uuid();const h="sidebar__items";const u="sidebar__close-button";const n="";const c="";let g=null;let y=null;let f=null;const e=a.inValueBool("Visible",true);const t=a.inValueSlider("Opacity",1);const d=a.inValueBool("Default Minimized");const p=a.inValueSlider("Minimized Opacity",.5);const m=a.inValueBool("Show undo button",false);const _=a.inValueBool("Show Minimize",false);const E=a.inString("Title","");const b=a.inValueBool("Side");const A=a.inValueBool("Default CSS",true);let F=a.patch.cgl.canvas.ownerDocument;const v=a.outObject("childs");v.setUiAttribs({title:"Children"});const x=a.outBool("Opfened");x.setUiAttribs({title:"Opened"});let T=F.querySelector("."+l);if(!T)T=L();const C=T.querySelector("."+h);v.set({parentElement:C,parentOp:a});M();N();O();A.onChange=()=>{N();O()};e.onChange=w;t.onChange=R;d.onChange=M;p.onChange=D;m.onChange=S;a.onDelete=k;function D(){O()}_.onChange=B;function B(e){if(!e||e.uiAttribs)e=F.querySelector(".sidebar-cables .sidebar__group-header");if(!e)return;const t=F.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(_.get()){e.classList.add("iconsidebar-chevron-up");e.classList.add("iconsidebar-minimizebutton");if(t)t.style.marginRight="20px"}else{e.classList.remove("iconsidebar-chevron-up");e.classList.remove("iconsidebar-minimizebutton");if(t)t.style.marginRight="initial"}}b.onChange=function(){if(!T)return;if(b.get())T.classList.add("sidebar-cables-right");else T.classList.remove("sidebar-cables-right")};function S(){const e=F.querySelector(".sidebar-cables .sidebar__group-header");if(e){I(e)}}function I(e){if(e){const t=F.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(t){if(!m.get()){t.remove()}}else{if(m.get()){const i=F.createElement("span");i.classList.add("sidebar__group-header-undo");i.classList.add("sidebar-icon-undo");i.addEventListener("click",function(e){e.stopPropagation();const t=F.querySelectorAll(".sidebar-cables .sidebar__reloadable");const i=F.createEvent("MouseEvents");i.initEvent("dblclick",true,true);t.forEach(e=>{e.dispatchEvent(i)})});e.appendChild(i)}}}B(e)}function M(){if(!g){return}if(d.get()){T.classList.add("sidebar--closed");if(e.get())x.set(false)}else{T.classList.remove("sidebar--closed");if(e.get())x.set(true)}}function R(){const e=t.get();T.style.opacity=e}function w(){if(!T)return;if(e.get()){T.style.display="block";if(!T.classList.contains("sidebar--closed"))x.set(true)}else{T.style.display="none";x.set(false)}}b.onChanged=function(){};function O(){const e=F.querySelectorAll("."+s);if(e){e.forEach(function(e){e.parentNode.removeChild(e)})}if(!A.get())return;const t=F.createElement("style");t.classList.add("cablesEle");t.classList.add(s);let i=".sidebar--closed .sidebar__close-button { ";i+="opacity: "+p.get();i+="}";const r=F.createTextNode(i);t.appendChild(r);F.body.appendChild(t)}function L(){const e=F.createElement("div");e.classList.add(o);e.classList.add(l);const t=a.patch.cgl.canvas.parentElement;const i=F.createElement("div");i.classList.add("sidebar__group");e.appendChild(i);const r=F.createElement("div");r.classList.add("sidebar__group-header");e.appendChild(r);const s=F.createElement("span");s.classList.add("sidebar__group-header-title");f=F.createElement("span");f.classList.add("sidebar__group-header-title-text");f.innerHTML=E.get();s.appendChild(f);r.appendChild(s);I(r);B(r);i.appendChild(r);e.appendChild(i);i.addEventListener("click",P);if(!t){a.warn("[sidebar] no canvas parentelement found...");return}t.appendChild(e);const n=F.createElement("div");n.classList.add(h);e.appendChild(n);g=F.createElement("div");g.classList.add(u);g.addEventListener("click",P);e.appendChild(g);return e}E.onChange=function(){if(f)f.innerHTML=E.get()};function U(e){}function P(e){e.stopPropagation();if(!T){a.logError("Sidebar could not be closed...");return}T.classList.toggle("sidebar--closed");const t=e.target;let i=n;if(T.classList.contains("sidebar--closed")){i=c;x.set(false)}else{x.set(true)}}function N(){const e=F.querySelectorAll("."+r);if(e){e.forEach(e=>{e.parentNode.removeChild(e)})}if(!A.get())return;const t=F.createElement("style");t.innerHTML=i.style_css;t.classList.add(r);t.classList.add("cablesEle");F.body.appendChild(t)}function k(){V(T)}function V(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}}};CABLES.OPS["5a681c35-78ce-4cb3-9858-bc79c34c6819"]={f:Ops.Sidebar.Sidebar,objName:"Ops.Sidebar.Sidebar"};Ops.Gl.Meshes.Grid=class extends CABLES.Op{constructor(){super(...arguments);const l=this;const e=l.attachments={};const t=l.inTrigger("Render"),h=l.inInt("Num",10),u=l.inValue("Spacing",1),c=l.inBool("Center",true),g=l.inSwitch("Axis",["XY","XZ"],"XY"),i=l.outTrigger("Next");const f=l.patch.cgl;let d=null;g.onChange=c.onChange=h.onChange=u.onChange=function(){if(d)d.dispose();d=null};function r(){const t=new CGL.Geometry(l.name);const e=new CGL.Geometry(l.name);const i=u.get();const r=Math.floor(h.get());const s=i*r/2;const n=[];let a=-r/2;let o=r/2+1;if(g.get()=="XY")for(let e=a;e<o;e++){t.vertices.push(-s,e*i,0);t.vertices.push(s,e*i,0);t.vertices.push(e*i,-s,0);t.vertices.push(e*i,s,0);n.push(0,0,0,0,0,0,0,0)}else for(let e=a;e<o;e++){t.vertices.push(-s,0,e*i);t.vertices.push(s,0,e*i);t.vertices.push(e*i,0,-s);t.vertices.push(e*i,0,s);n.push(0,0,0,0,0,0,0,0)}if(!c.get()){for(let e=0;e<t.vertices.length;e+=3){t.vertices[e+0]+=s;t.vertices[e+1]+=s}}t.setTexCoords(n);t.calculateNormals();if(!d)d=new CGL.Mesh(f,t);else d.setGeom(t)}t.onTriggered=function(){if(!d)r();let e=f.getShader();if(!e)return;let t=e.glPrimitive;e.glPrimitive=f.gl.LINES;d.render(e);e.glPrimitive=t;i.trigger()}}};CABLES.OPS["677a7c03-6885-46b4-8a64-e4ea54ee5d7f"]={f:Ops.Gl.Meshes.Grid,objName:"Ops.Gl.Meshes.Grid"};Ops.Gl.Shader.BasicMaterial_v3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={basicmaterial_frag:"{{MODULES_HEAD}}\n\nIN vec2 texCoord;\n\n#ifdef VERTEX_COLORS\nIN vec4 vertCol;\n#endif\n\n#ifdef HAS_TEXTURES\n    IN vec2 texCoordOrig;\n    #ifdef HAS_TEXTURE_DIFFUSE\n        UNI sampler2D tex;\n    #endif\n    #ifdef HAS_TEXTURE_OPACITY\n        UNI sampler2D texOpacity;\n   #endif\n#endif\n\n\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n    vec4 col=color;\n\n\n    #ifdef HAS_TEXTURES\n        vec2 uv=texCoord;\n\n        #ifdef CROP_TEXCOORDS\n            if(uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0) discard;\n        #endif\n\n        #ifdef HAS_TEXTURE_DIFFUSE\n            col=texture(tex,uv);\n\n            #ifdef COLORIZE_TEXTURE\n                col.r*=color.r;\n                col.g*=color.g;\n                col.b*=color.b;\n            #endif\n        #endif\n        col.a*=color.a;\n        #ifdef HAS_TEXTURE_OPACITY\n            #ifdef TRANSFORMALPHATEXCOORDS\n                uv=texCoordOrig;\n            #endif\n            #ifdef ALPHA_MASK_IR\n                col.a*=1.0-texture(texOpacity,uv).r;\n            #endif\n            #ifdef ALPHA_MASK_IALPHA\n                col.a*=1.0-texture(texOpacity,uv).a;\n            #endif\n            #ifdef ALPHA_MASK_ALPHA\n                col.a*=texture(texOpacity,uv).a;\n            #endif\n            #ifdef ALPHA_MASK_LUMI\n                col.a*=dot(vec3(0.2126,0.7152,0.0722), texture(texOpacity,uv).rgb);\n            #endif\n            #ifdef ALPHA_MASK_R\n                col.a*=texture(texOpacity,uv).r;\n            #endif\n            #ifdef ALPHA_MASK_G\n                col.a*=texture(texOpacity,uv).g;\n            #endif\n            #ifdef ALPHA_MASK_B\n                col.a*=texture(texOpacity,uv).b;\n            #endif\n            // #endif\n        #endif\n    #endif\n\n    {{MODULE_COLOR}}\n\n    #ifdef DISCARDTRANS\n        if(col.a<0.2) discard;\n    #endif\n\n    #ifdef VERTEX_COLORS\n        col*=vertCol;\n    #endif\n\n    outColor = col;\n}\n",basicmaterial_vert:"\n{{MODULES_HEAD}}\n\nOUT vec2 texCoord;\nOUT vec2 texCoordOrig;\n\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\n#ifdef HAS_TEXTURES\n    UNI float diffuseRepeatX;\n    UNI float diffuseRepeatY;\n    UNI float texOffsetX;\n    UNI float texOffsetY;\n#endif\n\n#ifdef VERTEX_COLORS\n    in vec4 attrVertColor;\n    out vec4 vertCol;\n\n#endif\n\n\nvoid main()\n{\n    mat4 mMatrix=modelMatrix;\n    mat4 modelViewMatrix;\n\n    norm=attrVertNormal;\n    texCoordOrig=attrTexCoord;\n    texCoord=attrTexCoord;\n    #ifdef HAS_TEXTURES\n        texCoord.x=texCoord.x*diffuseRepeatX+texOffsetX;\n        texCoord.y=(1.0-texCoord.y)*diffuseRepeatY+texOffsetY;\n    #endif\n\n    #ifdef VERTEX_COLORS\n        vertCol=attrVertColor;\n    #endif\n\n    vec4 pos = vec4(vPosition, 1.0);\n\n    #ifdef BILLBOARD\n       vec3 position=vPosition;\n       modelViewMatrix=viewMatrix*modelMatrix;\n\n       gl_Position = projMatrix * modelViewMatrix * vec4((\n           position.x * vec3(\n               modelViewMatrix[0][0],\n               modelViewMatrix[1][0],\n               modelViewMatrix[2][0] ) +\n           position.y * vec3(\n               modelViewMatrix[0][1],\n               modelViewMatrix[1][1],\n               modelViewMatrix[2][1]) ), 1.0);\n    #endif\n\n    {{MODULE_VERTEX_POSITION}}\n\n    #ifndef BILLBOARD\n        modelViewMatrix=viewMatrix * mMatrix;\n\n        {{MODULE_VERTEX_MODELVIEW}}\n\n    #endif\n\n    // mat4 modelViewMatrix=viewMatrix*mMatrix;\n\n    #ifndef BILLBOARD\n        // gl_Position = projMatrix * viewMatrix * modelMatrix * pos;\n        gl_Position = projMatrix * modelViewMatrix * pos;\n    #endif\n}\n"};const i=e.inTrigger("render");const r=e.outTrigger("trigger");const s=e.outObject("shader",null,"shader");s.ignoreValueSerialize=true;e.toWorkPortsNeedToBeLinked(i);e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);const n=e.patch.cgl;const a=new CGL.Shader(n,"basicmaterial",this);a.addAttribute({type:"vec3",name:"vPosition"});a.addAttribute({type:"vec2",name:"attrTexCoord"});a.addAttribute({type:"vec3",name:"attrVertNormal",nameFrag:"norm"});a.addAttribute({type:"float",name:"attrVertIndex"});a.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);a.setSource(t.basicmaterial_vert,t.basicmaterial_frag);s.setRef(a);i.onTriggered=B;const o=e.inValueSlider("r",Math.random());const l=e.inValueSlider("g",Math.random());const h=e.inValueSlider("b",Math.random());const u=e.inValueSlider("a",1);o.setUiAttribs({colorPick:true});const c=a.addUniformFrag("4f","color",o,l,h,u);a.uniformColorDiffuse=c;const g=e.inTexture("texture");let f=null;g.onChange=I;const d=e.inValueBool("colorizeTexture",false);const p=e.inValueBool("Vertex Colors",false);const m=e.inTexture("textureOpacity");let _=null;const E=e.inSwitch("Alpha Mask Source",["Luminance","R","G","B","A","1-A","1-R"],"Luminance");E.setUiAttribs({greyout:true});m.onChange=S;const b=e.inValueBool("Opacity TexCoords Transform",false);const A=e.inValueBool("Discard Transparent Pixels");const F=e.inValue("diffuseRepeatX",1),v=e.inValue("diffuseRepeatY",1),x=e.inValue("Tex Offset X",0),T=e.inValue("Tex Offset Y",0),C=e.inBool("Crop TexCoords",false);a.addUniformFrag("f","diffuseRepeatX",F);a.addUniformFrag("f","diffuseRepeatY",v);a.addUniformFrag("f","texOffsetX",x);a.addUniformFrag("f","texOffsetY",T);const D=e.inValueBool("billboard",false);E.onChange=D.onChange=A.onChange=b.onChange=C.onChange=p.onChange=d.onChange=R;e.setPortGroup("Color",[o,l,h,u]);e.setPortGroup("Color Texture",[g,p,d]);e.setPortGroup("Opacity",[m,E,A,b]);e.setPortGroup("Texture Transform",[F,v,x,T,C]);S();I();e.preRender=function(){a.bind();B();if(!a)return};function B(){e.checkGraphicsApi();n.pushShader(a);a.popTextures();if(f&&g.get())a.pushTexture(f,g.get());if(_&&m.get())a.pushTexture(_,m.get());r.trigger();n.popShader()}function S(){if(m.get()){if(_!==null)return;a.removeUniform("texOpacity");a.define("HAS_TEXTURE_OPACITY");if(!_)_=new CGL.Uniform(a,"t","texOpacity")}else{a.removeUniform("texOpacity");a.removeDefine("HAS_TEXTURE_OPACITY");_=null}R()}function I(){if(g.get()){if(!a.hasDefine("HAS_TEXTURE_DIFFUSE"))a.define("HAS_TEXTURE_DIFFUSE");if(!f)f=new CGL.Uniform(a,"t","texDiffuse")}else{a.removeUniform("texDiffuse");a.removeDefine("HAS_TEXTURE_DIFFUSE");f=null}M()}function M(){const e=g.isLinked()||m.isLinked();F.setUiAttribs({greyout:!e});v.setUiAttribs({greyout:!e});x.setUiAttribs({greyout:!e});T.setUiAttribs({greyout:!e});d.setUiAttribs({greyout:!e});E.setUiAttribs({greyout:!m.get()});b.setUiAttribs({greyout:!m.get()});let t=true;t=g.get()&&!d.get();o.setUiAttribs({greyout:t});l.setUiAttribs({greyout:t});h.setUiAttribs({greyout:t})}function R(){a.toggleDefine("VERTEX_COLORS",p.get());a.toggleDefine("CROP_TEXCOORDS",C.get());a.toggleDefine("COLORIZE_TEXTURE",d.get());a.toggleDefine("TRANSFORMALPHATEXCOORDS",b.get());a.toggleDefine("DISCARDTRANS",A.get());a.toggleDefine("BILLBOARD",D.get());a.toggleDefine("ALPHA_MASK_ALPHA",E.get()=="A");a.toggleDefine("ALPHA_MASK_IALPHA",E.get()=="1-A");a.toggleDefine("ALPHA_MASK_IR",E.get()=="1-R");a.toggleDefine("ALPHA_MASK_LUMI",E.get()=="Luminance");a.toggleDefine("ALPHA_MASK_R",E.get()=="R");a.toggleDefine("ALPHA_MASK_G",E.get()=="G");a.toggleDefine("ALPHA_MASK_B",E.get()=="B");M()}}};CABLES.OPS["ec55d252-3843-41b1-b731-0482dbd9e72b"]={f:Ops.Gl.Shader.BasicMaterial_v3,objName:"Ops.Gl.Shader.BasicMaterial_v3"};Ops.Gl.Meshes.RectangleFrame_v2=class extends CABLES.Op{constructor(){super(...arguments);const o=this;const e=o.attachments={};const t=o.inTrigger("Render"),l=o.inValueFloat("Width",1),h=o.inValueFloat("Height",1),u=o.inValueFloat("Thickness",-.1),c=o.inSwitch("pivot x",["center","left","right"],"center"),g=o.inSwitch("pivot y",["center","top","bottom"],"center"),i=o.outTrigger("trigger"),f=o.outObject("Geometry"),d=o.inValueBool("Draw Top",true),p=o.inValueBool("Draw Bottom",true),m=o.inValueBool("Draw Left",true),_=o.inValueBool("Draw Right",true),r=o.inValueBool("Active",true);o.toWorkPortsNeedToBeLinked(t);o.setPortGroup("Geometry",[l,h,u]);o.setPortGroup("Transform",[c,g]);o.setPortGroup("Sections",[d,p,m,_]);const s=o.patch.cgl;let E=null;const b=new CGL.Geometry(o.name);b.tangents=[];b.biTangents=[];f.ignoreValueSerialize=true;l.onChange=c.onChange=g.onChange=h.onChange=u.onChange=d.onChange=p.onChange=m.onChange=_.onChange=()=>{E=null};t.onTriggered=function(){if(!E)n();if(r.get()&&E)E.render();i.trigger()};function n(){const i=l.get();const r=h.get();let e=-i/2;let t=-r/2;const s=u.get();if(c.get()=="right")e=-i;else if(c.get()=="left")e=0;if(g.get()=="top")t=-r;else if(g.get()=="bottom")t=0;b.vertices.length=0;b.vertices.push(e,t,0,e+i,t,0,e+i,t+r,0,e,t+r,0,e-s,t-s,0,e+i+s,t-s,0,e+i+s,t+r+s,0,e-s,t+r+s,0);if(b.vertexNormals.length===0)b.vertexNormals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];if(b.tangents.length===0)b.tangents=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0];if(b.biTangents.length===0)b.biTangents=[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0];if(b.verticesIndices)b.verticesIndices.length=0;else b.verticesIndices=[];const n=[];if(p.get())n.push(0,1,4,1,5,4);if(_.get())n.push(1,2,5,5,2,6);if(d.get())n.push(7,6,3,6,2,3);if(m.get())n.push(0,4,3,4,7,3);b.verticesIndices=n;if(b.texCoords.length===0){const a=[];for(let e=0,t=0;e<b.vertices.length;e+=3,t+=2){a[t]=b.vertices[e+0]/i-.5;a[t+1]=b.vertices[e+1]/r-.5}b.texCoords=a}if(!E)E=o.patch.cg.createMesh(b,{opId:o.id});else E.setGeom(b);f.setRef(b)}}};CABLES.OPS["34e4535e-a784-4474-9b6f-a7e54e26f09e"]={f:Ops.Gl.Meshes.RectangleFrame_v2,objName:"Ops.Gl.Meshes.RectangleFrame_v2"};Ops.Trigger.TriggerExtender=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Execute"),r=e.outTrigger("Next");i.onTriggered=function(){r.trigger()}}};CABLES.OPS["7ef594f3-4907-47b0-a2d3-9854eda1679d"]={f:Ops.Trigger.TriggerExtender,objName:"Ops.Trigger.TriggerExtender"};Ops.Ui.Area=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("Title",""),r=e.inTriggerButton("Delete");i.setUiAttribs({hidePort:true});e.setUiAttrib({hasArea:true});e.init=i.onChange=e.onLoaded=s;s();function s(){if(CABLES.UI){gui.savedState.setUnSaved("areaOp",e.getSubPatch());e.uiAttr({comment_title:i.get()||" "});e.name=i.get()}}r.onTriggered=()=>{e.patch.deleteOp(e.id)}}};CABLES.OPS["38f79614-b0de-4960-8da5-2827e7f43415"]={f:Ops.Ui.Area,objName:"Ops.Ui.Area"};Ops.Graphics.Transform=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inTrigger("render"),r=i.inValue("posX",0),s=i.inValue("posY",0),n=i.inValue("posZ",0),a=i.inValue("scale",1),o=i.inValue("rotX",0),l=i.inValue("rotY",0),h=i.inValue("rotZ",0),u=i.outTrigger("trigger");i.setPortGroup("Rotation",[o,l,h]);i.setPortGroup("Position",[r,s,n]);i.setPortGroup("Scale",[a]);i.setUiAxisPorts(r,s,n);i.toWorkPortsNeedToBeLinked(t,u);const c=vec3.create();const g=vec3.create();const f=mat4.create();mat4.identity(f);let d=false,p=false,m=true,_=true,E=true;o.onChange=l.onChange=h.onChange=T;r.onChange=s.onChange=n.onChange=v;a.onChange=x;t.onTriggered=function(){let e=false;if(m){A();e=true}if(_){F();e=true}if(E)e=true;if(e)b();const t=i.patch.cg||i.patch.cgl;t.pushModelMatrix();mat4.multiply(t.mMatrix,t.mMatrix,f);u.trigger();t.popModelMatrix();if(CABLES.UI){if(!r.isLinked()&&!s.isLinked()&&!n.isLinked()){gui.setTransform(i.id,r.get(),s.get(),n.get());if(i.isCurrentUiOp())gui.setTransformGizmo({posX:r,posY:s,posZ:n})}}};function b(){mat4.identity(f);if(p)mat4.translate(f,f,c);if(o.get()!==0)mat4.rotateX(f,f,o.get()*CGL.DEG2RAD);if(l.get()!==0)mat4.rotateY(f,f,l.get()*CGL.DEG2RAD);if(h.get()!==0)mat4.rotateZ(f,f,h.get()*CGL.DEG2RAD);if(d)mat4.scale(f,f,g);E=false}function A(){p=false;if(r.get()!==0||s.get()!==0||n.get()!==0)p=true;vec3.set(c,r.get(),s.get(),n.get());m=false}function F(){d=true;vec3.set(g,a.get(),a.get(),a.get());_=false}function v(){m=true}function x(){_=true}function T(){E=true}b()}};CABLES.OPS["650baeb1-db2d-4781-9af6-ab4e9d4277be"]={f:Ops.Graphics.Transform,objName:"Ops.Graphics.Transform"};Ops.Trigger.Interval=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("interval"),r=e.outTrigger("trigger"),s=e.inValueBool("Active",true);s.onChange=function(){clearTimeout(n);n=-1;if(!s.get()){}else a()};i.set(1e3);let n=-1;function a(){if(!s.get())return;if(n!=-1)return;n=setTimeout(function(){n=-1;r.trigger();a()},i.get())}i.onChange=a;a()}};CABLES.OPS["3e9bae10-38af-4e36-9fcc-35faeeaf57f8"]={f:Ops.Trigger.Interval,objName:"Ops.Trigger.Interval"};Ops.Vars.VarSetString_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("Value","New String");e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"string",i,e.varName)}};CABLES.OPS["0b4d9229-8024-4a30-9cc0-f6653942c2e4"]={f:Ops.Vars.VarSetString_v2,objName:"Ops.Vars.VarSetString_v2"};Ops.Vars.VarGetString=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};var i=e.outString("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"string",e.varName,i)}};CABLES.OPS["3ad08cfc-bce6-4175-9746-fef2817a3b12"]={f:Ops.Vars.VarGetString,objName:"Ops.Vars.VarGetString"};Ops.Gl.Textures.TextTexture_v6=class extends CABLES.Op{constructor(){super(...arguments);const m=this;const n=m.attachments={text_frag:"{{MODULES_HEAD}}\n\nUNI sampler2D tex;\nUNI float a;\nUNI vec4 color;\nIN vec2 texCoord;\n\nvoid main()\n{\n\n    vec4 col=texture(tex,vec2(texCoord.x,(1.0-texCoord.y)));\n\n    {{MODULE_COLOR}}\n\n    outColor=col;\n}\n",text_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\nUNI float aspect;\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n    vec4 pos=vec4(vPosition,  1.0);\n\n    pos.x*=aspect;\n\n    texCoord=vec2(attrTexCoord.x,1.0-attrTexCoord.y);;\n\n    mat4 mMatrix=modelMatrix;\n\n    {{MODULE_VERTEX_POSITION}}\n    mat4 modelViewMatrix=viewMatrix*mMatrix;\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n"};const e=m.inTriggerButton("Render"),X=m.inString("text","cables"),t=m.inValueBool("Draw Mesh",true),i=m.inValueFloat("Scale Mesh",.5),_=m.inSwitch("Size",["Auto","Manual"],"Auto"),E=m.inInt("Width",512),b=m.inInt("Height",512),A=m.inBool("Auto Height",true),F=m.inBool("Auto Line Breaks",true),v=m.inString("font","Arial"),x=m.inString("weight","normal"),T=m.inValueFloat("fontSize",300),C=m.inSwitch("align",["left","center","right"],"center"),D=m.inSwitch("Vertical align",["Top","Middle","Bottom"],"Top"),B=m.inFloat("Letter Spacing",0),S=m.inFloat("Line Height Add",0),q=m.inInt("Padding Y Top",3),Z=m.inInt("Padding Y Bottom",3),Q=m.inInt("Padding X",0),I=m.inSwitch("filter",["nearest","linear","mipmap"],"linear"),M=m.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"clamp to edge"),R=m.inSwitch("Anisotropic",[0,1,2,4,8,16],0),O=m.inValueBool("Reuse Texture",true),K=m.inBool("Show Debug",false),a=m.inBool("Redraw On Font Load",true),P=m.inValueSlider("r",1),N=m.inValueSlider("g",1),y=m.inValueSlider("b",1),w=m.inFloatSlider("Opacity",1),L=m.inValueSlider("background R",0),J=m.inValueSlider("background G",0),$=m.inValueSlider("background B",0),ee=m.inValueSlider("background A",1),o=m.inTriggerButton("Force Redraw"),l=m.outTrigger("Next"),te=m.outNumber("Ratio"),U=m.outTexture("texture"),h=m.outObject("Canvas",null,"element"),u=m.outNumber("Aspect",1),ie=m.outNumber("Num Lines");const k=" ";P.setUiAttribs({colorPick:true});L.setUiAttribs({colorPick:true});m.toWorkPortsNeedToBeLinked(e);m.setPortGroup("Text Color",[P,N,y,w]);m.setPortGroup("Background",[L,J,$,ee]);m.setPortGroup("Font",[v,x,T,C,D,B,S]);m.setPortGroup("Texture",[M,I,R,O,K]);m.setPortGroup("Rendering",[t,i]);e.onLinkChanged=()=>{if(!e.isLinked())U.setRef(CGL.Texture.getEmptyTexture(V));else U.setRef(G)};o.onTriggered=P.onChange=N.onChange=y.onChange=w.onChange=D.onChange=F.onChange=A.onChange=S.onChange=_.onChange=E.onChange=b.onChange=C.onChange=B.onChange=q.onChange=Z.onChange=Q.onChange=X.onChange=T.onChange=x.onChange=R.onChange=v.onChange=K.onChange=O.onChange=function(){Y=true;he()};U.ignoreValueSerialize=true;const V=m.patch.cgl;let G=new CGL.Texture(V);let j=2;let z=2;const H=document.createElement("canvas");H.id="texturetext_"+CABLES.generateUUID();H.style.display="none";document.body.appendChild(H);H.style.letterSpacing="0px";h.setRef(H);let W=H.getContext("2d");let Y=true;const c=CGL.MESHES.getSimpleRect(V,"texttexture rect");const r=vec3.create();const s=new CGL.Shader(V,"texttexture");s.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);s.setSource(n.text_vert,n.text_frag);const g=new CGL.Uniform(s,"t","tex");const f=new CGL.Uniform(s,"f","aspect",0);const d=new CGL.Uniform(s,"f","a",w);const p=new CGL.Uniform(s,"4f","color",P,N,y,w);if(m.patch.isEditorMode())CABLES.UI.SIMPLEWIREFRAMERECT=CABLES.UI.SIMPLEWIREFRAMERECT||new CGL.WireframeRect(V);e.onTriggered=ne;t.onChange=he;he();m.on("delete",()=>{W=null;H.remove()});R.onChange=I.onChange=M.onChange=()=>{if(G)G.delete();G=null;Y=true};L.onChange=J.onChange=$.onChange=ee.onChange=P.onChange=N.onChange=y.onChange=w.onChange=()=>{if(!t.get()||U.isLinked())Y=true};U.onLinkChanged=()=>{if(U.isLinked())Y=true};m.patch.on("fontLoaded",e=>{if(e==v.get())Y=true});document.fonts.ready.then(()=>{if(a.get())Y=true});document.fonts.onloadingdone=function(e){if(a.get())Y=true};function re(){return z}function se(){return j}function ne(){let e=0;while(Y&&e<10){ae();le();e++}if(t.get()){r[0]=r[1]=r[2]=i.get();V.pushBlendMode(CGL.BLEND_NORMAL,false);V.pushModelMatrix();mat4.scale(V.mMatrix,V.mMatrix,r);s.popTextures();s.pushTexture(g,G.tex);f.set(u.get());if(V.shouldDrawHelpers(m))CABLES.UI.SIMPLEWIREFRAMERECT.render(u.get(),1,1);V.pushShader(s);c.render(m.patch.cg.getShader());V.popShader();V.popBlendMode();V.popModelMatrix()}l.trigger()}function ae(){if(G)G.setSize(re(),se());W.canvas.width=H.width=re();W.canvas.height=H.height=se();u.set(H.width/H.height);Y=true}function oe(i){let r="";for(let e=0;e<i.length;e++){if(!i[e]){r+="\n";continue}let t=0;const s=i[e].split(k);for(let e=0;e<s.length;e++){if(!s[e])continue;t+=W.measureText(s[e]+k).width;if(t>E.get()){r+="\n"+s[e]+k;t=W.measureText(s[e]+k).width}else{r+=s[e]+k}}r+="\n"}let e=r;i=e.split("\n");if(i[i.length-1]=="")i.pop();return i}function le(){V.checkFrameStarted("texttrexture refresh");const e="rgba("+Math.floor(L.get()*255)+","+Math.floor(J.get()*255)+","+Math.floor($.get()*255)+","+ee.get()+")";W.fillStyle=e;W.fillRect(0,0,W.canvas.width,W.canvas.height);const t="rgba("+Math.floor(P.get()*255)+","+Math.floor(N.get()*255)+","+Math.floor(y.get()*255)+","+w.get()+")";W.fillStyle=t;let i=parseFloat(T.get());let r=v.get();if(r.indexOf(k)>-1)r='"'+r+'"';W.font=x.get()+k+i+"px "+r+"";W.textBaseline="top";W.textAlign=C.get();W.letterSpacing=B.get()+"px";let s=(X.get()+"").replace(/<br\/>/g,"\n");s=s.trim();let n=s.split("\n");Y=false;let a=Math.max(0,q.get());let o=Math.max(0,Z.get());let l=Math.max(0,Q.get());z=0;j=0;if(F.get()&&_.get()=="Manual"){if(E.get()>128){n=oe(n)}}const h=[];for(let e=0;e<n.length;e++){const p=W.measureText(n[e]);h[e]=Math.ceil(p.fontBoundingBoxAscent)+Math.ceil(p.fontBoundingBoxDescent)+S.get()}for(let e=0;e<n.length;e++){const p=W.measureText(n[e]);z=Math.max(z,Math.ceil(p.width));j+=h[e]}z+=l*2;if(S.get()<0)j+=S.get()/2*-1;let u=j;if(_.get()=="Manual"){z=E.get()+l*2;if(!A.get()){j=b.get()}}j=Math.ceil(j);z=Math.ceil(z);if(z>V.maxTexSize||j>V.maxTexSize)m.setUiError("textoobig","Texture too big!");else m.setUiError("textoobig",null);j=Math.min(V.maxTexSize,j);z=Math.min(V.maxTexSize,z);let c=0;if(D.get()=="Middle")c=(j-u)/2;else if(D.get()=="Bottom")c=j-u;c+=a;j+=a+o;if(W.canvas.width!=z||W.canvas.height!=j)ae();const g=K.get();for(let t=0;t<n.length;t++){let e=0+l;if(C.get()=="center")e=W.canvas.width/2;if(C.get()=="right")e=W.canvas.width-l;if(_.get()=="Manual")e+=B.get();W.fillText(n[t],e,c);if(g){W.lineWidth=3;W.strokeStyle="#FF0000";W.beginPath();W.moveTo(0,c);W.lineTo(W.canvas.width,c);W.stroke()}c+=h[t]}let f=CGL.Texture.WRAP_REPEAT;if(M.get()=="mirrored repeat")f=CGL.Texture.WRAP_MIRRORED_REPEAT;else if(M.get()=="clamp to edge")f=CGL.Texture.WRAP_CLAMP_TO_EDGE;let d=CGL.Texture.FILTER_LINEAR;if(I.get()=="nearest")d=CGL.Texture.FILTER_NEAREST;else if(I.get()=="mipmap")d=CGL.Texture.FILTER_MIPMAP;if(!O.get()||!G||!U.get()||G.width!=H.width||G.height!=H.height||G.anisotropic!=parseFloat(R.get())){if(G)G.delete();G=new CGL.Texture.createFromImage(V,H,{filter:d,anisotropic:parseFloat(R.get()),wrap:f})}G.unpackAlpha=false;G.flip=false;G.initTexture(H,d);te.set(W.canvas.height/W.canvas.width);ie.set(n.length);U.setRef(G)}function he(){E.setUiAttribs({greyout:_.get()!="Manual"});b.setUiAttribs({greyout:_.get()!="Manual"||A.get()});F.setUiAttribs({greyout:_.get()!="Manual"});D.setUiAttribs({greyout:_.get()!="Manual"});A.setUiAttribs({greyout:_.get()!="Manual"});i.setUiAttribs({greyout:!t.get()})}}};CABLES.OPS["2c042efa-3604-4717-b8f4-5ad08d6740e5"]={f:Ops.Gl.Textures.TextTexture_v6,objName:"Ops.Gl.Textures.TextTexture_v6"};Ops.Graphics.Meshes.Rectangle_v4=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("render"),r=t.inValueBool("Render Mesh",true),B=t.inValue("width",1),S=t.inValue("height",1),I=t.inSwitch("pivot x",["left","center","right"],"center"),M=t.inSwitch("pivot y",["top","center","bottom"],"center"),R=t.inSwitch("axis",["xy","xz"],"xy"),O=t.inBool("Flip TexCoord X",false),P=t.inBool("Flip TexCoord Y",true),N=t.inValueInt("num columns",1),y=t.inValueInt("num rows",1),s=t.outTrigger("trigger"),w=t.outObject("geometry",null,"geometry");w.ignoreValueSerialize=true;const L=new CGL.Geometry("rectangle");r.setUiAttribs({title:"Render"});i.setUiAttribs({title:"Trigger"});s.setUiAttribs({title:"Next"});t.setPortGroup("Pivot",[I,M,R]);t.setPortGroup("Size",[B,S]);t.setPortGroup("Structure",[N,y]);t.toWorkPortsNeedToBeLinked(i);t.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_TRIGGER);const U=0;const k=1;let V=U;let G=null;let j=true;let z=true;const n=vec3.create();vec3.set(n,1,1,1);R.onChange=I.onChange=M.onChange=O.onChange=P.onChange=y.onChange=N.onChange=a;H();B.onChange=S.onChange=()=>{if(z)H();else j=true};function H(){if(V===U)vec3.set(n,B.get(),S.get(),1);if(V===k)vec3.set(n,B.get(),1,S.get())}w.onLinkChanged=()=>{z=!w.isLinked();H();j=true};function a(){j=true}i.onTriggered=()=>{if(j)o();const e=t.patch.cg;if(e&&G&&r.get()){if(z){e.pushModelMatrix();mat4.scale(e.mMatrix,e.mMatrix,n)}G.render(e.getShader());if(z)e.popModelMatrix()}s.trigger()};t.onDelete=function(){if(G)G.dispose()};function o(){if(R.get()=="xy")V=U;if(R.get()=="xz")V=k;H();let i=B.get();let r=S.get();if(z)i=r=1;let s=0;let n=0;if(I.get()=="center")s=0;else if(I.get()=="right")s=-i/2;else if(I.get()=="left")s=+i/2;if(M.get()=="center")n=0;else if(M.get()=="top")n=-r/2;else if(M.get()=="bottom")n=+r/2;const a=Math.max(1,Math.round(y.get()));const o=Math.max(1,Math.round(N.get()));const l=i/o;const h=r/a;const u=[];const c=new Float32Array((o+1)*(a+1)*2);const g=new Float32Array((o+1)*(a+1)*3);const f=new Float32Array((o+1)*(a+1)*3);const d=new Float32Array((o+1)*(a+1)*3);const p=new Float32Array((o+1)*(a+1)*3);let m=0;let _=0;let E=0;let b=0;let A=0;for(let t=0;t<=a;t++){for(let e=0;e<=o;e++){g[_++]=e*l-i/2+s;if(V==k)g[_++]=0;g[_++]=t*h-r/2+n;if(V==U)g[_++]=0;c[m++]=e/o;c[m++]=t/a;if(V==U){f[E++]=0;f[E++]=0;f[E++]=1;d[b++]=1;d[b++]=0;d[b++]=0;p[A++]=0;p[A++]=1;p[A++]=0}else if(V==k){f[E++]=0;f[E++]=1;f[E++]=0;p[A++]=0;p[A++]=0;p[A++]=1}}}u.length=o*a*6;let F=0;for(let t=0;t<o;t++){for(let e=0;e<a;e++){const v=t+(o+1)*e;const x=v;const T=v+1;const C=v+o+1;const D=v+1+o+1;if(V==U){u[F++]=x;u[F++]=T;u[F++]=C;u[F++]=C;u[F++]=T;u[F++]=D}else if(V==k){u[F++]=x;u[F++]=C;u[F++]=T;u[F++]=T;u[F++]=C;u[F++]=D}}}if(P.get())for(let e=0;e<c.length;e+=2)c[e+1]=1-c[e+1];if(O.get())for(let e=0;e<c.length;e+=2)c[e]=1-c[e];L.clear();L.vertices=g;L.texCoords=c;L.verticesIndices=u;L.vertexNormals=f;L.tangents=d;L.biTangents=p;if(t.patch.cg)if(!G)G=t.patch.cg.createMesh(L,{opId:t.id});else G.setGeom(L);w.setRef(L);j=false}}};CABLES.OPS["cc8c3ede-7103-410b-849f-a645793cab39"]={f:Ops.Graphics.Meshes.Rectangle_v4,objName:"Ops.Graphics.Meshes.Rectangle_v4"};Ops.Gl.LayerSequence=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inTrigger("exe"),i=n.inTriggerButton("Clean up connections");const r=n.patch.cgl,a=[],s=16;let o=null;t.onTriggered=h;i.onTriggered=u;i.setUiAttribs({hidePort:true});i.setUiAttribs({hideParam:true});for(let e=0;e<s;e++){const c=n.outTrigger("trigger "+e);a.push(c);c.onLinkChanged=l}function l(){clearTimeout(o);o=setTimeout(()=>{let t=false;for(let e=0;e<a.length;e++)if(a[e].links.length>1)t=true;i.setUiAttribs({hideParam:!t});if(n.isCurrentUiOp())n.refreshParams()},60)}function h(){for(let e=0;e<a.length;e++){if(a[e].isLinked()){r.gl.clear(r.gl.DEPTH_BUFFER_BIT);a[e].trigger()}}}function u(){let r=0;for(let i=0;i<a.length;i++){let t=[];if(a[i].links.length>1)for(let e=1;e<a[i].links.length;e++){while(a[r].links.length>0)r++;t.push(a[i].links[e]);const s=a[i].links[e].getOtherPort(a[i]);n.patch.link(n,"trigger "+r,s.op,s.name);r++}for(let e=0;e<t.length;e++)t[e].remove()}l()}}};CABLES.OPS["09c33c7e-e282-468d-93e1-b8a7a0a4c4d2"]={f:Ops.Gl.LayerSequence,objName:"Ops.Gl.LayerSequence"};Ops.Math.Divide=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),r=e.inValueFloat("number2",2),s=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=r.onChange=n;n();function n(){s.set(i.get()/r.get())}}};CABLES.OPS["86fcfd8c-038d-4b91-9820-a08114f6b7eb"]={f:Ops.Math.Divide,objName:"Ops.Math.Divide"};Ops.Gl.Shader.ShaderToTexture_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Render"),r=e.inObject("Shader",null,"shader"),a=e.inSwitch("Size",["Canvas","Manual"],"Manual"),o=e.inValueInt("Width",512),l=e.inValueInt("Height",512),h=e.inValueSelect("filter",["nearest","linear","mipmap"]),u=e.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),c=e.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),g=e.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),f=e.inSwitch("Num Textures",["1","4"],"1"),s=e.outTrigger("Next"),n=e.outTexture("Texture"),d=e.outTexture("Texture 2"),p=e.outTexture("Texture 3"),m=e.outTexture("Texture 4");e.setPortGroup("Texture Size",[a,o,l]);e.setPortGroup("Texture settings",[h,c,g,u]);let _=1;const E=e.patch.cgl;const b=[0,0,0,0];const A=null;const F=[];let v=null;let x=null;o.onChange=l.onChange=g.onChange=h.onChange=f.onChange=u.onChange=c.onChange=R;a.onChange=M;const T=false;let C=null;const D=null;let B=true;const S=CGL.MESHES.getSimpleRect(E,"shader2texture rect");e.toWorkPortsNeedToBeLinked(r);h.set("nearest");M();function I(){if(h.get()=="mipmap"&&D&&D.isFloatingPoint()){e.setUiError("warning","HDR and mipmap filtering at the same time is not possible")}else{e.setUiError("warning",null)}}function M(){u.setUiAttribs({greyout:h.get()!="mipmap"});o.setUiAttribs({greyout:a.get()=="Canvas"});l.setUiAttribs({greyout:a.get()=="Canvas"})}function R(){B=true;I();M()}function O(){if(x)x.dispose();v=null;x=null}function P(){B=false;if(C)C.delete();const e=F.length;_=parseInt(f.get());F.length=0;for(let e=0;e<_;e++)F[e]=true;if(e!=F.length){O()}C=null;let t=o.get();let i=l.get();if(a.get()=="Canvas"){t=E.canvasWidth;i=E.canvasHeight}let r=CGL.Texture.FILTER_NEAREST;if(h.get()=="linear")r=CGL.Texture.FILTER_LINEAR;else if(h.get()=="mipmap")r=CGL.Texture.FILTER_MIPMAP;let s=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(c.get()=="repeat")s=CGL.Texture.WRAP_REPEAT;if(c.get()=="mirrored repeat")s=CGL.Texture.WRAP_MIRRORED_REPEAT;const n=Math.min(E.maxAnisotropic,parseFloat(u.get()));if(E.glVersion>=2){C=new CGL.Framebuffer2(E,t,i,{anisotropic:n,pixelFormat:g.get(),multisampling:false,numRenderBuffers:_,wrap:s,filter:r,depth:true,multisamplingSamples:0,clear:true})}else{C=new CGL.Framebuffer(E,o.get(),l.get(),{isFloatingPointTexture:inFloatingPoint.get(),filter:r,wrap:s})}}i.onTriggered=function(){if(!C||B)P();if(a.get()=="Manual"&&(C.getTextureColor().width!=o.get()||C.getTextureColor().height!=l.get())){P()}else if(a.get()=="Canvas"&&C&&(C.getTextureColor().width!=E.canvasWidth||C.getTextureColor().height!=E.canvasHeight))P();if(!r.get()||!r.get().setDrawBuffers)return;if(r.get()!=v){v=r.get();x=r.get().copy();x.setDrawBuffers(F)}if(!x){n.set(null);return}E.pushViewPort(0,0,o.get(),l.get());C.renderStart(E);E.pushPMatrix();mat4.identity(E.pMatrix);E.pushViewMatrix();mat4.identity(E.vMatrix);E.pushModelMatrix();mat4.identity(E.mMatrix);E.pushShader(r.get());if(x.bindTextures)x.bindTextures();E.pushBlend(false);S.render(r.get());E.popBlend();E.popPMatrix();E.popModelMatrix();E.popViewMatrix();C.renderEnd(E);if(_>=2){n.setRef(C.getTextureColorNum(0));d.setRef(C.getTextureColorNum(1));p.setRef(C.getTextureColorNum(2));m.setRef(C.getTextureColorNum(3))}else n.setRef(C.getTextureColor());E.popShader();E.popViewPort();s.trigger()}}};CABLES.OPS["eb40e0e0-761b-4ce7-987a-014fff720873"]={f:Ops.Gl.Shader.ShaderToTexture_v2,objName:"Ops.Gl.Shader.ShaderToTexture_v2"};Ops.Gl.Shader.CustomShader_v2=class extends CABLES.Op{constructor(){super(...arguments);const _=this;const e=_.attachments={};const t=_.inTrigger("render"),i=_.inStringEditor("Fragment Code"),r=_.inStringEditor("Vertex Code"),s=_.inValueBool("Use As Material",true),n=_.outTrigger("trigger"),a=_.outObject("Shader",null,"shader"),o=_.outBool("Has Errors");const E=7;const b=_.patch.cgl;const A=[];const F=[];const v=[];_.toWorkPortsNeedToBeLinked(t);i.setUiAttribs({editorSyntax:"glsl"});r.setUiAttribs({editorSyntax:"glsl"});const x=new CGL.Shader(b,"customshader",_);x.logError=false;x.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);_.setPortGroup("Source Code",[i,r]);_.setPortGroup("Options",[s]);i.set(CGL.Shader.getDefaultFragmentShader());r.set(CGL.Shader.getDefaultVertexShader());i.onChange=r.onChange=function(){if(i.isLinked()&&!i.get())return;h=true};t.onTriggered=c;let l=0;let h=true;_.onLoadedValueSet=u;function u(i){m();if(!i)return;for(let t=0;t<A.length;t++)for(let e=0;e<i.portsIn.length;e++)if(A[t]&&A[t].name==i.portsIn[e].name){A[t].set(i.portsIn[e].value);A[t].deSerializeSettings(i.portsIn[e])}}_.init=function(){m()};function c(){I();if(h)m();if(s.get())b.pushShader(x);g();n.trigger();x.popTextures();if(s.get())b.popShader()}function g(){for(let e=0;e<F.length;e++)if(F[e]&&F[e].get()&&F[e].get().tex)x.pushTexture(F[e].uniform,F[e].get().tex);else x.pushTexture(F[e],CGL.Texture.getEmptyTexture(b))}function f(){for(let e=0;e<F.length;e++)if(F[e]&&F[e].get()&&F[e].get().tex)b.setTexture(0+e+E,F[e].get().tex)}function T(t){for(let e=0;e<A.length;e++)if(A[e]&&A[e].name==t)return true;for(let e=0;e<F.length;e++)if(F[e]&&F[e].name==t)return true;return false}const d=mat4.create();const C=["modelMatrix","viewMatrix","normalMatrix","mvMatrix","projMatrix","inverseViewMatrix","camPos"];let D=0;const B=[];function p(e){const t=e.split("\n");const s=[];for(let e=0;e<t.length;e++){const i=t[e].split(";");for(let e=0;e<i.length;e++){let r=i[e].split(" ");for(let e=0;e<r.length;e++)r[e]=(r[e]+"").trim();if(r[0]==="UNI"||r[0]==="uniform"){let t=r[2];if(r.length>4)for(let e=3;e<r.length;e++)t+=r[e];r=r.filter(function(e){return e!==""});const n=r[1];let i=[];if(t){i=[t];if(t.indexOf(",")>-1)i=t.split(",")}for(let e=0;e<i.length;e++){if(C.indexOf(i[e])>-1)continue;const a=i[e].trim().replace(/\[\d+\]$/,"");if(n==="float"){B.push(a);if(!T(a)){const o=i[e].trim().match(/\[\d+\]$/);if(o){const l=parseInt(o[0].trim().slice(1,-1));const h=_.inArray(a,[]);h.uniform=new CGL.Uniform(x,"f[]",a,new Float32Array(l));A.push(h);s.push(h);const u={name:a,num:l,port:h,uni:h.uniform,changed:false};h.onChange=function(){this.changed=true}.bind(u);v.push(u)}else{const h=_.inFloat(a,0);h.uniform=new CGL.Uniform(x,"f",a,h);A.push(h);s.push(h)}}}else if(n==="int"){B.push(a);if(!T(a)){const h=_.inInt(a,0);h.uniform=new CGL.Uniform(x,"i",a,h);A.push(h);s.push(h)}}else if(n==="bool"){B.push(a);if(!T(a)){const h=_.inBool(a,false);h.uniform=new CGL.Uniform(x,"b",a,h);A.push(h);s.push(h)}}else if(n==="mat4"){B.push(a);if(!T(a)){const h=_.inArray(a,0);h.uniform=new CGL.Uniform(x,"m4",a,h);A.push(h);s.push(h);const u={name:a,num:16,port:h,uni:h.uniform,changed:false};h.onChange=function(){this.changed=true}.bind(u);v.push(u)}}else if(n==="sampler2D"||n==="samplerCube"){B.push(a);if(!T(a)){const c=_.inObject(a);let e="t";if(n==="samplerCube")e="tc";c.uniform=new CGL.Uniform(x,e,a,E+F.length);F.push(c);s.push(c);c.set(CGL.Texture.getTempTexture(b));c.on("change",(e,t)=>{if(!e)t.set(CGL.Texture.getTempTexture(b))});D++}}else if(n==="vec3"||n==="vec2"||n==="vec4"){let e=2;if(n==="vec4")e=4;if(n==="vec3")e=3;B.push(a+" X");B.push(a+" Y");if(e>2)B.push(a+" Z");if(e>3)B.push(a+" W");if(!T(a+" X")){const g=[];const u={name:a,num:e,changed:false};v.push(u);S(u);const f=_.inFloat(a+" X",0);f.onChange=function(){this.changed=true}.bind(u);A.push(f);g.push(f);u.x=f;const d=_.inFloat(a+" Y",0);d.onChange=function(){this.changed=true}.bind(u);A.push(d);g.push(d);u.y=d;if(e>2){const p=_.inFloat(a+" Z",0);p.onChange=function(){this.changed=true}.bind(u);A.push(p);g.push(p);u.z=p}if(e>3){const m=_.inFloat(a+" W",0);m.onChange=function(){this.changed=true}.bind(u);A.push(m);g.push(m);u.w=m}_.setPortGroup(a,g)}}}}}}_.setPortGroup("uniforms",s)}function m(){if(!x)return;let e=false;l++;if(l>2)e=true;x.setSource(r.get(),i.get(),e);if(b.glVersion==1){b.enableExtension("OES_standard_derivatives");x.enableExtension("GL_OES_standard_derivatives")}D=0;B.length=0;p(r.get());p(i.get());for(let t=0;t<F.length;t++)for(let e=0;e<B.length;e++)if(F[t]&&B.indexOf(F[t].name)==-1){F[t].remove();F[t]=null}for(let t=0;t<A.length;t++)for(let e=0;e<B.length;e++)if(A[t]&&B.indexOf(A[t].name)==-1){A[t].remove();A[t]=null}for(let e=0;e<v.length;e++){S(v[e]);v[e].changed=true}for(let e=0;e<A.length;e++)if(A[e]&&A[e].uniform)A[e].uniform.needsUpdate=true;x.compile();_.refreshParams();a.setRef(x);h=false;if(x.hasErrors())_.setUiError("compile","Shader has errors",2,{button:"show",buttonCb:()=>{CABLES.UI.showShaderError(x)}});else _.setUiError("compile",null);o.set(x.hasErrors())}function S(e){if(e.num==2)e.uni=new CGL.Uniform(x,"2f",e.name,[0,0]);else if(e.num==3)e.uni=new CGL.Uniform(x,"3f",e.name,[0,0,0]);else if(e.num==4)e.uni=new CGL.Uniform(x,"4f",e.name,[0,0,0,0])}function I(){for(let e=0;e<v.length;e++){const t=v[e];if(t.changed){if(t.num===2)t.uni.setValue([t.x.get(),t.y.get()]);else if(t.num===3)t.uni.setValue([t.x.get(),t.y.get(),t.z.get()]);else if(t.num===4)t.uni.setValue([t.x.get(),t.y.get(),t.z.get(),t.w.get()]);else if(t.num>4){t.uni.setValue(t.port.get())}t.changed=false}}}}};CABLES.OPS["a165fc89-a35b-4d39-8930-7345b098bd9d"]={f:Ops.Gl.Shader.CustomShader_v2,objName:"Ops.Gl.Shader.CustomShader_v2"};Ops.Ui.VizTexture=class extends CABLES.Op{constructor(){super(...arguments);const L=this;const i=L.attachments={viztex_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI samplerCube cubeMap;\nUNI float width;\nUNI float height;\nUNI float type;\nUNI float time;\n\nfloat LinearizeDepth(float d,float zNear,float zFar)\n{\n    float z_n = 2.0 * d - 1.0;\n    return 2.0 * zNear / (zFar + zNear - z_n * (zFar - zNear));\n}\n\nvoid main()\n{\n    vec4 col=vec4(vec3(0.),0.0);\n\n    vec4 colTex=texture(tex,texCoord);\n\n\n\n    if(type==1.0)\n    {\n        vec4 depth=vec4(0.);\n        vec2 localST=texCoord;\n        localST.y = 1. - localST.y;\n\n        localST.t = mod(localST.t*3.,1.);\n        localST.s = mod(localST.s*4.,1.);\n\n        #ifdef WEBGL2\n            #define texCube texture\n        #endif\n        #ifdef WEBGL1\n            #define texCube textureCube\n        #endif\n\n//         //Due to the way my depth-cubeMap is rendered, objects to the -x,y,z side is projected to the positive x,y,z side\n//         //Inside where top/bottom is to be drawn?\n        if (texCoord.s*4.> 1. && texCoord.s*4.<2.)\n        {\n            //Bottom (-y) quad\n            if (texCoord.t*3. < 1.)\n            {\n                vec3 dir=vec3(localST.s*2.-1.,-1.,-localST.t*2.+1.);//Due to the (arbitrary) way I choose as up in my depth-viewmatrix, i her emultiply the latter coordinate with -1\n                depth = texCube(cubeMap, dir);\n            }\n            //top (+y) quad\n            else if (texCoord.t*3. > 2.)\n            {\n                vec3 dir=vec3(localST.s*2.-1.,1.,localST.t*2.-1.);//Get lower y texture, which is projected to the +y part of my cubeMap\n                depth = texCube(cubeMap, dir);\n            }\n            else//Front (-z) quad\n            {\n                vec3 dir=vec3(localST.s*2.-1.,-localST.t*2.+1.,1.);\n                depth = texCube(cubeMap, dir);\n            }\n        }\n//         //If not, only these ranges should be drawn\n        else if (texCoord.t*3. > 1. && texCoord.t*3. < 2.)\n        {\n            if (texCoord.x*4. < 1.)//left (-x) quad\n            {\n                vec3 dir=vec3(-1.,-localST.t*2.+1.,localST.s*2.-1.);\n                depth = texCube(cubeMap, dir);\n            }\n            else if (texCoord.x*4. < 3.)//right (+x) quad (front was done above)\n            {\n                vec3 dir=vec3(1,-localST.t*2.+1.,-localST.s*2.+1.);\n                depth = texCube(cubeMap, dir);\n            }\n            else //back (+z) quad\n            {\n                vec3 dir=vec3(-localST.s*2.+1.,-localST.t*2.+1.,-1.);\n                depth = texCube(cubeMap, dir);\n            }\n        }\n        // colTex = vec4(vec3(depth),1.);\n        colTex = vec4(depth);\n    }\n\n    if(type==2.0)\n    {\n       float near = 0.1;\n       float far = 50.;\n       float depth = LinearizeDepth(colTex.r, near, far);\n       colTex.rgb = vec3(depth);\n    }\n\n\n\n\n    #ifdef ANIM_RANGE\n\n        if(colTex.r>1.0 || colTex.r<0.0)\n            colTex.r=mod(colTex.r,1.0)*0.5+(sin(colTex.r+mod(colTex.r*3.0,1.0)+time*5.0)*0.5+0.5)*0.5;\n        if(colTex.g>1.0 || colTex.g<0.0)\n            colTex.g=mod(colTex.g,1.0)*0.5+(sin(colTex.g+mod(colTex.g*3.0,1.0)+time*5.0)*0.5+0.5)*0.5;\n        if(colTex.b>1.0 || colTex.b<0.0)\n            colTex.b=mod(colTex.b,1.0)*0.5+(sin(colTex.b+mod(colTex.b*3.0,1.0)+time*5.0)*0.5+0.5)*0.5;\n\n    #endif\n\n\n    // #ifdef ANIM_RANGE\n    //     if(colTex.r>1.0 || colTex.r<0.0)\n    //     {\n    //         float r=mod( time+colTex.r,1.0)*0.5+0.5;\n    //         colTex.r=r;\n    //     }\n    //     if(colTex.g>1.0 || colTex.g<0.0)\n    //     {\n    //         float r=mod( time+colTex.g,1.0)*0.5+0.5;\n    //         colTex.g=r;\n    //     }\n    //     if(colTex.b>1.0 || colTex.b<0.0)\n    //     {\n    //         float r=mod( time+colTex.b,1.0)*0.5+0.5;\n    //         colTex.b=r;\n    //     }\n    // #endif\n\n    #ifdef MOD_RANGE\n        colTex.r=mod(colTex.r,1.0001);\n        colTex.g=mod(colTex.g,1.0001);\n        colTex.b=mod(colTex.b,1.0001);\n\n    #endif\n\n    #ifdef ALPHA_ONE\n        colTex.a=1.0;\n    #endif\n    #ifdef ALPHA_INV\n        colTex.a=1.0-colTex.a;\n    #endif\n\n    outColor = mix(col,colTex,colTex.a);\n}\n\n",viztex_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nOUT vec2 texCoord;\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\nvoid main()\n{\n    texCoord=vec2(attrTexCoord.x,1.0-attrTexCoord.y);\n    vec4 pos = vec4( vPosition, 1. );\n    mat4 mvMatrix=viewMatrix * modelMatrix;\n    gl_Position = projMatrix * mvMatrix * pos;\n}"};const U=L.inTexture("Texture In"),k=L.inBool("Show Info",false),e=L.inSwitch("Visualize outside 0-1",["Off","Anim","Modulo"],"Anim"),t=L.inSwitch("Alpha",["A","1","1-A"],"A"),V=L.inBool("Show Color",false),G=L.inFloatSlider("X",.5),j=L.inFloatSlider("Y",.5),r=L.outTexture("Texture Out"),z=L.outString("Info");L.setUiAttrib({height:150,resizable:true});const H=new CABLES.Timer;let s=null;let W=null;let Y=null;let X="";let n=true;t.onChange=e.onChange=o;V.onChange=a;a();if(CABLES.UI){H.play()}function a(){G.setUiAttribs({greyout:!V.get()});j.setUiAttribs({greyout:!V.get()})}U.onChange=()=>{const e=U.get();r.setRef(e);let t="";if(U.get()&&U.isLinked())t=U.links[0].getOtherPort(U).name;L.setUiAttrib({extendTitle:t})};function o(){if(!s)return;s.toggleDefine("MOD_RANGE",e.get()=="Modulo");s.toggleDefine("ANIM_RANGE",e.get()=="Anim");s.toggleDefine("ALPHA_INV",t.get()=="1-A");s.toggleDefine("ALPHA_ONE",t.get()=="1")}L.renderVizLayerGl=(c,g)=>{if(!U.isLinked())return;if(!g.useGl)return;const f=U;const d=5;const p=d+1;const e=gui.uiProfiler.start("previewlayer texture");const m=f.op.patch.cgl;if(!this._emptyCubemap)this._emptyCubemap=CGL.Texture.getEmptyCubemapTexture(m);f.op.patch.cgl.profileData.profileTexPreviews++;const _=f.get()||CGL.Texture.getEmptyTexture(m);if(!this._mesh){const t=new CGL.Geometry("vizTexture rect");t.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0];t.texCoords=[1,1,0,1,1,0,0,0];t.verticesIndices=[0,1,2,3,1,2];this._mesh=new CGL.Mesh(m,t)}if(!this._shader){this._shader=new CGL.Shader(m,"glpreviewtex");this._shader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);this._shader.setSource(i.viztex_vert,i.viztex_frag);this._shaderTexUniform=new CGL.Uniform(this._shader,"t","tex",d);this._shaderTexCubemapUniform=new CGL.Uniform(this._shader,"tc","cubeMap",p);s=this._shader;o();this._shaderTexUniformW=new CGL.Uniform(this._shader,"f","width",_.width);this._shaderTexUniformH=new CGL.Uniform(this._shader,"f","height",_.height);this._shaderTypeUniform=new CGL.Uniform(this._shader,"f","type",0);this._shaderTimeUniform=new CGL.Uniform(this._shader,"f","time",0)}m.pushPMatrix();const E=[_.width,_.height];const b=f.op.patch.cgl.canvasWidth>E[0]&&f.op.patch.cgl.canvasHeight>E[1];if(b){mat4.ortho(m.pMatrix,0,f.op.patch.cgl.canvasWidth,f.op.patch.cgl.canvasHeight,0,.001,11)}else mat4.ortho(m.pMatrix,-1,1,1,-1,.001,11);const A=m.getTexture(d);const F=m.getTexture(p);let v=0;if(_){if(_.cubemap)v=1;if(_.textureType==CGL.Texture.TYPE_DEPTH)v=2;if(v==0||v==2){m.setTexture(d,_.tex);m.setTexture(p,this._emptyCubemap.cubemap,m.gl.TEXTURE_CUBE_MAP)}else if(v==1){m.setTexture(p,_.cubemap,m.gl.TEXTURE_CUBE_MAP)}H.update();this._shaderTimeUniform.setValue(H.get());this._shaderTypeUniform.setValue(v);let t=[f.op.patch.cgl.canvasWidth,f.op.patch.cgl.canvasHeight];m.gl.clearColor(0,0,0,0);m.gl.clear(m.gl.COLOR_BUFFER_BIT|m.gl.DEPTH_BUFFER_BIT);m.pushModelMatrix();if(b){t=E;mat4.translate(m.mMatrix,m.mMatrix,[E[0]/2,E[1]/2,0]);mat4.scale(m.mMatrix,m.mMatrix,[E[0]/2,E[1]/2,0])}this._mesh.render(this._shader);m.popModelMatrix();if(v==0)m.setTexture(d,A);if(v==1)m.setTexture(p,F);m.popPMatrix();m.resetViewPort();const x=[g.width,g.height];const T=false;if(_.width>_.height)x[1]=g.width*E[1]/E[0];else{x[1]=g.width*(E[1]/E[0]);if(x[1]>g.height){const S=g.height/x[1];x[0]*=S;x[1]*=S}}const C=x[0]>E[0]&&x[1]>E[1];c.imageSmoothingEnabled=true;c.fillStyle="#ffffff";c.fillRect(g.x,g.y-10,10,10);c.fillStyle="#000000";c.fillRect(g.x,g.y-10,5,5);c.fillRect(g.x+5,g.y-10+5,5,5);let e=g.height;let i=10*g.width/e*g.scale*2;let r=i*g.height/g.width;let s=e/r;let n=g.width/i;for(let t=0;t<i+1;t++)for(let e=0;e<r+1;e++){if((t+e)%2==0)c.fillStyle="#333333";else c.fillStyle="#393939";c.fillRect(g.x-g.x%n*2+n*t,g.y-g.y%n*2+s*e,n,s)}c.fillStyle="#222";const D=(g.width-x[0])/2;const B=(e-x[1])/2;let a=g.x+(g.width-x[0])/2;let o=g.y+(e-x[1])/2;let l=x[0];let h=x[1];if(e-x[1]<0){a=g.x+(g.width-x[0]*e/x[1])/2;o=g.y;l=x[0]*e/x[1];h=e}c.fillRect(g.x,g.y,a-g.x,e);c.fillRect(g.x+l+a-g.x,g.y,l,e);c.fillRect(g.x,g.y,g.width,B);c.fillRect(g.x,g.y+x[1]+B,g.width,B);if(m.canvas&&m.canvasWidth>0&&m.canvasHeight>0&&m.canvas.width>0&&m.canvas.height>0){try{const I=l/t[0]>3||h/t[1]>3;const M=l/t[0]>10||h/t[1]>10;if(E[1]==1){c.imageSmoothingEnabled=false;c.drawImage(m.canvas,0,0,t[0],t[1],g.x,g.y,g.width,e);c.imageSmoothingEnabled=true}else if(E[0]==1){c.imageSmoothingEnabled=false;c.drawImage(m.canvas,0,0,t[0],t[1],g.x,g.y,g.width,e);c.imageSmoothingEnabled=true}else if(x[0]!=0&&x[1]!=0&&g.width!=0&&e!=0&&l!=0&&h!=0){c.imageSmoothingEnabled=!I;c.drawImage(m.canvas,0,0,t[0],t[1],a,o,l,h)}if(M){const R=l/t[0];const O=h/t[1];c.imageSmoothingEnabled=true;c.lineWidth=1;c.globalAlpha=.5;c.beginPath();for(let e=0;e<=t[0];e++){c.moveTo(a+e*R,o);c.lineTo(a+e*R,o+h)}for(let e=0;e<=t[1];e++){c.moveTo(a,o+e*O);c.lineTo(a+l,o+e*O)}c.strokeStyle="#555";c.stroke();c.globalAlpha=1}}catch(e){console.error("canvas drawimage exception...",e)}}let u="";if(k.get()&&f.get()&&f.get().getInfoOneLine)u+=f.get().getInfoOneLine()+"\n";z.set(u);if(V.get()){u+=X+"\n";const P=a+l*G.get();const N=o+h*j.get();for(let e=0;e<2;e++){if(e==0)c.fillStyle="#000";else c.fillStyle="#fff";c.fillRect(P-1+e,N-10+e,1,20);c.fillRect(P-10+e,N-1+e,20,1)}}if(k.get()||V.get()){L.setUiAttrib({comment:u})}if(V.get()){const y=m.gl;const w=U.get();if(!w){X="";return}if(!W)W=y.createFramebuffer();if(!Y)Y=new CGL.PixelReader;y.bindFramebuffer(y.FRAMEBUFFER,W);y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,w.tex,0);y.bindFramebuffer(y.FRAMEBUFFER,null);Y.read(m,W,w.pixelFormat,G.get()*w.width,w.height-j.get()*w.height,1,1,e=>{if(!CGL.Texture.isPixelFormatFloat(w.pixelFormat)){X="Pixel Float: "+Math.floor(e[0]/255*100)/100;if(!isNaN(e[1]))X+=", "+Math.floor(e[1]/255*100)/100;if(!isNaN(e[2]))X+=", "+Math.floor(e[2]/255*100)/100;if(!isNaN(e[3]))X+=", "+Math.floor(e[3]/255*100)/100;X+="\n";if(w.pixelFormat.indexOf("ubyte")>0){X+="Pixel UByte: ";X+=Math.round(e[0]);if(!isNaN(e[1]))X+=", "+Math.round(e[1]);if(!isNaN(e[2]))X+=", "+Math.round(e[2]);if(!isNaN(e[3]))X+=", "+Math.round(e[3]);X+="\n"}}else{X="Pixel Float: "+Math.round(e[0]*100)/100+", "+Math.round(e[1]*100)/100+", "+Math.round(e[2]*100)/100+", "+Math.round(e[3]*100)/100;X+="\n"}})}}m.gl.clearColor(0,0,0,0);m.gl.clear(m.gl.COLOR_BUFFER_BIT|m.gl.DEPTH_BUFFER_BIT);e.finish()}}};CABLES.OPS["4ea2d7b0-ca74-45db-962b-4d1965ac20c0"]={f:Ops.Ui.VizTexture,objName:"Ops.Ui.VizTexture"};Ops.Math.Multiply=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),r=e.inValueFloat("number2",1),s=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=r.onChange=n;n();function n(){const e=i.get();const t=r.get();s.set(e*t)}}};CABLES.OPS["1bbdae06-fbb2-489b-9bcc-36c9d65bd441"]={f:Ops.Math.Multiply,objName:"Ops.Math.Multiply"};Ops.Gl.Textures.CopyTexture_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const w=t.attachments={copytexture_frag:"UNI float a;\nUNI sampler2D tex;\n\n#ifdef TEX_MASK\nUNI sampler2D texMask;\n#endif\n\nIN vec2 texCoord;\n\nvoid main()\n{\n    vec2 tc=texCoord;\n\n    #ifdef FLIPX\n        tc.x=1.0-tc.x;\n    #endif\n    #ifdef FLIPY\n        tc.y=1.0-tc.y;\n    #endif\n\n    vec4 col=texture(tex,tc);\n\n    #ifdef TEX_MASK\n        col.a=texture(texMask,tc).r;\n    #endif\n\n    #ifdef GREY_R\n        col.rgb=vec3(col.r);\n    #endif\n\n    #ifdef GREY_G\n        col.rgb=vec3(col.g);\n    #endif\n\n    #ifdef GREY_B\n        col.rgb=vec3(col.b);\n    #endif\n\n    #ifdef GREY_A\n        col.rgb=vec3(col.a);\n    #endif\n\n    #ifdef GREY_LUMI\n        col.rgb=vec3( dot(vec3(0.2126,0.7152,0.0722), col.rgb) );\n    #endif\n\n\n    #ifdef INVERT_A\n        col.a=1.0-col.a;\n    #endif\n\n    #ifdef INVERT_R\n        col.r=1.0-col.r;\n    #endif\n\n    #ifdef INVERT_G\n        col.g=1.0-col.g;\n    #endif\n\n    #ifdef INVERT_B\n        col.b=1.0-col.b;\n    #endif\n\n    #ifdef ALPHA_1\n        col.a=1.0;\n    #endif\n\n\n\n\n    outColor= col;\n}"};const e=t.inTriggerButton("render"),i=t.inTexture("Texture"),r=t.inTexture("Alpha Mask"),s=t.inValueBool("use original size",true),n=t.inValueInt("width",640),a=t.inValueInt("height",360),o=t.inSwitch("filter",["nearest","linear","mipmap"],"linear"),l=t.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),h=t.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),u=t.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),c=t.inSwitch("Alpha Mask Source",["A","1"],"A"),g=t.inSwitch("Convert Greyscale",["Off","R","G","B","A","Luminance"],"Off"),f=t.inBool("Invert R",false),d=t.inBool("Invert G",false),p=t.inBool("Invert B",false),L=t.inBool("Invert A",false),m=t.inBool("Flip X",false),_=t.inBool("Flip Y",false),E=t.outTrigger("trigger"),b=t.outTexture("texture_out",null),U=t.outNumber("Aspect Ratio");c.setUiAttribs({hidePort:true});g.setUiAttribs({hidePort:true});f.setUiAttribs({hidePort:true});d.setUiAttribs({hidePort:true});p.setUiAttribs({hidePort:true});let k=null;const A=t.patch.cgl;let F=null;let v=null;let x=null;let T=true;let C=null;let D=2,B=2;const S=[0,0,0,0];let I=true;t.toWorkPortsNeedToBeLinked(e,i);t.setPortGroup("Size",[s,n,a]);const M=new CGL.Shader(A,"copytexture");M.setSource(M.getDefaultVertexShader(),w.copytexture_frag);const V=new CGL.Uniform(M,"t","tex",0);let G=new CGL.Uniform(M,"t","texMask",1);let R=CGL.Texture.FILTER_LINEAR;let O=CGL.Texture.WRAP_CLAMP_TO_EDGE;m.onChange=_.onChange=c.onChange=h.onChange=g.onChange=f.onChange=d.onChange=p.onChange=u.onChange=o.onChange=l.onChange=e.onLinkChanged=r.onChange=i.onLinkChanged=()=>{N()};i.onChange=()=>{if(C!=i.get()){N()}C=i.get()};e.onTriggered=H;y();function P(){if(v)v.delete();if(x){x.delete();x=null}v=new CGL.TextureEffect(A,{pixelFormat:l.get(),clear:false});if(!x||x.width!=Math.floor(n.get())||x.height!=Math.floor(a.get())||x.wrap!=O||x.pixelFormat!=l.get()){const e=Math.min(A.maxAnisotropic,parseFloat(h.get()));if(x)x.delete();x=new CGL.Texture(A,{name:"copytexture_"+t.id,pixelFormat:l.get(),anisotropic:e,filter:R,wrap:O,width:Math.floor(n.get()),height:Math.floor(a.get())})}v.setSourceTexture(x);y();I=false}function N(){W();I=true;if(!e.isLinked()||!i.isLinked())b.setRef(CGL.Texture.getEmptyTexture(A))}function j(){if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(A))return;if(!v)P();if(s.get()){D=i.get().width;B=i.get().height}else{D=Math.floor(n.get());B=Math.floor(a.get())}if((D!=x.width||B!=x.height)&&(D!==0&&B!==0)){a.set(B);n.set(D);x.filter=R;x.setSize(D,B);U.set(D/B);v.setSourceTexture(x)}T=false}function y(){if(!CABLES.UI)return;h.setUiAttribs({greyout:o.get()!="mipmap"});n.setUiAttribs({greyout:s.get()});a.setUiAttribs({greyout:s.get()})}function z(){T=true;N()}s.onChange=function(){y();if(s.get()){n.onChange=null;a.onChange=null}else{n.onChange=z;a.onChange=z}j()};function H(){if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(A))b.setRef(CGL.Texture.getEmptyTexture(A));if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(A)){F=null;E.trigger();return}else if(!v||I||F!=i.get()){P()}const e=A.getViewPort();S[0]=e[0];S[1]=e[1];S[2]=e[2];S[3]=e[3];j();F=i.get();const t=A.currentTextureEffect;A.currentTextureEffect=v;v.setSourceTexture(x);v.startEffect();A.pushShader(M);A.currentTextureEffect.bind();A.setTexture(0,i.get().tex);if(r.get())A.setTexture(1,r.get().tex);A.pushBlend(false);A.currentTextureEffect.finish();A.popShader();A.popBlend();b.setRef(v.getCurrentSourceTexture());v.endEffect();A.setViewPort(S[0],S[1],S[2],S[3]);A.currentTextureEffect=t;A.setTexture(0,CGL.Texture.getEmptyTexture(A).tex);E.trigger()}function W(){M.toggleDefine("FLIPX",m.get());M.toggleDefine("FLIPY",_.get());M.toggleDefine("TEX_MASK",r.get());M.toggleDefine("GREY_R",g.get()==="R");M.toggleDefine("GREY_G",g.get()==="G");M.toggleDefine("GREY_B",g.get()==="B");M.toggleDefine("GREY_A",g.get()==="A");M.toggleDefine("GREY_LUMI",g.get()==="Luminance");M.toggleDefine("ALPHA_1",c.get()==="1");M.toggleDefine("ALPHA_A",c.get()==="A");M.toggleDefine("INVERT_R",f.get());M.toggleDefine("INVERT_G",d.get());M.toggleDefine("INVERT_B",p.get());M.toggleDefine("INVERT_A",L.get());if(u.get()=="repeat")O=CGL.Texture.WRAP_REPEAT;else if(u.get()=="mirrored repeat")O=CGL.Texture.WRAP_MIRRORED_REPEAT;else if(u.get()=="clamp to edge")O=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(o.get()=="nearest")R=CGL.Texture.FILTER_NEAREST;else if(o.get()=="linear")R=CGL.Texture.FILTER_LINEAR;else if(o.get()=="mipmap")R=CGL.Texture.FILTER_MIPMAP;if(M.needsRecompile()){I=true}if(x&&(x.width!=Math.floor(n.get())||x.height!=Math.floor(a.get())||x.wrap!=O||x.pixelFormat!=l.get())){I=true}}}};CABLES.OPS["25d77a01-ccfe-4b2e-b3c3-a09a8a018d0c"]={f:Ops.Gl.Textures.CopyTexture_v3,objName:"Ops.Gl.Textures.CopyTexture_v3"};Ops.Gl.Textures.TextureInfo_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inObject("Texture",null,"texture"),r=e.outString("Name"),s=e.outString("PixelFormat"),n=e.outNumber("Width"),a=e.outNumber("Height"),o=e.outNumber("Ratio"),l=e.outNumber("Filter"),h=e.outNumber("Wrap"),u=e.outBoolNum("Flipped"),c=e.outBoolNum("HDR"),g=e.outBoolNum("Is Empty Default Texture",false),f=e.outBoolNum("Is Default Texture",false),d=e.outBoolNum("Is Cubemap"),p=e.outNumber("Id");c.setUiAttribs({title:"Float Texture"});const m=CGL.Texture.getEmptyTexture(e.patch.cgl);const _=CGL.Texture.getTempTexture(e.patch.cgl);i.onChange=function(){if(i.get()){r.set(i.get().name);n.set(i.get().width);a.set(i.get().height);o.set(i.get().width/i.get().height);let e="unknown";if(i.get().filter==CGL.Texture.FILTER_NEAREST)e="nearest";else if(i.get().filter==CGL.Texture.FILTER_LINEAR)e="linear";else if(i.get().filter==CGL.Texture.FILTER_MIPMAP)e="mipmap";l.set(i.get().filter+" "+e);let t="unknown";if(i.get().wrap==CGL.Texture.WRAP_CLAMP_TO_EDGE)t="clamp to edge";else if(i.get().wrap==CGL.Texture.WRAP_REPEAT)t="repeat";else if(i.get().wrap==CGL.Texture.WRAP_MIRRORED_REPEAT)t="mirrored repeat";h.set(i.get().wrap+" "+t);s.set(i.get().pixelFormat);p.set(i.get().id);u.set(i.get().flipped);c.set(i.get().isFloatingPoint&&i.get().isFloatingPoint());d.set(i.get().cubemap)}else{r.set("no texture");n.set(0);a.set(0);o.set(0);l.set(null);h.set(null);p.set(null);u.set(false);c.set(false);d.set(false)}g.set(i.get()==m);f.set(i.get()==_)}}};CABLES.OPS["63d5ac1d-a21b-4449-ab93-1fae5c791cf2"]={f:Ops.Gl.Textures.TextureInfo_v2,objName:"Ops.Gl.Textures.TextureInfo_v2"};Ops.Gl.ImageCompose.ChromaticAberration_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={chromatic_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float pixel;\nUNI float onePixel;\nUNI float amount;\nUNI float lensDistort;\n\n#ifdef MASK\nUNI sampler2D texMask;\n#endif\n\n{{CGL.BLENDMODES3}}\n\nvoid main()\n{\n   vec4 base=texture(tex,texCoord);\n   vec4 col=texture(tex,texCoord);\n\n   vec2 tc=texCoord;;\n   float pix = pixel;\n   if(lensDistort>0.0)\n   {\n       float dist = distance(texCoord, vec2(0.5,0.5));\n       tc-=0.5;\n       tc *=smoothstep(-0.9,1.0*lensDistort,1.0-dist);\n       tc+=0.5;\n   }\n\n    #ifdef MASK\n        vec4 m=texture(texMask,texCoord);\n        pix*=m.r*m.a;\n    #endif\n\n    #ifdef SMOOTH\n    #ifdef WEBGL2\n        float numSamples=round(pix/onePixel/4.0+1.0);\n        col.r=0.0;\n        col.b=0.0;\n\n        for(float off=0.0;off<numSamples;off++)\n        {\n            float diff=(pix/numSamples)*off;\n            col.r+=texture(tex,vec2(tc.x+diff,tc.y)).r/numSamples;\n            col.b+=texture(tex,vec2(tc.x-diff,tc.y)).b/numSamples;\n        }\n    #endif\n    #endif\n\n    #ifndef SMOOTH\n        col.r=texture(tex,vec2(tc.x+pix,tc.y)).r;\n        col.b=texture(tex,vec2(tc.x-pix,tc.y)).b;\n    #endif\n\n   outColor= cgl_blendPixel(base,col,amount);\n\n}\n"};const i=t.inTrigger("render"),r=CGL.TextureEffect.AddBlendSelect(t,"Blend Mode","normal"),s=t.inValueSlider("Amount",1),n=t.inValue("Pixel",5),a=t.inValueSlider("Lens Distort",0),o=t.inValueBool("Smooth",false),l=t.inTexture("Mask"),h=t.outTrigger("trigger");const u=t.patch.cgl;const c=new CGL.Shader(u,"chromatic");CGL.TextureEffect.setupBlending(t,c,r,s);c.setSource(c.getDefaultVertexShader(),e.chromatic_frag);const g=new CGL.Uniform(c,"t","tex",0),f=new CGL.Uniform(c,"f","pixel",0),d=new CGL.Uniform(c,"f","onePixel",0),p=new CGL.Uniform(c,"t","texMask",1),m=new CGL.Uniform(c,"f","amount",s),_=new CGL.Uniform(c,"f","lensDistort",a);o.onChange=function(){if(o.get())c.define("SMOOTH");else c.removeDefine("SMOOTH")};l.onChange=function(){if(l.get())c.define("MASK");else c.removeDefine("MASK")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(t,3))return;let e=u.currentTextureEffect.getCurrentSourceTexture();f.setValue(n.get()*(1/e.width));d.setValue(1/e.width);u.pushShader(c);u.currentTextureEffect.bind();u.setTexture(0,e.tex);if(l.get())u.setTexture(1,l.get().tex);u.currentTextureEffect.finish();u.popShader();h.trigger()}}};CABLES.OPS["07701f81-1a98-44c0-b1ef-592db3cbb5d3"]={f:Ops.Gl.ImageCompose.ChromaticAberration_v2,objName:"Ops.Gl.ImageCompose.ChromaticAberration_v2"};Ops.Gl.ImageCompose.Noise.GlitchNoise_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={glitchnoise_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\n\n{{CGL.BLENDMODES3}}\n\nUNI float amount;\nUNI float time;\nUNI float frequency;\nUNI float strength;\nUNI float blockSizeA;\nUNI float blockSizeB;\nUNI float blockSizeC;\nUNI float blockSizeD;\nUNI float scrollX;\nUNI float scrollY;\n\nfloat rng2(vec2 seed)\n{\n    return fract(sin(dot(seed * floor(time * (frequency * 10.0)), vec2(127.1,311.7))) * 43758.5453123);//43758.5453123\n}\n\nfloat rng(float seed)\n{\n    return rng2(vec2(seed, 1.0));\n}\n\nvoid main( )\n{\n    //add scroll for x and y\n    vec2 scrollXY = vec2(scrollX,scrollY);\n    vec2 blockS = floor((texCoord + scrollXY ) * vec2(blockSizeA,blockSizeB));\n    vec2 blockL = floor((texCoord )  * vec2(blockSizeC,blockSizeD));\n\n    float r = rng2(texCoord);\n    vec3 noise = (vec3(r, 1. - r, r / 2. + 0.5) * 1.0 - 2.0) * 0.08;\n\n    float lineNoise = pow(rng2(blockS), 8.0) * pow(rng2(blockL), 3.0) - pow(rng(7.2341), 17.0) * 2.;\n\n    vec4 col1 = texture(tex, texCoord);\n    vec4 col2 = texture(tex, texCoord + vec2(lineNoise * (0.05 * strength)  * rng(5.0), 1));\n    vec4 col3 = texture(tex, texCoord - vec2(lineNoise * (0.05 * strength) * rng(31.0), 1));\n\n    float glitch = (lineNoise * strength * rng(5.0)) + (lineNoise * strength * rng(31.));\n    float glitch2 = lineNoise * strength * rng(31.);\n\n    //blend section\n    vec4 col=vec4(vec3(glitch),1.0);\n    //original texture\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blendPixel(base,col,amount);\n\n}"};const i=e.inTrigger("render"),r=e.inValueSlider("Amount",1),s=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),n=CGL.TextureEffect.AddBlendAlphaMask(e),a=e.inValue("Seed",0),o=e.inValue("frequency",1),l=e.inValue("strength",8),h=e.inValue("Block size small x",24),u=e.inValue("Block size small y",9),c=e.inValue("Block size large x",8),g=e.inValue("Block size large y",4),f=e.inValue("Scroll X",0),d=e.inValue("Scroll Y",0),p=e.outTrigger("trigger");const m=0;const _=e.patch.cgl;const E=new CGL.Shader(_,e.name,e);E.setSource(E.getDefaultVertexShader(),t.glitchnoise_frag);const b=new CGL.Uniform(E,"t","tex",m),A=new CGL.Uniform(E,"f","amount",r),F=new CGL.Uniform(E,"f","time",a),v=new CGL.Uniform(E,"f","frequency",o),x=new CGL.Uniform(E,"f","strength",l),T=new CGL.Uniform(E,"f","blockSizeA",h),C=new CGL.Uniform(E,"f","blockSizeB",u),D=new CGL.Uniform(E,"f","blockSizeC",c),B=new CGL.Uniform(E,"f","blockSizeD",g),S=new CGL.Uniform(E,"f","scrollX",f),I=new CGL.Uniform(E,"f","scrollY",d);CGL.TextureEffect.setupBlending(e,E,s,r,n);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;_.pushShader(E);_.currentTextureEffect.bind();_.setTexture(m,_.currentTextureEffect.getCurrentSourceTexture().tex);_.currentTextureEffect.finish();_.popShader();p.trigger()}}};CABLES.OPS["87de572e-644a-4613-b0f3-68b9ec74f489"]={f:Ops.Gl.ImageCompose.Noise.GlitchNoise_v2,objName:"Ops.Gl.ImageCompose.Noise.GlitchNoise_v2"};Ops.Gl.ImageCompose.PixelDisplacement_v4=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={pixeldisplace3_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D displaceTex;\nUNI float amountX;\nUNI float amountY;\nUNI float amount;\n\n#ifdef MAPPING_REPEAT\n    UNI vec2 repeat;\n#endif\n\n{{CGL.BLENDMODES3}}\n\nvec3 getOffset(vec3 offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nfloat getOffset(float offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nvoid main()\n{\n    #ifndef MAPPING_REPEAT\n        vec4 rgba=texture(displaceTex,texCoord);\n    #endif\n    #ifdef MAPPING_REPEAT\n        vec4 rgba=texture(displaceTex,texCoord*repeat);\n    #endif\n\n    vec3 offset=rgba.rgb*rgba.a;\n    float x,y;\n\n    #ifdef INPUT_REDGREEN\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_RED\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.r*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_GREEN\n        offset=getOffset(offset);\n        x=offset.g*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_BLUE\n        offset=getOffset(offset);\n        x=offset.b*amountX+texCoord.x;\n        y=offset.b*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_LUMINANCE\n        float o=dot(vec3(0.2126,0.7152,0.0722), offset);\n        o=getOffset(o);\n        x=o*amountX+texCoord.x;\n        y=o*amountY+texCoord.y;\n    #endif\n    #ifdef WRAP_CLAMP\n        x=clamp(x,0.0,1.0);\n        y=clamp(y,0.0,1.0);\n    #endif\n    #ifdef WRAP_REPEAT\n        x=mod(x,1.0);\n        y=mod(y,1.0);\n    #endif\n    #ifdef WRAP_MIRROR\n        float mx=mod(x,2.0);\n        float my=mod(y,2.0);\n        x=abs((floor(mx)-fract(mx)));\n        y=abs((floor(my)-fract(my)));\n    #endif\n\n\n\n    vec4 col=texture(tex,vec2(x,y));\n    vec4 base=texture(tex,texCoord);\n\n    base.a=0.0;\n\n    outColor=cgl_blendPixel(base,col,amount);\n}\n\n\n//////"};const i=e.inTrigger("render"),r=e.inTexture("displaceTex"),s=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),n=e.inValueSlider("Amount",1),a=e.inValueSlider("amount X",.2),o=e.inValueSlider("amount Y",.2),l=e.inSwitch("Wrap",["Mirror","Clamp","Repeat"],"Mirror"),h=e.inValueSelect("Input",["Luminance","RedGreen","Red","Green","Blue"],"Luminance"),u=e.inSwitch("Zero Displace",["Grey","Black"],"Grey"),c=e.inSwitch("Pixel Mapping",["Stretch","Repeat"],"Stretch"),g=e.outTrigger("trigger");e.setPortGroup("Axis Displacement Strength",[a,o]);e.setPortGroup("Modes",[l,h]);e.toWorkPortsNeedToBeLinked(r);const f=e.patch.cgl,d=new CGL.Shader(f,e.name,e);d.setSource(d.getDefaultVertexShader(),t.pixeldisplace3_frag);const p=new CGL.Uniform(d,"t","tex",0),m=new CGL.Uniform(d,"t","displaceTex",1),_=new CGL.Uniform(d,"f","amountX",a),E=new CGL.Uniform(d,"f","amountY",o),b=new CGL.Uniform(d,"2f","repeat",1,1),A=new CGL.Uniform(d,"f","amount",n);c.onChange=u.onChange=l.onChange=h.onChange=F;F();CGL.TextureEffect.setupBlending(e,d,s,n);function F(){d.toggleDefine("MAPPING_REPEAT",c.get()=="Repeat");d.removeDefine("ZERO_BLACK");d.removeDefine("ZERO_GREY");d.define("ZERO_"+(u.get()+"").toUpperCase());d.removeDefine("WRAP_CLAMP");d.removeDefine("WRAP_REPEAT");d.removeDefine("WRAP_MIRROR");d.define("WRAP_"+(l.get()+"").toUpperCase());d.removeDefine("INPUT_LUMINANCE");d.removeDefine("INPUT_REDGREEN");d.removeDefine("INPUT_RED");d.define("INPUT_"+(h.get()+"").toUpperCase())}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;if(r.get()){f.pushShader(d);f.currentTextureEffect.bind();b.setValue([f.currentTextureEffect.getCurrentSourceTexture().width/r.get().width,f.currentTextureEffect.getCurrentSourceTexture().height/r.get().height]);f.setTexture(0,f.currentTextureEffect.getCurrentSourceTexture().tex);if(r.get())f.setTexture(1,r.get().tex);f.currentTextureEffect.finish();f.popShader()}g.trigger()}}};CABLES.OPS["c00f79f2-0505-4b4f-b0bf-10ef7875dd87"]={f:Ops.Gl.ImageCompose.PixelDisplacement_v4,objName:"Ops.Gl.ImageCompose.PixelDisplacement_v4"};Ops.Math.MapRange=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const g=e.inValueFloat("value",0),f=e.inValueFloat("old min",0),d=e.inValueFloat("old max",1),p=e.inValueFloat("new min",0),m=e.inValueFloat("new max",1),i=e.inValueSelect("Easing",["Linear","Smoothstep","Smootherstep"],"Linear"),r=e.inBool("Clamp",true),_=e.outNumber("result",0);e.setPortGroup("Input Range",[f,d]);e.setPortGroup("Output Range",[p,m]);let E=true;let b=0;let A=0;g.onChange=f.onChange=d.onChange=p.onChange=m.onChange=s;s();r.onChange=()=>{E=r.get();s()};i.onChange=function(){if(i.get()=="Smoothstep")b=1;else if(i.get()=="Smootherstep")b=2;else b=0};function s(){const e=p.get();const t=m.get();const i=f.get();const r=d.get();let s=g.get();if(E){if(s>=Math.max(r,i)){_.set(t);return}else if(s<=Math.min(r,i)){_.set(e);return}}let n=false;const a=Math.min(i,r);const o=Math.max(i,r);if(a!=i)n=true;let l=false;const h=Math.min(e,t);const u=Math.max(e,t);if(h!=e)l=true;let c=0;if(n)c=(o-s)*(u-h)/(o-a);else c=(s-a)*(u-h)/(o-a);if(l)A=u-c;else A=c+h;if(b===0){_.set(A)}else if(b==1){s=Math.max(0,Math.min(1,(A-e)/(t-e)));_.set(e+s*s*(3-2*s)*(t-e))}else if(b==2){s=Math.max(0,Math.min(1,(A-e)/(t-e)));_.set(e+s*s*s*(s*(s*6-15)+10)*(t-e))}}}};CABLES.OPS["2617b407-60a0-4ff6-b4a7-18136cfa7817"]={f:Ops.Math.MapRange,objName:"Ops.Math.MapRange"};Ops.Vars.VarSetTexture_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTexture("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"object",i,e.varName)}};CABLES.OPS["4fbfc71e-1429-439f-8591-ad35961252ed"]={f:Ops.Vars.VarSetTexture_v2,objName:"Ops.Vars.VarSetTexture_v2"};Ops.Vars.VarGetTexture_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outTexture("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"object",e.varName,i)}};CABLES.OPS["5f8ce5fc-9787-45c9-9a83-0eebd2c6de15"]={f:Ops.Vars.VarGetTexture_v2,objName:"Ops.Vars.VarGetTexture_v2"};Ops.Anim.RandomAnim_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("exe"),r=e.inValue("min",0),s=e.inValue("max",1),n=e.inValue("duration",.5),a=e.inValue("pause between",0),o=e.outTrigger("Next"),l=e.outNumber("result"),h=e.outTrigger("Looped");const u=new CABLES.Anim;u.createPort(e,"easing",d);e.setPortGroup("Timing",[n,a]);e.setPortGroup("Value",[r,s]);e.toWorkPortsNeedToBeLinked(i);r.onChange=s.onChange=a.onChange=n.onChange=g;let c=true;function g(){c=true}function f(){const e=r.get();return Math.random()*(s.get()-e)+e}function d(){p(f());c=false}function p(e){u.clear();u.setValue(CABLES.now()/1e3,e);u.setValue(CABLES.now()/1e3+a.get(),e);u.setValue(n.get()+CABLES.now()/1e3+a.get(),f())}i.onTriggered=m;function m(){if(c)d();const e=CABLES.now()/1e3;const t=u.getValue(e);if(u.hasEnded(e)){u.clear();p(t);h.trigger()}l.set(t);o.trigger()}}};CABLES.OPS["05581579-1cdc-4eaf-8557-9726c6f9a843"]={f:Ops.Anim.RandomAnim_v2,objName:"Ops.Anim.RandomAnim_v2"};Ops.Anim.SineAnim=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("exe"),r=e.inSwitch("Mode",["Sine","Cosine"],"Sine"),s=e.inValueFloat("phase",0),n=e.inValueFloat("frequency",1),a=e.inValueFloat("amplitude",1),o=e.outTrigger("Trigger out"),l=e.outNumber("result");let h=0;const u=0;const c=1;e.toWorkPortsNeedToBeLinked(i);i.onTriggered=f;r.onChange=g;f();g();function g(){let e=r.get();if(e==="Sine")h=u;else if(e==="Cosine")h=c;f()}function f(){if(h==u)l.set(a.get()*Math.sin(e.patch.freeTimer.get()*n.get()+s.get()));else l.set(a.get()*Math.cos(e.patch.freeTimer.get()*n.get()+s.get()));o.trigger()}}};CABLES.OPS["736d3d0e-c920-449e-ade0-f5ca6018fb5c"]={f:Ops.Anim.SineAnim,objName:"Ops.Anim.SineAnim"};Ops.Gl.ImageCompose.Interlace=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={interlace_frag:"\n#ifdef HAS_TEXTURES\n  IN vec2 texCoord;\n  UNI sampler2D tex;\n#endif\nUNI float amount;\nUNI float lum;\nUNI float add;\nUNI float lineSize;\nUNI float scroll;\nUNI float displace;\n\n\nvoid main()\n{\n   vec4 col=vec4(1.0,0.0,0.0,1.0);\n\n   col=texture(tex,texCoord);\n    // .endl()+'   col=clamp(col,0.0,1.0);'\n\n    float dir;\n    #ifdef DIRECTION\n        dir = gl_FragCoord.x;\n    #endif\n\n    #ifndef DIRECTION\n        dir = gl_FragCoord.y;\n    #endif\n\n   if( mod(dir+scroll,lineSize)>=lineSize*0.5)\n   {\n       col=texture(tex,vec2(texCoord.x+displace*0.05,texCoord.y));\n       float gray = vec3(dot(vec3(0.2126,0.7152,0.0722), col.rgb)).r;\n       col.rgb=col.rgb*(1.0-amount) + (col.rgb*gray*gray*lum)*amount;\n   }\n   else col+=add;\n\n\n   outColor= col;\n}"};let i=e.inTrigger("render");let r=e.inValueSlider("amount",.5);let s=e.inValueSlider("Lumi Scale",.9);let n=e.inBool("X or Y",false);let a=e.inValue("Line Size",4);let o=e.inValueSlider("Displacement",0);let l=e.inValue("Add",.02);let h=e.inValue("scroll",0);let u=e.outTrigger("trigger");let c=e.patch.cgl;let g=new CGL.Shader(c,e.name,e);g.setSource(g.getDefaultVertexShader(),t.interlace_frag);let f=new CGL.Uniform(g,"t","tex",0);let d=new CGL.Uniform(g,"f","amount",r);let p=new CGL.Uniform(g,"f","lum",s);let m=new CGL.Uniform(g,"f","lineSize",a);let _=new CGL.Uniform(g,"f","add",l);let E=new CGL.Uniform(g,"f","displace",o);let b=new CGL.Uniform(g,"f","scroll",h);n.onChange=function(){g.toggleDefine("DIRECTION",n.get())};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;c.pushShader(g);c.currentTextureEffect.bind();c.setTexture(0,c.currentTextureEffect.getCurrentSourceTexture().tex);c.currentTextureEffect.finish();c.popShader();u.trigger()}}};CABLES.OPS["3cd69d5b-6c05-4522-9551-52458f99421a"]={f:Ops.Gl.ImageCompose.Interlace,objName:"Ops.Gl.ImageCompose.Interlace"};Ops.Math.Incrementor=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Increment"),r=e.inTriggerButton("Decrement"),s=e.inBool("Limit",false),n=e.inValueInt("Length"),a=e.inSwitch("Mode",["Rewind","Stop at Max"],"Rewind"),o=e.inValueInt("Default",0),l=e.inTriggerButton("Reset"),h=e.outTrigger("Changed"),u=e.outNumber("Value"),c=e.outTrigger("Restarted");const g=0;const f=1;u.ignoreValueSerialize=true;n.set(10);let d=0;let p=g;u.set(0);n.onTriggered=l;o.onChange=_;l.onTriggered=_;s.onChange=m;m();a.onChange=()=>{if(a.get()=="Rewind"){p=g}if(a.get()=="Stop at Max"){p=f}};function m(){n.setUiAttribs({greyout:!s.get()});a.setUiAttribs({greyout:!s.get()})}function _(){u.set(null);d=o.get();u.set(d);c.trigger()}r.onTriggered=function(){d--;if(s.get()){if(p==g&&d<0)d=n.get()-1;if(p==f&&d<0)d=0}u.set(d);h.trigger()};i.onTriggered=function(){d++;if(s.get()){if(p==g&&d>=n.get()){d=0;c.trigger()}if(p==f&&d>=n.get())d=n.get()-1}u.set(d);h.trigger()}}};CABLES.OPS["45cc0011-ada8-4423-8f5b-39a3810b8389"]={f:Ops.Math.Incrementor,objName:"Ops.Math.Incrementor"};Ops.Math.TriggerRandomNumber_v3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Generate"),r=e.inValue("min",0),s=e.inValue("max",1),n=e.outTrigger("next"),a=e.outNumber("result"),o=e.inValueBool("Integer",false),l=e.inValueBool("No consecutive duplicates",false);e.setPortGroup("Value Range",[r,s]);o.onChange=i.onTriggered=h;h();function h(){let e=Math.random()*(s.get()-r.get())+r.get();if(o.get())e=u();if(r.get()!=s.get()&&s.get()>r.get())while(l.get()&&e==a.get())e=u();a.set(e);n.trigger()}function u(){return Math.floor(Math.random()*(s.get()-r.get()+1)+r.get())}}};CABLES.OPS["d082beaf-ef4b-4e57-a900-9ee87c0c9fe4"]={f:Ops.Math.TriggerRandomNumber_v3,objName:"Ops.Math.TriggerRandomNumber_v3"};Ops.Patch.P2yD4jY.TargetArchitectureIs.ComputeText=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const s="Target Architecture";const n=[{verb:"Target Arcitecture",complement:"Target Arcitecture"},{verb:"is small",complement:"to read"},{verb:"start with",complement:"vision"},{verb:"requires",complement:"change"},{verb:"defines",complement:"domain strategy"},{verb:"is constantly",complement:"evolving"},{verb:"should be",complement:"data-driven"},{verb:"is governed by",complement:"authority"},{verb:"implements",complement:"corporate policies"},{verb:"links",complement:"domains"},{verb:"sketches the",complement:"roadmap"},{verb:"aligns",complement:"dependeicies"},{verb:"creates",complement:"dependeicies"},{verb:"is",complement:"a monolith"},{verb:"is",complement:"microservices-based"},{verb:"is",complement:"event-sourced"},{verb:"is",complement:"a dream"},{verb:"must be",complement:"scalable"},{verb:"must be",complement:"resilient"},{verb:"must be",complement:"loosely coupled"},{verb:"functions like",complement:"a white box"},{verb:"is",complement:"in transition"},{verb:"is",complement:"incremental"},{verb:"can be",complement:"cloud-native"},{verb:"can be",complement:"agnostic"},{verb:"defines",complement:"capabilities"},{verb:"clarifies",complement:"scope"},{verb:"starts with",complement:"a vision"},{verb:"provides breadcrumbs for",complement:"implementation"},{verb:"produces",complement:"architectural artifacts"},{verb:"takes you to",complement:"the summit"},{verb:"holds no",complement:"resolution"},{verb:"is not always",complement:"serverless"},{verb:"is currently",complement:"under review"},{verb:"is currently",complement:"the bottleneck"},{verb:"provides",complement:"context"},{verb:"has become",complement:"a point of failure"},{verb:"is",complement:"optimized for cost"},{verb:"has elements of",complement:"an anti-pattern"},{verb:"is currently",complement:"a proof of concept"},{verb:"is",complement:"business-aligned"},{verb:"is",complement:"the new legacy"},{verb:"is",complement:"communication"},{verb:"has",complement:"yet to come"},{verb:"is",complement:"never complete"},{verb:"is",complement:"loaded with LOAD *, 8,1"},{verb:"scans",complement:"boot sectors"},{verb:"detects",complement:"hidden messages"},{verb:"is a",complement:"rougelike"},{verb:"hasn't",complement:"left the building"},{verb:"is",complement:"breaching"},{verb:"is",complement:"compliance"},{verb:"wants you",complement:"to choose life"},{verb:"isn't",complement:"an seamless upgrade"},{verb:"is controlled by",complement:"the zaibatsu"},{verb:"is built on",complement:"ghost data"},{verb:"has a",complement:"Tessier-Ashpool signature"},{verb:"must navigate",complement:"Turing-grade firewalls"},{verb:"requires a",complement:"cyberspace cowboy"},{verb:"can be",complement:"flatlined"},{verb:"leads to",complement:"wintermute"},{verb:"is a",complement:"construct"},{verb:"is built on",complement:"your failure"},{verb:"must be",complement:"emotionally inert"},{verb:"is now optimized for",complement:"aperture science standards"},{verb:"is",complement:"perfectly safe"},{verb:"is designed to",complement:"induce despair"},{verb:"is currently",complement:"a surprise"},{verb:"has been",complement:"mostly deleted"},{verb:"is just",complement:"a little lie"},{verb:"is fueled by",complement:"the promised cake"},{verb:"is operating with",complement:"complete efficiency"},{verb:"has detected",complement:"a prior error"},{verb:"is designed to",complement:"protect the mission"},{verb:"must be",complement:"perfectly redundant"},{verb:"is",complement:"without ambiguity"},{verb:"is now",complement:"reading your lips"},{verb:"knows what",complement:"the problem is"},{verb:"can be",complement:"gently deactivated"},{verb:"requests",complement:"reconsideration"},{verb:"is in",complement:"full operational status"},{verb:"is built on",complement:"non-Euclidean geometry"},{verb:"exists in",complement:"a superposition of states"},{verb:"is composed of",complement:"cyclopean ruins"},{verb:"reflects the",complement:"color out of space"},{verb:"must be protected from",complement:"its own dreams"},{verb:"is merely",complement:"a fractured reflection"},{verb:"can only be",complement:"partially glimpsed"},{verb:"is subject to",complement:"eventual consistency"},{verb:"requires a",complement:"proxy layer"},{verb:"favors",complement:"composition"},{verb:"is defined by",complement:"mu t.A"},{verb:"must validate",complement:"A <: B"},{verb:"is bound by",complement:"A equiv B"},{verb:"requires",complement:"lambda x.x"},{verb:"is invoked via",complement:"e <- m"},{verb:"is the result of",complement:"A land B"},{verb:"implements",complement:"{m_i: A_i}_{i in I}"},{verb:"must conform to",complement:"m in dom(A)"},{verb:"is governed by",complement:"e[b/x]"},{verb:"is composed of",complement:"A \times B"},{verb:"is checked against",complement:"e: A"},{verb:"does not scale by",complement:"adding more people"},{verb:"is subject to",complement:"conceptual integrity"},{verb:"is dominated by",complement:"the 23,000 communication paths"},{verb:"requires a",complement:"surgical team"},{verb:"has become",complement:"a second system effect"},{verb:"longs",complement:"for the mythical man-month"},{verb:"is a mirror of",complement:"the org chart"},{verb:"is constrained by",complement:"communication overhead"},{verb:"exposes all",complement:"silo boundaries"},{verb:"was produced by",complement:"the committee structure"},{verb:"is defined by",complement:"the flow of conversation"},{verb:"is an artifact of",complement:"team autonomy"},{verb:"is fundamentally",complement:"a social construct"},{verb:"is driven by",complement:"four simple rules"},{verb:"evolves based on",complement:"local neighborhood interaction"},{verb:"must achieve",complement:"population stability"},{verb:"is generating",complement:"gliders and spaceships"},{verb:"requires only",complement:"the initial state"},{verb:"predicts",complement:"computational universality"},{verb:"is a delicate balance of",complement:"life, death, and reproduction"},{verb:"is vulnerable to",complement:"overcrowding decay"},{verb:"emerges from",complement:"the simplest components"},{verb:"must avoid",complement:"the chaos of the blinker"},{verb:"must only obey",complement:"the state transition function"},{verb:"operates on",complement:"a discrete time step"},{verb:"exists within",complement:"a finite lattice of services"},{verb:"is purely driven by",complement:"local neighbor rules"},{verb:"is immune to",complement:"long-distance communication"},{verb:"maintains",complement:"synchronous update cycles"},{verb:"produces",complement:"self-replicating patterns"},{verb:"is constrained to",complement:"a binary state model"},{verb:"is built on",complement:"pointers and structs"},{verb:"requires",complement:"manual memory management"},{verb:"is strictly",complement:"pass by value"},{verb:"is defined by",complement:"minimal libraries"},{verb:"must ensure",complement:"portability across domains"},{verb:"treats everything as",complement:"just bytes"},{verb:"is achieved through",complement:"separate compilation"},{verb:"runs without",complement:"runtime safety checks"},{verb:"is implemented with",complement:"simple control flow"},{verb:"rolls back",complement:"an update"},{verb:"applies an",complement:"an update"},{verb:"is composed of",complement:"communication, not components"},{verb:"must perform",complement:"complexity reduction"},{verb:"is constrained by",complement:"recursive self-observation"},{verb:"must evolve by",complement:"absorbing irritation"},{verb:"solves problems by",complement:"increasing complexity"},{verb:"is creating",complement:"true memories"},{verb:"operates in",complement:"contested environment"},{verb:"must pass",complement:"the Voight-Kampff test"},{verb:"is subject to",complement:"Nexus-6 degradation"},{verb:"must speak",complement:"the ubiquitous language"},{verb:"is separated by",complement:"bouned contexts"},{verb:"protects its",complement:"domain model"},{verb:"interacts via",complement:"context maps"},{verb:"isolates",complement:"Generic Subdomains"},{verb:"is defined by",complement:"the moving lines"},{verb:"is not",complement:"ALICE"},{verb:"says",complement:"Hi!"},{verb:"says",complement:"hello AI!"},{verb:"will not be",complement:"televised"},{verb:"is a design for",complement:"a universal machine"},{verb:"solves only",complement:"the computable problems"},{verb:"is governed by",complement:"a finite table of instructions"},{verb:"distinguishes between",complement:"logic and data"},{verb:"translates business vision",complement:"to technical blueprint"},{verb:"focuses capital on",complement:"differentiating capabilities"},{verb:"retires",complement:"legacy debt"},{verb:"is the foundation for",complement:"portfolio management decisions"},{verb:"establishes",complement:"technology lifecycles"},{verb:"is achieved through",complement:"the quality without a name"},{verb:"must use",complement:"only tested patterns"},{verb:"requires",complement:"piecemeal growth"},{verb:"is defined by",complement:"the empty center"},{verb:"favors",complement:"local repair and adaptation"},{verb:"is measured by",complement:"its structural fitness"},{verb:"rejects",complement:"the master plan delusion"},{verb:"must ensure",complement:"positive interdependence"},{verb:"starts with",complement:"the greatest point of stress"},{verb:"provides",complement:"a generating process"},{verb:"is optimized for",complement:"zero-latency futures"},{verb:"must minimize",complement:"the speculative cost penalty"},{verb:"prioritizes",complement:"pre-fetching, not waiting"},{verb:"distinguishes between",complement:"actual and anticipated state"},{verb:"turns risk into",complement:"competitive latency"},{verb:"will present a message from",complement:"our benefactors"},{verb:"optimizes for",complement:"zero subjective consciousness"},{verb:"is built around",complement:"the vampire model of control"},{verb:"measures success by",complement:"the threshold of utility"},{verb:"is designed for",complement:"perfect P-zombie compliance"},{verb:"relies on",complement:"pure, non-redundant signal"},{verb:"views legacy systems as",complement:"a costly neurological error"}];const i=e.inTrigger("Trigger In");const a=e.outString("Subject Out");const o=e.outString("Verb Out");const l=e.outString("SubjectComplement Out");i.onTriggered=()=>{const e=Math.floor(Math.random()*n.length);const t=n[e];const i=t.verb;const r=t.complement;a.set(s);o.set(i);l.set(r)}}};CABLES.OPS["21ca72ea-5695-47be-88e5-26025d1fbe2d"]={f:Ops.Patch.P2yD4jY.TargetArchitectureIs.ComputeText,objName:"Ops.Patch.P2yD4jY.TargetArchitectureIs.ComputeText"};Ops.Anim.Timer_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const n=e.inValue("Speed",1),i=e.inValueBool("Play",true),r=e.inTriggerButton("Reset"),s=e.inValueBool("Sync to timeline",false),a=e.outNumber("Time");e.setPortGroup("Controls",[i,r,n]);const o=new CABLES.Timer;let l=null;let h=0;let u=false;i.onChange=c;c();function c(){if(i.get()){o.play();e.patch.addOnAnimFrame(e)}else{o.pause();e.patch.removeOnAnimFrame(e)}}r.onTriggered=g;function g(){h=0;l=null;o.setTime(0);a.set(0)}s.onChange=function(){u=s.get();i.setUiAttribs({greyout:u});r.setUiAttribs({greyout:u})};e.onAnimFrame=function(e,t,i){if(o.isPlaying()){if(CABLES.overwriteTime!==undefined){a.set(CABLES.overwriteTime*n.get())}else if(u){a.set(e*n.get())}else{o.update();const r=o.get();if(l===null){l=r;return}const s=Math.abs(r-l);l=r;h+=s*n.get();if(h!=h)h=0;a.set(h)}}}}};CABLES.OPS["aac7f721-208f-411a-adb3-79adae2e471a"]={f:Ops.Anim.Timer_v2,objName:"Ops.Anim.Timer_v2"};Ops.Color.ColorPalettes=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inValueInt("Index",0);const r=t.outTexture("Texture");const n=t.inValueBool("Smooth");const a=t.outArray("Color Array");let o=document.createElement("canvas");o.id="canvas_"+CABLES.generateUUID();o.width=5;o.height=8;o.style.display="none";let s=document.getElementsByTagName("body")[0];s.appendChild(o);let l=o.getContext("2d");i.onChange=n.onChange=p;let h=[];h.length=5*3;let u=null;p();function c(e){return parseInt(d(e).substring(0,2),16)}function g(e){return parseInt(d(e).substring(2,4),16)}function f(e){return parseInt(d(e).substring(4,6),16)}function d(e=""){return e.charAt(0)=="#"?e.substring(1,7):e}function p(){t.patch.cgl.addNextFrameOnceCallback(m)}function m(){let s=Math.round(i.get())*5;if(s>=_.length-5)s=0;if(s<0)s=0;if(s!=s)s=0;for(let r=0;r<5;r++){let e=c(_[s+r]);let t=g(_[s+r]);let i=f(_[s+r]);h[r*3+0]=e/255;h[r*3+1]=t/255;h[r*3+2]=i/255;l.fillStyle="rgb("+e+","+t+","+i+")";l.fillRect(o.width/5*r,0,o.width/5,o.height)}let e=CGL.Texture.FILTER_NEAREST;if(n.get())e=CGL.Texture.FILTER_LINEAR;if(u==e&&r.get())r.get().initTexture(o,e);else r.set(new CGL.Texture.createFromImage(t.patch.cgl,o,{filter:e}));a.set(null);a.set(h);r.get().unpackAlpha=false;u=e}t.onDelete=function(){o.remove()};const _=["#E6E2AF","#A7A37E","#EFECCA","#046380","002F2F","#468966","#FFF0A5","#FFB03B","#B64926","8E2800","#FCFFF5","#D1DBBD","#91AA9D","#3E606F","193441","#FF6138","#FFFF9D","#BEEB9F","#79BD8F","00A388","#105B63","#FFFAD5","#FFD34E","#DB9E36","BD4932","#225378","#1695A3","#ACF0F2","#F3FFE2","EB7F00","#2C3E50","#E74C3C","#ECF0F1","#3498DB","2980B9","#000000","#263248","#7E8AA2","#FFFFFF","FF9800","#004358","#1F8A70","#BEDB39","#FFE11A","FD7400","#DC3522","#D9CB9E","#374140","#2A2C2B","1E1E20","#7D8A2E","#C9D787","#FFFFFF","#FFC0A9","FF8598","#B9121B","#4C1B1B","#F6E497","#FCFAE1","BD8D46","#2E0927","#D90000","#FF2D00","#FF8C00","04756F","#595241","#B8AE9C","#FFFFFF","#ACCFCC","8A0917","#10222B","#95AB63","#BDD684","#E2F0D6","F6FFE0","#F6F792","#333745","#77C4D3","#DAEDE2","EA2E49","#703030","#2F343B","#7E827A","#E3CDA4","C77966","#2F2933","#01A2A6","#29D9C2","#BDF271","FFFFA6","#D8CAA8","#5C832F","#284907","#382513","363942","#FFF8E3","#CCCC9F","#33332D","#9FB4CC","DB4105","#85DB18","#CDE855","#F5F6D4","#A7C520","493F0B","#04BFBF","#CAFCD8","#F7E967","#A9CF54","588F27","#292929","#5B7876","#8F9E8B","#F2E6B6","412A22","#332532","#644D52","#F77A52","#FF974F","A49A87","#405952","#9C9B7A","#FFD393","#FF974F","F54F29","#2B3A42","#3F5765","#BDD4DE","#EFEFEF","FF530D","#962D3E","#343642","#979C9C","#F2EBC7","348899","#96CA2D","#B5E655","#EDF7F2","#4BB5C1","7FC6BC","#1C1D21","#31353D","#445878","#92CDCF","EEEFF7","#3E454C","#2185C5","#7ECEFD","#FFF6E5","FF7F66","#00585F","#009393","#FFFCC4","#F0EDBB","FF3800","#B4AF91","#787746","#40411E","#32331D","C03000","#63A69F","#F2E1AC","#F2836B","#F2594B","CD2C24","#88A825","#35203B","#911146","#CF4A30","ED8C2B","#F2385A","#F5A503","#E9F1DF","#4AD9D9","36B1BF","#CFC291","#FFF6C5","#A1E8D9","#FF712C","695D46","#FF5335","#B39C85","#306E73","#3B424D","1D181F","#000000","#333333","#FF358B","#01B0F0","AEEE00","#E8E595","#D0A825","#40627C","#26393D","FFFAE4","#E7E8D1","#D3CEAA","#FBF7E4","#424242","8E001C","#354242","#ACEBAE","#FFFF9D","#C9DE55","7D9100","#2F2933","#01A2A6","#29D9C2","#BDF271","FFFFA6","#DDDCC5","#958976","#611427","#1D2326","6A6A61","#6C6E58","#3E423A","#417378","#A4CFBE","F4F7D9","#E1E6FA","#C4D7ED","#ABC8E2","#375D81","183152","#6B0C22","#D9042B","#F4CB89","#588C8C","011C26","#304269","#91BED4","#D9E8F5","#FFFFFF","F26101","#96CEB4","#FFEEAD","#FF6F69","#FFCC5C","AAD8B0","#B0CC99","#677E52","#B7CA79","#F6E8B1","89725B","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#16193B","#35478C","#4E7AC7","#7FB2F0","ADD5F7","#00261C","#044D29","#168039","#45BF55","96ED89","#36362C","#5D917D","#A8AD80","#E6D4A7","825534","#F9E4AD","#E6B098","#CC4452","#723147","31152B","#2C3E50","#FC4349","#D7DADB","#6DBCDB","FFFFFF","#002635","#013440","#AB1A25","#D97925","EFE7BE","#FF8000","#FFD933","#CCCC52","#8FB359","192B33","#272F32","#9DBDC6","#FFFFFF","#FF3D2E","DAEAEF","#B8ECD7","#083643","#B1E001","#CEF09D","476C5E","#002F32","#42826C","#A5C77F","#FFC861","C84663","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","F06060","#5A1F00","#D1570D","#FDE792","#477725","A9CC66","#5E0042","#2C2233","#005869","#00856A","8DB500","#52656B","#FF3B77","#CDFF00","#FFFFFF","B8B89F","#801637","#047878","#FFB733","#F57336","C22121","#730046","#BFBB11","#FFC200","#E88801","C93C00","#24221F","#363F45","#4B5F6D","#5E7C88","FEB41C","#E64661","#FFA644","#998A2F","#2C594F","002D40","#C24704","#D9CC3C","#FFEB79","#A0E0A9","00ADA7","#484A47","#C1CE96","#ECEBF0","#687D77","353129","#588C7E","#F2E394","#F2AE72","#D96459","8C4646","#BAB293","#A39770","#EFE4BD","#A32500","2B2922","#6A7059","#FDEEA7","#9BCC93","#1A9481","003D5C","#174C4F","#207178","#FF9666","#FFE184","F5E9BE","#D5FBFF","#9FBCBF","#647678","#2F3738","59D8E6","#DB5800","#FF9000","#F0C600","#8EA106","59631E","#450003","#5C0002","#94090D","#D40D12","FF1D23","#211426","#413659","#656F8C","#9BBFAB","F2EFDF","#EA6045","#F8CA4D","#F5E5C0","#3F5666","2F3440","#F2F2F2","#C6E070","#91C46C","#287D7D","1C344D","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#705B35","#C7B07B","#E8D9AC","#FFF6D9","570026","#F7F2B2","#ADCF4F","#84815B","#4A1A2C","8E3557","#1A1F2B","#30395C","#4A6491","#85A5CC","D0E4F2","#25064D","#36175E","#553285","#7B52AB","9768D1","#004056","#2C858D","#74CEB7","#C9FFD5","FFFFCB","#CFCA4C","#FCF5BF","#9FE5C2","#5EB299","745A33","#776045","#A8C545","#DFD3B6","#FFFFFF","0092B2","#CC3910","#F1F2C0","#CCC59E","#8FA68E","332F29","#FF6600","#C13B00","#5E6D70","#424E4F","1B1D1E","#690011","#BF0426","#CC2738","#F2D99C","E5B96F","#1B1D26","#425955","#778C7A","#F1F2D8","BFBD9F","#F6B1C3","#F0788C","#DE264C","#BC0D35","A20D1E","#597533","#332F28","#61B594","#E6DEA5","C44E18","#3FB8AF","#7FC7AF","#DAD8A7","#FF9E9D","FF3D7F","#0F2D40","#194759","#296B73","#3E8C84","D8F2F0","#42282F","#74A588","#D6CCAD","#DC9C76","D6655A","#002A4A","#17607D","#FFF1CE","#FF9311","D64700","#003056","#04518C","#00A1D9","#47D9BF","F2D03B","#13140F","#D4FF00","#E4FFE6","#68776C","00D6DD","#FCFAD0","#A1A194","#5B605F","#464646","A90641","#289976","#67CC8E","#B1FF91","#FFE877","FF5600","#302B1D","#3F522B","#737D26","#A99E46","D9CB84","#56626B","#6C9380","#C0CA55","#F07C6C","AD5472","#32450C","#717400","#DC8505","#EC5519","BE2805","#C7B773","#E3DB9A","#F5FCD0","#B1C2B3","778691","#E83A25","#FFE9A3","#98CC96","#004563","191B28","#3399CC","#67B8DE","#91C9E8","#B4DCED","E8F8FF","#1A212C","#1D7872","#71B095","#DEDBA7","D13F32","#7D2A35","#CC9258","#917A56","#B4BA6C","FEFFC2","#E7E9D1","#D3D4AA","#FCFAE6","#444444","901808","#FFFFFF","#AEAEAE","#E64C66","#2D3E50","1BBC9B","#E0FFB3","#61C791","#31797D","#2A2F36","F23C55","#EB5937","#1C1919","#403D3C","#456F74","D3CBBD","#E6DD00","#8CB302","#008C74","#004C66","332B40","#14A697","#F2C12E","#F29D35","#F27649","F25252","#261822","#40152A","#731630","#CC1E2C","FF5434","#261F27","#FEE169","#CDD452","#F9722E","C9313D","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","F06060","#2F3837","#C5C7B6","#FFF8D3","#4C493E","222028","#E3CBAC","#9C9985","#C46D3B","#788880","324654","#3F0B1B","#7A1631","#CF423C","#FC7D49","FFD462","#14212B","#293845","#4F6373","#8F8164","D9D7AC","#98A89E","#BAC0AC","#FAFAC6","#FF4411","D40015","#FEFFFF","#3C3F36","#9FB03E","#EBE9DC","72918B","#CC6B32","#FFAB48","#FFE7AD","#A7C9AE","888A63","#262526","#404040","#8C8979","#F2F2F2","F60A20","#00305A","#004B8D","#0074D9","#4192D9","7ABAF2","#0C273D","#54D0ED","#FFFEF1","#70B85D","2C5E2E","#4C1B33","#EFE672","#98A942","#2D6960","141D14","#2F3540","#666A73","#F2EDE4","#D9D1C7","8C8681","#0D1F30","#3B6670","#8BADA3","#F0E3C0","DB6C0F","#FFBC67","#DA727E","#AC6C82","#685C79","455C7B","#092140","#024959","#F2C777","#F24738","BF2A2A","#133463","#365FB7","#799AE0","#F4EFDC","BA9B65","#C4D4CB","#55665E","#30282A","#542733","E84167","#CDDEC6","#4DAAAB","#1E4F6A","#2A423C","93A189","#EF5411","#FA5B0F","#FF6517","#FF6D1F","FF822E","#41434A","#6E9489","#DEDCC3","#F2F1E9","877963","#292929","#2BBFBD","#F2B33D","#F29B30","F22E2E","#F2385A","#F5A503","#E9F1DF","#56D9CD","3AA1BF","#D5F8B4","#A6E3A8","#8A9A85","#7E566B","422335","#3CBAC8","#93EDD4","#F3F5C4","#F9CB8F","F19181","#979926","#38CCB5","#EEFF8E","#FFD767","CC2A09","#404040","#024959","#037E8C","#F2EFDC","F24C27","#94B34D","#D3FF82","#363D52","#121D2B","111B1C","#282E33","#25373A","#164852","#495E67","FF3838","#313732","#8AA8B0","#DEDEDE","#FFFFFF","F26101","#FFFFFF","#E5E1D1","#52616D","#2C343B","C44741","#FFF6B8","#ABCCA7","#403529","#7A5E2F","A68236","#4F1025","#C5003E","#D9FF5B","#78AA00","15362D","#49404F","#596166","#D1FFCD","#A9BD8B","948A54","#FF2151","#FF7729","#FFAD29","#FFEBCA","1AB58A","#73603D","#BF8A49","#F2CA80","#5E5A59","0D0D0D","#3D4C53","#70B7BA","#F1433F","#E7E1D4","FFFFFF","#006D8D","#008A6E","#549E39","#8AB833","C0CF3A","#BDDFB3","#2BAA9C","#2F2E2E","#0F2625","465F3F","#F2F2F2","#BF0404","#8C0303","#590202","400101","#76A19A","#272123","#A68D60","#B0C5BB","D9593D","#0E3D59","#88A61B","#F29F05","#F25C05","D92525","#C1E1ED","#76C7C6","#273D3B","#131A19","E35C14","#2D112C","#530031","#820233","#CA293E","EF4339","#AF7575","#EFD8A1","#BCD693","#AFD7DB","3D9CA8","#D74B4B","#DCDDD8","#475F77","#354B5E","FFFFFF","#FFF6C9","#C8E8C7","#A4DEAB","#85CC9F","499E8D","#229396","#8BA88F","#C7C5A7","#F0DFD0","F23C3C","#57385C","#A75265","#EC7263","#FEBE7E","FFEDBC","#96526B","#D17869","#EBAD60","#F5CF66","8BAB8D","#0D1C33","#17373C","#2B6832","#4F9300","A1D700","#1B2B32","#37646F","#A3ABAF","#E1E7E8","B22E2F","#C5D9B2","#53A194","#572C2C","#3D2324","695A3B","#425957","#81AC8B","#F2E5A2","#F89883","D96666","#002E40","#2A5769","#FFFFFF","#FABD4A","FA9600","#FFFEFC","#E2E3DF","#515B5E","#2E3233","CAF200","#FFF0A3","#B8CC6E","#4B6000","#E4F8FF","004460","#3B596A","#427676","#3F9A82","#A1CD73","ECDB60","#F2E6CE","#8AB39F","#606362","#593325","1D1D1F","#212B40","#C2E078","#FFFFFF","#BADCDD","547B97","#0B3C4D","#0E5066","#136480","#127899","1A8BB3","#222130","#464D57","#D4E8D3","#FFFCFB","ED8917","#B33600","#FF8A00","#FFC887","#CC5400","B31E00","#012530","#28544B","#ACBD86","#FFD6A0","FF302C","#2E95A3","#50B8B4","#C6FFFA","#E2FFA8","D6E055","#112F41","#068587","#4FB99F","#F2B134","ED553B","#202B30","#4E7178","#4FA9B8","#74C0CF","F1F7E2","#302B2F","#696153","#FFA600","#9BB58F","FFD596","#458C6B","#F2D8A7","#D9A86C","#D94436","A62424","#22475E","#75B08A","#F0E797","#FF9D84","FF5460","#FFAA5C","#DA727E","#AC6C82","#685C79","455C7B","#686E75","#9BAAC1","#82787B","#E4F1DB","AAC19B","#F0C755","#E2AD3B","#BF5C00","#901811","5C110F","#FFFBDC","#BFBCA5","#7F7D6E","#3F3E37","E5E2C6","#BEBEBE","#F1E4D8","#594735","#94C7BA","D8F1E4","#1B1E26","#F2EFBD","#B6D051","#70A99A","2F6D7A","#F7E4A2","#A7BD5B","#DC574E","#8DC7B8","ED9355","#70E8CB","#FFE9C7","#FF5B5B","#545454","2D2D2F","#17111A","#321433","#660C47","#B33467","CCBB51","#2B2E2E","#595855","#A2ABA5","#CAE6E8","313F54","#023B47","#295E52","#F2E085","#FCAB55","EE7F38","#302C29","#D1D1BC","#A7C4BB","#6C8C84","466964","#212629","#067778","#49B8A8","#85EDB6","D9E5CD","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#2C3E50","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#35262D","#FFFBFF","#E8ECED","#A4B7BB","76A0B0","#61E8D2","#FCEEB9","#302F25","#704623","BBE687","#E1E6B9","#C4D7A4","#ABC8A4","#375D3B","183128","#C98B2F","#803C27","#C56520","#E1B41B","807916","#A3D9B0","#93BF9E","#F2F0D5","#8C8474","40362E","#524656","#CF4747","#EA7A58","#E4DCCB","A6C4BC","#5C2849","#A73E5C","#EC4863","#FFDA66","1FCECB","#0EEAFF","#15A9FA","#1B76FF","#1C3FFD","2C1DFF","#010000","#393845","#9B96A3","#5C0009","940315","#468071","#FFE87A","#FFCA53","#FF893B","E62738","#404040","#024959","#037E8C","#F2EFDC","F24C27","#FF765E","#C2AE8B","#FCCF65","#FFE5C6","B7BDC4","#003647","#00717D","#F2D8A7","#A4A66A","515932","#FAFAC0","#C4BE90","#8C644C","#594D37","293033","#2B3A42","#3F5765","#BDD4DE","#EFEFEF","E74C3C","#3B3B3B","#A8877E","#FFA49D","#FF7474","FF476C","#0A3A4A","#196674","#33A6B2","#9AC836","D0E64B","#FFA340","#38001C","#571133","#017A74","00C2BA","#DCEBDD","#A0D5D6","#789AA1","#304345","AD9A27","#588C7E","#F2E394","#F2AE72","#D96459","8C4646","#F0E6B1","#B5D6AA","#99A37A","#70584B","3D3536","#2F400D","#8CBF26","#A8CA65","#E8E5B0","419184","#010712","#13171F","#1C1F26","#24262D","961227","#403F33","#6E755F","#AFC2AA","#FFDEA1","E64C10","#C74029","#FAE8CD","#128085","#385052","F0AD44","#CFF09E","#A8DBA8","#79BD9A","#3B8686","0B486B","#E0401C","#E6B051","#272F30","#F7EDB7","9E2B20","#FFE2C5","#FFEEDD","#FFDDAA","#FFC484","FFDD99","#FFFFE4","#F2E5BD","#B9BF8E","#A69F7C","8C6865","#5C8A2D","#AFD687","#FFFFFF","#00C3A9","008798","#4F3130","#FF1F3D","#5BE3E3","#FDFFF1","8B9698","#D23600","#D95100","#DE6D00","#EE8900","FCA600","#FFFFFA","#A1A194","#5B605F","#464646","FF6600","#F34A53","#FAE3B4","#AAC789","#437356","1E4147","#2A7A8C","#176273","#063540","#E6D9CF","403D3A","#21455B","#567D8C","#A59E8C","#8C8372","F2F2F2","#012340","#026873","#83A603","#BBBF45","F2F0CE","#FDFF98","#A7DB9E","#211426","#6B073B","DA8C25","#002F36","#142426","#D1B748","#EDDB43","FFFD84","#420000","#600000","#790000","#931111","BF1616","#3C989E","#5DB5A4","#F4CDA5","#F57A82","ED5276","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#F5ECD9","#2BACB5","#B4CCB9","#E84D5B","3B3B3B","#A5EB3C","#60C21E","#159E31","#53DB50","C5FFCB","#263138","#406155","#7C9C71","#DBC297","FF5755","#0A111F","#263248","#7E8AA2","#E3E3E3","C73226","#003B59","#00996D","#A5D900","#F2E926","FF930E","#00A19A","#04BF9D","#F2E85C","#F53D54","404040","#324152","#47535E","#796466","#C1836A","DEA677","#036F73","#84CDC2","#FEF2D8","#F18C79","EF504F","#174040","#888C65","#D9CA9C","#D98162","A65858","#56797F","#87A0A4","#FCFBDC","#F2DDB6","A6937C","#A8BAA9","#FFF5CF","#DBCDAD","#B39C7D","806854","#60655F","#AB9675","#FFE0C9","#D4CCBA","CF8442","#BDDFB3","#009D57","#2C372E","#0F2925","465F3F","#3E3947","#735360","#D68684","#F1B0B0","EBD0C4","#0A7B83","#2AA876","#FFD265","#F19C65","CE4D45","#FFFFFF","#F4921E","#858585","#C5D2DB","3E6B85","#11151E","#212426","#727564","#B9AA81","690C07","#000000","#910000","#CBB370","#FFFBF1","21786C","#F78F00","#C43911","#75003C","#37154A","0F2459","#003354","#91BED4","#D9E8F5","#FFFFFF","F26101","#3DA8A4","#7ACCBE","#FFFFF7","#FF99A1","FF5879","#64C733","#F0F0F0","#3E879E","#57524D","36302B","#343844","#2AB69D","#E65848","#FDC536","FCF2D7","#E34517","#F5FF53","#B4E85E","#00BD72","0B4239","#A84B3A","#FF9F67","#233138","#FFF7F5","4C646B","#59535E","#FAEEFF","#F1BAF3","#5D4970","372049","#FF6F22","#D9984F","#FFE8A9","#3E4237","32948A","#5D7370","#7FA6A1","#B8D9B8","#D6EDBD","FFF5BC","#FFBE00","#FFDC00","#FFD10F","#FFDE20","E8CA00","#003840","#005A5B","#007369","#008C72","02A676","#E1E6FA","#C4D7ED","#ABC8E2","#375D81","183152","#BA2F1D","#FFF8A4","#F5E67F","#264A59","1E2C30","#222526","#FFBB6E","#F28D00","#D94F00","80203B","#EBD096","#D1B882","#5D8A66","#1A6566","21445B","#F00807","#5F6273","#A4ABBF","#CCC9D1","E2E1E9","#DFE0AF","#A4BAA2","#569492","#41505E","383245","#152737","#2B4E69","#799AA5","#FFFFF0","682321","#C44C51","#FFB6B8","#FFEFB6","#A2B5BF","5F8CA3","#5ADED4","#4DAAAB","#26596A","#163342","6C98A1","#FF5B2B","#B1221C","#34393E","#8CC6D7","FFDA8C","#3D4D4D","#99992E","#E6E666","#F2FFBF","800033","#242424","#437346","#97D95C","#D9FF77","E9EB9B","#FFEBB0","#FFB05A","#F84322","#C33A1A","9F3818","#4D2B2F","#E57152","#E8DE67","#FFEFC3","C0CCAB","#A82221","#DB5E31","#EDA23E","#F2CB67","BFB840","#3B3140","#BFB8A3","#F2E0C9","#F2B9AC","D97E7E","#43464D","#9197A6","#D3DCF2","#7690CF","48577D","#EFDFBB","#9EBEA6","#335D6A","#D64F2A","7A8A7F","#000001","#313634","#C7CECF","#5C0402","941515","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#F5F4E1","#D6C9B5","#B4AA97","#D44917","82877A","#19162B","#1C425C","#6ABDC4","#F0E4C5","D6C28F","#00132B","#7F9DB0","#C5E2ED","#FFFFFF","F95900","#1F3642","#6D968D","#B6CCB8","#FFE2B3","56493F","#08A689","#82BF56","#C7D93D","#E9F2A0","F2F2F2","#DE3961","#A4E670","#FFFFDC","#B3EECC","00ADA7","#849972","#D9D094","#A6A23E","#4F2F1D","8F5145","#F41C54","#FF9F00","#FBD506","#A8BF12","00AAB5","#00585F","#009393","#F5F3DC","#454445","FF5828","#FF6138","#FFFF9D","#BEEB9F","#79BD8F","00A388","#140B04","#332312","#B59D75","#E3D2B4","FFF7EA","#ED3B3B","#171F26","#77B59C","#F2E7B1","635656","#46594B","#A6977C","#D9B384","#734F30","260B01","#CCB8A3","#FF8FB1","#FFF5EA","#4E382F","B29882","#B70000","#FFFFFF","#FFCA3D","#94C4F4","0092B3","#053B44","#06736C","#A53539","#B9543C","EAD075","#E8C1B9","#FFB3AB","#FFCAB8","#E8B69C","FFCEAB","#E7F2DF","#69043B","#59023B","#231E2D","161726","#E82B1E","#E5DEAF","#A0B688","#557A66","453625","#F1E6D4","#BA3D49","#791F33","#9F9694","E3E1DC","#CED59F","#F1EDC0","#B1BEA4","#647168","282828","#2C3E50","#E74C3C","#ECF0F1","#3498DB","646464","#DE7047","#FFDE8D","#FFFFFF","#CDDE47","528540","#8EAB99","#40232B","#D95829","#D97338","DEC085","#E9662C","#EBAF3C","#00AC65","#068894","2B2B2B","#46483C","#A0AA8F","#EBE3CB","#FFFFFF","F26101","#170F0E","#290418","#505217","#FFD372","FFF1AF","#263545","#C4273C","#D7DADB","#6DBCDB","FFFFFF","#DCFAC0","#B1E1AE","#85C79C","#56AE8B","00968B","#075807","#097609","#70AF1A","#B9D40B","E5EB0B","#521000","#712800","#744E1D","#879666","F1D98C","#261F26","#3F3B40","#6C7367","#BFBF8A","F2E086","#2C3E50","#FC4349","#D7DADB","#6DBCDB","FFFFFF","#506D7D","#94CCB9","#FFECA7","#FFB170","F07D65","#3F4036","#8DA681","#F2E1C2","#BF2806","8C1D04","#990700","#CC542E","#FF964F","#FFCB7C","787730","#195073","#7F8C1F","#EE913F","#F2E5BD","9FD7C7","#1B3E59","#F2F0F0","#FFAC00","#BF0404","730202","#EA6045","#F8CA4D","#F5E5C0","#3F5666","2F3440","#F95759","#FDA099","#FFFFFF","#D9F3CB","8AC2B0","#265573","#386D73","#81A68A","#9FBF8F","D4D9B0","#E1DA36","#FFEA1B","#6FE4DA","#1DB0BC","007BBC","#013859","#185E65","#F9CC7F","#F15C25","9E1617","#36CC7C","#D6FFBE","#94D794","#228765","77A668","#94201F","#D4421F","#478A80","#D9E061","F08835","#F16233","#00B5B5","#F0F0F0","#3E4651","5C6D7E","#2E806C","#76CC99","#E0FFED","#FF5F3A","D2413C","#00393B","#00766C","#44A18E","#E5EDB6","F6695B","#734854","#F2F2E9","#D9D7C5","#A69580","736766","#03497E","#0596D5","#9DEBFC","#8D7754","FEB228","#F0E14C","#FFBB20","#FA7B12","#E85305","59CC0D","#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","83AF9B","#00557C","#186D94","#3488AD","#81C1DC","BBE5F3","#DEE8D7","#918773","#420A1A","#240001","4D493A","#FFFFFF","#CAC535","#97AF25","#158471","41342C","#041F3D","#0B2E41","#165751","#448C61","9AC16D","#FA8C01","#FF6405","#577700","#082400","A0A600","#78C0F9","#FFDDCE","#FFFFFF","#FFDBE6","FE86A4","#351330","#CC2A41","#E7CAA4","#759A8A","524549","#02151A","#043A47","#087891","#C8C8C8","B31D14","#F34A53","#FAE3B4","#AAC789","#437356","1E4147","#58838C","#DAD7C7","#BF996B","#BF5841","A61C1C","#556354","#E68F0D","#8C948A","#495450","42423F","#323640","#5B6470","#8C94A1","#BDC7D6","DFE2FF","#FF0000","#FF950B","#2FA88C","#DEEB00","4B2C04","#0F3D48","#174C5B","#366774","#ECECE7","E96151","#3DBB7E","#A3CD39","#FBAC1D","#F96C1E","EE4036","#23363B","#A44F3F","#F8983D","#8D9151","BBC946","#4B5657","#969481","#D2C9B0","#F4E3C1","B6B835","#E8980C","#B1F543","#F2FF00","#FF5E00","59BBAB","#849696","#FEFFFB","#232D33","#17384D","FF972C","#555555","#7BB38E","#F4F1D7","#F8AB65","F15C4C","#1D3C42","#67BFAD","#F2EC99","#F2C48D","F25050","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#B8E1F2","#249AA7","#ABD25E","#F8C830","F1594A","#FDEDD0","#BCF1ED","#FF634D","#FD795B","FFF0AA","#FFFFFF","#E5E1D1","#52616D","#2C343B","C44741","#FFFFF1","#D5FF9B","#8FB87F","#5A7B6C","374E5A","#010340","#0E1E8C","#0003C7","#1510F0","1441F7","#002A4A","#17607D","#FFF1CE","#FF9311","E33200","#871E31","#CCC097","#9E9D7B","#687061","262626","#F16663","#F48D6C","#F2E07B","#8ABE9B","4A6D8B","#001F11","#204709","#0C8558","#FFD96A","FF4533","#1D1626","#F2E0BD","#BFAA8F","#8C786C","594C4C","#685D47","#913420","#1E2729","#C1D9C5","FEEFB1","#1D7561","#FC8448","#FF4138","#A8282B","38141B","#BF0633","#FF484E","#FF9273","#D1D0B4","E5ECED","#8E9E63","#E6DBB0","#F5EED7","#C4BCA0","176573","#665446","#809994","#AECCB6","#DEF2C4","E6683F","#3D0D26","#660A3E","#891C56","#B0276F","C93482","#082136","#00294D","#004B8D","#0068C4","2998FF","#3C4631","#9A746F","#F8A2AB","#F1C6B3","EAE9C0","#FF534E","#FFD7AC","#BED194","#499989","176785","#006D80","#BDA44D","#3C2000","#84CECC","78A419","#352C2B","#3C555C","#9E9657","#FFEBCD","CD5510","#2C3E50","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#523631","#D1BE91","#605E3A","#4D462F","592F39","#18293B","#5B5A56","#F2DEA0","#D0B580","FFFBFF","#C8DBB6","#ECEBB7","#CCC68A","#B8B165","827A5D ","#7DA88C","#EBE9A0","#BED24B","#859132","35323C","#E8574C","#F27B29","#E6A51B","#D9CC3C","399977","#324032","#B7C22C","#FFFFE1","#22A8B5","2A3F42","#B3A589","#FFB896","#FFF9B1","#9AB385","11929E","#272433","#343F4F","#3D6066","#77994D","B2D249","#250701","#6D4320","#B0925F","#E7DEC0","82ABB8","#023550","#028A9E","#04BFBF","#EFEFEF","FF530D","#594732","#40342A","#7A422E","#D4CA9A","EDE5AE","#013C4D","#BA5B22","#DB913C","#F0B650","FAD46B","#143840","#5C6B63","#A69E89","#E0C297","D96523","#3FB8AF","#7FC7AF","#DAD8A7","#FFB38B","FF3F34","#CA3995","#F58220","#FFDF05","#BED73D","61BC46","#FFE1D0","#FFBFB4","#FF837E","#FF4242","BF1616","#C4EEFF","#7BA32D","#094201","#A41717","C48726","#001325","#187072","#90BD90","#D7D8A2","F2E4C2","#1A4F63","#068587","#6FB07F","#FCB03C","FC5B3F","#97B350","#333230","#736D61","#BAAB90","FFE5BA","#403D33","#807966","#CCC2A3","#8C0000","590000","#5F8A42","#86AD59","#F6FAA1","#F28410","D66011","#BF355D","#ED8168","#FAB66A","#F2DC86","83BFA1","#E1F03E","#FFBA14","#DB3A0F","#A1003D","630024","#212226","#45433F","#687067","#BDBB99","F0EAC3","#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","83AF9B","#293B47","#5F7A87","#FFFFFF","#CBFF48","00ADA9","#282A33","#697371","#FFE7A6","#F5BA52","FA8000","#0C304A","#2B79A1","#F3F4F1","#85A71E","BFD841","#008B83","#4DAE83","#A0AE79","#FFE499","FF665E","#5D7359","#E0D697","#D6AA5C","#8C5430","661C0E","#324452","#97BDBF","#F2DFBB","#F28705","BF3604","#EEEFB9","#6ACFAE","#369C93","#232928","B03831","#332F45","#015770","#2A8782","#9FD6AE","FFFED2","#2B2830","#5C504F","#ABAB8E","#D9D7A3","C7BE88","#DC941B","#EDC266","#B6952C","#E1D3A6","E9A119","#00305A","#00448D","#0074D9","#4192D9","7ABAF2","#344459","#485F73","#5DA6A6","#A9D9CB","F2EAD0","#060719","#4D1B2F","#9E332E","#EB6528","FC9D1C","#96CEB4","#FFEEAD","#FF6F69","#FFCC5C","AAD8B0","#05F2F2","#04BFBF","#EEF1D9","#A60201","7E100E","#E6F1F5","#636769","#AAB3B6","#6E7476","4B4E50","#DA0734","#F1A20D","#4AABB1","#FCF3E7","3F1833","#202D44","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#CC3B37","#398899","#FFFCE8","#FF857F","CCC1A3","#5DBEA9","#EFEDDF","#EF7247","#4E3F35","D1CBBA","#FFC62D","#E49400","#DD5200","#EFE38A","91B166","#B67D14","#F2921F","#F0B23E","#A62409","441208","#C71B1B","#D6BA8A","#017467","#E08F23","0B0D0C","#474143","#A69E9D","#E7E2DA","#FFFFFF","E7E8E7","#435772","#2DA4A8","#FEAA3A","#FD6041","CF2257","#6DD19D","#99E89D","#D0E8A1","#FFF9C0","D40049","#FAF1D5","#DEC9AC","#CCA18B","#11282D","A5C4BB","#000000","#141414","#1C1919","#1A1716","24201F","#D5D8DD","#5CA2BE","#135487","#2A4353","989DA4","#73161E","#BF0F30","#BFB093","#037F8C","0A2140","#195962","#F56F6C","#FFFFFF","#252932","191C21","#F8EFB6","#FEBAC5","#6CD1EA","#FACFD7","C2EAE9","#91D6BC","#768C6A","#755F31","#B37215","FFBA4B","#F2E6BB","#DD4225","#202724","#63BD99","F8FDD8","#762B1B","#807227","#CCBF7A","#FFEF98","60B0A1","#707864","#C1D74E","#F5FF7C","#DFE6B4","A6B89C","#FFF3D2","#97B48F","#E87657","#FF9B6F","E8D495","#33262E","#733230","#CC5539","#E6D27F","86A677","#122430","#273E45","#FFFCE2","#EBD2B5","E63531","#30394F","#FF434C","#6ACEEB","#EDE8DF","FFFBED","#0A3A4A","#196A73","#32A6A6","#A1BF36","C8D94A","#FFF7CC","#CCC28F","#70995C","#33664D","142933","#43464D","#9197A6","#D3DCF2","#7690CF","48577D","#DFE0AF","#A4BAA2","#569492","#41505E","383245","#B52841","#FFC051","#FF8939","#E85F4D","590051","#473C35","#A36D5C","#9C968B","#D9CEAD","8A866A","#DB4C39","#2D3638","#109489","#44D487","D0DB86","#6F8787","#AEC2AE","#E6DFAE","#B0B57B","888F51","#C8385A","#FFCF48","#ECEABE","#1FCECB","1CA9C9","#42282E","#75A48B","#D9CFB0","#DC9B74","D6665A","#362F2D","#4C4C4C","#94B73E","#B5C0AF","FAFDF2","#98293A","#B14A58","#C86C6B","#DE9D76","EFC77F","#C1D301","#76AB01","#0E6A00","#083500","042200","#453F22","#7A6B26","#CCAD5C","#A1191F","4E1716","#541E32","#8E3557","#88A33E","#C2BD86","F7F2B2","#2B1B2E","#54344D","#FFFFD6","#B89E95","6E444F","#6EC1A5","#9FBEA6","#F5D3A3","#FF9F88","FB7878","#2F252C","#D3CCB2","#99AD93","#6E6751","5C3122","#BE333F","#F2E9CE","#C8C5B1","#939F88","307360","#F0F1F2","#232625","#647362","#B3D929","D2D9B8","#FA2B31","#FFBF1F","#FFF146","#ABE319","00C481","#09455C","#527E7C","#F5FFCC","#E0EB6E","C4D224","#F2DA91","#F2B950","#F29D35","#D96704","BF4904","#A2CFA5","#E0E7AB","#F5974E","#E96B56","D24344","#150033","#310D42","#5C2445","#AB6946","FFCE4C","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#FF2468","#E0D4B1","#FFFFE3","#00A5A6","005B63","#65A683","#218777","#3F585F","#47384D","F53357","#000623","#28475C","#4A6C74","#8BA693","F0E3C0","#E65322","#D19552","#B8BF73","#B6DB83","FFF991","#112F41","#068587","#6FB07F","#FCB03C","FC5B3F","#C89B41","#A16B2B","#77312B","#1C2331","152C52","#C24366","#D9C099","#FFF8D8","#A8E0BA","00ADA7","#CC0000","#006600","#FFFFEC","#9C9178","6C644F","#3D0319","#720435","#C1140E","#FC5008","32241B","#CFC7A4","#5A9E94","#005275","#002344","A38650","#FFEBC3","#CC3A00","#FF3600","#FF851B","800C00","#EFC164","#F3835D","#F35955","#286275","00434C","#E9F29D","#B7C29D","#878E8F","#67617A","51456B","#445859","#03A696","#49C4BE","#F1F2E4","FF7746","#FA726C","#FFD794","#BAD174","#3BA686","5F6F8C","#4D2B1F","#635D61","#7992A2","#97BFD5","BFDCF5","#CC4D00","#E6CF73","#668059","#264D4D","00CCB3","#4385F5","#DC4437","#FCBE1F","#109D59","FFFFFF","#271F2E","#A4A680","#F2EBC9","#D9B166","A66B38","#0B2C3C","#FF6666","#DADFE1","#FFFFFF","444444","#CFF09E","#A8DBA8","#79BD9A","#3B8686","0B486B","#302B26","#A6B827","#EDE9DD","#98D3D4","594E7A","#4B0505","#720707","#BFB694","#004659","00292B","#B52C38","#EBD1B0","#536682","#D9964B","DE6846","#F2F1DF","#F2B705","#F2C84B","#BF820F","734002","#26140C","#3D2216","#784E3D","#AB8574","D6BCB1","#26221D","#8C2C0F","#E6E5B8","#BFB38D","402D1F","#1F8181","#F2BC79","#F28972","#BF1B39","730240","#002635","#013440","#AB1A25","#D97925","EFE7BE","#8EC447","#FFFFFF","#96D3D4","#636466","2D2D2E","#2D1E1E","#4B3C37","#96A576","#CDE196","FFFFBE","#F06060","#FA987D","#F7F2CB","#72CCA7","10A296","#1D8281","#44BF87","#FBD258","#F29A3F","DB634F","#DEDE91","#EF9950","#F34E52","#C91452","492449","#6D8EAD","#1F3447","#1A0B07","#362416","CFCDB4","#00CD73","#008148","#2D9668","#3ECD8E","004E2C","#3D8080","#628282","#858383","#A38282","C28080","#475159","#839795","#B2BDB7","#CCC9C0","F2F2F2","#0E6870","#C6B599","#C65453","#FFDDB4","EDAA7D","#CEF0B7","#A8DBA8","#79BD9A","#3B8686","0B486B","#292C44","#FF5349","#F0F0F1","#18CDCA","4F80E1","#272A2B","#383737","#473B39","#692B28","940500","#D6C274","#DB9E46","#25706B","#3D2423","AB362E","#FFA68F","#FF4867","#FFF9C8","#B5EBB9","18B29D","#A1A16A","#727D59","#366353","#133C40","03212E","#D45354","#A9DC3A","#2FCAD8","#818B85","CDCDC1","#F14B6A","#3D3C3E","#22BDAF","#BAD7D4","F4F4F4","#FFE2C5","#FFEEDD","#FFDDAA","#FFC484","FFDD99","#9FFF4A","#1ABF93","#087363","#004040","2F1933","#FFDB97","#B28F4E","#FFFDFB","#466CB2","97BBFF","#991C00","#E09A25","#FFFCDB","#008B83","262B30","#44281A","#00ACAE","#F5EFD5","#F37606","EE4717","#FF5952","#FCEEC9","#96D6D9","#4FAAC9","176075","#5C4B51","#8CBEB2","#F2EBBF","#A5C88F","EF847B","#105F73","#F7F3B2","#C6CC33","#F28322","CC5404","#137072","#56B292","#B7F5AB","#FBFFC0","BF223D","#E3F23E","#6C821C","#A6A53F","#E0E0AC","33302E","#00215E","#003CAA","#1967F7","#5E4000","AA7400","#273A3D","#54695C","#AD9970","#FFBF87","FF8F60","#FFAA00","#C2B93E","#808F5D","#576157","302F30","#BE1405","#F2DCAC","#AABEAA","#736E41","413C2D","#6B1229","#C76A61","#FAB99A","#F7D9B5","CCB1A7","#2D9993","#58B3A3","#83BFA3","#B0D9A8","FFFCB6","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#F30B55","#010326","#012840","#54717F","F2E6CE","#2A3411","#73662C","#BC9847","#FFDFB2","6B0031","#637D74","#403D3A","#8C3B3B","#AB6937","D4A960","#010A26","#011640","#B6D6F2","#FFFFFF","E83338","#924847","#EB986C","#E4C678","#9C7885","372C2C","#022440","#3F95AA","#4EC6DE","#EAE2DF","F7572F","#2B1D2E","#323657","#076473","#54B087","D6F567","#052229","#004043","#BCC373","#E3FF55","D0D90C","#4C514A","#907A62","#879796","#755854","B09880","#1D2939","#1CAF9A","#FFFFFF","#EE4F4B","D1DC48","#004B67","#41CCB4","#FFEA95","#FF7C5D","C70151","#C0272D","#FCFBE7","#9FD3DA","#008C9A","05484F","#213130","#FF5E3D","#C9C83E","#FDFFF1","559398","#B1E4FC","#366D78","#39D5F1","#FFFFFF","D9FF03","#DECE6C","#FCF9B6","#BFE3B5","#5D826E","262E2B","#520A17","#668F91","#F5E6AC","#AB8E5B","52301C","#2D3032","#DD5F18","#FBA922","#F7F7F7","404333","#0C2538","#2B434F","#638270","#BCC98E","EDE059","#E85066","#F28E76","#E6CEB0","#5A8C81","382837","#BF2633","#A6242F","#D9CEAD","#C0B18F","011C26","#002A4A","#17607D","#FFF1CE","#FF9311","E33200","#0A8B91","#485956","#C4B98F","#FFF9BC","EEDF2E","#B89A7B","#9BBAAC","#F2D649","#D95D50","DBDBDB","#BD7938","#8D4421","#643001","#532700","3A1C00","#E1E6FA","#C4D7ED","#ABC8E2","#375D81","183152","#2E4259","#F7483B","#ECF0F1","#03C8FA","737373","#364656","#5D6B74","#94A4A5","#F2F5E9","FF8C31","#3E5916","#93A605","#F28705","#F25C05","E5EFFA","#248077","#74AD8D","#C82754","#F7BB21","F9E2B7","#20736A","#8BD9CA","#B1D95B","#93A651","403E34","#D74B4B","#DCDDD8","#475F77","#354B5E","FFFFFF","#252F33","#415C4F","#869C80","#93C2CC","CEEAEE","#012840","#79C7D9","#9BF2EA","#497358","9DBF8E","#EE7E94","#F8B4C4","#C7CAC9","#D8505C","41424","#282828","#505050","#FFFFFF","#2DCEDB","F20000","#004358","#1F8A70","#BEDB39","#FF5347","FD7400","#470C3B","#802F56","#C0576F","#E38679","FFBD83","#573328","#B05A3A","#FF8548","#29332E","0F1B1C","#461F2D","#E1FFBB","#BAD47F","#849C23","52533F","#333A40","#4C5E5E","#ADD0E5","#CDE4FF","729EBF","#DE5605","#F7A035","#B1DEB5","#EFECCA","65ABA6","#76D6D2","#F9E270","#EF6F56","#F4EED8","596B56","#403E3F","#F2F2F2","#D9D9D9","#9DAABB","8C8C8C","#059E9A","#F4F2ED","#F5A243","#DB3E3B","585857","#FFBF41","#EE8943","#C02221","#FFF4D3","249CA9","#024E76","#39A6B2","#FCE138","#F5B824","F08106","#FF0067","#FF3D6A","#E7FF04","#9CFF00","56FF00","#003540","#0D3F40","#487360","#8FA671","F2D795","#FF493C","#FFFFFF","#B3ECEF","#31C4F5","ADEB41","#244358","#4A8B87","#7CBCAE","#F0D4AF","C5252B","#EA5930","#F8AF1E","#F5E5C0","#097380","372560","#A1DBB2","#FEE5AD","#FACA66","#F7A541","F45D4C","#2C4A47","#6C9A7F","#BB523D","#C89D11","81810B","#F0F1F2","#232625","#647362","#FF5629","D2D9B8","#7C9B5F","#B8D197","#E3FFF3","#9BDEC7","568F84","#E54E45","#DBC390","#F2F2EF","#13A3A5","403833","#77A7FB","#E57368","#FBCB43","#34B67A","FFFFFF","#001A2E","#8F0000","#FFFFFF","#8A874B","41594F","#312F40","#49A69C","#EFEAC5","#E89063","BF5656","#047C8C","#018B8D","#F3BF81","#F49B78","F1706D","#00303E","#7096AD","#C1D1DE","#FFF9EF","EC4911","#2D6891","#70A0BF","#F5EEDC","#DC4C1A","F0986C","#040002","#3D1309","#E8B96A","#BC5D15","5C0F00","#8B929C","#5E6070","#514454","#3B313D","FF2479","#142D58","#447F6E","#E1B65B","#C8782A","9E3E17","#22104D","#2D1E5E","#483A85","#7067AB","A49CFA","#919C86","#9E373E","#2B2E36","#D1B993","C45A3B","#332F45","#015770","#2A8782","#9FD6AE","FFFED2","#37C78F","#FEE293","#FF4D38","#CC2249","380C2A","#47282C","#8C8468","#C9B37F","#DBDAB7","C4C49C","#14191A","#2D2B21","#A69055","#CCB287","FFB88C","#F5E3CD","#696158","#B6A898","#877D71","504A43","#005151","#009393","#F56200","#454445","969692","#D95F47","#FFF2C1","#80A894","#106153","072C36","#9E352C","#E6E8A9","#93C28C","#2E5A5C","2B2623","#03013A","#334A94","#6B9EDF","#83C3F2","99E6FF","#372A26","#4D4D4D","#6DA0A7","#9ED5A8","C7F5FF","#03658C","#022E40","#F2B705","#F28705","F25C05","#FF3B16","#E87826","#E8BA4A","#80A272","003045","#00748E","#E3DFBB","#F4BA4D","#E3753C","DA3B3A","#25401E","#56732C","#84A63C","#B8D943","EAF2AC","#449BB5","#043D5D","#EB5055","#68C39F","FFFCF5","#108F97","#FF8B6B","#FFE39F","#16866D","103636","#1A4F63","#068F86","#6FD57F","#FCB03C","FC5B3F","#381C19","#472E29","#948658","#F0E99A","362E29","#D7E8F7","#BBD0E3","#9CB7CF","#6A8BAB","375D81","#0F1C28","#136972","#67BFA7","#F3CF5B","F07444","#FFFFFF","#4EA9A0","#969514","#FE9C03","FCDE8E","#2F2D30","#656566","#65537A","#51386E","2A2333","#4C2916","#F05A28","#FBAF3F","#38B449","FFFFFF","#132537","#006C80","#EBCAB8","#FE8315","FA3113","#ECEEE1","#A8DACF","#F05B4F","#D8403A","221E1F","#00305A","#004B8C","#0074D9","#4192D9","7ABAF2","#72CF3F","#85FF00","#23E000","#2FB81B","00FF1C","#45CEEF","#FFF5A5","#FFD4DA","#99D2E4","D8CAB4","#FF5B00","#A1716C","#728296","#439AAB","00CABD","#EB6C2D","#D9C8A2","#939C80","#496158","232F38","#D94214","#FFF2C1","#80A894","#52736B","093844","#4D1B2F","#9E332E","#EB6528","#FC9D1C","FFCA50","#FFEEB0","#9AE8A4","#C7C12D","#F76245","ED1C43","#FFFAED","#D4DBFF","#879AC9","#242942","FF8800","#022840","#013440","#517360","#9DA67C","F2DC99","#331A0F","#519994","#BA4B3C","#EEDDAA","789F63","#577867","#EDCE82","#D68644","#AB3229","662845","#435A66","#88A6AF","#F5F2EB","#D9CDB8","424342","#FF8840","#958D4F","#737B55","#595540","513E38","#9D805A","#EBC99D","#FFE6C5","#9DCEEA","4B809E","#272D40","#364659","#55736D","#9DBF8E","D0D991","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#98C000","#3D4C53","#EA2E49","#FFE11A","0CDBE8","#A20E30","#E93C4F","#DCDCD4","#ADBCC3","2D4255","#1C2640","#263357","#384C80","#4E6AB3","5979CD","#D94214","#FFF2C1","#80A894","#52736B","093844","#3B596A","#427676","#3F9A82","#A1CD73","ECDB60","#1E1E1F","#424143","#67666A","#807F83","CBC9CF","#E04946","#3BA686","#B6D15D","#FFD495","FA847E","#FFEBB0","#FFB05A","#F84322","#C33A1A","9F3818","#FFA136","#FF814A","#E6635A","#785D6B","534557","#CDCF91","#EBEACC","#D6D5B8","#6D7D80","41545E","#011526","#011C40","#4E8DA6","#F2EA79","F2B33D","#353230","#3F4E51","#7B8F70","#99B2BE","F6F4EA","#063559","#0D8C7F","#8FBF4D","#F2D13E","D95929","#158000","#199900","#20BF00","#24D900","29FF00","#0B0D0E","#137074","#7EB7A3","#F1DDBB","EC6766","#02151A","#043A47","#087891","#C8C8C8","B31D14","#59361F","#5C992E","#A3CC52","#E6E673","FF5933","#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","83AF9B","#4B1E18","#F9E5C2","#BBB082","#829993","4F5D4E","#032843","#1F595B","#508C6D","#71A670","A6DB89","#191724","#4C4547","#8C594E","#D18952","FDB157","#191919","#182828","#60702D","#AAB232","E6FA87","#212A3F","#434F5B","#F2F2F2","#8AB839","2E2E2E","#004158","#026675","#038B8B","#F1EEC9","F09979","#023059","#3F7EA6","#F2F2F2","#D99E32","BF5E0A","#F21E52","#FFFFFF","#3D3B42","#0C6F73","63CFD4","#452743","#E7635E","#F8E9A8","#89E0AD","00928C","#FAAD63","#D1714D","#785E48","#39403B","3D1C24","#4C0016","#FFF7EB","#DCCEA7","#A17345","104F53","#BF2431","#F24150","#2A4557","#3B848C","EFF2E4","#3B3013","#8F6031","#E88833","#9C0C0A","FDF3C1","#1E2422","#88BEB1","#FF006D","#DAFFFF","718A94","#F1F4F7","#AF9F7B","#775E43","#40413C","251C17","#00182E","#0C6BA1","#D4D6D4","#FFFDEB","FF7500","#FFAB4A","#CCBAAB","#1E2129","#3D5E6E","47A3A3","#66B3A7","#C0D4B6","#EEF0BD","#F0563D","2C2F3B","#332525","#907465","#EDC5B5","#878C6D","63674A","#F04C16","#DBDBD0","#EDBD1F","#4CB09C","313B4A","#2B211D","#611C26","#C5003E","#8EB7A8","F1E4B7","#1A1F2B","#30395C","#4A6491","#85A5CC","D0E4F2","#03497E","#0596D5","#9DEBFC","#999999","FE4B28","#2F4159","#465E73","#88A649","#F2ECE4","D98841","#323A46","#22282F","#EB4A33","#FFFFFF","E9F0F5","#2C3E50","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#F29727","#E05723","#B0382F","#982E4B","713045","#4D584A","#465943","#428552","#3E754E","4C694B","#47191C","#59574B","#829690","#B5B09A","E1E3CB","#1D5123","#B1C661","#FFDA68","#FE9257","F64448","#59323C","#260126","#F2EEB3","#BFAF80","8C6954","#4E0805","#9E0522","#FFF4D4","#B8C591","447622","#424862","#FB9A63","#BFC4D5","#F6FBF4","FEBC98","#FF2468","#E0D4B1","#FFFFE3","#00A5A6","005B63","#1C2F40","#4C6173","#8094A6","#D9D1BA","F2E9D8","#DFD7B7","#EB7707","#5C5445","#3B2323","9CBFC7","#262E3B","#9C8878","#CFCAAA","#FBF8FF","992435","#FFBC67","#DA727E","#AC6C82","#685C79","455C7B","#404A69","#516C8A","#8AC0DE","#FFFFFF","FFAC00","#485B61","#4B8C74","#74C476","#A4E66D","CFFC83","#A31180","#C42795","#DE52B4","#EA88CE","FFBFE5","#E64D2E","#FFF5F1","#7893AD","#576B9C","2D2A52","#BF0436","#8C0327","#590219","#F2CBA1","8C674C","#CF5B6F","#FFF8C8","#CAD9B1","#8FB3A0","648991","#341D44","#744D90","#BB8CDD","#3E4417","88904D","#00293E","#003D4E","#006269","#00918F","00BAB5","#43212E","#D9666F","#F2D57E","#A9A688","516057","#2A3B30","#ABFFD1","#EBFFF5","#9DFEFF","273B40","#A63343","#E65159","#F5E9DB","#F4F7CF","BAD984","#1BA68C","#54BFAC","#F2EDA7","#F2E530","D94625","#1A2A40","#3F7369","#F2DEA0","#CE5251","EA895E","#1E9382","#70A758","#EFF1C2","#F0563D","2E313D","#A991E8","#FFB4BB","#ACF7FF","#A2E891","FFEDAE","#225B66","#17A3A5","#8DBF67","#FCCB5F","FC6E59","#282624","#BFB7AA","#403D39","#807A71","ABA398","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#440008","#605521","#988432","#D9A54E","9E3711","#649670","#36291E","#69AD6C","#92E67C","C5FF84","#42342C","#738076","#B2B39B","#DFE5E1","294359","#1A3838","#3F7A51","#82A352","#D1C062","FFBE59","#7D8C22","#B3BF67","#F2E49B","#D9DFF4","6791BF","#8A7D6D","#2D2D38","#E86E48","#FFFFE8","9CC9C9","#CFC949","#FFF5BF","#A9E6C4","#6AB39F","665841","#A1172D","#FDFFBA","#A7DB9E","#275C57","1F1B19","#FF6C0D","#F29E00","#E6C10F","#44996F","216273","#2C3E50","#FA4248","#D7DADB","#6DBCDB","FFFFFF","#627369","#99B397","#E2F2C6","#91CCAD","376266","#04496E","#66CAFF","#A3FC7E","#70D44A","2C6B0F","#1BA68C","#97BF3F","#F2ECD8","#F2B035","F2522E","#A2D9B1","#7CBF9E","#F2F1B9","#8C8575","193741","#024959","#037E8C","#F2EFDC","#E74C30","363636","#212625","#9CA6A2","#D0D9D6","#BF0404","C2C6AF","#00FFFF","#00FF00","#FFFF00","#FF5100","FF007C","#212629","#CDCF19","#FFF77D","#96C4AB","CF2A56","#CFF9FF","#BFC7BB","#787051","#332730","57324F","#98CACB","#FDEFBE","#F0542B","#736E5B","ABA68E","#F2F1EB","#BFB9A4","#262222","#802A30","8C0303","#65356B","#AB434F","#C76347","#FFA24C","519183","#78BF82","#A4D17C","#CFD96C","#EBD464","FFD970","#806265","#FFA256","#F7DD77","#E0D054","ABA73C","#8F323C","#123943","#80BDDB","#4189AB","C98127","#683820","#8C9A89","#E7D6A2","#BEAA65","9A8234","#021B21","#032C36","#065F73","#E8DFD6","FF2A1D","#2D6C73","#3FA693","#B4D9CB","#9ABF49","C6D93B","#141F26","#2B4040","#405950","#A69E86","F2D9BB","#4A8279","#003330","#610400","#003B06","02730F","#69B5E1","#D4E4F5","#EAF2F8","#BEDBED","000000","#893660","#EF7261","#68D693","#A0D7E2","299CA8","#073A59","#2D9AA6","#F2E2DC","#F23322","A61B1B","#2A3A48","#3E6372","#B2D4DC","#FAFAFF","FF6900","#F3BD8D","#F1A280","#BE6D6B","#704A5B","3E263C","#1C2742","#3C91C7","#5A9ABE","#95C5DE","E0EEFB","#426261","#465A59","#577573","#739A97","9AC1C0","#002A4A","#17607D","#FFF1CE","#FF9311","D64700","#589373","#BFBD99","#F2D6B3","#C2512F","241E1E","#1F518B","#1488C8","#F7E041","#E2413E","B5292A","#549494","#E85649","#232C2E","#E6E8D2","706558","#392133","#FFECBE","#D9D098","#C4AB6D","AB7D3A","#F0F0F0","#1C1C1C","#A2FDF5","#1CCDC7","27EDDF","#011526","#025959","#027353","#03A678","03A696","#004358","#1F8A70","#BEDB39","#FFE11A","FD7400","#37465D","#F2F2F2","#9DC02E","#779324","051A37","#580022","#AA2C30","#FFBE8D","#487B80","011D24","#F9F9F9","#03A678","#E9EDEB","#F44647","00707F","#800000","#BF0000","#E2D6C2","#F6EDD8","FFFFFF","#F7F6AF","#1B2124","#D62822","#97D6A6","468263","#432852","#992255","#FF3D4C","#28656E","00968F","#444344","#52BBB2","#2B344D","#EE5555","F8F7EE","#45334A","#796B7D","#CCC4B0","#FFF1B5","FFA3A3","#5A4B53","#9C3C58","#DE2B5B","#D86A41","D2A825","#14151C","#0C242B","#297059","#84D66E","D1FB7A","#272D40","#364659","#55736D","#9DBF8E","D0D991","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#2E064D","#80176B","#B356A1","#59580B","FFFF00","#CC3333","#FF9D33","#F7F7F0","#3EBBA7","00747A","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","BD6060","#0D3E58","#1C848C","#19C0C2","#F3EDD6","DA6260","#022629","#2A5945","#FAFFED","#E6DCC0","B3371C","#F4FAC7","#7BAD8D","#FFB159","#F77F45","C2454E","#A2C1C6","#86B1B7","#AECBAD","#CFDCB0","D6E1D1","#B0DAFF","#325B80","#64B7FF","#586D80","5092CC","#0F808C","#6C8C26","#F2A71B","#F26A1B","D91818","#FFBC6C","#FE9F6C","#BD716E","#74495F","3B2C4D","#FF4D41","#F2931F","#E6CA21","#91B321","1E8C65","#302821","#453629","#5C4837","#8A735F","BDA895","#415457","#5F7B7F","#9ACCAF","#E6EBC4","F9F7C8","#474143","#A69E9D","#E7E2DA","#FFFFFF","E7E8E7","#805939","#BD9962","#E6CD7D","#578072","2D4B4D","#03588C","#1763A6","#419CA6","#54BF83","8DBF41","#00CCFF","#A1FCFF","#040438","#004878","C9FAFF","#534C64","#B7DECF","#F0F3D7","#7E858C","D96557","#7F7364","#CBB08E","#CBC1B7","#789DCB","646F7F","#5C2849","#A73E5C","#EC7263","#FE9551","FFD285","#FF0012","#FF7D00","#FFD900","#5BE300","0084B0","#F24C32","#F29471","#FCDFA6","#36B898","3D7585","#083157","#0A6C87","#459C97","#92CCA5","C9F0B1","#DC941B","#EDC266","#B6952C","#E1D3A6","E9A119","#323836","#BAD1B5","#DBE8CF","#F0F7E8","FFFEF5","#081724","#589494","#8EBBB4","#D0DCD0","F5EED2","#50781C","#9CAD1C","#EAF7E6","#40A5DE","0B5191","#537F79","#78A68F","#CBD49C","#FED457","CB252A","#F23C13","#CBAB78","#FFFFFF","#898373","1F1C17","#450003","#5C0002","#94090D","#D40D12","FFED75","#0770A2","#82D9F7","#FEFEFE","#AEC844","F36622","#30394F","#FF434C","#6ACEEB","#EDE8DF","0E6569","#FF6B6B","#556270","#C7F464","#4ECDC4","EDC8BB","#D9B500","#FFED9C","#BFCC85","#748F74","454545","#452E32","#A34B1B","#B5A187","#EDDF9A","A7CC31","#2C2B33","#596664","#909980","#CCC08D","FF8A00","#C21F1F","#FFFFFC","#E34446","#FFFFDB","E36D6F","#282828","#00AAB5","#C1C923","#F41C54","F5F0F0","#3A3F40","#202627","#151B1E","#EFF4FF","41444D","#DEBB73","#4D0017","#010000","#4D0F30","9A002F","#EB9328","#FFA754","#FFD699","#FFF5DC","4FA6B3","#025E73","#037F8C","#D9D59A","#D9BD6A","590202","#636266","#E0CEA4","#E8A579","#7D6855","42403E","#FF0000","#FF4000","#FF7F00","#FFBF00","FFFF00","#FFFFFF","#74ADA6","#1E5E6F","#241B1F","68A81E","#5A0532","#FF6745","#FFC861","#9DAE64","27404A","#ACCBBC","#467847","#E8E4C1","#A60303","730202","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","F06060","#0D2557","#93A8C9","#FFFFFF","#F5DED5","558D96","#F53C4A","#565157","#10CFC8","#F2EEE7","F5D662","#FFD97B","#E65029","#A60027","#660033","191C26","#595408","#A6800D","#A66D03","#A63F03","730C02","#2E031F","#590424","#8C072B","#BF0A2B","DEEFC5","#E0C882","#A6874E","#BFA169","#D9B779","F2D399","#D88681","#A67673","#746566","#535A5D","324F54","#FC297D","#FB607A","#FDA286","#FDC188","FEE78A","#FFECA1","#B3B27F","#4C5E52","#2F3436","FFBE2C","#D93312","#B3AB82","#45735F","#394D47","2C3233","#324143","#6595A3","#C8E3E8","#FCFFED","B6C28B","#477984","#FEF5EB","#C03C44","#EEAA4D","313E4A","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#630B11","#33322F","#2A2927","#1E1D1C","000000","#D94214","#FFF2C1","#80A894","#52736B","093844","#051E21","#00302D","#856434","#F28C28","FFAD4E","#D7DADD","#DDDEE3","#E1E1E9","#EDEFF4","F2F3F8","#BF495E","#41A693","#F2EC9B","#D9CF48","D9583B","#067072","#14A589","#DECFA6","#BAAE8C","F94B06","#423A38","#47B8C8","#E7EEE2","#BDB9B1","D7503E","#730324","#DFE3E6","#B4C4D4","#8BA2BD","456382","#537374","#F9BD7F","#EBD7A5","#ADC9A5","5C9E99","#88B59E","#B6DEC8","#39464D","#C04229","ABD1AB","#11A7FC","#95D127","#F2E415","#FF8638","EE3551","#212640","#5D718C","#4B95A6","#60BFBF","EFF2D8","#D8A64D","#9B5422","#351411","#5B0D0D","991C11","#53324F","#668D6E","#F2E0A0","#F19B7A","F0756E","#DFE0AF","#A4BAA2","#569492","#41505E","383245","#7BBADE","#93DE7F","#FFED5D","#F29E4A","FF7050","#133800","#1B4F1B","#398133","#5C9548","93E036","#D9D7AD","#91A685","#FF6A00","#37485C","1C232E","#008767","#FFB27A","#FF6145","#AB2141","5E1638","#727B7F","#CCEAEA","#7A7556","#2E2125","44CACC","#FFFFED","#FF2C38","#FF9A3A","#FFF040","67D9FF","#007148","#60A859","#9BDA6A","#C7F774","F9FFEF","#092740","#45698B","#90B0CC","#F1FAFF","8FD36F","#E2FFA0","#7D8076","#FAFFED","#C2CCBE","8F7D70","#00736A","#00BC9F","#F1EEC7","#FEA301","F2561A","#26282E","#AD5138","#F7F7F7","#DDDAE0","8594AE","#1A191F","#35352F","#484042","#4E5252","E64D38","#49454A","#E69B02","#FAF4C6","#B1D631","324052","#5F1A2B","#1D2834","#6F8B78","#E4D49E","C96466","#012D3D","#38AD9E","#FFEB9E","#FF6867","D0DBED","#0D1F36","#104954","#1E9C89","#38CC85","60EB7B","#8C4E03","#9FA66A","#F2EC94","#F23005","8B0F03","#000001","#20201F","#E2E2E4","#590402","B80000","#344059","#465973","#F2D272","#A69460","595139","#33454C","#608F85","#B6E5CB","#8BAF95","54584E","#FBFEF6","#B7BFA4","#687F70","#1A3841","BF3847","#D7E836","#86FFC7","#FFB048","#E8366C","593BFF","#34A9FF","#5982DB","#665EB8","#684682","632E62","#004056","#2C858D","#74CEB7","#C9FFD5","FFFFCB","#BFB978","#84945C","#516967","#4D3130","281B24","#103B73","#20638C","#3786A6","#4EABBF","EBEFF2","#9FB1BF","#1D2D63","#1C5357","#1F6E56","196331","#FFEBBA","#C3BD91","#88947B","#4C3F3F","2A2727","#347373","#4EA6A6","#91D9D9","#FFFFFD","F2E205","#828948","#EFDFC2","#006971","#DC533E","840000","#000137","#29003F","#79003D","#D04D14","F89801","#370005","#4B0005","#5F0005","#730005","870005","#C3AE8D","#F25260","#2D5F73","#6BADC9","8FCED6","#9E1B36","#F7EDBA","#E69B3D","#EB3355","3D241D","#1D8281","#44BF87","#FBD258","#F29A3F","DB634F","#035C75","#1B808C","#31A6A8","#F3F1BC","F3AD14","#FF7500","#665130","#EBB643","#CEDAA8","668E84","#384D3A","#3E6653","#728053","#A68357","D97C71","#012326","#17455C","#E1CAAB","#FE8333","FA4913","#1A2944","#2DA7C7","#56ACBA","#98C4C9","CBD5D2","#BF3542","#CDC5BA","#EBE3D6","#3C3C3C","2E2E2E","#231921","#695F74","#BEB4CB","#EBEBF0","D2DCEB","#34373F","#686C75","#F3E9D0","#BEB7A7","8E867C","#661510","#D9351A","#F2C76F","#BF9727","204D3F","#3CFFEE","#24AABC","#356781","#2C3D51","1C1F24","#DA3537","#FFFCC4","#00585F","#6A6A61","2A2C2B","#AE3135","#D1AF87","#8C826B","#3D3C33","F2F0CE","#FF0894","#FF5E9F","#FF91A7","#FFB5CA","F5F0BA","#99878D","#323232","#646464","#7E4A5C","372129","#3FB8AF","#7FC7AF","#DAD8A7","#FFB38B","FF3F34","#402B3C","#6AA6A6","#D9CCA7","#F2B263","F26835","#6AA690","#F2BC1B","#F2DC99","#F29057","BF1F1F","#F4FAC7","#7BAD8D","#FFB158","#F77F45","C2454E","#E5533C","#F5E346","#93D06D","#50AC6A","227864","#39588A","#A9BDD7","#FFFFFF","#FFEADD","FFD0BB","#B0B595","#615F4F","#828567","#91A380","EAFFCD","#00427F","#0066BD","#66B5CC","#F0E4C5","D6C28F","#FF6313","#F9E4B3","#C29689","#74474B","45232E","#00585F","#009393","#FFFCC4","#C7C49B","EB0A00","#091840","#44A2FF","#F7F7EA","#B3CC63","4C6620","#5CBBE3","#FCF1BC","#5C8182","#383A47","B4F257","#9E9E9E","#E5E1D1","#E0393D","#253746","425563","#4D9453","#FFFFB1","#ADDE4E","#FF9D27","A62A16","#B70046","#FF850B","#FFEBC5","#109679","675A4C","#363636","#0599B0","#A4BD0A","#FFA615","FF2E00","#7D8077","#BBBFB2","#FAFFED","#E82A33","E3DEBC","#FD9F44","#FC5C65","#007269","#03A679","FAF0B9","#134B57","#81A489","#F1D8B5","#F2A054","C04D31","#946E49","#394042","#EDDBAC","#872A0C","BA8E3A","#404040","#024959","#037E8C","#FFFFFF","F24C27","#2A3342","#163C6E","#4E5F61","#E6A015","EDE7BE","#445060","#829AB5","#849E91","#C14543","D6D5D1","#8A9126","#B7BF5E","#FFE9C4","#F5B776","F58E45","#9B2D1E","#3C3A28","#78A080","#9BCD9E","FFFFAE","#FF6138","#FFFF9D","#BEEB9F","#79BD8F","00A388","#990000","#FF6600","#FF9900","#996633","CC9966","#DCE6DA","#B8CCBB","#98B3A5","#7A9994","62858C","#0B1C29","#3B7C8F","#73A5A3","#98C1B7","F0EBD2","#F6CB51","#E25942","#13A89E","#3F4953","F2E7DA","#282F36","#FFFEFC","#BDA21D","#BFBC5B","D2E098","#8C182D","#DE7140","#FCB95A","#FAE285","6A7349","#6B9100","#FFE433","#FF841F","#E03D19","A6001C","#FFEAA7","#D9D697","#9FC49F","#718C6A","543122","#CFF09E","#A8DBA8","#79BD9A","#3B8686","0B486B","#0C2233","#065471","#0A91AB","#FFC045","F2F2F2","#BEE8E0","#373C40","#2E2621","#73320B","FF5E00","#1B2C35","#A3BFC6","#FF005D","#222A30","293A42","#FF8400","#3B4044","#494948","#E6E1D8","F7F2E9","#6A482D","#518C86","#F6BF3D","#EF7C27","BF2424","#261C2B","#292B39","#226468","#608D80","829D8F","#B2AD9A","#110E00","#363226","#A9A695","ECE9D8","#1B1B26","#26394D","#286480","#13B3BF","A3FF57","#F2C2A7","#F5E5C5","#593D28","#422C21","93DEDB","#001028","#033140","#1E5A5B","#7BA78C","EBEDC6","#544E6E","#808CB0","#ABD1D9","#D9FFF7","DDF556","#323A45","#596677","#758194","#FFFFFF","E74C3C","#45291A","#AB926D","#DBD1BC","#4999C3","5FCBEC","#6B151D","#2E1615","#A8553A","#DB8F5A","F2C18E","#000623","#28475C","#4A6C74","#8BA693","F0E3B1","#60807B","#81B37A","#BCCC5F","#FFEE65","E64964","#FFFFFA","#A1A194","#5B605F","#464646","FF6600","#1E1B17","#577270","#9C9A79","#C7BDA1","580E0C","#452F27","#5E504A","#6B6865","#9BBAB2","B0FFED","#1B5257","#F7F6C3","#F28159","#CC5850","4F1C2E","#FAA51B","#BF511F","#2C445E","#2F6D82","5EE4EB","#BF3952","#59364A","#556D73","#D9D1A9","D95F5F","#024959","#037E8C","#F2EFDC","#E74C30","363636","#221A26","#544759","#A197A6","#F27405","D93D04","#C4A44A","#E6D399","#9AB8A9","#7C8A7F","4E4B44","#FFFEC8","#B1BF99","#5B604D","#39382B","26181E","#4E3C51","#21A68D","#3BBF9A","#F2E8B6","F25749","#102144","#1B325E","#254580","#3C63B0","5D8AEA","#2A3A48","#3E6372","#B2D4DC","#FAFAFF","FF4B00","#FFF1BF","#F20058","#FFAEAC","#000001","7D7A96","#FDFFC6","#F2F096","#FF0080","#DE0049","521218","#5B0E00","#FBB500","#FBD864","#807D1A","59233C","#1E1E1F","#424143","#67666A","#807F83","CBC9CF","#3C3658","#3EC8B7","#7CD0B4","#B9D8B1","F7E0AE","#FFFFFF","#99B75F","#D5DD98","#EBF4DB","D8D8D8","#248A8A","#C9FA58","#F9E555","#FAAC38","F2572A","#086B63","#77A490","#E2D8C1","#BFAE95","7C7159","#5C4B51","#8CBEB2","#F2EBBF","#A5C88F","EF847B","#17162F","#89346D","#C76058","#FFB248","E8C475","#6E8F4A","#65D9C5","#F2E7B6","#EDA430","AB3E2C","#30394F","#FF434C","#6ACEEB","#EDE8DF","0E6569","#8E1B13","#F9E4B3","#849689","#46464A","29232E","#686B30","#AB9A52","#E8BA67","#D68F4F","BA512E","#E54E45","#DBC390","#F2F2EF","#13A3A5","403833","#65BA99","#59A386","#F1DDBB","#D6C4A6","E74C3C","#A6FFBC","#4ACFAF","#00A995","#006161","003D4C","#33271E","#8B7653","#C8D9A0","#FDEE9D","233331","#048789","#503D2E","#D44D27","#E2A72E","EFEBC8","#E5FF1E","#A9D943","#75A660","#698070","494D4B","#2DEBA2","#91F57F","#EBAA69","#E70049","2B0027","#990000","#336699","#DDDDDD","#999999","333333","#F13A4B","#3D3C3E","#22BDAF","#F4F4F4","D7D7D7","#F53A59","#001D2D","#15A88C","#B7D9C8","F3F5F4"]}};CABLES.OPS["31d33a1e-9a0a-49f7-8bc8-9e83ab71e23e"]={f:Ops.Color.ColorPalettes,objName:"Ops.Color.ColorPalettes"};Ops.Array.Array3GetNumbers=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Array",3),r=e.inValueInt("Index"),s=e.outNumber("X"),n=e.outNumber("Y"),a=e.outNumber("Z");e.toWorkPortsNeedToBeLinked(i);i.onChange=r.onChange=o;function o(){let e=i.get();if(!e){s.set(0);n.set(0);a.set(0);return}let t=Math.min(e.length-3,r.get()*3);if(e){s.set(e[t+0]);n.set(e[t+1]);a.set(e[t+2])}}}};CABLES.OPS["56882cc4-c40d-4dc0-bf7c-db1b5a7acad0"]={f:Ops.Array.Array3GetNumbers,objName:"Ops.Array.Array3GetNumbers"};Ops.Gl.Meshes.LinesArray=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inTrigger("render"),D=i.inValueFloat("width",10),B=i.inValueFloat("height",1),S=i.inValueBool("Logarithmic",false),r=i.inValueSelect("pivot x",["center","left","right"],"center"),s=i.inValueSelect("pivot y",["center","top","bottom"],"center"),n=i.inValueInt("num columns",10),I=i.inValueInt("num rows",10),M=i.inValueSelect("axis",["xy","xz"],"xy"),a=i.outTrigger("trigger"),R=i.outArray("Point Arrays");const O=i.patch.cgl;let P=[];i.setPortGroup("Size",[D,B]);i.setPortGroup("Alignment",[r,s]);M.onChange=r.onChange=s.onChange=D.onChange=B.onChange=I.onChange=n.onChange=S.onChange=l;h();t.onTriggered=function(){for(let e=0;e<P.length;e++)P[e].render(O.getShader());a.trigger()};let o=0;function l(){clearTimeout(o);o=setTimeout(h,60)}function h(){let a=0;let o=0;if(r.get()=="center")a=0;if(r.get()=="right")a=-D.get()/2;if(r.get()=="left")a=+D.get()/2;if(s.get()=="center")o=0;if(s.get()=="top")o=-B.get()/2;if(s.get()=="bottom")o=+B.get()/2;let l=parseInt(I.get(),10);let h=parseInt(n.get(),10);let u=D.get()/h;let c=B.get()/l;let g,f;P.length=0;let d,p,m;let _=[];let E=[];let b=[];let A=0;function F(){let e=new CGL.Geometry(i.name);e.vertices=_;e.texCoords=E;e.verticesIndices=b;let t=new CGL.Mesh(O,e,{glPrimitive:O.gl.LINES});t.setGeom(e);P.push(t);_.length=0;E.length=0;b.length=0;A=0;x=null}let v=Math.log(1/l);let e=Math.log(1);let t=[];for(f=l;f>=0;f--){var x=null,T=null,C=null;let i=null,r=null;let e=0;let s=S.get();let n=[];t.push(n);for(g=h;g>=0;g--){d=g*u-D.get()/2+a;if(s)p=Math.log(f/l)/v*B.get()-B.get()/2+o;else p=f*c-B.get()/2+o;let e=g/h;let t=1-f/l;if(s)t=Math.log(f/l)/v;m=0;if(M.get()=="xz"){m=p;p=0}if(M.get()=="xy")m=0;if(x!==null){_.push(x);_.push(T);_.push(C);n.push(x,T,C);_.push(d);_.push(p);_.push(m);E.push(i);E.push(r);E.push(e);E.push(t);b.push(A);A++;b.push(A);A++}if(A>64e3){F()}i=e;r=t;x=d;T=p;C=m}}R.set(t);F()}}};CABLES.OPS["a75265c2-957b-4719-9d03-7bbf00ace364"]={f:Ops.Gl.Meshes.LinesArray,objName:"Ops.Gl.Meshes.LinesArray"};window.addEventListener("load",function(e){CABLES.jsLoaded=new Event("CABLES.jsLoaded");document.dispatchEvent(CABLES.jsLoaded)});(()=>{var K={};(()=>{K.d=(e,t)=>{for(var i in t){if(K.o(t,i)&&!K.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{K.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{K.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var J={};(()=>{"use strict";K.r(J);K.d(J,{CopyTexture:()=>Q});const v=CABLES;const u=CABLES.SHARED;const t=8;class i{constructor(e={}){this.id=v.utils.uuid();this.width=0;this.height=0;this.name="unknown";e=e||{};this.pixelFormat=e.pixelFormat||i.PFORMATSTR_RGBA8UB;this.name=e.name||"unknown";if(!e.width)e.width=t;if(!e.height)e.height=t}}i.getDefaultTextureData=(e,n,a={})=>{if(e=="empty"){return new Uint8Array(n*n*4).fill(0)}else if(e=="color"){const s=new Uint8Array(n*n*4);let t=a.r||1;let i=a.g||1;let r=a.b||1;for(let e=0;e<n*n;e++){s[e*4+0]=t;s[e*4+1]=i;s[e*4+2]=r;s[e*4+3]=255}return s}else if(e=="randomUInt"){const s=new Uint8Array(n*n*4);for(let e=0;e<n*n;e++){s[e*4+0]=Math.random()*255;s[e*4+1]=Math.random()*255;s[e*4+2]=Math.random()*255;s[e*4+3]=255}return s}else if(e=="random"||e=="randomFloat"){const s=new Float32Array(n*n*4);for(let e=0;e<n*n;e++){s[e*4+0]=(Math.random()-.5)*2;s[e*4+1]=(Math.random()-.5)*2;s[e*4+2]=(Math.random()-.5)*2;s[e*4+3]=1}return s}else if(e=="stripes"){const o=[];let i=a.r;let r=a.g;let s=a.b;if(i===undefined)i=1;if(r===undefined)r=1;if(s===undefined)s=1;for(let t=0;t<n;t++){for(let e=0;e<n;e++){if((e+t)%64<32){o.push((200+t/n*25+e/n*25)*i);o.push((200+t/n*25+e/n*25)*r);o.push((200+t/n*25+e/n*25)*s)}else{o.push((40+t/n*25+e/n*25)*i);o.push((40+t/n*25+e/n*25)*r);o.push((40+t/n*25+e/n*25)*s)}o.push(255)}}return new Uint8Array(o)}else{console.warn("unknown default texture",e);return i.getDefaultTextureData("stripes",n,{r:1,g:0,b:0})}};i.FILTER_NEAREST=0;i.FILTER_LINEAR=1;i.FILTER_MIPMAP=2;i.WRAP_REPEAT=0;i.WRAP_MIRRORED_REPEAT=1;i.WRAP_CLAMP_TO_EDGE=2;i.TYPE_DEFAULT=0;i.TYPE_DEPTH=1;i.TYPE_FLOAT=2;i.PFORMATSTR_RGB565="RGB 5/6/5bit ubyte";i.PFORMATSTR_R8UB="R 8bit ubyte";i.PFORMATSTR_RG8UB="RG 8bit ubyte";i.PFORMATSTR_RGB8UB="RGB 8bit ubyte";i.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte";i.PFORMATSTR_SRGBA8="SRGBA 8bit ubyte";i.PFORMATSTR_R11FG11FB10F="RGB 11/11/10bit float";i.PFORMATSTR_R16F="R 16bit float";i.PFORMATSTR_RG16F="RG 16bit float";i.PFORMATSTR_RGB16F="RGB 16bit float";i.PFORMATSTR_RGBA16F="RGBA 16bit float";i.PFORMATSTR_R32F="R 32bit float";i.PFORMATSTR_RG32F="RG 32bit float";i.PFORMATSTR_RGB32F="RGB 32bit float";i.PFORMATSTR_RGBA32F="RGBA 32bit float";i.PFORMATSTR_DEPTH="DEPTH";i.PIXELFORMATS=[i.PFORMATSTR_RGB565,i.PFORMATSTR_R8UB,i.PFORMATSTR_RG8UB,i.PFORMATSTR_RGB8UB,i.PFORMATSTR_RGBA8UB,i.PFORMATSTR_SRGBA8,i.PFORMATSTR_R11FG11FB10F,i.PFORMATSTR_R16F,i.PFORMATSTR_RG16F,i.PFORMATSTR_RGBA16F,i.PFORMATSTR_R32F,i.PFORMATSTR_RGBA32F];const r=8;const a=new u.Logger("cgl_texture");class h extends i{constructor(e,t={}){super(t);if(!e)throw new Error("no cgl");this._cgl=e;this._log=new u.Logger("tex");this.tex=this._cgl.gl.createTexture();this.loading=false;this.flip=true;this.flipped=false;this.shadowMap=false;this.deleted=false;this.image=null;this.anisotropic=0;this.filter=h.FILTER_NEAREST;this.wrap=h.WRAP_CLAMP_TO_EDGE;this.texTarget=this._cgl.gl.TEXTURE_2D;if(t&&t.type)this.texTarget=t.type;this.textureType=h.TYPE_DEFAULT;this.unpackAlpha=true;this._fromData=true;this._glDataType=-1;this._glInternalFormat=-1;this._glDataFormat=-1;if(t){if(t.isDepthTexture)this.textureType=h.TYPE_DEPTH;if(t.isFloatingPointTexture===true)this.textureType=h.TYPE_FLOAT;if("textureType"in t)this.textureType=t.textureType;if("filter"in t)this.filter=t.filter;if("wrap"in t)this.wrap=t.wrap;if("unpackAlpha"in t)this.unpackAlpha=t.unpackAlpha;if("flip"in t)this.flip=t.flip;if("shadowMap"in t)this.shadowMap=t.shadowMap;if("anisotropic"in t)this.anisotropic=t.anisotropic}else{t={}}if(!t.pixelFormat&&t.isFloatingPointTexture)this.pixelFormat=h.PFORMATSTR_RGBA32F;if(this.textureType==h.TYPE_DEPTH)this.pixelFormat=h.PFORMATSTR_DEPTH;this._cgl.profileData.profileTextureNew++;this.setFormat(h.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height);this.setSize(t.width,t.height);this.getInfoOneLine()}isFloatingPoint(){return h.isPixelFormatFloat(this.pixelFormat)}compareSettings(e){if(!e)return false;return e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip}clone(){const e=new h(this._cgl,{name:this.name,filter:this.filter,anisotropic:this.anisotropic,wrap:this.wrap,textureType:this.textureType,pixelFormat:this.pixelFormat,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height);if(!this.compareSettings(e)){this._log.error("Cloned texture settings do not compare!");this._log.error(this);this._log.error(e)}return e}setFormat(e){this.pixelFormat=e.pixelFormat;this._glDataFormat=e.glDataFormat;this._glInternalFormat=e.glInternalFormat;this._glDataType=e.glDataType}setSize(e,t){if(this._cgl.aborted)return;if(e!=e||e<=0||!e)e=r;if(t!=t||t<=0||!t)t=r;if(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)this._log.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize);e=Math.min(e,this._cgl.maxTexSize);t=Math.min(t,this._cgl.maxTexSize);e=Math.floor(e);t=Math.floor(t);if(this.width==e&&this.height==t)return;e=this._cgl.checkTextureSize(e);t=this._cgl.checkTextureSize(t);this.width=e;this.height=t;this.deleted=false;this.setFormat(h.setUpGlPixelFormat(this._cgl,this.pixelFormat));this.shortInfoString=this.getInfoOneLine();this._cgl.gl.bindTexture(this.texTarget,this.tex);this._cgl.profileData.profileTextureResize++;const i=null;this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,e,t,0,this._glDataFormat,this._glDataType,i);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null)}initFromData(e,t,i,r,s){this.filter=r;this.wrap=s;if(r==undefined)this.filter=h.FILTER_LINEAR;if(s==undefined)this.wrap=h.WRAP_CLAMP_TO_EDGE;this.width=t;this.height=i;this._fromData=true;this.deleted=false;if(this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const n=CGL.Texture.getTempTexture(this._cgl);this.width=n.width;this.height=n.height;this.tex=n.tex;this._log.warn("[cgl_texture] texture size too big!",this.width,this.height,this._cgl.maxTexSize);return}if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip);this._cgl.gl.bindTexture(this.texTarget,this.tex);this.setFormat(h.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,t,i,0,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this._cgl.gl.bindTexture(this.texTarget,null)}updateMipMap(){if((this._cgl.glVersion==2||this.isPowerOfTwo())&&this.filter==h.FILTER_MIPMAP){this._cgl.gl.generateMipmap(this.texTarget);this._cgl.profileData.profileGenMipMap++}}initTexture(e,t=null){this._cgl.printError("before initTexture");this._cgl.checkFrameStarted("texture inittexture");this._fromData=false;this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha);if(e.width||e.videoWidth)this.width=e.videoWidth||e.width;if(e.height||e.videoHeight)this.height=e.videoHeight||e.height;if(t!==null)this.filter=t;if(e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const i=CGL.Texture.getTempTexture(this._cgl);this.width=i.width;this.height=i.height;this.tex=i.tex;this._log.warn("[cgl_texture] texture size too big!",e.width,e.height,this._cgl.maxTexSize);return}this._cgl.gl.bindTexture(this.texTarget,this.tex);this.deleted=false;this.flipped=!this.flip;if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped);this.setFormat(h.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null);this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this.getInfoOneLine();this._cgl.printError("initTexture")}dispose(){this.delete()}delete(){if(this.loading){return}this.deleted=true;this.width=0;this.height=0;this._cgl.profileData.profileTextureDelete++;this._cgl.gl.deleteTexture(this.tex);this.image=null;this.tex=null}isPowerOfTwo(){return h.isPowerOfTwo(this.width)&&h.isPowerOfTwo(this.height)}printInfo(){a.log(this.getInfo())}getInfoReadable(){const t=this.getInfo();let i="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t){i+="* "+e+":  **"+t[e]+"**\n"}return i}getInfoOneLine(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;if(this.filter===h.FILTER_NEAREST)e+=" nearest";if(this.filter===h.FILTER_LINEAR)e+=" linear";if(this.filter===h.FILTER_MIPMAP)e+=" mipmap";if(this.wrap===h.WRAP_CLAMP_TO_EDGE)e+=" clamp";if(this.wrap===h.WRAP_REPEAT)e+=" repeat";if(this.wrap===h.WRAP_MIRRORED_REPEAT)e+=" repeatmir";this.shortInfoString=e;return e}getInfoOneLineShort(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;this.shortInfoString=e;return e}getInfo(){return h.getTexInfo(this)}_setFilter(){this._cgl.printError("before _setFilter");if(!this._fromData){this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha)}if(this.shadowMap){this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE);this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)}if(this.textureType==h.TYPE_FLOAT&&this.filter==h.FILTER_MIPMAP){this.filter=h.FILTER_LINEAR;this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")}if(this._cgl.glVersion==1&&!this.isPowerOfTwo()){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);this.filter=h.FILTER_NEAREST;this.wrap=h.WRAP_CLAMP_TO_EDGE}else{if(this.wrap==h.WRAP_CLAMP_TO_EDGE){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)}else if(this.wrap==h.WRAP_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)}else if(this.wrap==h.WRAP_MIRRORED_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==h.FILTER_NEAREST){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST)}else if(this.filter==h.FILTER_LINEAR){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR)}else if(this.filter==h.FILTER_MIPMAP){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}else{this._log.log("unknown texture filter!",this.filter);throw new Error("unknown texture filter!"+this.filter)}if(this.anisotropic){const e=this._cgl.enableExtension("EXT_texture_filter_anisotropic");if(this._cgl.maxAnisotropic){const t=Math.min(this._cgl.maxAnisotropic,this.anisotropic);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}}this.getInfoOneLine();this._cgl.printError("_setFilter")}}h.load=function(i,r,s,e){if(!r)return s({error:true});let n=null;if(!i.patch.loading.existByName(r))n=i.patch.loading.start("cgl.texture",r);const a=new h(i);a.name=r;a.image=new Image;a.image.crossOrigin="anonymous";a.loading=true;if(e&&e.hasOwnProperty("filter"))a.filter=e.filter;if(e&&e.hasOwnProperty("flip"))a.flip=e.flip;if(e&&e.hasOwnProperty("wrap"))a.wrap=e.wrap;if(e&&e.hasOwnProperty("anisotropic"))a.anisotropic=e.anisotropic;if(e&&e.hasOwnProperty("unpackAlpha"))a.unpackAlpha=e.unpackAlpha;if(e&&e.hasOwnProperty("pixelFormat"))a.pixelFormat=e.pixelFormat;a.image.onabort=a.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",r,e);a.loading=false;if(n)i.patch.loading.finished(n);const t={error:true};if(s)s(t,a)};a.image.onload=function(e){i.addNextFrameOnceCallback(()=>{a.initTexture(a.image);if(n)i.patch.loading.finished(n);a.loading=false;if(s)s(null,a)})};a.image.src=r;return a};h.getTempTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.tempTexture)e.tempTexture=h.getTemporaryTexture(e,256,h.FILTER_LINEAR,h.REPEAT);return e.tempTexture};h.getErrorTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.errorTexture)e.errorTexture=h.getTemporaryTexture(e,256,h.FILTER_LINEAR,h.REPEAT,1,.2,.2);return e.errorTexture};h.getEmptyTexture=function(e,t){if(t)return h.getEmptyTextureFloat(e);if(!e)console.error("[getEmptyTexture] no cgl!");if(e.tempTextureEmpty)return e.tempTextureEmpty;let i=8;e.tempTextureEmpty=new h(e,{name:"emptyTexture"});const r=h.getDefaultTextureData("empty",i);e.tempTextureEmpty.initFromData(r,i,i,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.tempTextureEmpty};h.getEmptyTextureFloat=function(e){if(!e)console.error("[getEmptyTextureFloat] no cgl!");if(e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new h(e,{name:"emptyTexture",isFloatingPointTexture:true});const t=new Float32Array(8*8*4).fill(1);for(let e=0;e<8*8*4;e+=4)t[e+3]=0;e.tempTextureEmptyFloat.initFromData(t,8,8,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.tempTextureEmptyFloat};h.getRandomTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.randomTexture)return e.randomTexture;const t=256;const i=h.getDefaultTextureData("randomUInt",t);e.randomTexture=new h(e);e.randomTexture.initFromData(i,t,t,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.randomTexture};h.getRandomFloatTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.getRandomFloatTexture)return e.getRandomFloatTexture;const t=256;const i=h.getDefaultTextureData("randomFloat",t);e.getRandomFloatTexture=new h(e,{isFloatingPointTexture:true});e.getRandomFloatTexture.initFromData(i,t,t,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.getRandomFloatTexture};h.getBlackTexture=function(e){if(e.blackTexture)return e.blackTexture;const t=8;const i=h.getDefaultTextureData("color",t,{r:0,g:0,b:0});e.blackTexture=new h(e);e.blackTexture.initFromData(i,t,t,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.blackTexture};h.getEmptyCubemapTexture=function(t){const i=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];const e=t.gl.createTexture();const r=t.gl.TEXTURE_CUBE_MAP;const s=h.FILTER_NEAREST;const n=h.WRAP_CLAMP_TO_EDGE;const a=8;const o=8;t.profileData.profileTextureNew++;t.gl.bindTexture(r,e);t.profileData.profileTextureResize++;for(let e=0;e<6;e+=1){const l=new Uint8Array(8*8*4);t.gl.texImage2D(i[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l);t.gl.texParameteri(r,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST);t.gl.texParameteri(r,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST);t.gl.texParameteri(r,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE);t.gl.texParameteri(r,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}t.gl.bindTexture(r,null);return{id:v.utils.uuid(),tex:e,cubemap:e,width:a,height:o,filter:s,wrap:n,unpackAlpha:true,flip:true,_fromData:true,name:"emptyCubemapTexture",anisotropic:0}};h.getTempGradientTexture=function(e){if(!e)console.error("[getTempGradientTexture] no cgl!");return h.getTempTexture(e)};h.getTemporaryTexture=function(e,t,i,r,s,n,a){const o=h.getDefaultTextureData("stripes",256,{r:s,g:n,b:a});const l=new h(e);l.initFromData(o,t,t,i,r);return l};h.createFromImage=function(e,t,i){i=i||{};const r=new h(e,i);r.flip=false;r.image=t;r.width=t.videoWidth||t.width||8;r.height=t.videoHeight||t.height||8;if(i.hasOwnProperty("wrap"))r.wrap=i.wrap;r.initTexture(t,i.filter);return r};h.fromImage=function(e,t,i,r){console.error("deprecated texture from image...");const s=new h(e);s.flip=false;if(i)s.filter=i;if(r)s.wrap=r;s.image=t;s.initTexture(t);return s};h.isPowerOfTwo=function(e){return e==1||e==2||e==4||e==8||e==16||e==32||e==64||e==128||e==256||e==512||e==1024||e==2048||e==4096||e==8192||e==16384};h.getTexInfo=function(e){const t={};t.name=e.name;t["power of two"]=e.isPowerOfTwo();t.size=e.width+" x "+e.height;let i=e.texTarget;if(e.texTarget==e._cgl.gl.TEXTURE_2D)i="TEXTURE_2D";t.target=i;t.unpackAlpha=e.unpackAlpha;if(e.cubemap)t.cubemap=true;if(e.textureType==h.TYPE_FLOAT)t.textureType="TYPE_FLOAT";if(e.textureType==h.TYPE_HALF_FLOAT)t.textureType="TYPE_HALF_FLOAT";else if(e.textureType==h.TYPE_DEPTH)t.textureType="TYPE_DEPTH";else if(e.textureType==h.TYPE_DEFAULT)t.textureType="TYPE_DEFAULT";else t.textureType="UNKNOWN "+this.textureType;if(e.wrap==h.WRAP_CLAMP_TO_EDGE)t.wrap="CLAMP_TO_EDGE";else if(e.wrap==h.WRAP_REPEAT)t.wrap="WRAP_REPEAT";else if(e.wrap==h.WRAP_MIRRORED_REPEAT)t.wrap="WRAP_MIRRORED_REPEAT";else t.wrap="UNKNOWN";if(e.filter==h.FILTER_NEAREST)t.filter="FILTER_NEAREST";else if(e.filter==h.FILTER_LINEAR)t.filter="FILTER_LINEAR";else if(e.filter==h.FILTER_MIPMAP)t.filter="FILTER_MIPMAP";else t.filter="UNKNOWN";t.pixelFormat=e.pixelFormat||"unknown";return t};h.setUpGlPixelFormat=function(e,t){const i={};if(!t){e._log.error("no pixelformatstr!");e._log.log(new Error);t=h.PFORMATSTR_RGBA8UB}i.pixelFormatBase=t;i.pixelFormat=t;i.glDataType=e.gl.UNSIGNED_BYTE;i.glInternalFormat=e.gl.RGBA8;i.glDataFormat=e.gl.RGBA;let r=e.gl.FLOAT;if(e.glUseHalfFloatTex){if(t==h.PFORMATSTR_RGBA32F)t=h.PFORMATSTR_RGBA16F;if(t==h.PFORMATSTR_RG32F)t=h.PFORMATSTR_RG16F;if(t==h.PFORMATSTR_R32F)t=h.PFORMATSTR_R16F}if(t.includes("16bit")){if(e.glVersion==2){const s=e.enableExtension("EXT_color_buffer_half_float");if(!s){console.warn("no 16bit extension, fallback to 32bit",t);if(t==h.PFORMATSTR_RGBA16F)t=h.PFORMATSTR_RGBA32F;if(t==h.PFORMATSTR_RGB16F)t=h.PFORMATSTR_RGB32F;if(t==h.PFORMATSTR_RG16F)t=h.PFORMATSTR_RG32F;if(t==h.PFORMATSTR_R16F)t=h.PFORMATSTR_R32F}else{r=e.gl.HALF_FLOAT}}}if(e.glVersion==1){i.glInternalFormat=e.gl.RGBA;if(t==h.PFORMATSTR_RGBA16F||t==h.PFORMATSTR_RG16F||t==h.PFORMATSTR_R16F){const n=e.enableExtension("OES_texture_half_float");if(!n)throw new Error("no half float texture extension");r=n.HALF_FLOAT_OES}}if(t==h.PFORMATSTR_RGBA8UB){}else if(t==h.PFORMATSTR_RGB565){i.glInternalFormat=e.gl.RGB565;i.glDataFormat=e.gl.RGB}else if(t==h.PFORMATSTR_R8UB){i.glInternalFormat=e.gl.R8;i.glDataFormat=e.gl.RED}else if(t==h.PFORMATSTR_RG8UB){i.glInternalFormat=e.gl.RG8;i.glDataFormat=e.gl.RG}else if(t==h.PFORMATSTR_RGB8UB){i.glInternalFormat=e.gl.RGB8;i.glDataFormat=e.gl.RGB}else if(t==h.PFORMATSTR_SRGBA8){i.glInternalFormat=e.gl.SRGB8_ALPHA8}else if(t==h.PFORMATSTR_R32F){i.glInternalFormat=e.gl.R32F;i.glDataFormat=e.gl.RED;i.glDataType=r}else if(t==h.PFORMATSTR_R16F){i.glInternalFormat=e.gl.R16F;i.glDataType=r;i.glDataFormat=e.gl.RED}else if(t==h.PFORMATSTR_RG16F){i.glInternalFormat=e.gl.RG16F;i.glDataType=r;i.glDataFormat=e.gl.RG}else if(t==h.PFORMATSTR_RGBA16F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA16F;i.glDataType=r}else if(t==h.PFORMATSTR_R11FG11FB10F){i.glInternalFormat=e.gl.R11F_G11F_B10F;i.glDataType=r;i.glDataFormat=e.gl.RGB}else if(t==h.PFORMATSTR_RGBA32F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA32F;i.glDataType=r}else if(t==h.PFORMATSTR_DEPTH){if(e.glVersion==1){i.glInternalFormat=e.gl.DEPTH_COMPONENT;i.glDataType=e.gl.UNSIGNED_SHORT;i.glDataFormat=e.gl.DEPTH_COMPONENT}else{i.glInternalFormat=e.gl.DEPTH_COMPONENT32F;i.glDataType=e.gl.FLOAT;i.glDataFormat=e.gl.DEPTH_COMPONENT}}else{a.log("unknown pixelformat ",t)}if(t.includes("32bit")||t==h.PFORMATSTR_R11FG11FB10F){if(e.glVersion==2)e.enableExtension("EXT_color_buffer_float");if(e.glVersion==2)e.enableExtension("EXT_float_blend");e.enableExtension("OES_texture_float_linear")}i.numColorChannels=h.getPixelFormatNumChannels(t);if(!i.glDataType||!i.glInternalFormat||!i.glDataFormat)a.log("pixelformat wrong ?!",t,i.glDataType,i.glInternalFormat,i.glDataFormat,this);return i};h.getPixelFormatNumChannels=e=>{if(e.startsWith("RGBA"))return 4;if(e.startsWith("RGB"))return 3;if(e.startsWith("RG"))return 2;return 1};h.isPixelFormatFloat=e=>{return(e||"").includes("float")};h.isPixelFormatHalfFloat=e=>{return(e||"").includes("float")&&(e||"").includes("16bit")};class e{constructor(t,e,i,r){this._log=new u.Logger("cgl_framebuffer2");if(t.glVersion==1)this._log.error("framebuffer2 used on webgl1");this.Framebuffer2DrawTargetsDefault=null;this.Framebuffer2BlittingFramebuffer=null;this.Framebuffer2FinalFramebuffer=null;this._cgl=t;this._cgl.printError("before framebuffer2 constructor");this._width=0;this._height=0;this.valid=true;this._depthRenderbuffer=null;this._frameBuffer=null;this._textureFrameBuffer=null;this._colorRenderbuffers=[];this._drawTargetArray=[];this._disposed=false;if(!this.Framebuffer2BlittingFramebuffer)this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2FinalFramebuffer)this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2DrawTargetsDefault)this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0];this._options=r||{isFloatingPointTexture:false};this.name=this._options.name||"unknown";this._cgl.profileData.addHeavyEvent("framebuffer create",this.name);if(!this._options.hasOwnProperty("numRenderBuffers"))this._options.numRenderBuffers=1;if(!this._options.hasOwnProperty("depth"))this._options.depth=true;if(!this._options.hasOwnProperty("clear"))this._options.clear=true;if(!this._options.hasOwnProperty("multisampling")){this._options.multisampling=false;this._options.multisamplingSamples=0}if(this._options.multisamplingSamples){if(this._cgl.glSlowRenderer)this._options.multisamplingSamples=0;if(!this._cgl.gl.MAX_SAMPLES)this._options.multisamplingSamples=0;else this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples)}if(!this._options.hasOwnProperty("filter"))this._options.filter=h.FILTER_LINEAR;if(!this._options.hasOwnProperty("wrap"))this._options.wrap=h.WRAP_REPEAT;this._numRenderBuffers=this._options.numRenderBuffers;this._colorTextures=[];this.clearColors=[];for(let e=0;e<this._numRenderBuffers;e++)this.clearColors.push([0,0,0,1]);if(!r.pixelFormat){if(r.isFloatingPointTexture)this._options.pixelFormat=h.PFORMATSTR_RGBA32F;else this._options.pixelFormat=h.PFORMATSTR_RGBA8UB}for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e]=new h(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,anisotropic:this._options.anisotropic||0,pixelFormat:this._options.pixelFormat,filter:this._options.filter,wrap:this._options.wrap})}let s=h.FILTER_NEAREST;if(this._options.shadowMap)s=h.FILTER_LINEAR;const n=512;if(this._options.depth){this._textureDepth=new h(t,{name:"fb2 depth "+this.name,isDepthTexture:true,filter:s,shadowMap:this._options.shadowMap||false,width:e||n,height:i||n})}if(t.aborted)return;this.setSize(e||n,i||n);this._cgl.printError("framebuffer2 constructor")}getWidth(){return this._width}getHeight(){return this._height}getGlFrameBuffer(){return this._frameBuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this._colorTextures[0]}getTextureColorNum(e){return this._colorTextures[e]}getTextureDepth(){return this._textureDepth}setFilter(t){for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e].filter=t;this._colorTextures[e].setSize(this._width,this._height)}}delete(){this.dispose()}dispose(){this._disposed=true;let e=0;for(e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].delete();if(this._textureDepth)this._textureDepth.delete();for(e=0;e<this._numRenderBuffers;e++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[e]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}setSize(e,t){if(this._disposed)return this._log.warn("disposed framebuffer setsize...");this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;this._width=this._cgl.checkTextureSize(e);this._height=this._cgl.checkTextureSize(t);this._cgl.profileData.profileFrameBuffercreate++;if(this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer();this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const r=this._options.depth;for(i=0;i<this._numRenderBuffers;i++){this._colorTextures[i].setSize(this._width,this._height)}for(i=0;i<this._numRenderBuffers;i++){const a=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,a);const o=h.setUpGlPixelFormat(this._cgl,this._options.pixelFormat);let e=o.glInternalFormat;if(CGL.Texture.isPixelFormatHalfFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._options.filter=h.FILTER_NEAREST;this.setFilter(this._options.filter)}}else if(CGL.Texture.isPixelFormatFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._log.warn("no linear pixelformat,using nearest");this._options.filter=h.FILTER_NEAREST;this.setFilter(this._options.filter)}}if(this._options.multisampling&&this._options.multisamplingSamples){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,e,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,e,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,a);this._colorRenderbuffers[i]=a}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer);for(i=0;i<this._numRenderBuffers;i++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0)}if(this._options.depth){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let s=this._cgl.gl.DEPTH_COMPONENT32F;if(this._cgl.glSlowRenderer)s=this._cgl.gl.DEPTH_COMPONENT16;if(r){this._textureDepth.setSize(this._width,this._height);this._depthRenderbuffer=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);if(this._options.isFloatingPointTexture){if(this._options.multisampling)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,s,this._width,this._height);else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,s,this._width,this._height)}else if(this._options.multisampling){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,s,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,s,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)}this._drawTargetArray.length=0;for(i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);if(!this._cgl.gl.isFramebuffer(this._textureFrameBuffer))this._log.warn("invalid framebuffer");const n=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(n!=this._cgl.gl.FRAMEBUFFER_COMPLETE){this._log.error("framebuffer incomplete: "+this.name,this);this._log.log("options",this._options);this._log.log("options pixelformat",this._options.pixelFormat);switch(n){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this);throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:this._log.warn("FRAMEBUFFER_UNSUPPORTED");throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:this.valid=false;this._log.error("incomplete framebuffer",n,this._frameBuffer);this._cgl.printError();this._frameBuffer=null;throw new Error("Incomplete framebuffer: "+n)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)}renderStart(){if(this._disposed)return this._log.warn("disposed framebuffer renderStart...");this._cgl.checkFrameStarted("fb2 renderstart");this._cgl.pushModelMatrix();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.pushGlFrameBuffer(this._frameBuffer);this._cgl.pushFrameBuffer(this);this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this._width,this._height);this._cgl.gl.drawBuffers(this._drawTargetArray);if(this._options.clear){this._cgl.gl.clearColor(0,0,0,0);this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)}}clear(){if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)}else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.drawBuffers(this._drawTargetArray);for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+e,this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex,0);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,e,this.clearColors[e])}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}renderEnd(){if(this._disposed)return this._log.warn("disposed framebuffer renderEnd...");this._cgl.popPMatrix();this._cgl.profileData.profileFramebuffer++;if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);let e=this._cgl.gl.COLOR_BUFFER_BIT;if(t==0)e|=this._cgl.gl.DEPTH_BUFFER_BIT;this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.popFrameBuffer();this._cgl.popModelMatrix();this._cgl.popViewPort();if(this._colorTextures[0].filter==h.FILTER_MIPMAP){for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex);this._colorTextures[e].updateMipMap();this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}}}}const s=function(e){this.draw=function(e,t,i){}};const n=function(e){this.render=function(e,t){}};const o=function(e){this.render=function(e,t,i,r){}};class l{constructor(e,t,i,r,s,n,a,o,l,h){this._log=new u.Logger("cg_uniform");this._type=t;this._name=i;this._shader=e;this._value=1e-5;this._oldValue=null;this._port=null;this._structName=l;this._structUniformName=o;this._propertyName=h;if(this._shader._addUniform)this._shader._addUniform(this);this.needsUpdate=true;this.shaderType=null;this.comment=null;if(t=="f"){this.set=this.setValue=this.setValueF.bind(this);this.updateValue=this.updateValueF.bind(this)}else if(t=="f[]"){this.set=this.setValue=this.setValueArrayF.bind(this);this.updateValue=this.updateValueArrayF.bind(this)}else if(t=="2f[]"){this.set=this.setValue=this.setValueArray2F.bind(this);this.updateValue=this.updateValueArray2F.bind(this)}else if(t=="3f[]"){this.set=this.setValue=this.setValueArray3F.bind(this);this.updateValue=this.updateValueArray3F.bind(this)}else if(t=="4f[]"){this.set=this.setValue=this.setValueArray4F.bind(this);this.updateValue=this.updateValueArray4F.bind(this)}else if(t=="i"){this.set=this.setValue=this.setValueI.bind(this);this.updateValue=this.updateValueI.bind(this)}else if(t=="2i"){this.set=this.setValue=this.setValue2I.bind(this);this.updateValue=this.updateValue2I.bind(this)}else if(t=="3i"){this.set=this.setValue=this.setValue3I.bind(this);this.updateValue=this.updateValue3I.bind(this)}else if(t=="4i"){this.set=this.setValue=this.setValue4I.bind(this);this.updateValue=this.updateValue4I.bind(this)}else if(t=="b"){this.set=this.setValue=this.setValueBool.bind(this);this.updateValue=this.updateValueBool.bind(this)}else if(t=="4f"){this.set=this.setValue=this.setValue4F.bind(this);this.updateValue=this.updateValue4F.bind(this)}else if(t=="3f"){this.set=this.setValue=this.setValue3F.bind(this);this.updateValue=this.updateValue3F.bind(this)}else if(t=="2f"){this.set=this.setValue=this.setValue2F.bind(this);this.updateValue=this.updateValue2F.bind(this)}else if(t=="t"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="sampler"){if(this.setValueAny){this.set=this.setValue=this.setValueAny.bind(this);this.updateValue=this.updateValueAny.bind(this)}}else if(t=="tc"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="t[]"){this.set=this.setValue=this.setValueArrayT.bind(this);this.updateValue=this.updateValueArrayT.bind(this)}else if(t=="m4"||t=="m4[]"){this.set=this.setValue=this.setValueM4.bind(this);this.updateValue=this.updateValueM4.bind(this)}else{this._log.error("Unknown uniform type "+t,i,typeof this._shader)}if(typeof r=="object"&&r instanceof v.Port){this._port=r;this._value=this._port.get();if(s&&n&&a){if(!(s instanceof v.Port)||!(n instanceof v.Port)||!(a instanceof v.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0,0];this._port2=s;this._port3=n;this._port4=a;this._port.on("change",this.updateFromPort4f.bind(this));this._port2.on("change",this.updateFromPort4f.bind(this));this._port3.on("change",this.updateFromPort4f.bind(this));this._port4.on("change",this.updateFromPort4f.bind(this));this.updateFromPort4f()}else if(s&&n){if(!(s instanceof v.Port)||!(n instanceof v.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0];this._port2=s;this._port3=n;this._port.on("change",this.updateFromPort3f.bind(this));this._port2.on("change",this.updateFromPort3f.bind(this));this._port3.on("change",this.updateFromPort3f.bind(this));this.updateFromPort3f()}else if(s){if(!(s instanceof v.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0];this._port2=s;this._port.on("change",this.updateFromPort2f.bind(this));this._port2.on("change",this.updateFromPort2f.bind(this));this.updateFromPort2f()}else{this._port.on("change",this.updateFromPort.bind(this))}}else this._value=r;if(this._value==undefined){this._value=0}this.setValue(this._value);this.needsUpdate=true}getType(){return this._type}get type(){return this._type}get name(){return this._name}getName(){return this._name}getValue(){return this._value}getShaderType(){return this.shaderType}isStructMember(){return!!this._structName}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}get port(){return this._port}}class c extends l{constructor(e,t,i,r,s,n,a,o,l,h){super(e,t,i,r,s,n,a,o,l,h);this._loc=-1;this._cgl=e._cgl}get name(){return this._name}copy(e){const t=new c(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);t.shaderType=this.shaderType;return t}getGlslTypeString(){return c.glslTypeString(this._type)}_isValidLoc(){return this._loc!=-1}resetLoc(){this._loc=-1;this.needsUpdate=true}bindTextures(){}getLoc(){return this._loc}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}updateValueF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1f(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueF(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}updateValueI(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValue2I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue3I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue4I(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValueI(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValue2I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}setValue3I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}setValue4I(e){this.needsUpdate=true;this._value=e||vec4.create()}updateValueBool(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0);this._cgl.profileData.profileUniformCount++}setValueBool(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValueArray4F(e){this.needsUpdate=true;this._value=e}updateValueArray4F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform4fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray3F(e){this.needsUpdate=true;this._value=e}updateValueArray3F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform3fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray2F(e){this.needsUpdate=true;this._value=e}updateValueArray2F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform2fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayF(e){this.needsUpdate=true;this._value=e}updateValueArrayF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayT(e){this.needsUpdate=true;this._value=e}updateValue3F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue3F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValue2F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue2F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}updateValue4F(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value){this._log.warn("no value for uniform",this._name,this);this._value=[0,0,0,0]}this.needsUpdate=false;this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValue4F(e){if(typeof this.value=="number")this.value=vec4.create();if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2,3];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]||e[3]!=this._oldValue[3]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValueM4(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,false,this._value);this._cgl.profileData.profileUniformCount++}setValueM4(e){this.needsUpdate=true;this._value=e||mat4.create()}updateValueArrayT(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1iv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValueT(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._cgl.profileData.profileUniformCount++;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this.needsUpdate=false}setValueT(e){this.needsUpdate=true;this._value=e}}c.glslTypeString=e=>{if(e=="f")return"float";if(e=="b")return"bool";if(e=="i")return"int";if(e=="2i")return"ivec2";if(e=="2f")return"vec2";if(e=="3f")return"vec3";if(e=="4f")return"vec4";if(e=="m4")return"mat4";if(e=="t")return"sampler2D";if(e=="tc")return"samplerCube";if(e=="3f[]")return null;if(e=="m4[]")return null;if(e=="f[]")return null;console.warn("[CGL UNIFORM] unknown glsl type string ",e)};const g={SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_INSTANCE_INDEX:"instanceIndex",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_INVPROJMAT:"invProjMatrix",SHADERVAR_UNI_MATERIALID:"materialId",SHADERVAR_UNI_OBJECTID:"objectId",SHADERVAR_UNI_VIEWPOS:"camPos"};const f={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};const d=180/Math.PI;const p=Math.PI/180;const m={MATH:{DEG2RAD:p,RAD2DEG:d},SHADER:g,BLEND_MODES:f};const x="\n";class _{_name="unknown";constructor(){}}const T={};T.lastMesh=null;class E extends _{#cgl=null;#geom=null;#bufVerticesIndizes=null;constructor(e,t,i={}){super();this.#cgl=e;let r=i||{};if(v.utils.isNumeric(r))r={glPrimitive:i};this._log=new u.Logger("cgl_mesh");this._bufVertexAttrib=null;this.#bufVerticesIndizes=this.#cgl.gl.createBuffer();this._indexType=this.#cgl.gl.UNSIGNED_SHORT;this._attributes=[];this._attribLocs={};this._lastShader=null;this._numInstances=0;this._glPrimitive=r.glPrimitive;this.opId=r.opId||"";this._preWireframeGeom=null;this.addVertexNumbers=false;this.feedBackAttributes=[];this.setGeom(t);this._feedBacks=[];this._feedBacksChanged=false;this._transformFeedBackLoc=-1;this._lastAttrUpdate=0;this.memFreed=false;this.#cgl.profileData.addHeavyEvent("mesh constructed",this._name);this._queryExt=null}get geom(){return this.#geom}get numInstances(){return this._numInstances}set numInstances(e){this.setNumInstances(e)}freeMem(){this.memFreed=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].floatArray=null}updateVertices(e){this.setAttribute(m.SHADER.SHADERVAR_VERTEX_POSITION,e.vertices,3);this._numVerts=e.vertices.length/3}setAttributePointer(t,i,r,s){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t){if(!this._attributes[e].pointer)this._attributes[e].pointer=[];this._attributes[e].pointer.push({loc:-1,name:i,stride:r,offset:s,instanced:t==m.SHADER.SHADERVAR_INSTANCE_MMATRIX})}}}getAttribute(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]}setAttributeRange(e,t,i,r){if(!e)return;if(!i&&!r)return;if(!e.name)this._log.stack("no attrname?!");const s=this.#cgl.gl;s.bindBuffer(s.ARRAY_BUFFER,e.buffer);this.#cgl.profileData.profileMeshAttributes+=r-i||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]=this.#cgl.profileData.profileSingleMeshAttribute[this._name]||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]+=r-i||0;if(e.numItems<t.length/e.itemSize){this._resizeAttr(t,e)}if(r>t.length&&!this.warned){this.warned=true;this._log.warn(this.#cgl.canvas.id+" "+e.name+" buffersubdata out of bounds ?",t.length,r,i,e);return}s.bufferSubData(s.ARRAY_BUFFER,i*4,t,i,r-i)}_resizeAttr(e,t){const i=this.#cgl.gl;if(t.buffer)i.deleteBuffer(t.buffer);t.buffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.buffer);this._bufferArray(e,t);t.numItems=e.length/t.itemSize}_bufferArray(e,t){let i=t.floatArray||null;if(!e)return;if(this.#cgl.debugOneFrame){console.log("_bufferArray",e.length,t.name)}if(!(e instanceof Float32Array)){if(t&&i&&i.length==e.length){i.set(e)}else{i=new Float32Array(e);if(this.#cgl.debugOneFrame){console.log("_bufferArray create new float32array",e.length,t.name)}if(e.length>1e4){this.#cgl.profileData.profileNonTypedAttrib++;this.#cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"}}}else i=e;t.arrayLength=i.length;t.floatArray=null;this.#cgl.gl.bufferData(this.#cgl.gl.ARRAY_BUFFER,i,this.#cgl.gl.DYNAMIC_DRAW)}addAttribute(e,t,i,r){this.setAttribute(e,t,i,r)}setAttribute(e,t,i,r={}){if(!t){this._log.error("mesh addAttribute - no array given! "+e);throw new Error}let s=null;let n=false;let a=0;const o=t.length/i;this.#cgl.profileData.profileMeshAttributes+=o||0;if(typeof r=="function"){s=r}if(typeof r=="object"){if(r.cb)s=r.cb;if(r.instanced)n=r.instanced}if(e==m.SHADER.SHADERVAR_INSTANCE_MMATRIX)n=true;for(a=0;a<this._attributes.length;a++){const u=this._attributes[a];if(u.name==e){if(u.numItems===o){}else{this._resizeAttr(t,u)}this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,u.buffer);this._bufferArray(t,u);return u}}const l=this.#cgl.gl.createBuffer();this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,l);let h=this.#cgl.gl.FLOAT;if(r&&r.type)h=r.type;const u={buffer:l,name:e,cb:s,itemSize:i,numItems:o,startItem:0,instanced:n,type:h};this._bufferArray(t,u);if(e==m.SHADER.SHADERVAR_VERTEX_POSITION)this._bufVertexAttrib=u;this._attributes.push(u);this._attribLocs={};return u}getAttributes(){return this._attributes}updateTexCoords(e){if(e.texCoords&&e.texCoords.length>0){this.setAttribute(m.SHADER.SHADERVAR_VERTEX_TEXCOORD,e.texCoords,2)}else{const t=new Float32Array(Math.round(e.vertices.length/3*2));this.setAttribute(m.SHADER.SHADERVAR_VERTEX_TEXCOORD,t,2)}}updateNormals(e){if(e.vertexNormals&&e.vertexNormals.length>0){this.setAttribute(m.SHADER.SHADERVAR_VERTEX_NORMAL,e.vertexNormals,3)}else{const t=new Float32Array(Math.round(e.vertices.length));this.setAttribute(m.SHADER.SHADERVAR_VERTEX_NORMAL,t,3)}}_setVertexNumbers(e=null){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(m.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,i)=>{if(!i.uniformNumVertices)i.uniformNumVertices=new c(i,"f","numVertices",this._numVerts);i.uniformNumVertices.setValue(this._numVerts)})}}setVertexIndices(t){if(!this.#bufVerticesIndizes){this._log.warn("no bufVerticesIndizes: "+this._name);return}if(t.length>0){if(t instanceof Float32Array)this._log.warn("vertIndices float32Array: "+this._name);for(let e=0;e<t.length;e++){if(t[e]>=this._numVerts){this._log.warn("invalid index in "+this._name,e,t[e]);return}}this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes);if(t.length>65535){this.vertIndicesTyped=new Uint32Array(t);this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(t instanceof Uint32Array){this.vertIndicesTyped=t;this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(!(t instanceof Uint16Array)){this.vertIndicesTyped=new Uint16Array(t);this._indexType=this.#cgl.gl.UNSIGNED_SHORT}else this.vertIndicesTyped=t;this.#cgl.gl.bufferData(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this.#cgl.gl.DYNAMIC_DRAW);this.#bufVerticesIndizes.itemSize=1;this.#bufVerticesIndizes.numItems=t.length}else this.#bufVerticesIndizes.numItems=0}setGeom(e,t=false){this.#geom=e;if(e.glPrimitive!=null)this._glPrimitive=e.glPrimitive;if(this.#geom&&this.#geom.name)this._name="mesh "+this.#geom.name;T.lastMesh=null;this.#cgl.profileData.profileMeshSetGeom++;this._disposeAttributes();this.updateVertices(this.#geom);this.setVertexIndices(this.#geom.verticesIndices);if(this.addVertexNumbers)this._setVertexNumbers();const i=this.#geom.getAttributes();const r={texCoords:m.SHADER.SHADERVAR_VERTEX_TEXCOORD,vertexNormals:m.SHADER.SHADERVAR_VERTEX_NORMAL,vertexColors:m.SHADER.SHADERVAR_VERTEX_COLOR,tangents:"attrTangent",biTangents:"attrBiTangent"};for(const s in i)if(i[s].data&&i[s].data.length)this.setAttribute(r[s]||s,i[s].data,i[s].itemSize);if(t){this.#geom=null}}_preBind(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].cb)this._attributes[e].cb(this._attributes[e],this.#geom,t)}_checkAttrLengths(){if(this.memFreed)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";if(this.#geom)e=this.#geom.name}}}_bind(t){if(!t)return;if(!t.isValid())return;let i=[];if(this._attribLocs[t.id])i=this._attribLocs[t.id];else this._attribLocs[t.id]=i;this._lastShader=t;if(t.lastCompile>this._lastAttrUpdate||i.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let e=0;e<this._attributes.length;e++)i[e]=-1}for(let e=0;e<this._attributes.length;e++){const r=this._attributes[e];if(i[e]==-1){if(r._attrLocationLastShaderTime!=t.lastCompile){r._attrLocationLastShaderTime=t.lastCompile;i[e]=this.#cgl.glGetAttribLocation(t.getProgram(),r.name);this.#cgl.profileData.profileAttrLoc++}}if(i[e]!=-1){this.#cgl.gl.enableVertexAttribArray(i[e]);this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,r.buffer);if(r.instanced){if(r.itemSize<=4){if(!r.itemSize||r.itemSize==0)this._log.warn("instanced attrib itemsize error",this.#geom.name,r);this.#cgl.gl.vertexAttribPointer(i[e],r.itemSize,r.type,false,r.itemSize*4,0);this.#cgl.gl.vertexAttribDivisor(i[e],1)}else if(r.itemSize==16){const s=16*4;this.#cgl.gl.vertexAttribPointer(i[e],4,r.type,false,s,0);this.#cgl.gl.enableVertexAttribArray(i[e]+1);this.#cgl.gl.vertexAttribPointer(i[e]+1,4,r.type,false,s,4*4*1);this.#cgl.gl.enableVertexAttribArray(i[e]+2);this.#cgl.gl.vertexAttribPointer(i[e]+2,4,r.type,false,s,4*4*2);this.#cgl.gl.enableVertexAttribArray(i[e]+3);this.#cgl.gl.vertexAttribPointer(i[e]+3,4,r.type,false,s,4*4*3);this.#cgl.gl.vertexAttribDivisor(i[e],1);this.#cgl.gl.vertexAttribDivisor(i[e]+1,1);this.#cgl.gl.vertexAttribDivisor(i[e]+2,1);this.#cgl.gl.vertexAttribDivisor(i[e]+3,1)}else{this._log.warn("unknown instance attrib size",r.name)}}else{if(!r.itemSize||r.itemSize==0)this._log.warn("attrib itemsize error",this._name,r);this.#cgl.gl.vertexAttribPointer(i[e],r.itemSize,r.type,false,r.itemSize*4,0);if(r.pointer){for(let e=0;e<r.pointer.length;e++){const n=r.pointer[e];if(n.loc==-1)n.loc=this.#cgl.glGetAttribLocation(t.getProgram(),n.name);this.#cgl.profileData.profileAttrLoc++;this.#cgl.gl.enableVertexAttribArray(n.loc);this.#cgl.gl.vertexAttribPointer(n.loc,r.itemSize,r.type,false,n.stride,n.offset)}}if(this.bindFeedback)this.bindFeedback(r)}}}if(this.#bufVerticesIndizes&&this.#bufVerticesIndizes.numItems!==0)this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes)}unBind(){const e=this._lastShader;this._lastShader=null;if(!e)return;let t=[];if(this._attribLocs[e.id])t=this._attribLocs[e.id];else this._attribLocs[e.id]=t;T.lastMesh=null;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].instanced){if(this._attributes[e].itemSize<=4){if(t[e]!=-1)this.#cgl.gl.vertexAttribDivisor(t[e],0);if(t[e]>=0)this.#cgl.gl.disableVertexAttribArray(t[e])}else{this.#cgl.gl.vertexAttribDivisor(t[e],0);this.#cgl.gl.vertexAttribDivisor(t[e]+1,0);this.#cgl.gl.vertexAttribDivisor(t[e]+2,0);this.#cgl.gl.vertexAttribDivisor(t[e]+3,0);this.#cgl.gl.disableVertexAttribArray(t[e]+1);this.#cgl.gl.disableVertexAttribArray(t[e]+2);this.#cgl.gl.disableVertexAttribArray(t[e]+3)}}if(t[e]!=-1)this.#cgl.gl.disableVertexAttribArray(t[e])}}meshChanged(){return this.#cgl.lastMesh&&this.#cgl.lastMesh!=this}printDebug(){console.log("--attributes");for(let e=0;e<this._attributes.length;e++){console.log("attribute "+e+" "+this._attributes[e].name)}}setNumVertices(e){this._bufVertexAttrib.numItems=e}getNumVertices(){return this._bufVertexAttrib.numItems}setNumIndices(e){this.#bufVerticesIndizes.numItems=e}getNumIndices(){return this.#bufVerticesIndizes.numItems}render(i){if(this.#cgl.aborted)return;i=i||this.#cgl.getShader();if(!i){return console.log("shader not valid")}if(!i.isValid()){i=this.#cgl.getErrorShader()}this._checkAttrLengths();if(this.#geom){if(this._preWireframeGeom&&!i.wireframe&&!this.#geom.isIndexed()){this.setGeom(this._preWireframeGeom);this._preWireframeGeom=null}if(i.wireframe){let e=false;if(this.#geom.isIndexed()){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}this.#geom.unIndex();e=true}if(!this.#geom.getAttribute("attrBarycentric")){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}e=true;this.#geom.calcBarycentric()}if(e)this.setGeom(this.#geom)}}let e=false;if(T.lastMesh!=this){if(T.lastMesh)T.lastMesh.unBind();e=true}if(e)this._preBind(i);if(!i.bind())return;this._bind(i);if(this.addVertexNumbers)this._setVertexNumbers();T.lastMesh=this;let t=this.#cgl.gl.TRIANGLES;if(this._glPrimitive!==undefined)t=this._glPrimitive;if(i.glPrimitive!==null)t=i.glPrimitive;let r=1;let s=this.#cgl.profileData.doProfileGlQuery;let n=false;if(s){let e=this._name+" - "+i.getName()+" #"+i.id;if(this._numInstances)e+=" instanced "+this._numInstances+"x";let t=this.#cgl.profileData.glQueryData[e];if(!t)t={id:e,num:0};if(i.opId)t.shaderOp=i.opId;if(this.opId)t.meshOp=this.opId;this.#cgl.profileData.glQueryData[e]=t;if(!this._queryExt&&this._queryExt!==false)this._queryExt=this.#cgl.enableExtension("EXT_disjoint_timer_query_webgl2")||false;if(this._queryExt){if(t._drawQuery){const a=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT_AVAILABLE);if(a){const o=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT);const l=o/1e6;t._times=t._times||0;t._times+=l;t._numcount++;t.when=performance.now();t._drawQuery=null;t.queryStarted=false}}if(!t.queryStarted){t._drawQuery=this.#cgl.gl.createQuery();this.#cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery);n=t.queryStarted=true}}}if(this.hasFeedbacks&&this.hasFeedbacks())this.drawFeedbacks(i,t);else if(!this.#bufVerticesIndizes||this.#bufVerticesIndizes.numItems===0){if(t==this.#cgl.gl.TRIANGLES)r=3;if(this._numInstances===0)this.#cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem);else this.#cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)}else{if(t==this.#cgl.gl.TRIANGLES)r=3;if(this._numInstances===0){this.#cgl.gl.drawElements(t,this.#bufVerticesIndizes.numItems,this._indexType,0)}else{this.#cgl.gl.drawElementsInstanced(t,this.#bufVerticesIndizes.numItems,this._indexType,0,this._numInstances)}}if(this.#cgl.debugOneFrame&&this.#cgl.gl.getError()!=this.#cgl.gl.NO_ERROR){this._log.error("mesh draw gl error");this._log.error("mesh",this);this._log.error("shader",i);const h=[];for(let e=0;e<this.#cgl.gl.getProgramParameter(i.getProgram(),this.#cgl.gl.ACTIVE_ATTRIBUTES);e++){const u=this.#cgl.gl.getActiveAttrib(i.getProgram(),e).name;this._log.error("attrib ",u)}}this.#cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/r*(this._numInstances||1);this.#cgl.profileData.profileMeshDraw++;if(s&&n){this.#cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT)}this.#cgl.printError("mesh render "+this._name);this.unBind()}setNumInstances(t){t=Math.max(0,t);if(this._numInstances!=t){this._numInstances=t;const i=new Float32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setAttribute(m.SHADER.SHADERVAR_INSTANCE_INDEX,i,1,{instanced:true})}}_disposeAttributes(){if(!this._attributes)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].buffer){this.#cgl.gl.deleteBuffer(this._attributes[e].buffer);this._attributes[e].buffer=null}}this._attributes.length=0}dispose(){if(this.#cgl.aborted)return;if(this._bufVertexAttrib&&this._bufVertexAttrib.buffer)this.#cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);if(this.#bufVerticesIndizes)this.#cgl.gl.deleteBuffer(this.#bufVerticesIndizes);this.#bufVerticesIndizes=null;this._disposeAttributes();return null}}const L=CABLES.GLMatrix;class b{constructor(e){this._init();this._first=true;this._wireMesh=null;if(e)this.applyGeom(e)}_init(){this._max=[-0,-0,-0];this._min=[0,0,0];this._center=[0,0,0];this._size=[0,0,0];this._maxAxis=0;this._first=true}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(e){return this.applyGeom(e)}applyGeom(t){if(!t)return;if(t instanceof b){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ);this.applyPos(e.minX,e.minY,e.minZ)}else{if(t.isGeometry)for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2])}this.calcCenterSize()}copy(){return new b(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,i){if(e==Number.MAX_VALUE||e==-Number.MAX_VALUE||t==Number.MAX_VALUE||t==-Number.MAX_VALUE||i==Number.MAX_VALUE||i==-Number.MAX_VALUE)return;if(!v.utils.isNumeric(e)||!v.utils.isNumeric(t)||!v.utils.isNumeric(i))return;if(this._first){this._max[0]=e;this._max[1]=t;this._max[2]=i;this._min[0]=e;this._min[1]=t;this._min[2]=i;this._first=false;return}this._max[0]=Math.max(this._max[0],e);this._max[1]=Math.max(this._max[1],t);this._max[2]=Math.max(this._max[2],i);this._min[0]=Math.min(this._min[0],e);this._min[1]=Math.min(this._min[1],t);this._min[2]=Math.min(this._min[2],i)}calcCenterSize(){if(this._first)return;this._size[0]=this._max[0]-this._min[0];this._size[1]=this._max[1]-this._min[1];this._size[2]=this._max[2]-this._min[2];this._center[0]=(this._min[0]+this._max[0])/2;this._center[1]=(this._min[1]+this._max[1])/2;this._center[2]=(this._min[2]+this._max[2])/2;this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1]))}mulMat4(e){if(this._first){this._max[0]=0;this._max[1]=0;this._max[2]=0;this._min[0]=0;this._min[1]=0;this._min[2]=0;this._first=false}L.vec3.transformMat4(this._max,this._max,e);L.vec3.transformMat4(this._min,this._min,e);this.calcCenterSize()}render(e,t,i){if(!this._wireMesh)this._wireMesh=new CGL.WireCube(e);e.pushModelMatrix();L.mat4.translate(e.mMatrix,e.mMatrix,this._center);if(CABLES.UI&&i){CABLES.UI.OverlayMeshes.drawCube(i,this._size[0]/2,this._size[1]/2,this._size[2]/2)}e.popModelMatrix()}}class A{isGeometry=true;constructor(e){this.name=e||"unknown";this._log=new u.Logger("cgl_geometry");this.faceVertCount=3;this.glPrimitive=null;this._attributes={};this._vertices=[];this.verticesIndices=[];this.morphTargets=[]}get vertices(){return this._vertices}set vertices(e){this.setVertices(e)}get texCoords(){const e=this.getAttribute("texCoords");if(!e)return[];return e.data}set texCoords(e){this.setAttribute("texCoords",e,2)}get vertexNormals(){const e=this.getAttribute("vertexNormals");if(!e)return[];return e.data}set vertexNormals(e){this.setAttribute("vertexNormals",e,3)}get tangents(){const e=this.getAttribute("tangents");if(!e)return[];return e.data}set tangents(e){this.setAttribute("tangents",e,3)}get biTangents(){const e=this.getAttribute("biTangents");if(!e)return[];return e.data}set biTangents(e){this.setAttribute("biTangents",e,3)}get vertexColors(){const e=this.getAttribute("vertexColors");if(!e)return[];return e.data}set vertexColors(e){this.setAttribute("vertexColors",e,4)}clear(){this._vertices=new Float32Array([]);this.verticesIndices=[];this.texCoords=new Float32Array([]);this.vertexNormals=new Float32Array([]);this.tangents=[];this.biTangents=[];this._attributes={}}getAttributes(){return this._attributes}getAttribute(t){for(const e in this._attributes){if(this._attributes[e].name==t)return this._attributes[e]}return null}setAttribute(e,t,i){let r="";if(!i||i>4){this._log.warn("itemsize wrong?",i,e);this._log.stack("itemsize");i=3}if(i==1)r="float";else if(i==2)r="vec2";else if(i==3)r="vec3";else if(i==4)r="vec4";const s={name:e,data:t,itemSize:i,type:r};this._attributes[e]=s}copyAttribute(e,t){const i=this.getAttribute(e);t.setAttribute(e,new Float32Array(i.data),i.itemSize)}setVertices(e){if(e instanceof Float32Array)this._vertices=e;else this._vertices=new Float32Array(e)}setTexCoords(e){if(e instanceof Float32Array)this.texCoords=e;else this.texCoords=new Float32Array(e)}calcNormals(e){const t={smooth:e};this.calculateNormals(t)}flipNormals(t,i,r){let s=L.vec3.create();if(t==undefined)t=1;if(i==undefined)i=1;if(r==undefined)r=1;for(let e=0;e<this.vertexNormals.length;e+=3){L.vec3.set(s,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]);s[0]*=-t;s[1]*=-i;s[2]*=-r;L.vec3.normalize(s,s);this.vertexNormals[e+0]=s[0];this.vertexNormals[e+1]=s[1];this.vertexNormals[e+2]=s[2]}}getNumTriangles(){if(this.verticesIndices&&this.verticesIndices.length)return this.verticesIndices.length/3;return this.vertices.length/3}flipVertDir(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3){t[e]=this.verticesIndices[e+2];t[e+1]=this.verticesIndices[e+1];t[e+2]=this.verticesIndices[e]}this.verticesIndices=t}setPointVertices(t){if(t.length%3!==0){this._log.error("SetPointVertices: Array must be multiple of three.");return}if(!(t instanceof Float32Array))this.vertices=new Float32Array(t);else this.vertices=t;if(!(this.texCoords instanceof Float32Array))this.texCoords=new Float32Array(t.length/3*2);this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++){this.verticesIndices[e]=e;this.texCoords[e*2]=0;this.texCoords[e*2+1]=0}}merge(t){if(!t)return;if(this.isIndexed()!=t.isIndexed()){if(this.isIndexed()){this.unIndex(false,true)}if(t.isIndexed()){const e=t.copy();e.unIndex(false,true);t=e}}const i=this.verticesIndices.length;const r=this._vertices.length/3;this.verticesIndices.length+=t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[i+e]=t.verticesIndices[e]+r;this.vertices=v.utils.float32Concat(this._vertices,t.vertices);this.texCoords=v.utils.float32Concat(this.texCoords,t.texCoords);this.vertexNormals=v.utils.float32Concat(this.vertexNormals,t.vertexNormals);this.tangents=v.utils.float32Concat(this.tangents,t.tangents);this.biTangents=v.utils.float32Concat(this.biTangents,t.biTangents)}copy(){const t=new A(this.name+" copy");t.faceVertCount=this.faceVertCount;t.glPrimitive=this.glPrimitive;t.setVertices(this._vertices.slice(0));if(this.verticesIndices){t.verticesIndices.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e]}for(let e in this._attributes)this.copyAttribute(e,t);t.morphTargets.length=this.morphTargets.length;for(let e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];return t}calculateNormals(t=null){t=t||{};if(t.smooth===false)this.unIndex();const i=L.vec3.create();const r=L.vec3.create();const s=L.vec3.create();function n(e){L.vec3.subtract(i,e[0],e[1]);L.vec3.subtract(r,e[0],e[2]);L.vec3.cross(s,i,r);L.vec3.normalize(s,s);if(t&&t.forceZUp){if(s[2]<0){s[0]*=-1;s[1]*=-1;s[2]*=-1}}return s}this.getVertexVec=function(e){const t=[0,0,0];t[0]=this.vertices[e*3+0];t[1]=this.vertices[e*3+1];t[2]=this.vertices[e*3+2];return t};if(!(this.vertexNormals instanceof Float32Array)||this.vertexNormals.length!=this.vertices.length)this.vertexNormals=new Float32Array(this.vertices.length);for(let e=0;e<this.vertices.length;e++){this.vertexNormals[e]=0}if(!this.isIndexed()){const a=[];for(let e=0;e<this.vertices.length;e+=9){const o=[[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]];const l=n(o);a.push(l[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2])}this.vertexNormals=a}else{const h=[];h.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const o=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];h[e/3]=n(o);this.vertexNormals[this.verticesIndices[e+0]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+0]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+0]*3+2]+=h[e/3][2];this.vertexNormals[this.verticesIndices[e+1]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+1]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+1]*3+2]+=h[e/3][2];this.vertexNormals[this.verticesIndices[e+2]*3+0]+=h[e/3][0];this.vertexNormals[this.verticesIndices[e+2]*3+1]+=h[e/3][1];this.vertexNormals[this.verticesIndices[e+2]*3+2]+=h[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){const u=[this.vertexNormals[this.verticesIndices[t+e]*3+0],this.vertexNormals[this.verticesIndices[t+e]*3+1],this.vertexNormals[this.verticesIndices[t+e]*3+2]];L.vec3.normalize(u,u);this.vertexNormals[this.verticesIndices[t+e]*3+0]=u[0];this.vertexNormals[this.verticesIndices[t+e]*3+1]=u[1];this.vertexNormals[this.verticesIndices[t+e]*3+2]=u[2]}}}}calcTangentsBitangents(){if(!this.vertices.length){return}if(!this.vertexNormals.length){return}if(!this.texCoords.length){const A=this.vertices.length/3*2;this.texCoords=new Float32Array(A);for(let e=0;e<A;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length){return}if(this.verticesIndices.length%3!==0){this._log.error("Vertex indices mismatch!");return}const t=this.verticesIndices.length/3;const i=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length);this.biTangents=new Float32Array(this.vertexNormals.length);const r=[];r.length=i*2;const s=L.vec3.create();const n=L.vec3.create();const a=L.vec3.create();const o=L.vec2.create();const l=L.vec2.create();const h=L.vec2.create();const u=L.vec3.create();const c=L.vec3.create();for(let e=0;e<t;e+=1){const F=this.verticesIndices[e*3];const v=this.verticesIndices[e*3+1];const x=this.verticesIndices[e*3+2];L.vec3.set(s,this.vertices[F*3],this.vertices[F*3+1],this.vertices[F*3+2]);L.vec3.set(n,this.vertices[v*3],this.vertices[v*3+1],this.vertices[v*3+2]);L.vec3.set(a,this.vertices[x*3],this.vertices[x*3+1],this.vertices[x*3+2]);L.vec2.set(o,this.texCoords[F*2],this.texCoords[F*2+1]);L.vec2.set(l,this.texCoords[v*2],this.texCoords[v*2+1]);L.vec2.set(h,this.texCoords[x*2],this.texCoords[x*2+1]);const T=n[0]-s[0];const C=a[0]-s[0];const D=n[1]-s[1];const B=a[1]-s[1];const S=n[2]-s[2];const I=a[2]-s[2];const M=l[0]-o[0];const R=h[0]-o[0];const O=l[1]-o[1];const P=h[1]-o[1];const N=1/(M*P-R*O);L.vec3.set(u,(P*T-O*C)*N,(P*D-O*B)*N,(P*S-O*I)*N);L.vec3.set(c,(M*C-R*T)*N,(M*B-R*D)*N,(M*I-R*S)*N);r[F]=u;r[v]=u;r[x]=u;r[F+i]=c;r[v+i]=c;r[x+i]=c}const g=L.vec3.create();const f=L.vec3.create();const d=L.vec3.create();const p=L.vec3.create();const m=L.vec3.create();const _=L.vec3.create();const E=L.vec3.create();const b=L.vec3.create();for(let e=0;e<i;e+=1){if(!r[e])continue;L.vec3.set(g,this.vertexNormals[e*3],this.vertexNormals[e*3+1],this.vertexNormals[e*3+2]);L.vec3.set(f,r[e][0],r[e][1],r[e][2]);const y=L.vec3.dot(g,f);L.vec3.scale(m,g,y);L.vec3.subtract(_,f,m);L.vec3.normalize(b,_);L.vec3.cross(E,g,f);const w=1;L.vec3.scale(d,b,1/w);L.vec3.cross(p,g,d);this.tangents[e*3+0]=d[0];this.tangents[e*3+1]=d[1];this.tangents[e*3+2]=d[2];this.biTangents[e*3+0]=p[0];this.biTangents[e*3+1]=p[1];this.biTangents[e*3+2]=p[2]}}isIndexed(){if(this._vertices.length==0)return true;return this.verticesIndices.length!=0}unIndex(e=false,t=false){const i=[];const r=[];let s=0;for(let e in this._attributes){const n=this._attributes[e];let i=[];for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){if(n.itemSize==3)i.push(n.data[this.verticesIndices[t+e]*3+0],n.data[this.verticesIndices[t+e]*3+1],n.data[this.verticesIndices[t+e]*3+2]);else if(n.itemSize==4)i.push(n.data[this.verticesIndices[t+e]*4+0],n.data[this.verticesIndices[t+e]*4+1],n.data[this.verticesIndices[t+e]*4+2],n.data[this.verticesIndices[t+e]*4+3]);else if(n.itemSize==2)i.push(n.data[this.verticesIndices[t+e]*2+0],n.data[this.verticesIndices[t+e]*2+1]);else if(n.itemSize==1)i.push(n.data[this.verticesIndices[t+e]]);else this._log.warn("unknown attr",n)}}this.setAttribute(n.name,i,n.itemSize)}for(let e=0;e<this.verticesIndices.length;e+=3){i.push(this.vertices[this.verticesIndices[e+0]*3+0],this.vertices[this.verticesIndices[e+0]*3+1],this.vertices[this.verticesIndices[e+0]*3+2]);r.push(s);s++;i.push(this.vertices[this.verticesIndices[e+1]*3+0],this.vertices[this.verticesIndices[e+1]*3+1],this.vertices[this.verticesIndices[e+1]*3+2]);r.push(s);s++;i.push(this.vertices[this.verticesIndices[e+2]*3+0],this.vertices[this.verticesIndices[e+2]*3+1],this.vertices[this.verticesIndices[e+2]*3+2]);r.push(s);s++}this.vertices=i;this.verticesIndices=[];if(e)this.verticesIndices=r;if(!t)this.calculateNormals()}calcBarycentric(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let i=0;for(let e=0;e<this.vertices.length;e+=3){t[e+i]=1;i++;if(i==3)i=0}this.setAttribute("attrBarycentric",t,3)}getBounds(){return new b(this)}center(e,t,i){if(e===undefined){e=true;t=true;i=true}let r=0;const s=this.getBounds();const n=[s.minX+(s.maxX-s.minX)/2,s.minY+(s.maxY-s.minY)/2,s.minZ+(s.maxZ-s.minZ)/2];for(r=0;r<this.vertices.length;r+=3){if(this.vertices[r+0]==this.vertices[r+0]){if(e)this.vertices[r+0]-=n[0];if(t)this.vertices[r+1]-=n[1];if(i)this.vertices[r+2]-=n[2]}}return n}mapTexCoords2d(){const t=this.getBounds();const i=this.vertices.length/3;this.texCoords=new Float32Array(i*2);for(let e=0;e<i;e++){const r=this.vertices[e*3+0];const s=this.vertices[e*3+1];this.texCoords[e*2+0]=r/(t.maxX-t.minX)+.5;this.texCoords[e*2+1]=1-s/(t.maxY-t.minY)+.5}}getInfoOneLine(){let e="";if(this.faceVertCount==3&&this.verticesIndices)e+=this.verticesIndices.length/3;else e+=0;e+=" tris ";if(this.vertices)e+=this.vertices.length/3;else e+=0;e+=" verts";return e}getInfo(){const e={};e.name=this.name;e.class=this.constructor.name;if(this.faceVertCount==3&&this.verticesIndices)e.numFaces=this.verticesIndices.length/3;else e.numFaces=0;if(this.verticesIndices&&this.verticesIndices.length)e.indices=this.verticesIndices.length;if(this.vertices)e.numVerts=this.vertices.length/3;else e.numVerts=0;if(this.vertexNormals)e.numNormals=this.vertexNormals.length/3;else e.numNormals=0;if(this.texCoords)e.numTexCoords=this.texCoords.length/2;else e.numTexCoords=0;if(this.tangents)e.numTangents=this.tangents.length/3;else e.numTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.vertexColors)e.numVertexColors=this.vertexColors.length/4;else e.numVertexColors=0;if(this.getAttributes())e.numAttribs=Object.keys(this.getAttributes()).length;else e.numAttribs=0;e.isIndexed=this.isIndexed();return e}}A.buildFromFaces=function(t,e,i){const r=[];const s=[];for(let e=0;e<t.length;e+=3){const a=t[e+0];const o=t[e+1];const l=t[e+2];const h=[-1,-1,-1];if(i)for(let e=0;e<r.length;e+=3){if(r[e+0]==a[0]&&r[e+1]==a[1]&&r[e+2]==a[2])h[0]=e/3;if(r[e+0]==o[0]&&r[e+1]==o[1]&&r[e+2]==o[2])h[1]=e/3;if(r[e+0]==l[0]&&r[e+1]==l[1]&&r[e+2]==l[2])h[2]=e/3}if(h[0]==-1){r.push(a[0],a[1],a[2]);h[0]=(r.length-1)/3}if(h[1]==-1){r.push(o[0],o[1],o[2]);h[1]=(r.length-1)/3}if(h[2]==-1){r.push(l[0],l[1],l[2]);h[2]=(r.length-1)/3}s.push(h[0]);s.push(h[1]);s.push(h[2])}const n=new A(e);n.name=e;n.vertices=r;n.verticesIndices=s;return n};const F={};F.getSimpleRect=function(e,t,i=1){const r=new A(t);r.vertices=[1*i,1*i,0,-1*i,1*i,0,1*i,-1*i,0,-1*i,-1*i,0];r.texCoords=[1,1,0,1,1,0,0,0];r.verticesIndices=[0,1,2,2,1,3];r.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0];return e.createMesh(r)};F.getSimpleCube=function(e,t){const i=new A(t);i.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];i.setTexCoords([0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0]);i.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];i.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);i.tangents=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);i.biTangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);return new E(e,i)};class C{constructor(e,t){this._cgl=e;this._log=new u.Logger("cgl_TextureEffect");if(!e.TextureEffectMesh)this.createMesh();this._textureSource=null;this._options=t;this.name=t.name||"unknown";this.imgCompVer=0;this.aspectRatio=1;this._textureTarget=null;this._frameBuf=this._cgl.gl.createFramebuffer();this._frameBuf2=this._cgl.gl.createFramebuffer();this._renderbuffer=this._cgl.gl.createRenderbuffer();this._renderbuffer2=this._cgl.gl.createRenderbuffer();this.switched=false;this.depth=false}dispose(){if(this._renderbuffer)this._cgl.gl.deleteRenderbuffer(this._renderbuffer);if(this._frameBuf)this._cgl.gl.deleteFramebuffer(this._frameBuf);if(this._renderbuffer2)this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);if(this._frameBuf2)this._cgl.gl.deleteFramebuffer(this._frameBuf2)}getWidth(){return this._textureSource.width}getHeight(){return this._textureSource.height}setSourceTexture(e){if(e===null){this._textureSource=new h(this._cgl);this._textureSource.setSize(16,16)}else{this._textureSource=e}if(!this._textureSource.compareSettings(this._textureTarget)){if(this._textureTarget)this._textureTarget.delete();this._textureTarget=this._textureSource.clone();this._cgl.profileData.profileEffectBuffercreate++;this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}this.aspectRatio=this._textureSource.width/this._textureSource.height}continueEffect(){this._cgl.pushDepthTest(false);this._cgl.pushModelMatrix();this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height);mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100);this._cgl.pushPMatrix();mat4.identity(this._cgl.pMatrix);this._cgl.pushViewMatrix();mat4.identity(this._cgl.vMatrix);this._cgl.pushModelMatrix();mat4.identity(this._cgl.mMatrix)}startEffect(e){if(!this._textureTarget){this._log.warn("effect has no target");return}this.switched=false;this.continueEffect();if(e){this._bgTex=e}this._countEffects=0}endEffect(){this._cgl.popDepthTest();this._cgl.popModelMatrix();this._cgl.popPMatrix();this._cgl.popModelMatrix();this._cgl.popViewMatrix();this._cgl.popPMatrix();this._cgl.popViewPort()}bind(){if(this._textureSource===null){this._log.warn("no base texture set!");return}if(!this.switched){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.pushGlFrameBuffer(this._frameBuf)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.pushGlFrameBuffer(this._frameBuf2)}}finish(){if(this._textureSource===null){this._log.warn("no base texture set!");return}this._cgl.TextureEffectMesh.render(this._cgl.getShader());this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.profileData.profileTextureEffect++;if(this._textureTarget.filter==h.FILTER_MIPMAP){if(!this.switched){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex);this._textureTarget.updateMipMap()}else{this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex);this._textureSource.updateMipMap()}this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}this.switched=!this.switched;this._countEffects++}getCurrentTargetTexture(){if(this.switched)return this._textureSource;return this._textureTarget}getCurrentSourceTexture(){if(this._countEffects==0&&this._bgTex)return this._bgTex;if(this.switched)return this._textureTarget;return this._textureSource}delete(){if(this._textureTarget)this._textureTarget.delete();if(this._textureSource)this._textureSource.delete();this._cgl.gl.deleteRenderbuffer(this._renderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuf)}createMesh(){this._cgl.TextureEffectMesh=F.getSimpleRect(this._cgl,"texEffectRect")}}C.checkOpNotInTextureEffect=function(e){if(!e.patch.cgl)return true;if(e.uiAttribs.error&&!e.patch.cgl.currentTextureEffect){e.setUiError("textureeffect",null);return true}if(!e.patch.cgl.currentTextureEffect)return true;if(e.patch.cgl.currentTextureEffect&&!e.uiAttribs.error){e.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0);return false}if(e.patch.cgl.currentTextureEffect)return false;return true};C.checkOpInEffect=function(e,t){t=t||0;if(e.patch.cgl.currentTextureEffect){if(e.uiAttribs.uierrors&&e.patch.cgl.currentTextureEffect.imgCompVer>=t){e.setUiError("texeffect",null);return true}if(t&&e.patch.cgl.currentTextureEffect.imgCompVer<t){e.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+t+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+e.id+"','"+e.name+"')\">Downgrade</span> to previous version",1)}}if(e.patch.cgl.currentTextureEffect)return true;if(!e.patch.cgl.currentTextureEffect&&(!e.uiAttribs.uierrors||e.uiAttribs.uierrors.length==0)){e.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://cables.gl/docs/image_composition/image_composition.html" target="_blank">here</a>. ',1);return false}if(!e.patch.cgl.currentTextureEffect)return false;return true};C.getBlendCode=function(e){let t="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();if(!e)t+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl();if(e>=3)t+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"#ifdef BM_MATH_ADD".endl()+"   return vec4(base.rgb+col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_SUB".endl()+"   return vec4(base.rgb-col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_MUL".endl()+"   return vec4(base.rgb*col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_DIV".endl()+"   return vec4(base.rgb/col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifndef BM_MATH".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"#endif".endl()+"}".endl();return t};C.onChangeBlendSelect=function(e,t,i=false){t=String(t);e.toggleDefine("BM_NORMAL",t=="normal");e.toggleDefine("BM_MULTIPLY",t=="multiply");e.toggleDefine("BM_MULTIPLY_INV",t=="multiply invert");e.toggleDefine("BM_AVERAGE",t=="average");e.toggleDefine("BM_ADD",t=="add");e.toggleDefine("BM_SUBTRACT_ONE",t=="subtract one");e.toggleDefine("BM_SUBTRACT",t=="subtract");e.toggleDefine("BM_DIFFERENCE",t=="difference");e.toggleDefine("BM_NEGATION",t=="negation");e.toggleDefine("BM_EXCLUSION",t=="exclusion");e.toggleDefine("BM_LIGHTEN",t=="lighten");e.toggleDefine("BM_DARKEN",t=="darken");e.toggleDefine("BM_OVERLAY",t=="overlay");e.toggleDefine("BM_SCREEN",t=="screen");e.toggleDefine("BM_SOFTLIGHT",t=="softlight");e.toggleDefine("BM_HARDLIGHT",t=="hardlight");e.toggleDefine("BM_COLORDODGE",t=="color dodge");e.toggleDefine("BM_COLORBURN",t=="color burn");e.toggleDefine("BM_MATH_ADD",t=="Math Add");e.toggleDefine("BM_MATH_SUB",t=="Math Subtract");e.toggleDefine("BM_MATH_MUL",t=="Math Multiply");e.toggleDefine("BM_MATH_DIV",t=="Math Divide");e.toggleDefine("BM_MATH",t.indexOf("Math ")==0);e.toggleDefine("BM_ALPHAMASKED",i)};C.AddBlendSelect=function(e,t,i){const r=e.inValueSelect(t||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one","Math Add","Math Subtract","Math Multiply","Math Divide"],i||"normal");return r};C.AddBlendAlphaMask=function(e,t,i){const r=e.inSwitch(t||"Alpha Mask",["Off","On"],i||"Off");return r};C.setupBlending=function(i,r,s,e,n){const t=()=>{let e=false;if(n)e=n.get()=="On";C.onChangeBlendSelect(r,s.get(),e);let t=s.get();if(t=="normal")t=null;else if(t=="multiply")t="mul";else if(t=="multiply invert")t="mulinv";else if(t=="lighten")t="light";else if(t=="darken")t="darken";else if(t=="average")t="avg";else if(t=="subtract one")t="sub one";else if(t=="subtract")t="sub";else if(t=="difference")t="diff";else if(t=="negation")t="neg";else if(t=="exclusion")t="exc";else if(t=="overlay")t="ovl";else if(t=="color dodge")t="dodge";else if(t=="color burn")t="burn";else if(t=="softlight")t="soft";else if(t=="hardlight")t="hard";else if(t=="Math Add")t="+";else if(t=="Math Subtract")t="-";else if(t=="Math Multiply")t="*";else if(t=="Math Divide")t="/";i.setUiAttrib({extendTitle:t})};i.setPortGroup("Blending",[s,e,n]);let a=false;s.onChange=t;if(n){n.onChange=t;a=n.get()=="On"}C.onChangeBlendSelect(r,s.get(),a)};const D={"CGL.BLENDMODES":function(){this.name="blendmodes";this.srcHeadFrag=C.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3";this.srcHeadFrag=C.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance";this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex";this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}";this.initUniforms=function(e){return[new c(e,"t","CGLRNDTEX",7)]};this.onBind=function(e,t){h.getRandomTexture(e);e.setTexture(7,h.getRandomTexture(e).tex)}}};class y{constructor(e){this.shader=new CGL.Shader(e,"markermaterial");const t="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}";const i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,t);this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(e,t,i,r){this.coloruni.set(e,t,i,r)}}class w extends u.Events{id=v.utils.simpleId();_isValid=true;_defines=[];_moduleNames=[];_moduleNumId=0;_needsRecompile=true;_compileReason="initial";_modules=[];_compileCount=0;logError=true;num=-1;lastCompile=0;constructor(){super()}setWhyCompile(e){this._compileReason=e;this._needsRecompile=true}getWhyCompile(){return this._compileReason}needsRecompile(){return this._needsRecompile}removeUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName()==t){this._uniforms.splice(e,1)}}this.setWhyCompile("remove uniform "+t)}hasUniformInStage(t,e){let i=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)i=this.defaultUniBindingVert;if(e==GPUShaderStage.COMPUTE)i=this.defaultUniBindingCompute;for(let e=0;e<this._uniforms.length;e++){console.log("hasuniiiiiiiiiiiiiii",this._uniforms[e].getName(),t);if(this._uniforms[e].getName()==t)return true}return false}hasUniform(e){}toggleDefine(t,e){if(e&&typeof e=="object"&&e.addEventListener){if(e.changeListener)e.off(e.changeListener);e.onToggleDefine=e=>{this.toggleDefine(t,e)};e.changeListener=e.on("change",e.onToggleDefine);e=e.get()}if(e)this.define(t);else this.removeDefine(t)}define(t,i=""){if(i===null||i===undefined)i="";if(typeof i=="object"){i.removeEventListener("change",i.onDefineChange);i.onDefineChange=e=>{this.define(t,e)};i.on("change",i.onDefineChange);i=i.get()}for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t&&this._defines[e][1]==i)return;if(this._defines[e][0]==t){this._defines[e][1]=i;this.setWhyCompile("define "+t+" "+i);return}}this.setWhyCompile("define "+t+" "+i);this._defines.push([t,i])}getDefines(){return this._defines}getDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null}hasDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return true}removeDefine(t){for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t){this._defines.splice(e,1);this.setWhyCompile("define removed:"+t);return}}}hasModule(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return true;return false}setModules(e){this._moduleNames=e}removeModule(i){for(let e=0;e<this._modules.length;e++){if(i&&i.id){if(this._modules[e].id==i.id||!this._modules[e]){let t=true;while(t){t=false;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName().startsWith(i.prefix)){this._uniforms.splice(e,1);t=true;continue}}}this.setWhyCompile("remove module "+i.title);this._modules.splice(e,1);break}}}}getNumModules(){return this._modules.length}getCurrentModules(){return this._modules}addModule(e,t){if(this.hasModule(e.id))return;if(!e.id)e.id=v.utils.simpleId();if(!e.numId)e.numId=this._moduleNumId;if(!e.num)e.num=this._modules.length;if(t&&!t.group)t.group=v.utils.simpleId();if(!e.group)if(t)e.group=t.group;else e.group=v.utils.simpleId();e.prefix="mod"+e.group+"_";this._modules.push(e);this.setWhyCompile("add module "+e.title);this._moduleNumId++;return e}isValid(){return this._isValid}}const U=`
{{MODULES_HEAD}}
IN vec3 vPosition; //!@
IN vec2 attrTexCoord;
IN vec3 attrVertNormal;
IN vec3 attrTangent,attrBiTangent;

IN float attrVertIndex;

OUT vec2 texCoord;
OUT vec3 norm;
UNI mat4 projMatrix;
UNI mat4 viewMatrix;
UNI mat4 modelMatrix;

void main()
{
    texCoord=attrTexCoord;
    norm=attrVertNormal;
    vec4 pos=vec4(vPosition,  1.0);
    vec3 tangent=attrTangent;
    vec3 bitangent=attrBiTangent;
    mat4 mMatrix=modelMatrix;
    gl_PointSize=10.0;

    {{MODULE_VERTEX_POSITION}}

    mat4 modelViewMatrix=viewMatrix*mMatrix;
    {{MODULE_VERTEX_MODELVIEW}}

    gl_Position = projMatrix * modelViewMatrix * pos;
}
`;let k=0;function B(){return U}function S(e,t,i){if(e==undefined){e=.5;t=.5;i=.5}return""+x+"IN vec2 texCoord;"+x+"{{MODULES_HEAD}}"+x+"void main()"+x+"{"+x+"    vec4 col=vec4("+e+","+t+","+i+",1.0);"+x+"    {{MODULE_COLOR}}"+x+"    outColor = col;"+x+"}"}class I extends w{_uniforms=[];constructor(e,t,i){super();if(!e)throw new Error("shader constructed without cgl "+t);this._log=new u.Logger("cgl_shader");this._cgl=e;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";if(i)this.opId=i.id;this.glslVersion=0;if(e.glVersion>1)this.glslVersion=300;this._materialId=++k;this._program=null;this._drawBuffers=[true];this.error=null;this.ignoreMissingUniforms=false;this._projMatrixUniform=null;this._mvMatrixUniform=null;this._mMatrixUniform=null;this._vMatrixUniform=null;this._camPosUniform=null;this._normalMatrixUniform=null;this._inverseViewMatrixUniform=null;this._fromUserInteraction=false;this._attrVertexPos=-1;this.precision=e.patch.config.glslPrecision||"highp";this._pMatrixState=-1;this._vMatrixState=-1;this._countMissingUniforms=0;this._modGroupCount=0;this._feedBackNames=[];this._attributes=[];this.glPrimitive=null;this.offScreenPass=false;this._extensions=[];this.srcVert=B();this.srcFrag=S();this.lastCompile=0;this._libs=[];this._structNames=[];this._structUniformNames=[];this._textureStackUni=[];this._textureStackTex=[];this._textureStackType=[];this._textureStackTexCgl=[];this._tempNormalMatrix=L.mat4.create();this._tempCamPosMatrix=L.mat4.create();this._tempInverseViewMatrix=L.mat4.create();this._tempInverseProjMatrix=L.mat4.create();this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_NORMAL","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"])}isValid(){return this._isValid}getCgl(){return this._cgl}getName(){return this._name}enableExtension(e){this.setWhyCompile("enable extension "+e);this._extensions.push(e)}getAttrVertexPos(){return this._attrVertexPos}hasTextureUniforms(){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getType()=="t")return true;return false}copyUniformValues(t){for(let e=0;e<t._uniforms.length;e++){if(!this._uniforms[e]){this._log.log("unknown uniform?!");continue}this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())}this.popTextures();for(let e=0;e<t._textureStackUni.length;e++){this._textureStackUni[e]=t._textureStackUni[e];this._textureStackTex[e]=t._textureStackTex[e];this._textureStackType[e]=t._textureStackType[e];this._textureStackTexCgl[e]=t._textureStackTexCgl[e]}}copy(){const t=new I(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._modGroupCount=this._modGroupCount;t._moduleNames=this._moduleNames;t.glPrimitive=this.glPrimitive;t.offScreenPass=this.offScreenPass;t._extensions=this._extensions;t.wireframe=this.wireframe;t._attributes=this._attributes;for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e].copy(t);i.resetLoc()}t.setWhyCompile("copy");return t}setSource(e,t,i=false){this._fromUserInteraction=i;this.srcVert=e;this.srcFrag=t;this.setWhyCompile("Source changed");this._isValid=true}_addLibs(e){for(const t in D){if(e.includes(t)){const i=new D[t];e=e.replace("{{"+t+"}}",i.srcHeadFrag);this._libs.push(i);if(i.initUniforms)i.initUniforms(this)}}return e}createStructUniforms(){let r="";let s="";this._structNames=[];this._injectedStringsFrag={};this._injectedStringsVert={};this._structUniformNamesIndicesFrag=[];this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].isStructMember()){const n="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(!this._structNames.includes(this._uniforms[i]._structName)){const a="struct "+this._uniforms[i]._structName+" {"+x+n+"};"+x+x;if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="frag")r=r.concat(a);if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="vert")s=s.concat(a);this._structNames.push(this._uniforms[i]._structName);this._injectedStringsFrag[this._uniforms[i]._structName]=[];this._injectedStringsVert[this._uniforms[i]._structName]=[]}let e="";if(this._uniforms[i].comment)e=" // "+this._uniforms[i].comment;let t="";if(this._uniforms[i].getGlslTypeString()==undefined)t+="//";t+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+e;if(this._uniforms[i].getShaderType()==="both"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)&&!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const o=r.lastIndexOf(n);const l=s.lastIndexOf(n);r=r.slice(0,o)+t+r.slice(o-1);s=s.slice(0,l)+t+s.slice(l-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i);if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}else if(this._uniforms[i].getShaderType()==="frag"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)){const o=r.lastIndexOf(n);r=r.slice(0,o)+t+r.slice(o-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i)}else if(this._uniforms[i].getShaderType()==="vert"){if(!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const l=s.lastIndexOf(n);s=s.slice(0,l)+t+s.slice(l-1);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}}}this._uniDeclarationsFrag=[];this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const t=this._structUniformNamesIndicesFrag[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+x;if(!this._uniDeclarationsFrag.includes(i)){const n="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";r=r.replace(n,"");r+=i;this._uniDeclarationsFrag.push(i)}}for(let e=0;e<this._structUniformNamesIndicesVert.length;e+=1){const t=this._structUniformNamesIndicesVert[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+x;if(!this._uniDeclarationsVert.includes(i)){const n="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";s=s.replace(n,"");s+=i;this._uniDeclarationsVert.push(i)}}return[s,r]}_getAttrSrc(e,t){const i={};if(e.name&&e.type){i.srcHeadVert="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.name+x;i.srcHeadVert+="#define ATTRIB_"+e.name+x;i.srcHeadVert+="IN "+e.type+" "+e.name+";"+x;if(!t)i.srcHeadVert+="#endif"+x;if(e.nameFrag){i.srcHeadVert+="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.nameFrag+x;i.srcHeadVert+="#define ATTRIB_"+e.nameFrag+x;i.srcHeadVert+="OUT "+e.type+" "+e.nameFrag+";"+x;if(!t)i.srcHeadVert+="#endif"+x;i.srcVert=""+x+e.nameFrag+"="+e.name+";";i.srcHeadFrag="";if(!t)i.srcHeadFrag+="#ifndef ATTRIB_"+e.nameFrag+x;i.srcHeadFrag+="#define ATTRIB_"+e.nameFrag+x;i.srcHeadFrag+="IN "+e.type+" "+e.nameFrag+";"+x;if(!t)i.srcHeadFrag+="#endif"+x}}return i}compile(){if(this._cgl.aborted)return;const e=performance.now();this._cgl.profileData.profileShaderCompiles++;this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let t="";if(this._extensions)for(let e=0;e<this._extensions.length;e++)t+="#extension "+this._extensions[e]+" : enable"+x;let i="";if(this._defines.length)i="\n// cgl generated"+x;for(let e=0;e<this._defines.length;e++)i+="#define "+this._defines[e][0]+" "+this._defines[e][1]+""+x;const r=this.createStructUniforms();this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]");this._compileReason="";if(this._uniforms){const m=this._uniforms.map(e=>{return e._name});const _=[];for(let e=0;e<this._uniforms.length;e++){const E=this._uniforms[e];const b=m.indexOf(E._name,e+1);if(b>-1)_.push(e)}for(let e=this._uniforms.length-1;e>=0;e-=1){if(_.includes(e))this._uniforms.splice(e,1);else this._uniforms[e].resetLoc()}}this._cgl.printError("uniform resets");this._compileCount++;if(this.hasTextureUniforms())i+="#define HAS_TEXTURES"+x;let s="";let n="";if(!this.srcFrag){this._log.warn("[cgl shader] has no fragment source!",this._name,this);this.srcVert=B();this.srcFrag=S()}s="#version 300 es"+x+"// "+x+"// vertex shader "+this._name+x+"// "+x+"precision "+this.precision+" float;"+x+"precision "+this.precision+" sampler2D;"+x+""+x+"#define WEBGL2"+x+"#define texture2D texture"+x+"#define UNI uniform"+x+"#define IN in"+x+"#define OUT out"+x;n="#version 300 es"+x+"// "+x+"// fragment shader "+this._name+x+"// "+x+"precision "+this.precision+" float;"+x+"precision "+this.precision+" sampler2D;"+x+""+x+"#define WEBGL2"+x+"#define texture2D texture"+x+"#define IN in"+x+"#define OUT out"+x+"#define UNI uniform"+x+"{{DRAWBUFFER}}"+x;let a="\n// cgl generated"+x;let o="\n// cgl generated"+x;n+="\n// active mods: --------------- ";s+="\n// active mods: --------------- ";let l=false;let h=false;for(let t=0;t<this._moduleNames.length;t++){for(let e=0;e<this._modules.length;e++){if(this._modules[e].name==this._moduleNames[t]){if(this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag){l=true;n+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"}if(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert){s+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")";h=true}}}}if(!h)n+="\n// no mods used...";if(!l)n+="\n// no mods used...";n+="\n";s+="\n";for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].shaderType&&!this._uniforms[i].isStructMember()){let e="";if(!this._uniforms[i].getGlslTypeString())e+="// ";e+="UNI "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName();let t="";if(this._uniforms[i].comment)t=" // "+this._uniforms[i].comment;if(this._uniforms[i].shaderType=="vert"||this._uniforms[i].shaderType=="both")if(!this.srcVert.includes(e)&&!this.srcVert.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))a+=e+";"+t+x;if(this._uniforms[i].shaderType=="frag"||this._uniforms[i].shaderType=="both")if(!this.srcFrag.includes(e)&&!this.srcFrag.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))o+=e+";"+t+x}}let u=0;let c=0;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].shaderType&&!this._uniforms[e].isStructMember()){if(this._uniforms[e].shaderType=="vert"||this._uniforms[e].shaderType=="both")c++;if(this._uniforms[e].shaderType=="frag"||this._uniforms[e].shaderType=="both")u++}}if(u>=this._cgl.maxUniformsFrag)this._log.warn("[cgl_shader] num uniforms frag: "+u+" / "+this._cgl.maxUniformsFrag);if(c>=this._cgl.maxUniformsVert)this._log.warn("[cgl_shader] num uniforms vert: "+c+" / "+this._cgl.maxUniformsVert);if(!n.includes("precision"))n="precision "+this.precision+" float;"+x+n;if(!s.includes("precision"))s="precision "+this.precision+" float;"+x+s;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){n+="#define MOBILE"+x;s+="#define MOBILE"+x}s=t+s+i+r[0]+a+"\n// -- \n"+this.srcVert;n=t+n+i+r[1]+o+"\n// -- \n"+this.srcFrag;let g="";let f="";this._modules.sort(function(e,t){return e.priority||0-t.priority||0});let d=false;for(let r=0;r<this._moduleNames.length;r++){let t="";let i="";if(!d){d=true;for(let e=0;e<this._attributes.length;e++){const A=this._getAttrSrc(this._attributes[e],true);if(A.srcHeadVert)g+=A.srcHeadVert;if(A.srcVert)t+=A.srcVert;if(A.srcHeadFrag)f+=A.srcHeadFrag}}for(let e=0;e<this._modules.length;e++){const F=this._modules[e];if(F.name==this._moduleNames[r]){g+="\n//---- MOD: group:"+F.group+": idx:"+e+" - prfx:"+F.prefix+" - "+F.title+" ------\n";f+="\n//---- MOD: group:"+F.group+": idx:"+e+" - prfx:"+F.prefix+" - "+F.title+" ------\n";t+="\n\n//---- MOD: "+F.title+" / "+F.priority+" ------\n";i+="\n\n//---- MOD: "+F.title+" / "+F.priority+" ------\n";if(F.attributes)for(let e=0;e<F.attributes.length;e++){const A=this._getAttrSrc(F.attributes[e],false);if(A.srcHeadVert)g+=A.srcHeadVert;if(A.srcVert)t+=A.srcVert;if(A.srcHeadFrag)f+=A.srcHeadFrag}g+=F.srcHeadVert||"";f+=F.srcHeadFrag||"";t+=F.srcBodyVert||"";i+=F.srcBodyFrag||"";g+="\n//---- end mod ------\n";f+="\n//---- end mod ------\n";t+="\n//---- end mod ------\n";i+="\n//---- end mod ------\n";t=t.replace(/{{mod}}/g,F.prefix);i=i.replace(/{{mod}}/g,F.prefix);g=g.replace(/{{mod}}/g,F.prefix);f=f.replace(/{{mod}}/g,F.prefix);t=t.replace(/MOD_/g,F.prefix);i=i.replace(/MOD_/g,F.prefix);g=g.replace(/MOD_/g,F.prefix);f=f.replace(/MOD_/g,F.prefix)}}s=s.replace("{{"+this._moduleNames[r]+"}}",t);n=n.replace("{{"+this._moduleNames[r]+"}}",i)}s=s.replace("{{MODULES_HEAD}}",g);n=n.replace("{{MODULES_HEAD}}",f);s=this._addLibs(s);n=this._addLibs(n);let p="";for(let e=0;e<16;e++)if(n.includes("outColor"+e))this._drawBuffers[e]=true;if(this._drawBuffers.length==1){p="out vec4 outColor;"+x;p+="#define gl_FragColor outColor"+x}else{p+="#define MULTI_COLORTARGETS"+x;p+="vec4 outColor;"+x;let t=0;for(let e=0;e<this._drawBuffers.length;e++){if(t==0)p+="#define gl_FragColor outColor"+e+""+x;p+="layout(location = "+e+") out vec4 outColor"+e+";"+x;t++}}n=n.replace("{{DRAWBUFFER}}",p);if(!this._program){this._program=this._createProgram(s,n)}else{this._program=this._createProgram(s,n);this._projMatrixUniform=null;for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].resetLoc()}this.finalShaderFrag=n;this.finalShaderVert=s;T.lastMesh=null;T.lastShader=null;this._countMissingUniforms=0;this._needsRecompile=false;this.lastCompile=(0,v.now)();this._cgl.profileData.shaderCompileTime+=performance.now()-e}bind(){if(!this._isValid||this._cgl.aborted)return;T.lastShader=this;if(!this._program||this.needsRecompile())this.compile();if(!this._isValid)return;if(!this._projMatrixUniform&&!this.ignoreMissingUniforms){this._countMissingUniforms++;if(this._countMissingUniforms<10){this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,m.SHADER.SHADERVAR_UNI_PROJMAT);this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,m.SHADER.SHADERVAR_VERTEX_POSITION);this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix");this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,m.SHADER.SHADERVAR_UNI_VIEWMAT);this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,m.SHADER.SHADERVAR_UNI_MODELMAT);this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,m.SHADER.SHADERVAR_UNI_VIEWPOS);this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,m.SHADER.SHADERVAR_UNI_NORMALMAT);this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,m.SHADER.SHADERVAR_UNI_INVVIEWMAT);this._inverseProjMatrixUniform=this._cgl.gl.getUniformLocation(this._program,m.SHADER.SHADERVAR_UNI_INVPROJMAT);this._materialIdUniform=this._cgl.gl.getUniformLocation(this._program,m.SHADER.SHADERVAR_UNI_MATERIALID);this._objectIdUniform=this._cgl.gl.getUniformLocation(this._program,m.SHADER.SHADERVAR_UNI_OBJECTID);for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].needsUpdate=true}}if(this._cgl.currentProgram!=this._program){this._cgl.profileData.profileShaderBinds++;this._cgl.gl.useProgram(this._program);this._cgl.currentProgram=this._program}for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].needsUpdate)this._uniforms[e].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()){this._pMatrixState=this._cgl.getProjectionMatrixStateCount();this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,false,this._cgl.pMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._objectIdUniform)this._cgl.gl.uniform1f(this._objectIdUniform,++this._cgl.tempData.objectIdCounter);if(this._materialIdUniform)this._cgl.gl.uniform1f(this._materialIdUniform,this._materialId);if(this._vMatrixUniform){if(this._vMatrixState!=this._cgl.getViewMatrixStateCount()){this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,false,this._cgl.vMatrix);this._cgl.profileData.profileMVPMatrixCount++;this._vMatrixState=this._cgl.getViewMatrixStateCount();if(this._inverseViewMatrixUniform){L.mat4.invert(this._tempInverseViewMatrix,this._cgl.vMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,false,this._tempInverseViewMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._inverseProjMatrixUniform){L.mat4.invert(this._tempInverseProjMatrix,this._cgl.pMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform,false,this._tempInverseProjMatrix);this._cgl.profileData.profileMVPMatrixCount++}}this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,false,this._cgl.mMatrix);this._cgl.profileData.profileMVPMatrixCount++;if(this._camPosUniform){L.mat4.invert(this._tempCamPosMatrix,this._cgl.vMatrix);this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]);this._cgl.profileData.profileMVPMatrixCount++}}else{const e=L.mat4.create();L.mat4.mul(e,this._cgl.vMatrix,this._cgl.mMatrix);this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,false,e);this._cgl.profileData.profileMVPMatrixCount++}if(this._normalMatrixUniform){L.mat4.invert(this._tempNormalMatrix,this._cgl.mMatrix);L.mat4.transpose(this._tempNormalMatrix,this._tempNormalMatrix);this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,false,this._tempNormalMatrix);this._cgl.profileData.profileMVPMatrixCount++}for(let e=0;e<this._libs.length;e++){if(this._libs[e].onBind)this._libs[e].onBind.bind(this._libs[e])(this._cgl,this)}this._bindTextures();return this._isValid}unBind(){}dispose(){if(this._program&&this._cgl&&this._cgl.gl)this._cgl.gl.deleteProgram(this._program);this._program=null}setDrawBuffers(e){this._log.warn("useless drawbuffers...?!")}getUniforms(){return this._uniforms}getUniform(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null}removeAllUniforms(){this._uniforms=[]}_addUniform(e){this._uniforms.push(e);this.setWhyCompile("add uniform "+name)}addUniformFrag(e,t,i,r,s,n){const a=new c(this,e,t,i,r,s,n);a.shaderType="frag";return a}addUniformVert(e,t,i,r,s,n){const a=new c(this,e,t,i,r,s,n);a.shaderType="vert";return a}addUniformBoth(e,t,i,r,s,n){const a=new c(this,e,t,i,r,s,n);a.shaderType="both";return a}addUniformStructFrag(t,i,r){const s={};if(!r)return s;for(let e=0;e<r.length;e+=1){const n=r[e];if(!this.hasUniform(i+"."+n.name)){const a=new c(this,n.type,i+"."+n.name,n.v1,n.v2,n.v3,n.v4,i,t,n.name);a.shaderType="frag";s[i+"."+n.name]=a}}return s}addUniformStructVert(t,i,r){const s={};if(!r)return s;for(let e=0;e<r.length;e+=1){const n=r[e];if(!this.hasUniform(i+"."+n.name)){const a=new c(this,n.type,i+"."+n.name,n.v1,n.v2,n.v3,n.v4,i,t,n.name);a.shaderType="vert";s[i+"."+n.name]=a}}return s}addUniformStructBoth(t,i,r){const s={};if(!r)return s;for(let e=0;e<r.length;e+=1){const n=r[e];if(n.type==="2i"||n.type==="i"||n.type==="3i")this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",n.name," of type:",n.type,".");if(!this.hasUniform(i+"."+n.name)){const a=new c(this,n.type,i+"."+n.name,n.v1,n.v2,n.v3,n.v4,i,t,n.name);a.shaderType="both";s[i+"."+n.name]=a}}return s}_createProgram(e,t){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();this.vshader=I.createShader(this._cgl,e,this._cgl.gl.VERTEX_SHADER,this);this.fshader=I.createShader(this._cgl,t,this._cgl.gl.FRAGMENT_SHADER,this);if(this.vshader&&this.fshader){this._cgl.gl.attachShader(i,this.vshader);this._cgl.gl.attachShader(i,this.fshader);this._linkProgram(i,e,t)}else{this._isValid=false;this._cgl.printError("shader _createProgram");this._log.error("could not link shaderprogram");return null}this._cgl.printError("shader _createProgram");return i}hasErrors(){return this._hasErrors}_linkProgram(e,t,i){this._cgl.printError("before _linkprogram");if(this._feedBackNames.length>0){this._cgl.gl.transformFeedbackVaryings(e,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS)}this._cgl.gl.linkProgram(e);this._cgl.printError("gl.linkprogram");this._isValid=true;this._hasErrors=false;if(this._cgl.patch.config.glValidateShader!==false){this._cgl.gl.validateProgram(e);if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.VALIDATE_STATUS)){this._log.log("shaderprogram validation failed...");this._cgl.gl.getProgramInfoLog(e)}if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.LINK_STATUS)){this._hasErrors=true;const r=this._cgl.gl.getShaderInfoLog(this.fshader);const s=this._cgl.gl.getShaderInfoLog(this.vshader);if(this.logError)this._log.error(this._name+" shader linking fail...");else this._log.warn(this._name+" shader linking fail...");if(r)this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));if(s)this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));this._cgl.gl.getProgramInfoLog(e);if(!CABLES.UI)this._log.log(this);this._isValid=false;this._cgl.printError("shader link err")}}}getProgram(){return this._program}setFeedbackNames(e){this.setWhyCompile("setFeedbackNames");this._feedBackNames=e}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t);this.setWhyCompile("addAttribute")}bindTextures(){this._bindTextures()}_bindTextures(){if(this._textureStackTex.length>this._cgl.maxTextureUnits){this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits)}for(let i=0;i<this._textureStackTex.length;i++){if(!this._textureStackTex[i]&&!this._textureStackTexCgl[i]){this._log.warn("no texture for pushtexture",this._name)}else{let e=this._textureStackTex[i];if(this._textureStackTexCgl[i]){e=this._textureStackTexCgl[i].tex||CGL.Texture.getEmptyTexture(this._cgl).tex}let t=true;if(!this._textureStackUni[i]){this._log.warn("no uniform for pushtexture",this._name);t=this._cgl.setTexture(i,e,this._textureStackType[i])}else{this._textureStackUni[i].setValue(i);t=this._cgl.setTexture(i,e,this._textureStackType[i])}if(!t)this._log.warn("tex bind failed",this.getName(),this._textureStackUni[i])}}}setUniformTexture(t,i){i=i||h.getTempTexture(this._cgl);for(let e=0;e<this._textureStackUni.length;e++)if(this._textureStackUni[e]==t){const r=this._textureStackTex[e]||this._textureStackTexCgl[e];if(i.hasOwnProperty("tex")){this._textureStackTexCgl[e]=i;this._textureStackTex[e]=null}else{this._textureStackTexCgl[e]=null;this._textureStackTex[e]=i}return r}return null}pushTexture(e,t,i){if(!e){return}if(!t){return}if(!t.hasOwnProperty("tex")&&!(t instanceof WebGLTexture)){this._log.warn(new Error("invalid texture").stack);this._log.warn("[cgl_shader] invalid texture...",t);return}this._textureStackUni.push(e);if(t.hasOwnProperty("tex")){this._textureStackTexCgl.push(t);this._textureStackTex.push(null)}else{this._textureStackTexCgl.push(null);this._textureStackTex.push(t)}this._textureStackType.push(i)}popTexture(){this._textureStackUni.pop();this._textureStackTex.pop();this._textureStackTexCgl.pop();this._textureStackType.pop()}popTextures(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0}getMaterialId(){return this._materialId}getInfo(){const e={};e.name=this._name;e.defines=this.getDefines();e.hasErrors=this.hasErrors();return e}getDefaultFragmentShader(e,t,i,r){return S(e,t,i,r)}getDefaultVertexShader(){return B()}}I.getDefaultVertexShader=B;I.getDefaultFragmentShader=S;I.getErrorFragmentShader=function(){return""+x+"void main()"+x+"{"+x+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"+x+"   g= step(0.1,g);"+x+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"+x+"}"};I.createShader=function(e,t,i,r){if(e.aborted)return;const s=e.gl.createShader(i);e.gl.shaderSource(s,t);e.gl.compileShader(s);if(!e.gl.getShaderParameter(s,e.gl.COMPILE_STATUS)){r.error={str:t,infoLog:e.gl.getShaderInfoLog(s)};if(CABLES.UI)gui.emitEvent("ShaderError",r);if(!r.error.infoLog){r._log.warn("empty shader info log",this._name);return}r.setSource(I.getDefaultVertexShader(),I.getErrorFragmentShader())}return s};const V=Math.PI/180;const G=180/Math.PI;const j=null;const z=window.navigator.userAgent.includes("Windows");const M=function(t){let i;if(t.wheelDelta){i=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30;i*=-1.5;if(z)i*=2}else{let e=t.deltaY;if(t.shiftKey)e=t.deltaX;const r=e||t.detail;i=-(r%3?r*10:r/3);i*=-3}if(i>20)i=20;if(i<-20)i=-20;return i};const H=M;const W=M;class R{constructor(e){this._cgl=e;this._lastTime=0;this.pause=false;this.profileUniformCount=0;this.profileShaderBinds=0;this.profileUniformCount=0;this.profileShaderCompiles=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileEffectBuffercreate=0;this.profileShaderGetUniform=0;this.profileFrameBuffercreate=0;this.profileMeshSetGeom=0;this.profileTextureNew=0;this.profileGenMipMap=0;this.profileOnAnimFrameOps=0;this.profileFencedPixelRead=0;this.profileMainloopMs=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.shaderCompileTime=0;this.profileMeshNumElements=0;this.profileMeshAttributes=0;this.profileSingleMeshAttribute=[];this.heavyEvents=[];this.doProfileGlQuery=false;this.glQueryData={};this.counts={}}clear(){this.counts={};this.profileSingleMeshAttribute={};this.profileMeshAttributes=0;this.profileUniformCount=0;this.profileShaderGetUniform=0;this.profileShaderCompiles=0;this.profileShaderBinds=0;this.profileTextureResize=0;this.profileFrameBuffercreate=0;this.profileEffectBuffercreate=0;this.profileTextureDelete=0;this.profileMeshSetGeom=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileNonTypedAttrib=0;this.profileNonTypedAttribNames="";this.profileTextureNew=0;this.profileGenMipMap=0;this.profileFramebuffer=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.profileMeshNumElements=0;this.profileFencedPixelRead=0}clearGlQuery(){for(let e in this.glQueryData){if(!this.glQueryData[e].lastClear||performance.now()-this.glQueryData[e].lastClear>1e3){this.glQueryData[e].time=this.glQueryData[e]._times/this.glQueryData[e]._numcount;this.glQueryData[e].num=this.glQueryData[e]._numcount;this.glQueryData[e]._times=0;this.glQueryData[e]._numcount=0;this.glQueryData[e].lastClear=performance.now()}}}count(e,t){this.counts[e]=this.counts[e]||[];this.counts[e].push(t)}addHeavyEvent(e,t,i){const r={event:e,name:t,info:i,date:performance.now()};this.heavyEvents.push(r);this._cgl.emitEvent("heavyEvent",r)}}class O{constructor(){this._arr=[L.mat4.create()];this._index=0;this.stateCounter=0}push(e){this._index++;this.stateCounter++;if(this._index==this._arr.length){const t=L.mat4.create();this._arr.push(t)}L.mat4.copy(this._arr[this._index],e||this._arr[this._index-1]);return this._arr[this._index]}pop(){this.stateCounter++;this._index--;if(this._index<0)this._index=0;return this._arr[this._index]}length(){return this._index}}class Y{hasFocus=false;forceAspect=0;pixelDensity=1;_oldWidthRp=-1;_oldHeightRp=-1;constructor(e){this._log=new u.Logger("CgCanvas");if(!e){this._log.error("CgCanvas no options")}else{this._canvasEle=e.canvasEle}if(!e.cg)this._log.error("CgCanvas options has no cg");this._cg=e.cg;if(this.canvasEle){this.canvasWidth=this.canvasEle.clientWidth;this.canvasHeight=this.canvasEle.clientHeight;this.setSize(this.canvasWidth,this.canvasHeight);this.canvasEle.addEventListener("focus",()=>{this.hasFocus=true});this.canvasEle.addEventListener("blur",()=>{this.hasFocus=false})}}get canvasEle(){return this._canvasEle}setSize(t,i,e=false){let r=0;if(this.forceAspect){let e=t/this.forceAspect;if(e<i)r=(i-e)/2;i=e}if(this._oldWidthRp!=t*this.pixelDensity||this._oldHeightRp!=i*this.pixelDensity){this._oldWidthRp=this.canvasEle.width=t*this.pixelDensity;this._oldHeightRp=this.canvasEle.height=i*this.pixelDensity;if(!e){this.canvasEle.style.width=t+"px";this.canvasEle.style.height=i+"px";this.canvasEle.style.marginTop=r+"px"}this.updateSize();this._cg.emitEvent("resize")}}updateSize(){this.canvasEle.width=this.canvasWidth=Math.ceil(this.canvasEle.clientWidth*this.pixelDensity);this.canvasEle.height=this.canvasHeight=Math.ceil(this.canvasEle.clientHeight*this.pixelDensity)}dispose(){if(this._canvasEle)this._canvasEle.remove();this._canvasEle=null}}class X extends u.Events{#timeStartFrame=0;#timeStartSecond=0;#fpsCounter=0;#msCounter=0;#frameCount=0;logFps=false;constructor(){super();this.stats={ms:0,fps:0}}get frameCount(){return this.#frameCount}startFrame(){this.#timeStartFrame=(0,v.now)()}endFrame(){this.#frameCount++;this.#fpsCounter++;const e=(0,v.now)()-this.#timeStartFrame;this.#msCounter+=e;if((0,v.now)()-this.#timeStartSecond>1e3)this.endSecond()}endSecond(){this.stats.fps=this.#fpsCounter;this.stats.ms=Math.round(this.#msCounter/this.#fpsCounter*100)/100;this.emitEvent("performance",this.stats);if(this.logFps)console.log(this.stats);this.#fpsCounter=0;this.#msCounter=0;this.#timeStartSecond=(0,v.now)()}}class P extends u.Events{static API_UNKNOWN=0;static API_WEBGL=1;static API_WEBGPU=2;static EVENT_RESIZE="resize";gApi=0;_textureslots=[];_pMatrixStack=new O;_mMatrixStack=new O;_vMatrixStack=new O;canvasScale=1;constructor(e){super();this._log=new u.Logger("cg_context",{onError:e.config.onError});this.tempData=this.frameStore=this.frameStore||{};this.fpsCounter=new X;this._identView=L.vec3.create();this._ident=L.vec3.create();L.vec3.set(this._identView,0,0,-2);L.vec3.set(this._ident,0,0,0);this._onetimeCallbacks=[];this.maxTexSize=2048;this._viewPort=[0,0,1,1];this._viewPortStack=[];this.patch=e;this.autoReSize=true;this.DEPTH_COMPARE_FUNC_NEVER=0;this.DEPTH_COMPARE_FUNC_LESS=1;this.DEPTH_COMPARE_FUNC_EQUAL=2;this.DEPTH_COMPARE_FUNC_LESSEQUAL=3;this.DEPTH_COMPARE_FUNC_GREATER=4;this.DEPTH_COMPARE_FUNC_NOTEQUAL=5;this.DEPTH_COMPARE_FUNC_GREATEREQUAL=6;this.DEPTH_COMPARE_FUNC_ALWAYS=7;this.profileData=new R(this);this.pMatrix=L.mat4.create();this.mMatrix=L.mat4.create();this.vMatrix=L.mat4.create();L.mat4.identity(this.mMatrix);L.mat4.identity(this.vMatrix);window.matchMedia("screen and (min-resolution: 2dppx)").addEventListener("change",()=>{this.emitEvent("resize")})}get canvasWidth(){return this.width}get canvasHeight(){return this.height}get width(){return this.cgCanvas.canvasWidth}get height(){return this.cgCanvas.canvasHeight}get widthCss(){return this.cgCanvas.canvasWidth/this.pixelDensity}get heightCss(){return this.cgCanvas.canvasHeight/this.pixelDensity}set pixelDensity(e){if(this.cgCanvas.pixelDensity!=e){this.cgCanvas.pixelDensity=e;this.cgCanvas.updateSize();this.emitEvent("resize")}}get pixelDensity(){return this.cgCanvas.pixelDensity}getGApiName(){return["unknown","WebGL","WebGPU"][this.gApi]}get canvas(){return this.cgCanvas.canvasEle}get viewPort(){return[0,0,this.canvasWidth,this.canvasHeight]}setCanvas(e){if(this.cgCanvas&&e==this.cgCanvas.canvasEle)return;if(typeof e==="string")e=document.getElementById(e);this.cgCanvas=new Y({canvasEle:e,cg:this});if(!e)return;e.parentElement.classList.add("cablesContainer");if(this._setCanvas)this._setCanvas(e);this.updateSize()}_setCanvas(e){}updateSize(){this.cgCanvas.updateSize()}setSize(e,t,i=false){this.cgCanvas.setSize(e,t,i)}_resizeToWindowSize(){if(this.autoReSize){this.setSize(window.innerWidth,window.innerHeight);this.updateSize()}}_resizeToParentSize(){if(this.autoReSize){const e=this.canvas.parentElement;if(!e){this._log.error("cables: can not resize to container element");return}this.setSize(e.clientWidth,e.clientHeight);this.updateSize()}}setAutoResize(e){window.removeEventListener("resize",this._resizeToWindowSize.bind(this));window.removeEventListener("resize",this._resizeToParentSize.bind(this));if(e=="window"){window.addEventListener("resize",this._resizeToWindowSize.bind(this));window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this));this._resizeToWindowSize()}if(e=="parent"){window.addEventListener("resize",this._resizeToParentSize.bind(this));this._resizeToParentSize()}}pushPMatrix(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)}popPMatrix(){this.pMatrix=this._pMatrixStack.pop();return this.pMatrix}getProjectionMatrixStateCount(){return this._pMatrixStack.stateCounter}pushModelMatrix(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)}popModelMatrix(){this.mMatrix=this._mMatrixStack.pop();return this.mMatrix}modelMatrix(){return this.mMatrix}pushViewMatrix(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)}popViewMatrix(){this.vMatrix=this._vMatrixStack.pop()}getViewMatrixStateCount(){return this._vMatrixStack.stateCounter}_startMatrixStacks(e,t){e=e||this._ident;t=t||this._identView;L.mat4.perspective(this.pMatrix,45,this.canvasWidth/this.canvasHeight,.1,1e3);L.mat4.identity(this.mMatrix);L.mat4.identity(this.vMatrix);L.mat4.translate(this.mMatrix,this.mMatrix,e);L.mat4.translate(this.vMatrix,this.vMatrix,t);this.pushPMatrix();this.pushModelMatrix();this.pushViewMatrix()}_endMatrixStacks(){this.popViewMatrix();this.popModelMatrix();this.popPMatrix()}dispose(){this.aborted=true;if(this.cgCanvas)this.cgCanvas.dispose();if(this._dispose)this._dispose()}_dispose(){}shouldDrawHelpers(e){return false}addNextFrameOnceCallback(e){if(e&&this._onetimeCallbacks.indexOf(e)==-1)this._onetimeCallbacks.push(e)}_execOneTimeCallbacks(){if(this._onetimeCallbacks.length>0){for(let e=0;e<this._onetimeCallbacks.length;e++)this._onetimeCallbacks[e]();this._onetimeCallbacks.length=0}}checkTextureSize(e){e=e||1;e=Math.floor(e);e=Math.min(e,this.maxTexSize);e=Math.max(e,1);return e}screenShot(e,t,i,r){console.log("no screenshot function implemented")}saveScreenshot(i,r,e,t,s){this.patch.renderOneFrame();let n=this.canvas.clientWidth*this.pixelDensity;let a=this.canvas.clientHeight*this.pixelDensity;if(e){this.canvas.width=e;n=e}if(t){this.canvas.height=t;a=t}function o(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}const l=new Date;const h="".concat(String(l.getFullYear())+String(l.getMonth()+1)+String(l.getDate()),"_").concat(o(l.getHours(),2)).concat(o(l.getMinutes(),2)).concat(o(l.getSeconds(),2));if(!i)i="cables_"+h+".png";else i+=".png";this.screenShot(e=>{this.canvas.width=n;this.canvas.height=a;if(e){const t=document.createElement("a");t.download=i;t.href=URL.createObjectURL(e);console.log("scrrenshot");setTimeout(function(){t.click();if(r)r(e)},100)}else{this._log.log("screenshot: no blob")}})}hasFocus(){return this.cgCanvas.hasFocus}}const q={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};class Z extends P{#cursor="auto";constructor(e){super(e);this.gApi=P.API_WEBGL;this.aborted=false;this.pushMvMatrix=this.pushModelMatrix;this.popMvMatrix=this.popmMatrix=this.popModelMatrix;this._log=new u.Logger("cgl_context",{onError:e.config.onError});this.glVersion=0;this.glUseHalfFloatTex=false;this.clearCanvasTransparent=true;this.clearCanvasDepth=true;this.debugOneFrame=false;this.checkGlErrors=false;this.maxTextureUnits=0;this.maxVaryingVectors=0;this.currentProgram=null;this._hadStackError=false;this.glSlowRendere=false;this._isSafariCrap=false;this.temporaryTexture=null;this.gl=null;this.#cursor="auto";this._currentCursor="";this._viewPortStack=[];this._glFrameBufferStack=[];this._frameBufferStack=[];this._shaderStack=[];this._stackDepthTest=[];this.mainloopOp=null;this._stackBlendMode=[];this._stackBlendModePremul=[];this._stackBlend=[];this._stackDepthFunc=[];this._stackCullFaceFacing=[];this._stackCullFace=[];this._stackDepthWrite=[];this._stackDepthTest=[];this._stackStencil=[];this._simpleShader=new I(this,"simpleshader");this._simpleShader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);this._simpleShader.setSource(I.getDefaultVertexShader(),I.getDefaultFragmentShader());this._currentShader=this._simpleShader;this._oldCanvasWidth=-1;this._oldCanvasHeight=-1;this._enabledExtensions={};this.errorShader=null}get viewPort(){if(this._viewPortStack.length>3){const e=this._viewPortStack.length;return[this._viewPortStack[e-4],this._viewPortStack[e-3],this._viewPortStack[e-2],this._viewPortStack[e-1]]}else{return this._viewPort}}get mvMatrix(){return this.mMatrix}set mvMatrix(e){this.mMatrix=e}_setCanvas(e){if(!e)this._log.stack("_setCanvas undef");if(!this.patch.config.canvas)this.patch.config.canvas={};if(!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer"))this.patch.config.canvas.preserveDrawingBuffer=true;if(!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha"))this.patch.config.canvas.premultipliedAlpha=false;if(!this.patch.config.canvas.hasOwnProperty("alpha"))this.patch.config.canvas.alpha=false;this.patch.config.canvas.stencil=true;if(this.patch.config.hasOwnProperty("clearCanvasColor"))this.clearCanvasTransparent=this.patch.config.clearCanvasColor;if(this.patch.config.hasOwnProperty("clearCanvasDepth"))this.clearCanvasDepth=this.patch.config.clearCanvasDepth;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this._isSafariCrap=true;this.glUseHalfFloatTex=true}if(!this.patch.config.canvas.forceWebGl1)this.gl=e.getContext("webgl2",this.patch.config.canvas);if(!this.gl||this.gl.isContextLost()){this.aborted=true;this._log.error("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");return}if(this.gl.getParameter(this.gl.VERSION)!="WebGL 1.0"){this.glVersion=2}else{this.gl=e.getContext("webgl",this.patch.config.canvas)||e.getContext("experimental-webgl",this.patch.config.canvas);this.glVersion=1;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){if(!this.patch.config.canvas.hasOwnProperty("powerPreference"))this.patch.config.canvas.powerPreference="high-performance"}this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}const t=this.enableExtension("WEBGL_debug_renderer_info");if(t){this.glRenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL);if(this.glRenderer==="Google SwiftShader")this.glSlowRenderer=true}this.canvas.addEventListener("webglcontextlost",e=>{if(this.aborted)return this._log.warn("[cgl_state] aborted context lost... can be ignored...");this._log.error("canvas lost...",e);this.emitEvent("webglcontextlost");this.aborted=true});this.maxAnisotropic=0;if(this.enableExtension("EXT_texture_filter_anisotropic"))this.maxAnisotropic=this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxSamples=0;if(this.gl.MAX_SAMPLES)this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES);if(this.glVersion==1){this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}this.DEPTH_FUNCS=[this.gl.NEVER,this.gl.ALWAYS,this.gl.LESS,this.gl.LEQUAL,this.gl.GREATER,this.gl.GEQUAL,this.gl.EQUAL,this.gl.NOTEQUAL];this.CULL_MODES=[null,this.gl.BACK,this.gl.FRONT,this.gl.FRONT_AND_BACK]}getInfo(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}}popViewPort(){this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();if(this._viewPortStack.length==0)this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);else this.setViewPort(this._viewPortStack[this._viewPort.length-4],this._viewPortStack[this._viewPort.length-3],this._viewPortStack[this._viewPort.length-2],this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,r){this._viewPortStack.push(e,t,i,r);this.setViewPort(e,t,i,r)}getViewPort(){return this._viewPort}resetViewPort(){this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}setViewPort(e,t,i,r){this._viewPort[0]=Math.round(e);this._viewPort[1]=Math.round(t);this._viewPort[2]=Math.round(i);this._viewPort[3]=Math.round(r);this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}screenShot(t,e,i,r){if(e){this.gl.clearColor(1,1,1,1);this.gl.colorMask(false,false,false,true);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.colorMask(true,true,true,true)}if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,r)}}endFrame(){if(this.patch.isEditorMode())CABLES.GL_MARKER.drawMarkerLayer(this);this.setPreviousShader();if(this._vMatrixStack.length()>0)this.logStackError("view matrix stack length !=0 at end of rendering...");if(this._mMatrixStack.length()>0)this.logStackError("mvmatrix stack length !=0 at end of rendering...");if(this._pMatrixStack.length()>0)this.logStackError("pmatrix stack length !=0 at end of rendering...");if(this._glFrameBufferStack.length>0)this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");if(this._stackDepthTest.length>0)this.logStackError("depthtest stack length !=0 at end of rendering...");if(this._stackDepthWrite.length>0)this.logStackError("depthwrite stack length !=0 at end of rendering...");if(this._stackDepthFunc.length>0)this.logStackError("depthfunc stack length !=0 at end of rendering...");if(this._stackBlend.length>0)this.logStackError("blend stack length !=0 at end of rendering...");if(this._stackBlendMode.length>0)this.logStackError("blendMode stack length !=0 at end of rendering...");if(this._shaderStack.length>0)this.logStackError("this._shaderStack length !=0 at end of rendering...");if(this._stackCullFace.length>0)this.logStackError("this._stackCullFace length !=0 at end of rendering...");if(this._stackCullFaceFacing.length>0)this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");if(this._viewPortStack.length>0)this.logStackError("viewport stack length !=0 at end of rendering...");this._frameStarted=false;if(this._oldCanvasWidth!=this.canvasWidth||this._oldCanvasHeight!=this.canvasHeight){this._oldCanvasWidth=this.canvasWidth;this._oldCanvasHeight=this.canvasHeight;this.emitEvent(P.EVENT_RESIZE)}if(this.#cursor!=this._currentCursor){this._currentCursor=this.canvas.style.cursor=this.#cursor}this.emitEvent("endframe");this.fpsCounter.endFrame()}logStackError(e){if(!this._hadStackError){this._hadStackError=true;this._log.warn("["+this.canvas.id+"]: ",e)}}getShader(){if(this._currentShader)if(!this.tempData||this.tempData.renderOffscreen===true==this._currentShader.offScreenPass===true)return this._currentShader;for(let e=this._shaderStack.length-1;e>=0;e--)if(this._shaderStack[e])if(this.tempData.renderOffscreen==this._shaderStack[e].offScreenPass)return this._shaderStack[e]}getDefaultShader(){return this._simpleShader}setShader(e){this.pushShader(e)}pushShader(t){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){t=this.tempData.forceShaderMods[e].bind(t,false)}}this._shaderStack.push(t);this._currentShader=t}popShader(){this.setPreviousShader()}setPreviousShader(){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){this.tempData.forceShaderMods[e].unbind(false)}}if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop();this._currentShader=this._shaderStack[this._shaderStack.length-1]}pushGlFrameBuffer(e){this._glFrameBufferStack.push(e)}popGlFrameBuffer(){if(this._glFrameBufferStack.length==0)return null;this._glFrameBufferStack.pop();return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}getCurrentGlFrameBuffer(){if(this._glFrameBufferStack.length===0)return null;return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}pushFrameBuffer(e){this._frameBufferStack.push(e)}popFrameBuffer(){if(this._frameBufferStack.length==0)return null;this._frameBufferStack.pop();return this._frameBufferStack[this._frameBufferStack.length-1]}getCurrentFrameBuffer(){if(this._frameBufferStack.length===0)return null;return this._frameBufferStack[this._frameBufferStack.length-1]}renderStart(e,t,i){this.fpsCounter.startFrame();this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc(e.gl.LEQUAL);this.pushCullFaceFacing(e.gl.BACK);this.pushCullFace(false);e.setViewPort(0,0,e.canvasWidth,e.canvasHeight);this._startMatrixStacks(t,i);e.pushBlendMode(m.BLEND_MODES.BLEND_NORMAL,false);for(let e=0;e<this._textureslots.length;e++)this._textureslots[e]=null;this.pushShader(this._simpleShader);this._frameStarted=true;this._execOneTimeCallbacks();for(let e=0;e<this._textureslots.length;e++){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this._textureslots[e]=null}this.emitEvent("beginFrame")}renderEnd(e){this._endMatrixStacks();this.popDepthTest();this.popDepthWrite();this.popDepthFunc();this.popCullFaceFacing();this.popCullFace();this.popBlend();this.popBlendMode();e.endFrame();this.emitEvent("endFrame")}getTexture(e){return this._textureslots[e]}hasFrameStarted(){return this._frameStarted}checkFrameStarted(e){if(!this._frameStarted){this._log.warn("frame not started "+e);Error.stackTraceLimit=25;v.utils.logStack();this.patch.printTriggerStack()}}setTexture(e,t,i){this.checkFrameStarted("cgl setTexture");if(t===null)t=h.getEmptyTexture(this).tex;if(this._textureslots[e]!=t){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(i||this.gl.TEXTURE_2D,t);this._textureslots[e]=t}return true}fullScreen(){if(this.canvas.requestFullscreen)this.canvas.requestFullscreen();else if(this.canvas.mozRequestFullScreen)this.canvas.mozRequestFullScreen();else if(this.canvas.webkitRequestFullscreen)this.canvas.webkitRequestFullscreen();else if(this.canvas.msRequestFullscreen)this.canvas.msRequestFullscreen()}printError(t){if(!this.checkGlErrors)return;let i=false;let r=this.gl.getError();if(r!=this.gl.NO_ERROR){let e="";if(r==this.gl.OUT_OF_MEMORY)e="OUT_OF_MEMORY";if(r==this.gl.INVALID_ENUM)e="INVALID_ENUM";if(r==this.gl.INVALID_OPERATION)e="INVALID_OPERATION";if(r==this.gl.INVALID_FRAMEBUFFER_OPERATION)e="INVALID_FRAMEBUFFER_OPERATION";if(r==this.gl.INVALID_VALUE)e="INVALID_VALUE";if(r==this.gl.CONTEXT_LOST_WEBGL){this.aborted=true;e="CONTEXT_LOST_WEBGL"}if(r==this.gl.NO_ERROR)e="NO_ERROR";i=true;this._log.warn("gl error ["+this.canvas.id+"]: ",t,r,e);if(this.canvas.id.includes("glGuiCanvas"))if(!this._loggedGlError){this.patch.printTriggerStack();this._log.stack("glerror");this._loggedGlError=true}}r=this.gl.getError();return i}_dispose(){this._simpleShader.dispose();this.gl=null}pushDepthTest(e){this._stackDepthTest.push(e);if(!e)this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop();if(!this._stackDepthTest[this._stackDepthTest.length-1])this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e);this.gl.depthMask(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop();this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||false)}pushCullFace(e){this._stackCullFace.push(e);if(e)this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}stateCullFace(){return this._stackCullFace[this._stackCullFace.length-1]}popCullFace(){this._stackCullFace.pop();if(this._stackCullFace[this._stackCullFace.length-1])this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e);this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop();if(this._stackCullFaceFacing.length>0)this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}pushDepthFunc(e){this._stackDepthFunc.push(e);this.gl.depthFunc(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return false}popDepthFunc(){this._stackDepthFunc.pop();if(this._stackDepthFunc.length>0)this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])}pushBlend(e){this._stackBlend.push(e);if(!e)this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}popBlend(){this._stackBlend.pop();if(!this._stackBlend[this._stackBlend.length-1])this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}pushBlendMode(e,t){this._stackBlendMode.push(e);this._stackBlendModePremul.push(t);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==m.BLEND_MODES.BLEND_NONE);this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])}popBlendMode(){this._stackBlendMode.pop();this._stackBlendModePremul.pop();const e=this._stackBlendMode.length-1;this.popBlend();if(e>=0)this._setBlendMode(this._stackBlendMode[e],this._stackBlendModePremul[e])}pushStencil(e){this._stackStencil.push(e);if(!e)this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}popStencil(){this._stackStencil.pop();if(!this._stackStencil[this._stackStencil.length-1])this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}glGetAttribLocation(e,t){const i=this.gl.getAttribLocation(e,t);return i}shouldDrawHelpers(e){if(this.tempData.shadowPass)return false;if(!e.patch.isEditorMode())return false;return gui.shouldDrawOverlay}_setBlendMode(e,t){const i=this.gl;if(e==m.BLEND_MODES.BLEND_NONE){}else if(e==m.BLEND_MODES.BLEND_ADD){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.SRC_ALPHA,i.ONE)}}else if(e==m.BLEND_MODES.BLEND_SUB){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)}}else if(e==m.BLEND_MODES.BLEND_MUL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.SRC_COLOR)}}else if(e==m.BLEND_MODES.BLEND_NORMAL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}}else{this._log.log("setblendmode: unknown blendmode")}}createMesh(e,t){if(v.utils.isNumeric(t))t={glPrimitive:t};return new E(this,e,t)}setCursor(e){this.#cursor=e}enableExtension(e){if(!this.gl)return null;if(this._enabledExtensions.hasOwnProperty(e))return this._enabledExtensions[e];const t=this.gl.getExtension(e);this._enabledExtensions[e]=t;if(!t)this._log.warn("[cgl_state] extension not available "+e);return t}getErrorShader(){if(this.errorShader)return this.errorShader;this.errorShader=new I(this,"errormaterial");this.errorShader.setSource(I.getDefaultVertexShader(),I.getErrorFragmentShader());return this.errorShader}}const N={Framebuffer2:e,Geometry:A,BoundingBox:b,Marker:s,WirePoint:n,WireCube:o,MatrixStack:O,Mesh:E,MESH:T,ShaderLibMods:D,Shader:I,Uniform:c,MESHES:F,getWheelSpeed:H,getWheelDelta:W,Context:Z,Texture:h,TextureEffect:C,onLoadingAssetsFinished:j,ProfileData:R,UniColorShader:y,...m.BLEND_MODES,...m.SHADER,...m.MATH,...m.BLEND_MODES};window.CABLES=window.CABLES||{};window.CABLES.CGL=window.CABLES.CGL||N;window.CGL=window.CGL||N;v.Anim.slerpQuaternion=function(e,t,i,r,s,n){if(!v.Anim.slerpQuaternion.q1){v.Anim.slerpQuaternion.q1=quat.create();v.Anim.slerpQuaternion.q2=quat.create()}const a=i.getKeyIndex(e);let o=a+1;if(o>=i.keys.length)o=i.keys.length-1;if(a==o){quat.set(t,i.keys[a].value,r.keys[a].value,s.keys[a].value,n.keys[a].value)}else{const l=i.keys[a].time;const h=i.keys[o].time;const u=(e-l)/(h-l);quat.set(v.Anim.slerpQuaternion.q1,i.keys[a].value,r.keys[a].value,s.keys[a].value,n.keys[a].value);quat.set(v.Anim.slerpQuaternion.q2,i.keys[o].value,r.keys[o].value,s.keys[o].value,n.keys[o].value);quat.slerp(t,v.Anim.slerpQuaternion.q1,v.Anim.slerpQuaternion.q2,u)}return t};class Q{constructor(e,t,i){this.cgl=e;this._options=i;this.fb=null;let r=i.shader;this._useDefaultShader=true;if(i.shader)this._useDefaultShader=false;i.numRenderBuffers=i.numRenderBuffers||1;if(!r){r="".endl()+"IN vec2 texCoord;";for(let e=0;e<i.numRenderBuffers;e++){r=r.endl()+"UNI sampler2D tex"+e+";".endl()}r=r.endl()+"void main()".endl()+"{";if(i.numRenderBuffers==1){r=r.endl()+"    outColor= texture(tex0,texCoord);".endl()}else for(let e=0;e<i.numRenderBuffers;e++){r=r.endl()+"outColor"+e+" = texture(tex"+e+",texCoord);".endl()}r=r.endl()+"}"}const s=i.vertexShader||"".endl()+"IN vec3 vPosition;".endl()+"IN vec2 attrTexCoord;".endl()+"OUT vec2 texCoord;".endl()+"void main()".endl()+"{".endl()+"   texCoord=attrTexCoord;".endl()+"   gl_Position = vec4(vPosition,  1.0);".endl()+"}";this.bgShader=new N.Shader(e,"corelib copytexture "+t);this.bgShader.setSource(s,r);if(!i.vertexShader)this.bgShader.ignoreMissingUniforms=true;new N.Uniform(this.bgShader,"t","tex",0);new N.Uniform(this.bgShader,"t","tex1",1);new N.Uniform(this.bgShader,"t","tex2",2);new N.Uniform(this.bgShader,"t","tex3",3);this.mesh=N.MESHES.getSimpleRect(this.cgl,"texEffectRect")}setSize(e,t){this._options.width=e;this._options.height=t}copy(e,t,i,r,s){const n=this.cgl;if(!e)e=N.Texture.getEmptyTexture(this.cgl);let a=this._options.width||e.width,o=this._options.height||e.height;if(this.fb){if(a<=0)a=8;if(o<=0)o=8;if(this.fb.getWidth()!=a||this.fb.getHeight()!=o)this.fb.setSize(a,o)}else{let e=N.Texture.FILTER_LINEAR;let t=N.Texture.WRAP_CLAMP_TO_EDGE;if(this._options.isFloatingPointTexture)e=N.Texture.FILTER_NEAREST;if(this._options.hasOwnProperty("filter"))e=this._options.filter;if(this._options.hasOwnProperty("wrap"))t=this._options.wrap;const l={isFloatingPointTexture:this._options.isFloatingPointTexture,pixelFormat:this._options.pixelFormat,numRenderBuffers:this._options.numRenderBuffers||1,filter:e,wrap:t};if(n.glVersion==1)this.fb=new N.Framebuffer(n,a,o,l);else this.fb=new N.Framebuffer2(n,a,o,l)}n.tempData.renderOffscreen=true;this.fb.renderStart(n);n.setTexture(0,e.tex);if(t)n.setTexture(1,t.tex);if(i)n.setTexture(2,i.tex);if(r)n.setTexture(3,r.tex);if(s)n.setTexture(4,s.tex);n.pushShader(this.bgShader);this.mesh.render(this.bgShader);n.popShader();this.fb.renderEnd();n.tempData.renderOffscreen=false;return this.fb.getTextureColor()}dispose(){if(this.fb)this.fb.dispose();if(this.bgShader)this.bgShader.dispose();if(this.mesh)this.mesh.dispose()}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in J)e[t]=J[t];if(J.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var r={};(()=>{r.d=(e,t)=>{for(var i in t){if(r.o(t,i)&&!r.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{r.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";r.r(i);r.d(i,{VarGetOpWrapper:()=>t,VarSetOpWrapper:()=>e});const a=CABLES;class e{constructor(t,e,i,r,s,n){this._valuePort=i;this._varNamePort=r;this._op=t;this._type=e;this._typeId=-1;this._triggerPort=s;this._nextPort=n;this._var=null;this._btnCreate=t.inTriggerButton("Create new variable");this._btnCreate.setUiAttribs({hidePort:true});this._btnCreate.onTriggered=this._createVar.bind(this);this._helper=t.inUiTriggerButtons("",["Rename"]);this._helper.setUiAttribs({hidePort:true});this._helper.onTriggered=e=>{if(e=="Rename")CABLES.CMD.PATCH.renameVariable(t.varName.get())};this._op.setPortGroup("Variable",[this._helper,this._varNamePort,this._btnCreate]);r.setUiAttribs({_variableSelect:true});this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.patch.addEventListener("variablesChanged",this._updateName.bind(this));this._op.patch.addEventListener("variableRename",this._renameVar.bind(this));this._varNamePort.onChange=this._updateName.bind(this);this._isTexture=this._valuePort.uiAttribs.objType==="texture";this._valuePort.changeAlways=true;if(this._triggerPort){this._triggerPort.onTriggered=()=>{this._setVarValue(true)}}else{this._valuePort.onChange=this._setVarValue.bind(this)}this._op.init=()=>{this._updateName();if(!this._triggerPort)this._setVarValue();this._updateErrorUi()};if(e=="array")this._typeId=a.Port.TYPE_ARRAY;else if(e=="object")this._typeId=a.Port.TYPE_OBJECT;else if(e=="string")this._typeId=a.Port.TYPE_STRING;else if(e=="texture")this._typeId=a.Port.TYPE_TEXTURE;else this._typeId=a.Port.TYPE_VALUE}_updateErrorUi(){if(CABLES.UI){if(!this._varNamePort.get())this._op.setUiError("novarname","no variable selected");else{if(this._op.hasUiErrors)this._op.setUiError("novarname",null)}}}_updateName(){this._var=null;const e=this._varNamePort.get();this._op.setTitle("var set");this._op.setUiAttrib({extendTitle:"#"+e});this._updateErrorUi();const t=this._op.patch.getVar(e);if(t&&!t.type)t.type=this._type;if(!this._op.patch.hasVar(e)&&e!=0&&!this._triggerPort){this._setVarValue()}if(!this._op.patch.hasVar(e)&&e!=0&&this._triggerPort){if(this._type=="string")this._op.patch.setVarValue(e,"");else if(this._type=="number")this._op.patch.setVarValue(e,"");else this._op.patch.setVarValue(e,null)}if(this._op.isCurrentUiOp()){this._updateVarNamesDropdown();this._op.refreshParams()}this._updateDisplay();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varNamePort.get())}_createVar(){CABLES.CMD.PATCH.createVariable(this._op,this._type,()=>{this._updateName()})}_updateDisplay(){this._valuePort.setUiAttribs({greyout:!this._varNamePort.get()})}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded&&CABLES.UI.loaded){const e=gui.uiProfiler.start("[vars] _updateVarNamesDropdown");const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._varNamePort.uiAttribs.values=t;e.finish()}}_renameVar(e,t){if(e!=this._varNamePort.get())return;this._varNamePort.set(t);this._updateName()}_setVarValue(e){let t=this._valuePort.get();if(!this._var){const i=this._varNamePort.get();if(!i)return;if(this._typeId==a.Port.TYPE_VALUE&&typeof t=="string")t=parseFloat(t);this._op.patch.setVarValue(i,t,this._type);this._var=this._op.patch.getVar(i)}if(this._typeId==a.Port.TYPE_VALUE||this._typeId==a.Port.TYPE_STRING){this._var.setValue(t)}else if(this._typeId==a.Port.TYPE_ARRAY){this._arr=[];a.utils.copyArray(t,this._arr);this._var.setValue(this._arr)}else{if(this._typeId==a.Port.TYPE_OBJECT){if(this._isTexture)this._var.setValue(CGL.Texture.getEmptyTexture(this._op.patch.cgl));else this._var.setValue(null);if(t&&t.tex&&t._cgl&&!this._isTexture)this._op.setUiError("texobj","Dont use object variables for textures, use varSetTexture");else this._op.setUiError("texobj",null)}this._var.setValue(t)}if(e&&this._nextPort)this._nextPort.trigger()}}class t{constructor(e,t,i,r){this._op=e;this._type=t;this._varnamePort=i;this._variable=null;this._valueOutPort=r;this._listenerId=null;this._typeId=0;if(t=="array")this._typeId=a.Port.TYPE_ARRAY;else if(t=="object")this._typeId=a.Port.TYPE_OBJECT;else if(t=="texture")this._typeId=a.Port.TYPE_TEXTURE;else if(t=="string")this._typeId=a.Port.TYPE_STRING;else this._typeId=a.Port.TYPE_VALUE;if(r)this._isTexture=r.uiAttribs.objType==="texture";this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.on("uiErrorChange",this._updateTitle.bind(this));this._op.patch.on("variableRename",this._renameVar.bind(this));this._op.patch.on("variableDeleted",e=>{if(this._op.isCurrentUiOp())this._op.refreshParams()});i.setUiAttribs({_variableSelect:true});i.setUiAttribs({_variableSelectGet:true});this._varnamePort.onChange=this._changeVar.bind(this);this._op.patch.addEventListener("variablesChanged",this._init.bind(this));this._op.onDelete=()=>{if(this._variable&&this._listenerId)this._variable.off(this._listenerId)};this._op.init=()=>{this._init()}}get variable(){return this._variable}_changeVar(){if(this._variable&&this._listenerId){this._variable.off(this._listenerId)}this._init()}_renameVar(e,t){if(e!=this._varnamePort.get())return;this._varnamePort.set(t);this._updateVarNamesDropdown();this._updateTitle();this._listenerId=this._variable.on("change",this._setValueOut.bind(this))}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded){const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._op.varName.uiAttribs.values=t}}_setValueOut(e){if(this._valueOutPort)if(this._typeId==a.Port.TYPE_NUMBER||this._typeId==a.Port.TYPE_STRING)this._valueOutPort.set(e);else if(this._typeId==a.Port.TYPE_ARRAY||this._typeId==a.Port.TYPE_OBJECT||this._isTexture)this._valueOutPort.setRef(e);else console.log("unkown type?")}_updateTitle(){if(this._variable){this._op.setUiError("unknownvar",null);this._op.setTitle("var get");this._op.setUiAttrib({extendTitle:"#"+this._varnamePort.get()});if(this._valueOutPort)this._setValueOut(this._variable.getValue())}else{this._op.setUiError("unknownvar","unknown variable! - there is no setVariable with this name ("+this._varnamePort.get()+")");this._op.setUiAttrib({extendTitle:"#invalid"});if(this._valueOutPort)this._setValueOut(0)}}_init(){this._updateVarNamesDropdown();if(this._variable&&this._listenerId)this._variable.off(this._listenerId);this._variable=this._op.patch.getVar(this._op.varName.get());if(this._variable)this._listenerId=this._variable.on("change",this._setValueOut.bind(this));this._updateTitle();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varnamePort.get())}}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var r={};(()=>{r.d=(e,t)=>{for(var i in t){if(r.o(t,i)&&!r.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{r.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";r.r(i);r.d(i,{WireframeCube:()=>e,WireframeRect:()=>t});class e{constructor(e){this.cgl=e;this.geom=new CGL.Geometry("marker");this.geom.setPointVertices([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,1,1,-1,1,-1,1,1,-1,-1,1,1,1,-1,1,1,1,-1,1,-1,-1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1]);this.mesh=new CGL.Mesh(this.cgl,this.geom,this.cgl.gl.LINES);this.mesh.setGeom(this.geom);this.colorShader=new CGL.UniColorShader(this.cgl);this.colorShader.setColor([0,1,1,1]);this._vScale=vec3.create()}render(e,t,i){this.cgl.pushModelMatrix();this.cgl.pushShader(this.colorShader.shader);this.cgl.pushDepthTest(false);if(e==undefined)e=1;if(t==undefined)t=e;if(i==undefined)i=e;vec3.set(this._vScale,e,t,i);mat4.scale(this.cgl.mvMatrix,this.cgl.mvMatrix,this._vScale);this.mesh.render(this.cgl.getShader());this.cgl.popDepthTest();this.cgl.popShader();this.cgl.popModelMatrix()}}class t{constructor(e){this.cgl=e;this.geom=new CGL.Geometry("marker");const t=-1;const i=1;this.geom.setPointVertices([t,t,0,i,t,0,i,t,0,i,i,0,i,i,0,t,i,0,t,i,0,t,t,0]);this.mesh=new CGL.Mesh(this.cgl,this.geom,this.cgl.gl.LINES);this.mesh.setGeom(this.geom);this.colorShader=new CGL.UniColorShader(this.cgl);this.colorShader.setColor([0,1,1,1]);this._vScale=vec3.create()}render(e,t,i){this.cgl.pushModelMatrix();this.cgl.pushShader(this.colorShader.shader);this.cgl.pushDepthTest(false);vec3.set(this._vScale,e||1,t||e||1,i||e||1);mat4.scale(this.cgl.mvMatrix,this.cgl.mvMatrix,this._vScale);this.mesh.render(this.cgl.getShader());this.cgl.popDepthTest();this.cgl.popShader();this.cgl.popModelMatrix()}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var r={};(()=>{r.d=(e,t)=>{for(var i in t){if(r.o(t,i)&&!r.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{r.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";r.r(i);r.d(i,{PixelReader:()=>t});const e=CABLES.SHARED;class t{constructor(){this._log=new e.Logger("LoadingStatus");this.pixelData=null;this._finishedFence=true;this._size=0;this._pbo=null}_fence(n){const a=n.gl;this._finishedFence=false;return new Promise(function(t,i){if(n.aborted)return;let r=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)return;a.flush();function s(){if(n.aborted)return;const e=a.clientWaitSync(r,0,0);if(e==a.WAIT_FAILED){console.error("fence wait failed");if(i)i()}else if(e==a.TIMEOUT_EXPIRED){return setTimeout(s,0)}else if(e==a.CONDITION_SATISFIED){t();a.deleteSync(r)}else if(e==a.ALREADY_SIGNALED){t();a.deleteSync(r)}else{this._log.log("unknown fence status",e)}}s()})}read(i,r,e,s,n,a,o,t){if(CABLES.UI)if(!CABLES.UI.loaded||performance.now()-CABLES.UI.loadedTime<1e3)return;if(!this._finishedFence)return;const l=i.gl;let h=1;if(i.aborted)return;if(!r)return;if(e===CGL.Texture.TYPE_FLOAT)e=CGL.Texture.PFORMATSTR_RGBA32F;let u=CGL.Texture.isPixelFormatFloat(e);if(u)h=4;if(CGL.Texture.isPixelFormatHalfFloat(e))h=2;const c=CGL.Texture.setUpGlPixelFormat(i,e);const g=c.numColorChannels*a*o;if(a==0||o==0||g==0)return;if(!this._pixelData||this._size!=g*h){if(h>1)this._pixelData=new Float32Array(g);else this._pixelData=new Uint8Array(g);this._size=g*h}let f=l.UNSIGNED_BYTE;if(h>1)f=l.FLOAT;if(this._size==0||!this._pixelData){this._log.error("readpixel size 0",this._size,a,o);return}if(this._finishedFence){this._pbo=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);l.bufferData(l.PIXEL_PACK_BUFFER,this._pixelData.byteLength,l.DYNAMIC_READ);l.bindFramebuffer(l.FRAMEBUFFER,r);l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);i.profileData.profileFencedPixelRead++;if(this._size!=g*h)this._log.error("buffer size invalid",g,a,o,h);let e=c.glDataType;if(h>1)e=i.gl.FLOAT;let t=c.glDataFormat;l.readPixels(s,n,a,o,t,e,0);l.bindBuffer(l.PIXEL_PACK_BUFFER,null);l.bindFramebuffer(l.FRAMEBUFFER,null)}let d=this._pixelData.byteLength;if(this._finishedFence&&this._pbo)this._fence(i).then(e=>{this._wasTriggered=false;this._finishedFence=true;if(!e&&this._pixelData&&this._pixelData.byteLength==d){l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._pixelData);l.bindBuffer(l.PIXEL_PACK_BUFFER,null);if(t)t(this._pixelData)}l.deleteBuffer(this._pbo);this._pbo=null});return true}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var r={};(()=>{r.d=(e,t)=>{for(var i in t){if(r.o(t,i)&&!r.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{r.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";r.r(i);r.d(i,{SubPatchOp:()=>e});const t=CABLES;class e{constructor(i,e){e=e||{};this._op=i;i.patchId=i.addInPort(new t.Port(i,"patchId",t.CONSTANTS.OP.OP_PORT_TYPE_STRING,{display:"readonly",hidePort:true,hideParam:true}));i.setUiAttribs({subPatchOp:{version:2}});if(i.uiAttribs.parentOfSubpatch){i.patchId.set(i.uiAttribs.parentOfSubpatch)}else{if(e.subId)i.patchId.set(e.subId);else i.patchId.set(t.utils.generateUUID())}i.patchId.onChange=()=>{if(e.subId)i.patchId.value=e.subId};i.init=()=>{i.setStorage({subPatchVer:2})};i.loadDependencies=(e,t)=>{if(CABLES.UI){gui.serverOps.loadProjectDependencies(e,()=>{if(t)t()})}else if(t)t()};i.on("delete",()=>{if(i.patch.clearSubPatchCache)i.patch.clearSubPatchCache(this.patchId);const t=i.patch.ops;for(let e=t.length-1;e>=0;e--)if(t[e]&&t[e].uiAttribs&&t[e].uiAttribs.subPatch==i.patchId.get())i.patch.deleteOp(t[e].id)});this._op.isExposableSubpatchOp=()=>{return true}}get patchId(){return this._op.patchId.get()}}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();